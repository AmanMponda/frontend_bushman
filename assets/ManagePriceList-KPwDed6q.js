import{d as D,_ as B,a as L,g as V,w as n,b as a,i as p,e as s,t as d,h as _,F,q as x,x as I,o as c,m as b,y as N,l as U,A as z,B as j,C as E,D as R,s as S,v as q}from"./index-BOLhL9Zf.js";import{u as Q}from"./useForm-8rV_bshE.js";import{u as H}from"./useToast-DQfdZK_y.js";import{M as G}from"./ModuleTable-CHbQU7L4.js";import{u as Y}from"./payment-cards-D62C0YaC.js";import{f as W}from"./format-Cn4G_mmc.js";import{u as O}from"./price-list-store-D95PlDHx.js";import{h as Z}from"./errorHandler-BXe9Gc4p.js";import{v as J}from"./utils-BWc0LXoO.js";import{u as T}from"./quota-store-y69W85j6.js";import{u as $}from"./settings-store-CEOCrJYv.js";import{S as K}from"./SalesPackageForm-Xc2sTTJU.js";import{d as M}from"./pdfDownloader-DiRJnS-k.js";import"./regulatrory-store-BqCYuF_K.js";const X=D({components:{},props:{priceListItem:{type:Object,required:!0}},data(){return{cardStore:Y(),format:W}},computed:{loading(){return this.cardStore.loading},hasUpgradeFees(){var t;const e=new Map;return(t=this.priceListItem.trophy_fees)==null||t.forEach(i=>{const l=e.get(i.species_id)||0;e.set(i.species_id,l+1)}),Array.from(e.values()).some(i=>i>1)}},mounted(){this.cardStore.load()},methods:{formatChargesPer(e){return e?e.toLowerCase().replace("_"," "):""},formatAmount(e){return(typeof e=="string"?parseFloat(e):e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},getSequenceLabel(e){const t=["th","st","nd","rd"],i=e%100,l=t[(i-20)%10]||t[i]||t[0];return`${e}${l}`}}}),ee={key:1,class:"price-list-details"},te={class:"text-center"},se={class:"va-h3 mb-2"},ae={class:"flex justify-center items-center gap-4 mb-3"},oe={class:"text-lg text-secondary"},ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ne={class:"text-3xl font-bold"},re={class:"text-3xl font-bold"},le={class:"text-lg font-bold"},de={class:"text-lg font-bold"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},ue={class:"flex justify-between items-start"},pe={class:"flex-1"},me={class:"font-semibold text-base"},ge={class:"text-sm text-secondary italic"},ye={key:0},fe={class:"va-table-responsive"},he={class:"va-table va-table--hoverable w-full"},_e={class:"text-right"},be={class:"font-semibold"},ve={class:"text-secondary italic"},Ve={class:"text-center"},Le={class:"text-right font-bold text-lg"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Pe={class:"space-y-3"},we={key:0,class:"p-4 rounded-lg bg-gray-50"},Se={class:"flex justify-between items-start mb-2"},Ce={class:"text-right"},Ie={class:"font-bold text-lg"},Fe={class:"flex justify-between items-start mb-2"},Oe={class:"font-semibold text-base capitalize"},Te={class:"text-sm text-secondary"},Ae={class:"text-right"},xe={class:"font-bold text-lg"},$e={class:"text-xs text-secondary"},qe={class:"space-y-4"},De={key:0},Be={class:"flex justify-between items-center"},Me={class:"font-bold text-xl"},Ue={class:"flex items-center gap-2"},Qe={class:"flex items-center gap-2"};function He(e,t,i,l,u,r){const g=p("VaSkeleton"),y=p("VaSkeletonGroup"),m=p("VaIcon"),k=p("VaChip"),f=p("VaCardContent"),h=p("VaCard"),w=p("VaCardTitle"),C=p("VaBadge"),P=p("VaAlert");return e.cardStore.loading?(c(),L(y,{key:0},{default:n(()=>[a(g,{class:"mb-4",height:"160px",variant:"squared"}),a(g,{class:"mb-4",height:"160px",variant:"squared"}),a(g,{height:"360px",variant:"squared"})]),_:1})):(c(),V("div",ee,[a(h,{class:"mb-6",stripe:"","stripe-color":"primary"},{default:n(()=>[a(f,null,{default:n(()=>{var o,v,A;return[s("div",te,[s("h1",se,d(e.priceListItem.sales_package.name),1),s("div",ae,[a(k,{color:"primary",size:"large"},{default:n(()=>[a(m,{name:"calendar_month",class:"mr-1"}),_(" "+d(e.format(e.priceListItem.price_list_type.price_list.start_date,"MMM yyyy"))+" - "+d(e.format(e.priceListItem.price_list_type.price_list.end_date,"MMM yyyy")),1)]),_:1}),(o=e.priceListItem.price_list_type)!=null&&o.is_active?(c(),L(k,{key:0,color:"success",size:"large"},{default:n(()=>[a(m,{name:"check_circle",class:"mr-1"}),t[0]||(t[0]=_(" Active "))]),_:1})):(c(),L(k,{key:1,color:"danger",size:"large"},{default:n(()=>[a(m,{name:"cancel",class:"mr-1"}),t[1]||(t[1]=_(" Inactive "))]),_:1}))]),s("p",oe,[a(m,{name:"location_on",size:"small"}),_(" "+d((A=(v=e.priceListItem.sales_package)==null?void 0:v.area)==null?void 0:A.name)+" ("+d(e.priceListItem.sales_package.area.description)+") ",1)])])]}),_:1})]),_:1}),s("div",ie,[a(h,{stripe:"","stripe-color":"primary"},{default:n(()=>[a(f,{class:"text-center"},{default:n(()=>[a(m,{name:"attach_money",size:"large",color:"primary",class:"mb-2"}),s("div",ne,d(e.priceListItem.price_list_type.currency.symbol)+d(e.formatAmount(e.priceListItem.price_list_type.amount)),1),t[2]||(t[2]=s("div",{class:"text-sm text-secondary mt-1"},"Base Amount",-1))]),_:1})]),_:1}),a(h,{stripe:"","stripe-color":"success"},{default:n(()=>[a(f,{class:"text-center"},{default:n(()=>[a(m,{name:"schedule",size:"large",color:"success",class:"mb-2"}),s("div",re,d(e.priceListItem.price_list_type.duration),1),t[3]||(t[3]=s("div",{class:"text-sm text-secondary mt-1"},"Days Duration",-1))]),_:1})]),_:1}),a(h,{stripe:"","stripe-color":"warning"},{default:n(()=>[a(f,{class:"text-center"},{default:n(()=>{var o;return[a(m,{name:"verified",size:"large",color:"warning",class:"mb-2"}),s("div",le,d((o=e.priceListItem.sales_package.regulatory_package)==null?void 0:o.name),1),t[4]||(t[4]=s("div",{class:"text-sm text-secondary mt-1"},"License Type",-1))]}),_:1})]),_:1}),a(h,{stripe:"","stripe-color":"info"},{default:n(()=>[a(f,{class:"text-center"},{default:n(()=>[a(m,{name:"category",size:"large",color:"info",class:"mb-2"}),s("div",de,d(e.priceListItem.price_list_type.hunting_type.name),1),t[5]||(t[5]=s("div",{class:"text-sm text-secondary mt-1"},"Hunting Type",-1))]),_:1})]),_:1})]),a(h,{class:"mb-6",stripe:"","stripe-color":"success"},{default:n(()=>[a(w,{class:"flex items-center gap-2"},{default:n(()=>[a(m,{name:"pets"}),_(" Available Species ("+d(e.priceListItem.sales_package.species.length)+") ",1)]),_:1}),a(f,null,{default:n(()=>[s("div",ce,[(c(!0),V(F,null,x(e.priceListItem.sales_package.species,o=>(c(),L(h,{key:o.id,class:"species-card",color:o.quantity>0?"#f0f9ff":"#fef2f2"},{default:n(()=>[a(f,null,{default:n(()=>[s("div",ue,[s("div",pe,[s("div",me,d(o.species.name),1),s("div",ge,d(o.species.scientific_name),1)]),a(C,{color:o.quantity>0?"success":"danger",class:"ml-2"},{default:n(()=>[_(" Qty: "+d(o.quantity),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1032,["color"]))),128))])]),_:1})]),_:1}),a(h,{class:"mb-6",stripe:"","stripe-color":"warning"},{default:n(()=>[a(w,{class:"flex items-center gap-2"},{default:n(()=>[a(m,{name:"military_tech"}),_(" Trophy Fees ("+d(e.priceListItem.price_list_type.currency.name)+") ",1)]),_:1}),a(f,null,{default:n(()=>[e.priceListItem.trophy_fees&&e.priceListItem.trophy_fees.length>0?(c(),V("div",ye,[s("div",fe,[s("table",he,[s("thead",null,[s("tr",null,[t[6]||(t[6]=s("th",{class:"text-left"},"Species",-1)),t[7]||(t[7]=s("th",{class:"text-left"},"Scientific Name",-1)),t[8]||(t[8]=s("th",{class:"text-center"},"Sequence",-1)),s("th",_e,"Price ("+d(e.priceListItem.price_list_type.currency.symbol)+")",1)])]),s("tbody",null,[(c(!0),V(F,null,x(e.priceListItem.trophy_fees,o=>(c(),V("tr",{key:o.id},[s("td",be,d(o.species.name),1),s("td",ve,d(o.species.scientific_name),1),s("td",Ve,[a(C,{text:e.getSequenceLabel(o.sequence_order),color:"primary"},null,8,["text"])]),s("td",Le,d(e.priceListItem.price_list_type.currency.symbol)+d(e.formatAmount(o.price_usd)),1)]))),128))])])])])):(c(),L(P,{key:1,color:"info",border:"top"},{default:n(()=>t[9]||(t[9]=[_(" No trophy fees available for this package ")])),_:1}))]),_:1})]),_:1}),s("div",ke,[a(h,{stripe:"","stripe-color":"info"},{default:n(()=>[a(w,{class:"flex items-center gap-2"},{default:n(()=>[a(m,{name:"add_circle"}),t[10]||(t[10]=_(" Safari Extras "))]),_:1}),a(f,null,{default:n(()=>{var o;return[s("div",Pe,[e.priceListItem.observer&&e.priceListItem.observer.length>0?(c(),V("div",we,[s("div",Se,[t[12]||(t[12]=s("div",null,[s("div",{class:"font-semibold text-base"},"Observer"),s("div",{class:"text-sm text-secondary"},"Observer cost")],-1)),s("div",Ce,[s("div",Ie,d(e.priceListItem.price_list_type.currency.symbol)+d((o=e.priceListItem.observer[0])==null?void 0:o.amount),1),t[11]||(t[11]=s("div",{class:"text-xs text-secondary"},"per day / person",-1))])])])):I("",!0),(c(!0),V(F,null,x(e.priceListItem.safari_extras,v=>(c(),V("div",{key:v.id,class:"p-4 rounded-lg bg-gray-50"},[s("div",Fe,[s("div",null,[s("div",Oe,d(v.name),1),s("div",Te,d(v.description),1)]),s("div",Ae,[s("div",xe,d(v.currency.symbol)+d(v.amount),1),s("div",$e,d(e.formatChargesPer(v.charges_per)),1)])])]))),128))])]}),_:1})]),_:1}),a(h,{stripe:"","stripe-color":"success"},{default:n(()=>[a(w,{class:"flex items-center gap-2"},{default:n(()=>[a(m,{name:"groups"}),t[13]||(t[13]=_(" Companion & Observer Costs "))]),_:1}),a(f,null,{default:n(()=>[s("div",qe,[e.priceListItem.componions_hunter&&e.priceListItem.componions_hunter.length>0?(c(),V("div",De,[t[15]||(t[15]=s("div",{class:"text-sm font-semibold text-secondary mb-2"},"Companion Hunter",-1)),(c(!0),V(F,null,x(e.priceListItem.componions_hunter,o=>(c(),V("div",{key:o.id,class:"p-4 rounded-lg bg-green-50"},[s("div",Be,[t[14]||(t[14]=s("span",{class:"text-base"},"Daily Rate",-1)),s("span",Me,d(e.priceListItem.price_list_type.currency.symbol)+d(o.amount),1)])]))),128))])):I("",!0)])]),_:1})]),_:1})]),a(h,{class:"mb-6",stripe:"","stripe-color":"danger"},{default:n(()=>[a(f,null,{default:n(()=>[a(P,{color:"warning",border:"left",class:"mb-3"},{title:n(()=>[s("div",Ue,[a(m,{name:"warning"}),t[16]||(t[16]=s("span",{class:"font-bold"},"Important Information",-1))])]),default:n(()=>[t[17]||(t[17]=_(" All hunts confirmation is subject to quota availability. Other safari packages are available on request and can be customized depending on client requirements. "))]),_:1}),e.hasUpgradeFees?(c(),L(P,{key:0,color:"info",border:"left"},{title:n(()=>[s("div",Qe,[a(m,{name:"info"}),t[18]||(t[18]=s("span",{class:"font-bold"},"Upgrade Fees",-1))])]),default:n(()=>[t[19]||(t[19]=_(" If additional trophies beyond the standard package are taken, upgrade fees may apply (plus trophy fees). "))]),_:1})):I("",!0)]),_:1})]),_:1})]))}const Ne=B(X,[["render",He],["__scopeId","data-v-22b8f298"]]),ze=D({components:{SalesPackageForm:K,VaForm:R,VaInput:E,VaSelect:j,VaButton:z},setup(){const e=S(),{isValid:t,validate:i,resetValidation:l,reset:u}=Q(e),{init:r}=H(),g=S(!1),y=q({id:null,hunting_type_id:null,package:[],amount:null,currency:null,duration:null,season:null,end_date:null,species:null,quantity:null,companion_amount:null,observer_amount:null}),m=q({id:null,client_id:null,contact:"",contact_type:null,contactable:!1}),k=v=>{y.package=y.package.filter(A=>A!==v)},f=S([]),h=S([]),w=S([]),C=S([]),P=S([]),o=S(0);return{formRef:e,form:y,contactForm:m,showEditForm:g,countries:f,nationality:h,categoryOptions:w,contactsTypes:C,clients:P,step:o,init:r,isValidForm:t,validateForm:i,resetValidationForm:l,resetForm:u,deleteChip:k,validators:J}},data(){return{preferred_species:[],speciesOptions:[],speciesObjects:[],areasOptions:[],huntingTypesOptions:[],salesQuotasOptions:[],speciesItemOptions:[],currencyOptions:[],savingPriceList:!1,durationsOptions:[{value:1,text:"1 day"},{value:2,text:"2 days"},{value:3,text:"3 days"},{value:4,text:"4 days"},{value:5,text:"5 days"},{value:6,text:"6 days"},{value:7,text:"7 days"},{value:8,text:"8 days"},{value:9,text:"9 days"},{value:10,text:"10 days"},{value:11,text:"11 days"},{value:12,text:"12 days"},{value:13,text:"13 days"},{value:14,text:"14 days"},{value:15,text:"15 days"},{value:16,text:"16 days"},{value:17,text:"17 days"},{value:18,text:"18 days"},{value:19,text:"19 days"},{value:20,text:"20 days"},{value:21,text:"21 days"}],seasonsOptions:[]}},computed:{...U(O,["salesPackages","packageOptions","latestPackage","loadingpackages"]),...N(O,{_shM:"showModal"})},watch:{},mounted(){this.getAreas(),this.getHuntingTypes(),this.getQuotaList(),this.getCurrencyList(),this.getSalesPackages(),this.getSeasonList()},methods:{...b(T,["getSpeciesList"]),...b(T,["getAllSpeciesPerQuotaPerArea"]),...b(T,["getAreaList"]),...b($,["getHuntingsTypes"]),...b($,["getCurrencies","getSeasons"]),...b(T,["getQuotas"]),...b(O,["createPriceList"]),...b(O,["getSalesPackageList"]),onAreaChange(e){console.log(e)},async submit(){var t;this.savingPriceList=!0;const e={huntingTypeId:this.form.hunting_type_id.value,sales_package_ids:(t=this.form.package)==null?void 0:t.filter(i=>(i==null?void 0:i.value)!==void 0).map(i=>i==null?void 0:i.value),amount:this.form.amount,currency:this.form.currency.value,duration:this.form.duration.value,season_id:this.form.season.value.id,start_at:this.form.season.value.start_at,end_at:this.form.season.value.end_at,is_active:1,area_id:3,user_id:1,companionAmount:this.form.companion_amount,observerAmount:this.form.observer_amount};this.savingPriceList=!1;try{const i=await this.createPriceList(e);i.status===201?(this.init({message:i.data.message,color:"success"}),this.resetForm(),this.resetValidationForm(),this.speciesObjects=[],this.savingPriceList=!1):(console.log(i),this.savingPriceList=!1)}catch(i){this.savingPriceList=!1,Z(i.response),console.log(i),this.init({message:i.message,color:"danger"})}},async getSpeciesItems(){try{const e=await this.getSpeciesList();this.speciesOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getSeasonList(){try{const e=await this.getSeasons();this.seasonsOptions=e.data.map(t=>({value:t,text:t.name}))}catch(e){console.log(e)}},_showModal(){this._shM=!0},async getSalesPackages(){try{await this.getSalesPackageList(!0)}catch(e){console.log(e)}},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async getAreas(){try{const e=await this.getAreaList();this.areasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getHuntingTypes(){try{const e=await this.getHuntingsTypes();this.huntingTypesOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},onChangePackage(e){console.log(e.filter(t=>(t==null?void 0:t.value)!==void 0).map(t=>t==null?void 0:t.value))},async getQuotaList(){try{const e=await this.getQuotas(null);this.salesQuotasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getCurrencyList(){try{const e=await this.getCurrencies();this.currencyOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}}}}),je={class:"p-1"},Ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ye={class:"mt-4 d-flex p-2"};function We(e,t,i,l,u,r){const g=p("VaChip"),y=p("VaIcon"),m=p("VaSelect"),k=p("VaInput"),f=p("VaButton"),h=p("VaForm"),w=p("VaInnerLoading"),C=p("SalesPackageForm"),P=p("VaModal");return c(),V(F,null,[a(w,{loading:e.savingPriceList,size:60},{default:n(()=>[a(h,{ref:"formRef"},{default:n(()=>[s("div",je,[t[11]||(t[11]=s("h3",{class:"font-bold text-lg mb-2"},"Price list Infos",-1)),s("div",Ee,[a(m,{modelValue:e.form.package,"onUpdate:modelValue":[t[1]||(t[1]=o=>e.form.package=o),e.onChangePackage],options:e.packageOptions,multiple:"",clearable:"",placeholder:"Select Package list here",rules:[o=>o||"Package is required"],label:"Packages","required-mark":""},{content:n(({value:o})=>[(c(!0),V(F,null,x(o,v=>(c(),L(g,{key:v,size:"small",color:"info",class:"mr-1 my-1",closeable:"","onUpdate:modelValue":A=>e.deleteChip(v)},{default:n(()=>[_(d(v.text),1)]),_:2},1032,["onUpdate:modelValue"]))),128))]),append:n(()=>[a(y,{name:"add",class:"ml-2",onClick:t[0]||(t[0]=o=>e._showModal())})]),_:1},8,["modelValue","options","rules","onUpdate:modelValue"]),a(m,{modelValue:e.form.hunting_type_id,"onUpdate:modelValue":t[2]||(t[2]=o=>e.form.hunting_type_id=o),placeholder:"Select Hunting Type",label:"Hunting Type",rules:[o=>o||"Hunting type is required"],options:e.huntingTypesOptions,searchable:"","required-mark":"","highlight-matched-text":""},null,8,["modelValue","rules","options"]),a(m,{modelValue:e.form.season,"onUpdate:modelValue":t[3]||(t[3]=o=>e.form.season=o),options:e.seasonsOptions,"required-mark":"",label:"Select season",placeholder:"Select season"},null,8,["modelValue","options"])]),t[12]||(t[12]=s("h3",{class:"font-bold text-lg mb-2"},"Charges",-1)),s("div",Re,[a(k,{modelValue:e.form.amount,"onUpdate:modelValue":t[4]||(t[4]=o=>e.form.amount=o),type:"text",placeholder:"Enter Amount",rules:[o=>o&&o.length>0||"Amount is required"],label:"Amount","required-mark":""},null,8,["modelValue","rules"]),a(m,{modelValue:e.form.currency,"onUpdate:modelValue":t[5]||(t[5]=o=>e.form.currency=o),placeholder:"Select Currency",label:"Currency",rules:[o=>o||"Currency is required"],options:e.currencyOptions,searchable:"","highlight-matched-text":"","required-mark":""},null,8,["modelValue","rules","options"]),a(m,{modelValue:e.form.duration,"onUpdate:modelValue":t[6]||(t[6]=o=>e.form.duration=o),type:"text",options:e.durationsOptions,"required-mark":"",placeholder:"Enter Duration eg: 21 days",rules:[o=>o||"Duration is required"],label:"Duration(days)"},null,8,["modelValue","options","rules"])]),t[13]||(t[13]=s("h3",{class:"font-bold text-lg mb-2"},"Companion's and Observer's Charges(Optional)",-1)),s("div",Ge,[a(k,{modelValue:e.form.companion_amount,"onUpdate:modelValue":t[7]||(t[7]=o=>e.form.companion_amount=o),type:"text",placeholder:"Enter Companion Amount",label:"Companion Cost(Per Person)"},null,8,["modelValue"]),a(k,{modelValue:e.form.observer_amount,"onUpdate:modelValue":t[8]||(t[8]=o=>e.form.observer_amount=o),type:"text",placeholder:"Enter observer Amount",label:"Observer Cost(Per Person)"},null,8,["modelValue"])])]),s("div",Ye,[e.showEditForm?I("",!0):(c(),L(f,{key:0,icon:"save",class:"mr-3 mb-2",loading:e.savingPriceList,disabled:!e.isValidForm,onClick:t[9]||(t[9]=o=>e.validateForm()&&e.submit())},{default:n(()=>t[14]||(t[14]=[_(" Save ")])),_:1},8,["loading","disabled"]))])]),_:1},512)]),_:1},8,["loading"]),a(P,{modelValue:e._shM,"onUpdate:modelValue":t[10]||(t[10]=o=>e._shM=o),"ok-text":"Apply","close-button":"",size:"large","hide-default-actions":!0},{default:n(()=>[a(C)]),_:1},8,["modelValue"])],64)}const Ze=B(ze,[["render",We]]),Je={name:"",start_date:null,end_date:null},Ke=D({name:"QuotaPage",components:{ModuleTable:G,PricesListDetails:Ne,CreatePricesListForm:Ze},setup(){const e=S(null),t=S(null),i=[{key:"id",sortable:!0,sortingOptions:["desc","asc"]},{key:"package_name",sortable:!0},{key:"area",sortable:!0},{key:"hunting_type",sortable:!0},{key:"amount",sortable:!0},{key:"duration",sortable:!0,label:"Duration (Days)"},{key:"status",sortable:!0},{key:"actions",width:80}],{isValid:l,validate:u,resetValidation:r,reset:g}=Q(t);return{isValidSForm:l,validateSForm:u,resetValidationSForm:r,resetSForm:g,formRef:e,sformRef:t,columns:i}},data(){const e=[],t=[],i=q({id:null,name:"",scientific_name:""}),l=[];return{items:e,printableDataList:t,item:null,editedItemId:null,editedItem:null,createdItem:{...Je},toast:H(),sform:i,speciesOptions:[],areasOptions:[],huntingTypeOptions:[],speciesObjects:[],showModal:!1,quotasOptions:l,showPriceList:!0,ShowCreateNewPriceListForm:!1,loading:!1,currentQuota:null,quotaItems:[],excellFile:[],itemsByHuntingType:[],huntingTypeValue:null,areaValue:null,quotaValue:null,poriceListPdf:"",downloadPdf:M}},computed:{...U($,["logo"])},mounted(){this.getPriceLists(),this.getAreas(),this.getQuota(),this.getHuntingTypesOptions(),this.loadLogo()},methods:{...b(O,["getPriceList"]),...b(O,["getPriceListByHuntingType"]),...b(O,["getPriceListById"]),...b(T,["getQuotas"]),...b(T,["getAreaList"]),...b(T,["generateQuotaYear"]),...b($,["getHuntingsTypes"]),...b($,["loadLogo"]),async toggleShowPriceListMethod(e){console.log("=== Eye button clicked ==="),console.log("Row data received:",e),console.log("Current showPriceList:",this.showPriceList);const t=e==null?void 0:e.id;if(!t){console.error("No price list ID found in row data");return}try{console.log("Fetching price list detail for ID:",t);const i=await this.getPriceListById(t);this.item=i.data.data||i.data,console.log("Fetched price list detail:",this.item),this.showPriceList=!1,console.log("Switched to detail view")}catch(i){console.error("Error fetching price list detail:",i)}},async onDownloadPdf(){var l,u;const e=this.poriceListPdf;console.log("onDownloadPdf clicked, poriceListPdf length:",e?e.length:0);const t=r=>typeof r=="string"&&/^https?:\/\//i.test(r),i=r=>typeof r=="string"&&r.length>200&&/^[A-Za-z0-9+/=\r\n]+$/.test(r);if(!e||!t(e)&&!i(e)){try{(l=this.toast)==null||l.init({message:"PDF not available for this selection",color:"warning"})}catch{console.warn("PDF not available")}return}try{await M(e,`price-list-${Date.now()}.pdf`)}catch(r){try{(u=this.toast)==null||u.init({message:"Failed to download PDF",color:"danger"})}catch{console.error("Failed to download PDF",r)}}},goBack(){this.showPriceList=!this.showPriceList,this.ShowCreateNewPriceListForm=!1,this.getPriceLists()},showCreateNewPriceListFormMethod(){this.ShowCreateNewPriceListForm=!this.ShowCreateNewPriceListForm,this.showPriceList=!1},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async addNewSpecies(){},formatDate(e){const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${l}`},async getPriceLists(){this.loading=!0;try{const e=r=>r==null?"":typeof r=="object"&&"value"in r?r.value:r,t=e(this.huntingTypeValue)||"",i=e(this.areaValue)||"",l=e(this.quotaValue)||"";console.log("Filter params:",{huntingTypeId:t,areaId:i,quotaId:l}),console.log("huntingTypeValue:",this.huntingTypeValue),console.log("areaValue:",this.areaValue);const u=await this.getPriceList(t,i,l);if(console.log("API response:",u),console.log("Response data structure:",u==null?void 0:u.data),u.status===200){this.loading=!1;const r=u==null?void 0:u.data,g=Array.isArray(r)?r:(r==null?void 0:r.data)??[];console.log("Data array:",g),this.printableDataList=r,this.poriceListPdf=(r==null?void 0:r.pdf)||"",Array.isArray(g)?this.items=g.map(y=>({id:y.id,package_name:y.package_name,area:y.area,hunting_type:y.hunting_type,amount:y.amount,duration:y.duration,status:y.status})):(console.error("Data is not an array:",g),this.items=[]),console.log("Updated items:",this.items)}}catch(e){this.loading=!1,console.error("Error in getPriceLists:",e)}},async getPriceListByHuntingTypes(e){var t;try{const i=await this.getPriceListByHuntingType(e);this.itemsByHuntingType=(t=i==null?void 0:i.data)==null?void 0:t.map(l=>({id:l==null?void 0:l.id,item:l})),console.log(this.itemsByHuntingType)}catch(i){console.log(i)}},async getAreas(){var e;try{const t=await this.getAreaList(),i={value:"",text:"All"};this.areasOptions=(e=t==null?void 0:t.data)==null?void 0:e.map(l=>({value:l.id,text:l.name})),this.areasOptions.unshift(i),this.areaValue=this.areasOptions[0]}catch(t){console.log(t)}},async getQuota(){try{const e=await this.getQuotas(null);if(e.status===200){const t=e.data[0],i=this.generateQuotaYear(t.start_date,t.end_date);this.quotaValue={value:t.id,text:`${i} - ${t.name}`,name:t.name,start_date:t.start_date,end_date:t.end_date},this.currentQuota=t;const l={value:"",text:"All"};this.quotasOptions=e.data.map(u=>{const r=this.generateQuotaYear(u.start_date,u.end_date);return{value:u.id,text:`${r} - ${u.name}`,name:u.name,start_date:u.start_date,end_date:u.end_date}}),this.quotasOptions.unshift(l)}}catch(e){console.log(e)}},async getHuntingTypesOptions(){var t;const e=await this.getHuntingsTypes();if(e.status===200){const i={value:"",text:"All"};this.huntingTypeOptions=(t=e==null?void 0:e.data)==null?void 0:t.map(l=>({value:l.id,text:l.name})),this.huntingTypeOptions.unshift(i),this.huntingTypeValue=this.huntingTypeOptions[0]}}}}),Xe={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},et={class:"flex flex-col md:flex-row gap-2 justify-start"},tt={class:"grid sm:grid-cols-3 gap-6 mb-6"};function st(e,t,i,l,u,r){const g=p("VaButton"),y=p("VaButtonGroup"),m=p("VaDivider"),k=p("VaSelect"),f=p("ModuleTable"),h=p("PricesListDetails"),w=p("CreatePricesListForm"),C=p("VaCard");return c(),L(C,{class:"p-6"},{default:n(()=>[s("div",Xe,[s("div",et,[e.showPriceList?I("",!0):(c(),L(g,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e.goBack},{default:n(()=>t[2]||(t[2]=[_(" Go Back ")])),_:1},8,["onClick"]))]),e.ShowCreateNewPriceListForm?I("",!0):(c(),L(y,{key:0},{default:n(()=>[a(g,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add","border-color":"primary",round:"",preset:"secondary",size:"small",onClick:e.showCreateNewPriceListFormMethod},{default:n(()=>t[3]||(t[3]=[_(" Add a new Price List ")])),_:1},8,["onClick"])]),_:1}))]),a(m),e.ShowCreateNewPriceListForm?I("",!0):(c(),V(F,{key:0},[e.showPriceList?(c(),L(f,{key:0,items:e.items,columns:e.columns,loading:e.loading,onOnView:e.toggleShowPriceListMethod},{"filter-elements-and-download-btn":n(()=>[s("div",tt,[a(k,{modelValue:e.huntingTypeValue,"onUpdate:modelValue":[t[0]||(t[0]=P=>e.huntingTypeValue=P),e.getPriceLists],options:e.huntingTypeOptions,placeholder:"Filter By Hunting Type"},null,8,["modelValue","options","onUpdate:modelValue"]),a(k,{modelValue:e.areaValue,"onUpdate:modelValue":[t[1]||(t[1]=P=>e.areaValue=P),e.getPriceLists],options:e.areasOptions,placeholder:"Filter By Area"},null,8,["modelValue","options","onUpdate:modelValue"]),a(g,{class:"px-2 py-0",color:"primary",label:"Download",icon:"download",size:"small",onClick:e.onDownloadPdf},{default:n(()=>t[4]||(t[4]=[_(" Download ")])),_:1},8,["onClick"])])]),_:1},8,["items","columns","loading","onOnView"])):(c(),L(h,{key:1,"price-list-item":e.item},null,8,["price-list-item"]))],64)),e.ShowCreateNewPriceListForm?(c(),L(w,{key:1})):I("",!0)]),_:1})}const ht=B(Ke,[["render",st]]);export{ht as default};
//# sourceMappingURL=ManagePriceList-KPwDed6q.js.map
