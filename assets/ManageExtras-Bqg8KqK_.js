import{u as b}from"./settings-store-CCBWwQZx.js";import{u as R}from"./quota-store-Ch_FUFDF.js";import{d as q,m as k,l as N,k as V,s as T,B as U,_ as B,g as f,e as t,b as o,w as r,i as l,h as d,F as x,v as j,q as $,a as C,t as g,X as H,o as m}from"./index-CepPxMNg.js";import{u as I}from"./useForm-C2zo2Lif.js";import{u as z}from"./useToast-MdJILhkk.js";import{h as L}from"./errorHandler-DijQ3xmc.js";import"./format-Cn4G_mmc.js";const W=q({setup(){const{init:e}=z(),s=T(null),{isValid:c,validate:u,reset:y}=I(s),h=U({id:null,name:"",amount:null,currency_id:null,season_id:null,hunting_area_id:null,charges_per:null,description:""});return{init:e,formRef:s,isValid:c,validate:u,reset:y,form:h}},data(){return{columns:[{key:"name",label:"Service Name",sortable:!0},{key:"hunting_area",label:"Hunting Area",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"charges_per",label:"Charges Per",sortable:!0},{key:"description",label:"Description",sortable:!1},{key:"actions",label:"Actions",sortable:!1,width:100}],chargesPerOptions:[{value:"PER_DAY",text:"Per Day"},{value:"PER_PERSON",text:"Per Person"},{value:"PER_ROUND",text:"Per Round"}],seasonsOptions:[],currenciesOptions:[],areasOptions:[],allSeasons:[],allExtras:[],loadingSeasons:!1,showFormModal:!1,showDeleteModal:!1,editMode:!1,preselectedSeason:null,itemToDelete:null,deleting:!1}},computed:{...N(b,["loadingExtras","savingSafariExtra"]),seasonsWithExtras(){return this.allSeasons.map(e=>({...e,extras:this.allExtras.filter(s=>s.season_id===e.id)}))}},mounted(){this.loadData()},methods:{...k(b,["getSeasons","getCurrencies","createSafariExtras"]),...k(R,["getAreaList"]),async loadData(){await Promise.all([this.loadSeasons(),this.loadExtras(),this.loadCurrencies(),this.loadAreas()])},async loadSeasons(){this.loadingSeasons=!0;try{const e=await this.getSeasons();this.allSeasons=e.data||[],this.seasonsOptions=this.allSeasons.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Error loading seasons:",e)}finally{this.loadingSeasons=!1}},async loadExtras(){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/safari-extras-vset/";try{const s=await V.get(e);this.allExtras=s.data||[]}catch(s){console.error("Error loading extras:",s)}},async loadCurrencies(){try{const e=await this.getCurrencies();this.currenciesOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Error loading currencies:",e)}},async loadAreas(){try{const e=await this.getAreaList();this.areasOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Error loading areas:",e)}},formatChargesPer(e){return{PER_HOUR:"Per Hour",PER_DAY:"Per Day",PER_PERSON:"Per Person",PER_ROUND:"Per Round"}[e]||e},openAddModal(e){this.editMode=!1,this.preselectedSeason=e,this.resetForm(),e&&(this.form.season_id={value:e.id,text:e.name}),this.showFormModal=!0},openEditModal(e){this.editMode=!0,this.preselectedSeason=null,this.form.id=e.id,this.form.name=e.name,this.form.amount=e.amount,this.form.description=e.description||"",this.form.currency_id=e.currency?{value:e.currency.id,text:e.currency.name}:null,this.form.season_id=e.season?{value:e.season.id,text:e.season.name}:null,this.form.hunting_area_id=e.hunting_area?{value:e.hunting_area.id,text:e.hunting_area.name}:null,this.form.charges_per=this.chargesPerOptions.find(s=>s.value===e.charges_per)||null,this.showFormModal=!0},closeFormModal(){this.showFormModal=!1,this.resetForm()},resetForm(){this.form.id=null,this.form.name="",this.form.amount=null,this.form.currency_id=null,this.form.season_id=null,this.form.hunting_area_id=null,this.form.charges_per=null,this.form.description="",this.preselectedSeason=null},async submitForm(){var s,c,u,y;const e={name:this.form.name,amount:this.form.amount,currency_id:(s=this.form.currency_id)==null?void 0:s.value,season_id:(c=this.form.season_id)==null?void 0:c.value,hunting_area_id:(u=this.form.hunting_area_id)==null?void 0:u.value,charges_per:(y=this.form.charges_per)==null?void 0:y.value,description:this.form.description||""};try{this.editMode?await this.updateExtra(this.form.id,e):(await this.createSafariExtras(e)).status===201&&this.init({message:"Extra service created successfully",color:"success"}),await this.loadExtras(),this.closeFormModal()}catch(h){console.error(h);const n=L(h.response);this.init({message:n.join(", "),color:"danger"})}},async updateExtra(e,s){const c="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/safari-extras-vset/"+e+"/",u=await V.put(c,s);return u.status===200&&this.init({message:"Extra service updated successfully",color:"success"}),u},confirmDelete(e){this.itemToDelete=e,this.showDeleteModal=!0},async deleteExtra(){if(this.itemToDelete){this.deleting=!0;try{const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/safari-extras-vset/"+this.itemToDelete.id+"/";await V.delete(e),this.init({message:"Extra service deleted successfully",color:"success"}),await this.loadExtras(),this.showDeleteModal=!1,this.itemToDelete=null}catch(e){console.error(e),this.init({message:"Failed to delete extra service",color:"danger"})}finally{this.deleting=!1}}}}}),G={class:"safari-extras-page"},Y={class:"flex flex-col md:flex-row gap-2 mb-4 justify-between py-2"},Q={key:0,class:"flex justify-center py-8"},X={class:"flex items-center justify-between w-full pr-4"},J={class:"flex items-center gap-2"},K={class:"font-semibold"},Z={class:"pa-4"},ee={key:0,class:"text-center text-gray-500 py-4"},se={class:"flex gap-2"},ae={key:0,class:"text-center py-8 text-gray-500"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},le={class:"flex gap-2 justify-end"},ne={class:"flex gap-2 justify-end"};function ie(e,s,c,u,y,h){const n=l("VaButton"),w=l("VaButtonGroup"),M=l("VaProgressCircle"),P=l("VaIcon"),_=l("VaBadge"),D=l("VaDataTable"),A=l("VaCollapse"),E=l("VaInput"),v=l("VaSelect"),F=l("VaTextarea"),O=l("VaForm"),S=l("VaModal");return m(),f("div",G,[t("div",Y,[s[12]||(s[12]=t("div",{class:"flex flex-col md:flex-row gap-2 justify-start"},[t("h2",{class:"va-h5"},"Safari Extra Services by Season")],-1)),o(w,null,{default:r(()=>[o(n,{class:"px-2 py-2",color:"primary",round:"",present:"secondary","border-color":"primary",icon:"add",size:"small",onClick:s[0]||(s[0]=a=>e.openAddModal(null))},{default:r(()=>s[11]||(s[11]=[d(" Add Extra Service ")])),_:1})]),_:1})]),e.loadingExtras||e.loadingSeasons?(m(),f("div",Q,[o(M,{indeterminate:""})])):(m(),f(x,{key:1},[(m(!0),f(x,null,$(e.seasonsWithExtras,a=>(m(),C(A,{key:a.id,class:"mb-4",header:a.name,icon:"calendar_month",color:"primary"},{header:r(()=>[t("div",X,[t("div",J,[o(P,{name:"calendar_month",color:"primary"}),t("span",K,g(a.name),1),o(_,{text:String(a.extras.length),color:"info"},null,8,["text"])]),o(n,{preset:"plain",icon:"add_circle",color:"success",title:"Add extra to this season",onClick:H(i=>e.openAddModal(a),["stop"])},null,8,["onClick"])])]),default:r(()=>[t("div",Z,[a.extras.length===0?(m(),f("div",ee,[s[14]||(s[14]=d(" No extra services for this season. ")),o(n,{preset:"plain",onClick:i=>e.openAddModal(a)},{default:r(()=>s[13]||(s[13]=[d("Add one now")])),_:2},1032,["onClick"])])):(m(),C(D,{key:1,items:a.extras,columns:e.columns,hoverable:"",striped:""},{"cell(hunting_area)":r(({rowData:i})=>{var p;return[d(g(((p=i.hunting_area)==null?void 0:p.name)||"N/A"),1)]}),"cell(amount)":r(({rowData:i})=>{var p;return[d(g(((p=i.currency)==null?void 0:p.symbol)||"")+" "+g(i.amount),1)]}),"cell(charges_per)":r(({rowData:i})=>[o(_,{text:e.formatChargesPer(i.charges_per),color:"secondary"},null,8,["text"])]),"cell(actions)":r(({rowData:i})=>[t("div",se,[o(n,{preset:"plain",icon:"edit",color:"warning",title:"Edit",onClick:p=>e.openEditModal(i)},null,8,["onClick"]),o(n,{preset:"plain",icon:"delete",color:"danger",title:"Delete",onClick:p=>e.confirmDelete(i)},null,8,["onClick"])])]),_:2},1032,["items","columns"]))])]),_:2},1032,["header"]))),128)),e.seasonsWithExtras.length===0?(m(),f("div",ae," No seasons found. Please create seasons first in the settings. ")):j("",!0)],64)),o(S,{modelValue:e.showFormModal,"onUpdate:modelValue":s[8]||(s[8]=a=>e.showFormModal=a),title:e.editMode?"Edit Extra Service":"Add Extra Service",size:"medium","hide-default-actions":""},{footer:r(()=>[t("div",le,[o(n,{preset:"secondary",onClick:e.closeFormModal},{default:r(()=>s[15]||(s[15]=[d("Cancel")])),_:1},8,["onClick"]),o(n,{loading:e.savingSafariExtra,disabled:e.savingSafariExtra,onClick:e.submitForm},{default:r(()=>[d(g(e.editMode?"Update":"Save"),1)]),_:1},8,["loading","disabled","onClick"])])]),default:r(()=>[o(O,{ref:"formRef",class:"space-y-4"},{default:r(()=>[t("div",oe,[o(E,{modelValue:e.form.name,"onUpdate:modelValue":s[1]||(s[1]=a=>e.form.name=a),label:"Service Name",placeholder:"e.g., Ammunition, Trophy Handling",rules:[a=>!!a||"Service name is required"],"required-mark":""},null,8,["modelValue","rules"]),o(E,{modelValue:e.form.amount,"onUpdate:modelValue":s[2]||(s[2]=a=>e.form.amount=a),type:"number",label:"Amount",placeholder:"Enter amount",rules:[a=>!!a||"Amount is required"],"required-mark":""},null,8,["modelValue","rules"])]),t("div",re,[o(v,{modelValue:e.form.currency_id,"onUpdate:modelValue":s[3]||(s[3]=a=>e.form.currency_id=a),label:"Currency",placeholder:"Select currency",options:e.currenciesOptions,rules:[a=>!!a||"Currency is required"],"required-mark":""},null,8,["modelValue","options","rules"]),o(v,{modelValue:e.form.hunting_area_id,"onUpdate:modelValue":s[4]||(s[4]=a=>e.form.hunting_area_id=a),label:"Hunting Area",placeholder:"Select hunting area",options:e.areasOptions,rules:[a=>!!a||"Hunting area is required"],"required-mark":""},null,8,["modelValue","options","rules"])]),t("div",te,[o(v,{modelValue:e.form.season_id,"onUpdate:modelValue":s[5]||(s[5]=a=>e.form.season_id=a),label:"Season",placeholder:"Select season",options:e.seasonsOptions,rules:[a=>!!a||"Season is required"],"required-mark":"",disabled:!!e.preselectedSeason},null,8,["modelValue","options","rules","disabled"]),o(v,{modelValue:e.form.charges_per,"onUpdate:modelValue":s[6]||(s[6]=a=>e.form.charges_per=a),label:"Charges Per",placeholder:"Select charge type",options:e.chargesPerOptions,rules:[a=>!!a||"Charges per is required"],"required-mark":""},null,8,["modelValue","options","rules"])]),o(F,{modelValue:e.form.description,"onUpdate:modelValue":s[7]||(s[7]=a=>e.form.description=a),label:"Description (Optional)",placeholder:"Describe this extra service","min-rows":3},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue","title"]),o(S,{modelValue:e.showDeleteModal,"onUpdate:modelValue":s[10]||(s[10]=a=>e.showDeleteModal=a),title:"Confirm Delete",size:"small","hide-default-actions":""},{footer:r(()=>[t("div",ne,[o(n,{preset:"secondary",onClick:s[9]||(s[9]=a=>e.showDeleteModal=!1)},{default:r(()=>s[18]||(s[18]=[d("Cancel")])),_:1}),o(n,{color:"danger",loading:e.deleting,onClick:e.deleteExtra},{default:r(()=>s[19]||(s[19]=[d(" Delete ")])),_:1},8,["loading","onClick"])])]),default:r(()=>{var a;return[t("p",null,[s[16]||(s[16]=d(' Are you sure you want to delete "')),t("strong",null,g((a=e.itemToDelete)==null?void 0:a.name),1),s[17]||(s[17]=d('"? '))])]}),_:1},8,["modelValue"])])}const ge=B(W,[["render",ie],["__scopeId","data-v-ab622db4"]]);export{ge as default};
//# sourceMappingURL=ManageExtras-Bqg8KqK_.js.map
