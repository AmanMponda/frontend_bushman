{"version":3,"file":"SalesConfirmationProposals-B_wJYXcl.js","sources":["../../src/stores/proposal-store.ts","../../src/pages/client/dashboard/components/PipelineCard.vue","../../src/pages/client/dashboard/components/PipelineCard.vue","../../src/pages/client/dashboard/components/PipelineBoard.vue","../../src/pages/client/dashboard/components/PipelineBoard.vue","../../src/pages/client/dashboard/components/StageIndicator.vue","../../src/pages/client/dashboard/components/StageIndicator.vue","../../src/pages/client/dashboard/components/PaymentTable.vue","../../src/pages/client/dashboard/components/PaymentTable.vue","../../src/pages/client/dashboard/components/PaymentModal.vue","../../src/pages/client/dashboard/components/PaymentModal.vue","../../src/pages/client/dashboard/components/ProposalView.vue","../../src/pages/client/dashboard/components/ProposalView.vue","../../src/pages/client/dashboard/components/ProposalForm.vue","../../src/pages/client/dashboard/components/ProposalForm.vue","../../src/pages/client/dashboard/SalesConfirmationProposals.vue","../../src/pages/client/dashboard/SalesConfirmationProposals.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport axios from 'axios'\n\n// Pipeline item interface (for both inquiries and proposals in pipeline)\ninterface PipelineClient {\n  id: number\n  full_name: string\n  country: string\n  email: string\n  phone: string\n}\n\ninterface PipelineHuntingDetails {\n  season: string\n  areas: string\n  species: string\n  start_date: string\n  end_date: string\n  no_of_days: number\n  no_of_hunters: number\n}\n\ninterface PipelineSalesAgent {\n  id: number\n  name: string\n}\n\ninterface PipelineItem {\n  id: number\n  type: 'inquiry' | 'proposal'\n  stage: string\n  code: string\n  created_date: string\n  created_date_formatted: string\n  client: PipelineClient\n  hunting_details: PipelineHuntingDetails\n  proposal_id: number | null\n  confirmation_id: number | null\n  sales_agent: PipelineSalesAgent | null\n  total_amount: number | null\n  confirmation_date: string | null\n}\n\ninterface PipelineData {\n  new_inquiries: PipelineItem[]\n  pending: PipelineItem[]\n  provision_sales: PipelineItem[]\n  confirmed: PipelineItem[]\n  cancelled: PipelineItem[]\n  completed: PipelineItem[]\n}\n\ninterface PipelineCounts {\n  new_inquiries: number\n  pending: number\n  provision_sales: number\n  confirmed: number\n  cancelled: number\n  completed: number\n}\n\n// Payment installment interface\ninterface PaymentTransaction {\n  id: number\n  amount: number\n  payment_reference: string | null\n  paid_at: string\n  paid_by?: string | null\n}\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid: number\n  remaining_balance: number\n  payment_status: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at: string | null\n  payment_reference: string | null\n  paid_by?: string | null\n  due_days?: number | null\n  amount_due_type?: string | null\n  due_days_type?: string | null\n  payments: PaymentTransaction[]\n}\n\n// Payment status response interface\ninterface PaymentStatus {\n  proposal_id: number\n  current_stage: string\n  installments: Installment[]\n  summary: {\n    total_due: number\n    total_paid: number\n    total_unpaid: number\n    fully_paid_count: number\n    partial_paid_count: number\n    unpaid_count: number\n    paid_count?: number // deprecated, use fully_paid_count\n  }\n}\n\n// Payment response interface\ninterface PaymentResponse {\n  success: boolean\n  message: string\n  data: {\n    installment_id: number\n    narration: string\n    amount_due: number\n    amount_paid: number\n    remaining_balance: number\n    payment_status: 'paid' | 'partial' | 'unpaid'\n    paid_at: string\n    payment_reference: string\n    proposal_id: number\n    payments: PaymentTransaction[]\n  }\n  stage_changed: boolean\n  old_stage?: string\n  new_stage?: string\n}\n\ninterface Proposal {\n  id: number\n  confirmation_date: string\n  confirmation_date_formatted: string\n  hunting_license: string | null\n  remarks: string | null\n  status: string\n  sales_agent: {\n    id: number\n    name: string\n    email: string\n  }\n  client: {\n    id: number\n    full_name: string\n    nick_name: string | null\n    country: string\n    nationality: string\n    address: string\n    home_tel: string\n    work_tel: string | null\n    cell: string | null\n    email: string\n  }\n  hunting_trip: {\n    type: string\n    hunting_area: string\n    hunting_areas: Array<{\n      id: number\n      name: string\n      description: string\n      location: string\n    }>\n    outfitter: string\n    dates: string\n    start_date: string\n    end_date: string\n    no_of_days: number\n  }\n  trip_details: {\n    no_of_hunters: number\n    no_of_observers: number\n    no_of_companions: number\n    special_requests: string | null\n    prev_experience: string | null\n  }\n  hunt_combination: Array<{\n    id: number\n    species_id: number\n    species_name: string\n    scientific_name: string\n    quantity: number\n  }>\n  pricing: {\n    currency: string\n    total_amount: number\n    installments: Array<{\n      id: number\n      narration: string\n      amount_due: number\n      due_days: number | null\n      amount_due_type: string | null\n      due_days_type: string | null\n      is_paid?: boolean\n      paid_at?: string | null\n      amount_paid?: number | null\n      payment_reference?: string | null\n    }>\n  }\n  sales_inquiry: {\n    id: number\n    code: string\n    created_date: string\n    season: string\n  }\n  regulatory_package: any\n  created_date: string\n  updated_date: string\n}\n\ninterface ProposalState {\n  proposals: Proposal[]\n  currentProposal: Proposal | null\n  pipeline: PipelineData\n  pipelineCounts: PipelineCounts\n  pipelineTotal: number\n  paymentStatus: PaymentStatus | null\n  loading: boolean\n  saving: boolean\n  error: string | null\n}\n\nexport const useProposalStore = defineStore('proposals', {\n  state: (): ProposalState => ({\n    proposals: [],\n    currentProposal: null,\n    pipeline: {\n      new_inquiries: [],\n      pending: [],\n      provision_sales: [],\n      confirmed: [],\n      cancelled: [],\n      completed: [],\n    },\n    pipelineCounts: {\n      new_inquiries: 0,\n      pending: 0,\n      provision_sales: 0,\n      confirmed: 0,\n      cancelled: 0,\n      completed: 0,\n    },\n    pipelineTotal: 0,\n    paymentStatus: null,\n    loading: false,\n    saving: false,\n    error: null,\n  }),\n\n  getters: {\n    getProposalById: (state) => (id: number) => {\n      return state.proposals.find((p) => p.id === id)\n    },\n\n    pendingProposals: (state) => {\n      return state.proposals.filter((p) => p.status === 'pending')\n    },\n\n    confirmedProposals: (state) => {\n      return state.proposals.filter((p) => p.status === 'confirmed')\n    },\n\n    // Pipeline getters\n    newInquiries: (state) => state.pipeline.new_inquiries,\n    pendingItems: (state) => state.pipeline.pending,\n    provisionSalesItems: (state) => state.pipeline.provision_sales,\n    confirmedItems: (state) => state.pipeline.confirmed,\n    cancelledItems: (state) => state.pipeline.cancelled,\n    completedItems: (state) => state.pipeline.completed,\n  },\n\n  actions: {\n    // Pipeline Actions\n    async fetchPipeline(stage?: string, seasonId?: number) {\n      this.loading = true\n      this.error = null\n\n      try {\n        let url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/pipeline`\n        const params = new URLSearchParams()\n        if (stage) params.append('stage', stage)\n        if (seasonId) params.append('season_id', String(seasonId))\n        if (params.toString()) url += `?${params.toString()}`\n\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.pipeline = response.data.data\n          this.pipelineCounts = response.data.counts\n          this.pipelineTotal = response.data.total\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch pipeline'\n        console.error('Error fetching pipeline:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async updatePipelineStage(inquiryId: number, newStage: string) {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/pipeline/${inquiryId}/stage`\n        const response = await axios.put(url, { stage: newStage })\n\n        if (response.data.success) {\n          // Refresh pipeline after stage update\n          await this.fetchPipeline()\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to update stage'\n        console.error('Error updating pipeline stage:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async fetchProposals() {\n      this.loading = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.proposals = response.data.data\n        } else {\n          this.proposals = Array.isArray(response.data) ? response.data : []\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch proposals'\n        console.error('Error fetching proposals:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async fetchProposalById(id: number) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${id}`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.currentProposal = response.data.data\n        } else {\n          this.currentProposal = response.data\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch proposal'\n        console.error('Error fetching proposal:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async createProposal(payload: {\n      sales_inquiry_id: number\n      regulatory_package_id?: number | null\n      confirmation_date?: string\n      remarks?: string\n      hunting_license?: string\n      installments?: Array<{\n        narration: string\n        amount_due: number\n        due_days?: number\n        amount_due_type?: string\n        due_days_type?: string\n      }>\n    }) {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals`\n        const response = await axios.post(url, payload)\n\n        if (response.data.success && response.data.data) {\n          this.proposals.push(response.data.data)\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to create proposal'\n        console.error('Error creating proposal:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async updateProposal(\n      id: number,\n      payload: {\n        regulatory_package_id?: number | null\n        confirmation_date?: string\n        remarks?: string\n        hunting_license?: string\n        status?: string\n        installments?: Array<{\n          narration: string\n          amount_due: number\n          due_days?: number\n          amount_due_type?: string\n          due_days_type?: string\n        }>\n      },\n    ) {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${id}`\n        const response = await axios.put(url, payload)\n\n        if (response.data.success && response.data.data) {\n          // Update the proposal in the list\n          const index = this.proposals.findIndex((p) => p.id === id)\n          if (index !== -1) {\n            this.proposals[index] = response.data.data\n          }\n          // Also update currentProposal if it matches\n          if (this.currentProposal?.id === id) {\n            this.currentProposal = response.data.data\n          }\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to update proposal'\n        console.error('Error updating proposal:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async updateProposalStatus(id: number, status: string) {\n      return this.updateProposal(id, { status })\n    },\n\n    // Payment Actions\n    async fetchPayments(proposalId: number) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${proposalId}/payments`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.paymentStatus = response.data.data\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch payments'\n        console.error('Error fetching payments:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async recordPayment(\n      installmentId: number,\n      payload: {\n        amount_paid: number\n        payment_reference?: string\n        paid_at?: string\n      },\n    ): Promise<PaymentResponse> {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/installments/${installmentId}/pay`\n        const response = await axios.post(url, payload)\n\n        // If payment recorded successfully and we have paymentStatus, refresh it\n        if (response.data.success && this.paymentStatus) {\n          await this.fetchPayments(this.paymentStatus.proposal_id)\n        }\n\n        // Also refresh current proposal if present\n        if (response.data.success && this.currentProposal) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n\n        return response.data as PaymentResponse\n      } catch (error: any) {\n        this.error = error.message || 'Failed to record payment'\n        console.error('Error recording payment:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async unpayInstallment(installmentId: number): Promise<PaymentResponse> {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/installments/${installmentId}/unpay`\n        const response = await axios.post(url)\n\n        // If unpaid successfully and we have paymentStatus, refresh it\n        if (response.data.success && this.paymentStatus) {\n          await this.fetchPayments(this.paymentStatus.proposal_id)\n        }\n\n        // Also refresh current proposal if present\n        if (response.data.success && this.currentProposal) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n\n        return response.data as PaymentResponse\n      } catch (error: any) {\n        this.error = error.message || 'Failed to reverse payment'\n        console.error('Error reversing payment:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async deletePayment(paymentId: number): Promise<{ success: boolean; message: string }> {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/payments/${paymentId}`\n        const response = await axios.delete(url)\n\n        // If deleted successfully and we have paymentStatus, refresh it\n        if (response.data.success && this.paymentStatus) {\n          await this.fetchPayments(this.paymentStatus.proposal_id)\n        }\n\n        // Also refresh current proposal if present\n        if (response.data.success && this.currentProposal) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n\n        return response.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to delete payment'\n        console.error('Error deleting payment:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    clearPaymentStatus() {\n      this.paymentStatus = null\n    },\n\n    clearCurrentProposal() {\n      this.currentProposal = null\n      this.paymentStatus = null\n    },\n\n    clearError() {\n      this.error = null\n    },\n  },\n})\n","<template>\n  <div class=\"pipeline-card\" :class=\"{ 'is-new': item.type === 'inquiry' }\" @click=\"handleClick\">\n    <!-- Header -->\n    <div class=\"card-header\">\n      <span class=\"inquiry-code\">{{ item.code }}</span>\n      <VaChip v-if=\"item.type === 'proposal'\" size=\"small\" color=\"primary\"> Quotation </VaChip>\n    </div>\n\n    <!-- Client Info -->\n    <div class=\"client-info\">\n      <h4 class=\"client-name\">{{ item.client?.full_name || 'Unknown Client' }}</h4>\n      <p class=\"client-meta\">\n        {{ item.client?.country || 'N/A' }} • {{ item.created_date_formatted || item.created_date }}\n      </p>\n    </div>\n\n    <!-- Hunting Details -->\n    <div class=\"hunting-details\">\n      <div class=\"detail-row\">\n        <VaIcon name=\"pets\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text truncate\">{{ truncateSpecies(item.hunting_details?.species) }}</span>\n      </div>\n      <div class=\"detail-row\">\n        <VaIcon name=\"location_on\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text\">{{ item.hunting_details?.areas || 'N/A' }}</span>\n      </div>\n      <div class=\"detail-row\">\n        <VaIcon name=\"calendar_today\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text\">{{ formatDateRange }}</span>\n      </div>\n      <div v-if=\"item.type === 'proposal' && item.total_amount\" class=\"detail-row amount-row\">\n        <VaIcon name=\"payments\" size=\"small\" color=\"success\" />\n        <span class=\"detail-text amount\">{{ formatCurrency(item.total_amount) }}</span>\n      </div>\n      <div v-else class=\"detail-row\">\n        <VaIcon name=\"person\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text\">{{ item.hunting_details?.no_of_hunters || 0 }} hunter(s)</span>\n      </div>\n    </div>\n\n    <!-- Sales Agent (for proposals) -->\n    <div v-if=\"item.sales_agent\" class=\"agent-info\">\n      <VaIcon name=\"support_agent\" size=\"small\" color=\"info\" />\n      <span class=\"agent-name\">{{ item.sales_agent.name }}</span>\n    </div>\n\n    <!-- Actions -->\n    <div class=\"card-actions\">\n      <template v-if=\"item.type === 'inquiry'\">\n        <VaButton size=\"small\" color=\"primary\" block @click.stop=\"$emit('create-proposal', item)\">\n          Create Quotation\n        </VaButton>\n      </template>\n      <template v-else>\n        <VaButton size=\"small\" preset=\"secondary\" @click.stop=\"$emit('view', item)\"> View </VaButton>\n        <VaButton size=\"small\" preset=\"plain\" color=\"info\" @click.stop=\"$emit('edit', item)\"> Edit </VaButton>\n      </template>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface PipelineItem {\n  id: number\n  type: 'inquiry' | 'proposal'\n  stage: string\n  code: string\n  created_date: string\n  created_date_formatted?: string\n  client?: {\n    id?: number\n    full_name: string\n    country: string\n    email?: string\n    phone?: string\n  }\n  hunting_details?: {\n    season?: string\n    areas: string\n    species?: string\n    start_date?: string\n    end_date?: string\n    no_of_days?: number\n    no_of_hunters?: number\n  }\n  proposal_id?: number | null\n  confirmation_id?: number | null\n  sales_agent?: {\n    id: number\n    name: string\n  } | null\n  total_amount?: number | null\n}\n\nexport default defineComponent({\n  name: 'PipelineCard',\n  props: {\n    item: {\n      type: Object as PropType<PipelineItem>,\n      required: true,\n    },\n  },\n  emits: ['click', 'create-proposal', 'view', 'edit'],\n  computed: {\n    formatDateRange(): string {\n      const details = this.item.hunting_details\n      if (!details?.start_date) return 'N/A'\n\n      const formatDate = (dateStr: string) => {\n        try {\n          const date = new Date(dateStr)\n          return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n        } catch {\n          return dateStr\n        }\n      }\n\n      const start = formatDate(details.start_date)\n      const end = details.end_date ? formatDate(details.end_date) : ''\n      const days = details.no_of_days ? ` (${details.no_of_days}d)` : ''\n\n      return end ? `${start} - ${end}${days}` : `${start}${days}`\n    },\n  },\n  methods: {\n    handleClick() {\n      this.$emit('click', this.item)\n    },\n\n    truncateSpecies(species: string | undefined): string {\n      if (!species) return 'N/A'\n      if (species.length > 30) {\n        return species.substring(0, 30) + '...'\n      }\n      return species\n    },\n\n    formatCurrency(amount: number | null | undefined): string {\n      if (!amount) return '$0'\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.pipeline-card {\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  padding: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.pipeline-card:hover {\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  transform: translateY(-2px);\n}\n\n.pipeline-card.is-new {\n  border-left: 3px solid var(--va-warning);\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.inquiry-code {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #6b7280;\n  font-family: monospace;\n}\n\n.client-info {\n  margin-bottom: 12px;\n}\n\n.client-name {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin: 0 0 4px 0;\n  line-height: 1.3;\n}\n\n.client-meta {\n  font-size: 0.75rem;\n  color: #9ca3af;\n  margin: 0;\n}\n\n.hunting-details {\n  background: #f9fafb;\n  border-radius: 6px;\n  padding: 8px;\n  margin-bottom: 12px;\n}\n\n.detail-row {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-bottom: 4px;\n}\n\n.detail-row:last-child {\n  margin-bottom: 0;\n}\n\n.detail-text {\n  font-size: 0.8rem;\n  color: #4b5563;\n}\n\n.detail-text.truncate {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 180px;\n}\n\n.amount-row .amount {\n  font-weight: 600;\n  color: var(--va-success);\n}\n\n.agent-info {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 8px;\n  background: #eff6ff;\n  border-radius: 4px;\n  margin-bottom: 12px;\n}\n\n.agent-name {\n  font-size: 0.75rem;\n  color: #3b82f6;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.card-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.card-actions :deep(.va-button) {\n  flex: 1;\n}\n</style>\n","<template>\n  <div class=\"pipeline-card\" :class=\"{ 'is-new': item.type === 'inquiry' }\" @click=\"handleClick\">\n    <!-- Header -->\n    <div class=\"card-header\">\n      <span class=\"inquiry-code\">{{ item.code }}</span>\n      <VaChip v-if=\"item.type === 'proposal'\" size=\"small\" color=\"primary\"> Quotation </VaChip>\n    </div>\n\n    <!-- Client Info -->\n    <div class=\"client-info\">\n      <h4 class=\"client-name\">{{ item.client?.full_name || 'Unknown Client' }}</h4>\n      <p class=\"client-meta\">\n        {{ item.client?.country || 'N/A' }} • {{ item.created_date_formatted || item.created_date }}\n      </p>\n    </div>\n\n    <!-- Hunting Details -->\n    <div class=\"hunting-details\">\n      <div class=\"detail-row\">\n        <VaIcon name=\"pets\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text truncate\">{{ truncateSpecies(item.hunting_details?.species) }}</span>\n      </div>\n      <div class=\"detail-row\">\n        <VaIcon name=\"location_on\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text\">{{ item.hunting_details?.areas || 'N/A' }}</span>\n      </div>\n      <div class=\"detail-row\">\n        <VaIcon name=\"calendar_today\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text\">{{ formatDateRange }}</span>\n      </div>\n      <div v-if=\"item.type === 'proposal' && item.total_amount\" class=\"detail-row amount-row\">\n        <VaIcon name=\"payments\" size=\"small\" color=\"success\" />\n        <span class=\"detail-text amount\">{{ formatCurrency(item.total_amount) }}</span>\n      </div>\n      <div v-else class=\"detail-row\">\n        <VaIcon name=\"person\" size=\"small\" color=\"secondary\" />\n        <span class=\"detail-text\">{{ item.hunting_details?.no_of_hunters || 0 }} hunter(s)</span>\n      </div>\n    </div>\n\n    <!-- Sales Agent (for proposals) -->\n    <div v-if=\"item.sales_agent\" class=\"agent-info\">\n      <VaIcon name=\"support_agent\" size=\"small\" color=\"info\" />\n      <span class=\"agent-name\">{{ item.sales_agent.name }}</span>\n    </div>\n\n    <!-- Actions -->\n    <div class=\"card-actions\">\n      <template v-if=\"item.type === 'inquiry'\">\n        <VaButton size=\"small\" color=\"primary\" block @click.stop=\"$emit('create-proposal', item)\">\n          Create Quotation\n        </VaButton>\n      </template>\n      <template v-else>\n        <VaButton size=\"small\" preset=\"secondary\" @click.stop=\"$emit('view', item)\"> View </VaButton>\n        <VaButton size=\"small\" preset=\"plain\" color=\"info\" @click.stop=\"$emit('edit', item)\"> Edit </VaButton>\n      </template>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface PipelineItem {\n  id: number\n  type: 'inquiry' | 'proposal'\n  stage: string\n  code: string\n  created_date: string\n  created_date_formatted?: string\n  client?: {\n    id?: number\n    full_name: string\n    country: string\n    email?: string\n    phone?: string\n  }\n  hunting_details?: {\n    season?: string\n    areas: string\n    species?: string\n    start_date?: string\n    end_date?: string\n    no_of_days?: number\n    no_of_hunters?: number\n  }\n  proposal_id?: number | null\n  confirmation_id?: number | null\n  sales_agent?: {\n    id: number\n    name: string\n  } | null\n  total_amount?: number | null\n}\n\nexport default defineComponent({\n  name: 'PipelineCard',\n  props: {\n    item: {\n      type: Object as PropType<PipelineItem>,\n      required: true,\n    },\n  },\n  emits: ['click', 'create-proposal', 'view', 'edit'],\n  computed: {\n    formatDateRange(): string {\n      const details = this.item.hunting_details\n      if (!details?.start_date) return 'N/A'\n\n      const formatDate = (dateStr: string) => {\n        try {\n          const date = new Date(dateStr)\n          return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n        } catch {\n          return dateStr\n        }\n      }\n\n      const start = formatDate(details.start_date)\n      const end = details.end_date ? formatDate(details.end_date) : ''\n      const days = details.no_of_days ? ` (${details.no_of_days}d)` : ''\n\n      return end ? `${start} - ${end}${days}` : `${start}${days}`\n    },\n  },\n  methods: {\n    handleClick() {\n      this.$emit('click', this.item)\n    },\n\n    truncateSpecies(species: string | undefined): string {\n      if (!species) return 'N/A'\n      if (species.length > 30) {\n        return species.substring(0, 30) + '...'\n      }\n      return species\n    },\n\n    formatCurrency(amount: number | null | undefined): string {\n      if (!amount) return '$0'\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.pipeline-card {\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  padding: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.pipeline-card:hover {\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  transform: translateY(-2px);\n}\n\n.pipeline-card.is-new {\n  border-left: 3px solid var(--va-warning);\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.inquiry-code {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #6b7280;\n  font-family: monospace;\n}\n\n.client-info {\n  margin-bottom: 12px;\n}\n\n.client-name {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin: 0 0 4px 0;\n  line-height: 1.3;\n}\n\n.client-meta {\n  font-size: 0.75rem;\n  color: #9ca3af;\n  margin: 0;\n}\n\n.hunting-details {\n  background: #f9fafb;\n  border-radius: 6px;\n  padding: 8px;\n  margin-bottom: 12px;\n}\n\n.detail-row {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-bottom: 4px;\n}\n\n.detail-row:last-child {\n  margin-bottom: 0;\n}\n\n.detail-text {\n  font-size: 0.8rem;\n  color: #4b5563;\n}\n\n.detail-text.truncate {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 180px;\n}\n\n.amount-row .amount {\n  font-weight: 600;\n  color: var(--va-success);\n}\n\n.agent-info {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 8px;\n  background: #eff6ff;\n  border-radius: 4px;\n  margin-bottom: 12px;\n}\n\n.agent-name {\n  font-size: 0.75rem;\n  color: #3b82f6;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.card-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.card-actions :deep(.va-button) {\n  flex: 1;\n}\n</style>\n","<template>\n  <div class=\"pipeline-board\">\n    <!-- Header with filters -->\n    <div class=\"board-header\">\n      <div class=\"flex items-center gap-4\">\n        <h2 class=\"text-xl font-bold text-gray-800\">Sales Confirmation Pipeline</h2>\n        <VaBadge :text=\"String(totalItems)\" color=\"primary\" />\n      </div>\n      <div class=\"flex gap-3\">\n        <VaSelect\n          v-model=\"seasonFilter\"\n          :options=\"seasonOptions\"\n          placeholder=\"All Seasons\"\n          class=\"w-48\"\n          clearable\n          @update:modelValue=\"onSeasonChange\"\n        />\n        <VaButton preset=\"secondary\" icon=\"refresh\" :loading=\"loading\" @click=\"refreshPipeline\"> Refresh </VaButton>\n      </div>\n    </div>\n\n    <!-- Loading State -->\n    <div v-if=\"loading && !hasData\" class=\"loading-container\">\n      <VaProgressBar indeterminate />\n      <p class=\"text-center mt-4 text-gray-600\">Loading pipeline...</p>\n    </div>\n\n    <!-- Pipeline Columns -->\n    <div v-else class=\"pipeline-columns\">\n      <!-- New Inquiries Column -->\n      <div class=\"pipeline-column new-inquiries\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.new_inquiries }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"fiber_new\" :color=\"stageColors.new_inquiries\" />\n            <span>New Inquiries</span>\n          </div>\n          <VaBadge :text=\"String(counts.new_inquiries)\" :color=\"stageColors.new_inquiries\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.new_inquiries.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"inbox\" size=\"2rem\" color=\"secondary\" />\n            <span>No new inquiries</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.new_inquiries\"\n            :key=\"`new-${item.id}`\"\n            :item=\"item\"\n            @createProposal=\"$emit('create-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Pending Column -->\n      <div class=\"pipeline-column pending\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.pending }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"hourglass_empty\" :color=\"stageColors.pending\" />\n            <span>Pending</span>\n          </div>\n          <VaBadge :text=\"String(counts.pending)\" :color=\"stageColors.pending\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.pending.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"hourglass_empty\" size=\"2rem\" color=\"secondary\" />\n            <span>No pending items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.pending\"\n            :key=\"`pending-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Provision Sales Column -->\n      <div class=\"pipeline-column provision-sales\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.provision_sales }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"pending_actions\" :color=\"stageColors.provision_sales\" />\n            <span>Provision Sales</span>\n          </div>\n          <VaBadge :text=\"String(counts.provision_sales)\" :color=\"stageColors.provision_sales\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.provision_sales.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"pending_actions\" size=\"2rem\" color=\"secondary\" />\n            <span>No provisional sales</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.provision_sales\"\n            :key=\"`provision-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Confirmed Column -->\n      <div class=\"pipeline-column confirmed\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.confirmed }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"check_circle\" :color=\"stageColors.confirmed\" />\n            <span>Confirmed</span>\n          </div>\n          <VaBadge :text=\"String(counts.confirmed)\" :color=\"stageColors.confirmed\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.confirmed.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"check_circle\" size=\"2rem\" color=\"secondary\" />\n            <span>No confirmed items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.confirmed\"\n            :key=\"`confirmed-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Cancelled Column -->\n      <div class=\"pipeline-column cancelled\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.cancelled }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"cancel\" :color=\"stageColors.cancelled\" />\n            <span>Cancelled</span>\n          </div>\n          <VaBadge :text=\"String(counts.cancelled)\" :color=\"stageColors.cancelled\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.cancelled.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"cancel\" size=\"2rem\" color=\"secondary\" />\n            <span>No cancelled items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.cancelled\"\n            :key=\"`cancelled-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Completed Column -->\n      <div class=\"pipeline-column completed\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.completed }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"task_alt\" :color=\"stageColors.completed\" />\n            <span>Completed</span>\n          </div>\n          <VaBadge :text=\"String(counts.completed)\" :color=\"stageColors.completed\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.completed.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"task_alt\" size=\"2rem\" color=\"secondary\" />\n            <span>No completed items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.completed\"\n            :key=\"`completed-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n    </div>\n\n    <!-- Stage Change Modal -->\n    <VaModal v-model=\"showStageModal\" title=\"Move to Stage\" size=\"small\" :hide-default-actions=\"true\">\n      <div class=\"p-4\">\n        <p class=\"mb-4\">\n          Move <strong>{{ selectedItem?.code }}</strong> to:\n        </p>\n        <VaSelect v-model=\"targetStage\" :options=\"availableStages\" label=\"Select Stage\" class=\"mb-4\" />\n        <div class=\"flex justify-end gap-3\">\n          <VaButton preset=\"secondary\" @click=\"showStageModal = false\"> Cancel </VaButton>\n          <VaButton color=\"primary\" :loading=\"saving\" :disabled=\"!targetStage\" @click=\"confirmStageChange\">\n            Move\n          </VaButton>\n        </div>\n      </div>\n    </VaModal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport PipelineCard from './PipelineCard.vue'\n\ninterface PipelineItem {\n  id: number\n  type: 'inquiry' | 'proposal'\n  stage: string\n  code: string\n  created_date: string\n  created_date_formatted?: string\n  client?: {\n    id?: number\n    full_name: string\n    country: string\n    email?: string\n    phone?: string\n  }\n  hunting_details?: {\n    season?: string\n    areas: string\n    species?: string\n    start_date?: string\n    end_date?: string\n    no_of_days?: number\n    no_of_hunters?: number\n  }\n  proposal_id?: number | null\n  confirmation_id?: number | null\n  sales_agent?: {\n    id: number\n    name: string\n  } | null\n  total_amount: number | null\n}\n\ninterface PipelineData {\n  new_inquiries: PipelineItem[]\n  pending: PipelineItem[]\n  provision_sales: PipelineItem[]\n  confirmed: PipelineItem[]\n  cancelled: PipelineItem[]\n  completed: PipelineItem[]\n}\n\ninterface PipelineCounts {\n  new_inquiries: number\n  pending: number\n  provision_sales: number\n  confirmed: number\n  cancelled: number\n  completed: number\n}\n\nexport default defineComponent({\n  name: 'PipelineBoard',\n  components: {\n    PipelineCard,\n  },\n  props: {\n    pipeline: {\n      type: Object as PropType<PipelineData>,\n      required: true,\n    },\n    counts: {\n      type: Object as PropType<PipelineCounts>,\n      required: true,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n    saving: {\n      type: Boolean,\n      default: false,\n    },\n    seasonOptions: {\n      type: Array as PropType<{ value: number; text: string }[]>,\n      default: () => [],\n    },\n  },\n  emits: ['refresh', 'season-change', 'create-proposal', 'view-proposal', 'edit-proposal', 'stage-change'],\n  data() {\n    return {\n      seasonFilter: null as number | null,\n      showStageModal: false,\n      selectedItem: null as PipelineItem | null,\n      targetStage: null as string | null,\n      stageColors: {\n        new_inquiries: 'warning',\n        pending: 'warning',\n        provision_sales: 'info',\n        confirmed: 'success',\n        cancelled: 'secondary',\n        completed: 'primary',\n      } as Record<string, string>,\n      stageOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provision Sales' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n    }\n  },\n  computed: {\n    totalItems(): number {\n      return Object.values(this.counts).reduce((sum, count) => sum + count, 0)\n    },\n\n    hasData(): boolean {\n      return this.totalItems > 0\n    },\n\n    availableStages(): { value: string; text: string }[] {\n      if (!this.selectedItem) return this.stageOptions\n      // Filter out current stage\n      const currentStage = this.selectedItem.stage === 'new' ? 'new_inquiries' : this.selectedItem.stage\n      return this.stageOptions.filter((opt) => opt.value !== currentStage)\n    },\n  },\n  methods: {\n    refreshPipeline() {\n      this.$emit('refresh')\n    },\n\n    onSeasonChange(seasonId: number | null) {\n      this.$emit('season-change', seasonId)\n    },\n\n    handleCardClick(item: PipelineItem) {\n      // For proposals, open stage change modal on double-click or via context menu\n      // For now, single click opens view for proposals\n      if (item.type === 'proposal') {\n        this.$emit('view-proposal', item)\n      }\n    },\n\n    openStageModal(item: PipelineItem) {\n      this.selectedItem = item\n      this.targetStage = null\n      this.showStageModal = true\n    },\n\n    confirmStageChange() {\n      if (this.selectedItem && this.targetStage) {\n        this.$emit('stage-change', {\n          inquiryId: this.selectedItem.id,\n          newStage: this.targetStage,\n        })\n        this.showStageModal = false\n        this.selectedItem = null\n        this.targetStage = null\n      }\n    },\n  },\n})\n</script>\n\n<style scoped>\n.pipeline-board {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.board-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  margin-bottom: 16px;\n}\n\n.loading-container {\n  padding: 60px 20px;\n  text-align: center;\n}\n\n.pipeline-columns {\n  display: flex;\n  gap: 16px;\n  overflow-x: auto;\n  padding-bottom: 16px;\n  flex: 1;\n  min-height: 500px;\n}\n\n.pipeline-column {\n  flex: 0 0 280px;\n  min-width: 280px;\n  background: #f3f4f6;\n  border-radius: 8px;\n  display: flex;\n  flex-direction: column;\n  max-height: calc(100vh - 280px);\n}\n\n.column-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 16px;\n  background: white;\n  border-radius: 8px 8px 0 0;\n  border-bottom: 3px solid;\n  position: sticky;\n  top: 0;\n  z-index: 1;\n}\n\n.column-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  font-size: 0.9rem;\n  color: #374151;\n}\n\n.column-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 12px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.empty-column {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 20px;\n  color: #9ca3af;\n  text-align: center;\n  gap: 8px;\n}\n\n.empty-column span {\n  font-size: 0.85rem;\n}\n\n/* Column-specific colors */\n.pipeline-column.new-inquiries .column-header {\n  border-color: #f59e0b;\n}\n\n.pipeline-column.pending .column-header {\n  border-color: #f59e0b;\n}\n\n.pipeline-column.provision-sales .column-header {\n  border-color: #3b82f6;\n}\n\n.pipeline-column.confirmed .column-header {\n  border-color: #10b981;\n}\n\n.pipeline-column.cancelled .column-header {\n  border-color: #6b7280;\n}\n\n.pipeline-column.completed .column-header {\n  border-color: #8b5cf6;\n}\n\n/* Scrollbar styling */\n.column-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.column-content::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.column-content::-webkit-scrollbar-thumb {\n  background: #d1d5db;\n  border-radius: 3px;\n}\n\n.column-content::-webkit-scrollbar-thumb:hover {\n  background: #9ca3af;\n}\n\n/* Responsive adjustments */\n@media (max-width: 1400px) {\n  .pipeline-column {\n    flex: 0 0 250px;\n    min-width: 250px;\n  }\n}\n</style>\n","<template>\n  <div class=\"pipeline-board\">\n    <!-- Header with filters -->\n    <div class=\"board-header\">\n      <div class=\"flex items-center gap-4\">\n        <h2 class=\"text-xl font-bold text-gray-800\">Sales Confirmation Pipeline</h2>\n        <VaBadge :text=\"String(totalItems)\" color=\"primary\" />\n      </div>\n      <div class=\"flex gap-3\">\n        <VaSelect\n          v-model=\"seasonFilter\"\n          :options=\"seasonOptions\"\n          placeholder=\"All Seasons\"\n          class=\"w-48\"\n          clearable\n          @update:modelValue=\"onSeasonChange\"\n        />\n        <VaButton preset=\"secondary\" icon=\"refresh\" :loading=\"loading\" @click=\"refreshPipeline\"> Refresh </VaButton>\n      </div>\n    </div>\n\n    <!-- Loading State -->\n    <div v-if=\"loading && !hasData\" class=\"loading-container\">\n      <VaProgressBar indeterminate />\n      <p class=\"text-center mt-4 text-gray-600\">Loading pipeline...</p>\n    </div>\n\n    <!-- Pipeline Columns -->\n    <div v-else class=\"pipeline-columns\">\n      <!-- New Inquiries Column -->\n      <div class=\"pipeline-column new-inquiries\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.new_inquiries }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"fiber_new\" :color=\"stageColors.new_inquiries\" />\n            <span>New Inquiries</span>\n          </div>\n          <VaBadge :text=\"String(counts.new_inquiries)\" :color=\"stageColors.new_inquiries\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.new_inquiries.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"inbox\" size=\"2rem\" color=\"secondary\" />\n            <span>No new inquiries</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.new_inquiries\"\n            :key=\"`new-${item.id}`\"\n            :item=\"item\"\n            @createProposal=\"$emit('create-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Pending Column -->\n      <div class=\"pipeline-column pending\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.pending }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"hourglass_empty\" :color=\"stageColors.pending\" />\n            <span>Pending</span>\n          </div>\n          <VaBadge :text=\"String(counts.pending)\" :color=\"stageColors.pending\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.pending.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"hourglass_empty\" size=\"2rem\" color=\"secondary\" />\n            <span>No pending items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.pending\"\n            :key=\"`pending-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Provision Sales Column -->\n      <div class=\"pipeline-column provision-sales\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.provision_sales }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"pending_actions\" :color=\"stageColors.provision_sales\" />\n            <span>Provision Sales</span>\n          </div>\n          <VaBadge :text=\"String(counts.provision_sales)\" :color=\"stageColors.provision_sales\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.provision_sales.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"pending_actions\" size=\"2rem\" color=\"secondary\" />\n            <span>No provisional sales</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.provision_sales\"\n            :key=\"`provision-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Confirmed Column -->\n      <div class=\"pipeline-column confirmed\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.confirmed }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"check_circle\" :color=\"stageColors.confirmed\" />\n            <span>Confirmed</span>\n          </div>\n          <VaBadge :text=\"String(counts.confirmed)\" :color=\"stageColors.confirmed\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.confirmed.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"check_circle\" size=\"2rem\" color=\"secondary\" />\n            <span>No confirmed items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.confirmed\"\n            :key=\"`confirmed-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Cancelled Column -->\n      <div class=\"pipeline-column cancelled\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.cancelled }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"cancel\" :color=\"stageColors.cancelled\" />\n            <span>Cancelled</span>\n          </div>\n          <VaBadge :text=\"String(counts.cancelled)\" :color=\"stageColors.cancelled\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.cancelled.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"cancel\" size=\"2rem\" color=\"secondary\" />\n            <span>No cancelled items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.cancelled\"\n            :key=\"`cancelled-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n\n      <!-- Completed Column -->\n      <div class=\"pipeline-column completed\">\n        <div class=\"column-header\" :style=\"{ borderColor: stageColors.completed }\">\n          <div class=\"column-title\">\n            <VaIcon name=\"task_alt\" :color=\"stageColors.completed\" />\n            <span>Completed</span>\n          </div>\n          <VaBadge :text=\"String(counts.completed)\" :color=\"stageColors.completed\" />\n        </div>\n        <div class=\"column-content\">\n          <div v-if=\"pipeline.completed.length === 0\" class=\"empty-column\">\n            <VaIcon name=\"task_alt\" size=\"2rem\" color=\"secondary\" />\n            <span>No completed items</span>\n          </div>\n          <PipelineCard\n            v-for=\"item in pipeline.completed\"\n            :key=\"`completed-${item.id}`\"\n            :item=\"item\"\n            @view=\"$emit('view-proposal', item)\"\n            @edit=\"$emit('edit-proposal', item)\"\n            @click=\"handleCardClick(item)\"\n          />\n        </div>\n      </div>\n    </div>\n\n    <!-- Stage Change Modal -->\n    <VaModal v-model=\"showStageModal\" title=\"Move to Stage\" size=\"small\" :hide-default-actions=\"true\">\n      <div class=\"p-4\">\n        <p class=\"mb-4\">\n          Move <strong>{{ selectedItem?.code }}</strong> to:\n        </p>\n        <VaSelect v-model=\"targetStage\" :options=\"availableStages\" label=\"Select Stage\" class=\"mb-4\" />\n        <div class=\"flex justify-end gap-3\">\n          <VaButton preset=\"secondary\" @click=\"showStageModal = false\"> Cancel </VaButton>\n          <VaButton color=\"primary\" :loading=\"saving\" :disabled=\"!targetStage\" @click=\"confirmStageChange\">\n            Move\n          </VaButton>\n        </div>\n      </div>\n    </VaModal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport PipelineCard from './PipelineCard.vue'\n\ninterface PipelineItem {\n  id: number\n  type: 'inquiry' | 'proposal'\n  stage: string\n  code: string\n  created_date: string\n  created_date_formatted?: string\n  client?: {\n    id?: number\n    full_name: string\n    country: string\n    email?: string\n    phone?: string\n  }\n  hunting_details?: {\n    season?: string\n    areas: string\n    species?: string\n    start_date?: string\n    end_date?: string\n    no_of_days?: number\n    no_of_hunters?: number\n  }\n  proposal_id?: number | null\n  confirmation_id?: number | null\n  sales_agent?: {\n    id: number\n    name: string\n  } | null\n  total_amount: number | null\n}\n\ninterface PipelineData {\n  new_inquiries: PipelineItem[]\n  pending: PipelineItem[]\n  provision_sales: PipelineItem[]\n  confirmed: PipelineItem[]\n  cancelled: PipelineItem[]\n  completed: PipelineItem[]\n}\n\ninterface PipelineCounts {\n  new_inquiries: number\n  pending: number\n  provision_sales: number\n  confirmed: number\n  cancelled: number\n  completed: number\n}\n\nexport default defineComponent({\n  name: 'PipelineBoard',\n  components: {\n    PipelineCard,\n  },\n  props: {\n    pipeline: {\n      type: Object as PropType<PipelineData>,\n      required: true,\n    },\n    counts: {\n      type: Object as PropType<PipelineCounts>,\n      required: true,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n    saving: {\n      type: Boolean,\n      default: false,\n    },\n    seasonOptions: {\n      type: Array as PropType<{ value: number; text: string }[]>,\n      default: () => [],\n    },\n  },\n  emits: ['refresh', 'season-change', 'create-proposal', 'view-proposal', 'edit-proposal', 'stage-change'],\n  data() {\n    return {\n      seasonFilter: null as number | null,\n      showStageModal: false,\n      selectedItem: null as PipelineItem | null,\n      targetStage: null as string | null,\n      stageColors: {\n        new_inquiries: 'warning',\n        pending: 'warning',\n        provision_sales: 'info',\n        confirmed: 'success',\n        cancelled: 'secondary',\n        completed: 'primary',\n      } as Record<string, string>,\n      stageOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provision Sales' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n    }\n  },\n  computed: {\n    totalItems(): number {\n      return Object.values(this.counts).reduce((sum, count) => sum + count, 0)\n    },\n\n    hasData(): boolean {\n      return this.totalItems > 0\n    },\n\n    availableStages(): { value: string; text: string }[] {\n      if (!this.selectedItem) return this.stageOptions\n      // Filter out current stage\n      const currentStage = this.selectedItem.stage === 'new' ? 'new_inquiries' : this.selectedItem.stage\n      return this.stageOptions.filter((opt) => opt.value !== currentStage)\n    },\n  },\n  methods: {\n    refreshPipeline() {\n      this.$emit('refresh')\n    },\n\n    onSeasonChange(seasonId: number | null) {\n      this.$emit('season-change', seasonId)\n    },\n\n    handleCardClick(item: PipelineItem) {\n      // For proposals, open stage change modal on double-click or via context menu\n      // For now, single click opens view for proposals\n      if (item.type === 'proposal') {\n        this.$emit('view-proposal', item)\n      }\n    },\n\n    openStageModal(item: PipelineItem) {\n      this.selectedItem = item\n      this.targetStage = null\n      this.showStageModal = true\n    },\n\n    confirmStageChange() {\n      if (this.selectedItem && this.targetStage) {\n        this.$emit('stage-change', {\n          inquiryId: this.selectedItem.id,\n          newStage: this.targetStage,\n        })\n        this.showStageModal = false\n        this.selectedItem = null\n        this.targetStage = null\n      }\n    },\n  },\n})\n</script>\n\n<style scoped>\n.pipeline-board {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.board-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  margin-bottom: 16px;\n}\n\n.loading-container {\n  padding: 60px 20px;\n  text-align: center;\n}\n\n.pipeline-columns {\n  display: flex;\n  gap: 16px;\n  overflow-x: auto;\n  padding-bottom: 16px;\n  flex: 1;\n  min-height: 500px;\n}\n\n.pipeline-column {\n  flex: 0 0 280px;\n  min-width: 280px;\n  background: #f3f4f6;\n  border-radius: 8px;\n  display: flex;\n  flex-direction: column;\n  max-height: calc(100vh - 280px);\n}\n\n.column-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 16px;\n  background: white;\n  border-radius: 8px 8px 0 0;\n  border-bottom: 3px solid;\n  position: sticky;\n  top: 0;\n  z-index: 1;\n}\n\n.column-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  font-size: 0.9rem;\n  color: #374151;\n}\n\n.column-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 12px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.empty-column {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 20px;\n  color: #9ca3af;\n  text-align: center;\n  gap: 8px;\n}\n\n.empty-column span {\n  font-size: 0.85rem;\n}\n\n/* Column-specific colors */\n.pipeline-column.new-inquiries .column-header {\n  border-color: #f59e0b;\n}\n\n.pipeline-column.pending .column-header {\n  border-color: #f59e0b;\n}\n\n.pipeline-column.provision-sales .column-header {\n  border-color: #3b82f6;\n}\n\n.pipeline-column.confirmed .column-header {\n  border-color: #10b981;\n}\n\n.pipeline-column.cancelled .column-header {\n  border-color: #6b7280;\n}\n\n.pipeline-column.completed .column-header {\n  border-color: #8b5cf6;\n}\n\n/* Scrollbar styling */\n.column-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.column-content::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.column-content::-webkit-scrollbar-thumb {\n  background: #d1d5db;\n  border-radius: 3px;\n}\n\n.column-content::-webkit-scrollbar-thumb:hover {\n  background: #9ca3af;\n}\n\n/* Responsive adjustments */\n@media (max-width: 1400px) {\n  .pipeline-column {\n    flex: 0 0 250px;\n    min-width: 250px;\n  }\n}\n</style>\n","<template>\n  <div class=\"stage-indicator\">\n    <!-- Stage Progress Bar -->\n    <div class=\"stage-progress\">\n      <div\n        v-for=\"(stage, index) in stages\"\n        :key=\"stage.value\"\n        class=\"stage-step\"\n        :class=\"{\n          'is-active': currentStage === stage.value,\n          'is-completed': isStageCompleted(stage.value),\n          'is-cancelled': currentStage === 'cancelled',\n        }\"\n      >\n        <div class=\"stage-dot\" :style=\"{ backgroundColor: getStageColor(stage.value) }\">\n          <VaIcon v-if=\"isStageCompleted(stage.value)\" name=\"check\" size=\"small\" color=\"white\" />\n          <VaIcon v-else-if=\"currentStage === 'cancelled'\" name=\"close\" size=\"small\" color=\"white\" />\n          <span v-else class=\"stage-number\">{{ index + 1 }}</span>\n        </div>\n        <div class=\"stage-label\">{{ stage.label }}</div>\n        <div\n          v-if=\"index < stages.length - 1\"\n          class=\"stage-line\"\n          :class=\"{ 'is-filled': isStageCompleted(stage.value) }\"\n        ></div>\n      </div>\n    </div>\n\n    <!-- Payment Indicators -->\n    <div v-if=\"installments && installments.length > 0\" class=\"payment-indicators\">\n      <div\n        v-for=\"installment in mainInstallments\"\n        :key=\"installment.id\"\n        class=\"payment-indicator\"\n        :class=\"{ 'is-paid': installment.is_paid }\"\n        :title=\"installment.narration\"\n      >\n        <VaIcon\n          :name=\"installment.is_paid ? 'check_circle' : 'radio_button_unchecked'\"\n          :color=\"installment.is_paid ? 'success' : 'secondary'\"\n          size=\"small\"\n        />\n        <span class=\"payment-label\">{{ getShortLabel(installment) }}</span>\n      </div>\n    </div>\n\n    <!-- Cancelled Overlay -->\n    <div v-if=\"currentStage === 'cancelled'\" class=\"cancelled-overlay\">\n      <VaChip color=\"danger\" size=\"small\">CANCELLED</VaChip>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  amount_paid?: number | null\n}\n\nexport default defineComponent({\n  name: 'StageIndicator',\n  props: {\n    currentStage: {\n      type: String,\n      required: true,\n    },\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n  },\n  data() {\n    return {\n      stages: [\n        { value: 'new_inquiries', label: 'NEW' },\n        { value: 'pending', label: 'PEND' },\n        { value: 'provision_sales', label: 'PROV' },\n        { value: 'confirmed', label: 'CONF' },\n        { value: 'completed', label: 'COMP' },\n      ],\n      stageColors: {\n        new_inquiries: '#E3F2FD',\n        pending: '#FFF9C4',\n        provision_sales: '#FFE0B2',\n        confirmed: '#C8E6C9',\n        cancelled: '#FFCDD2',\n        completed: '#E1BEE7',\n      } as Record<string, string>,\n      stageActiveColors: {\n        new_inquiries: '#2196F3',\n        pending: '#FFC107',\n        provision_sales: '#FF9800',\n        confirmed: '#4CAF50',\n        cancelled: '#F44336',\n        completed: '#9C27B0',\n      } as Record<string, string>,\n    }\n  },\n  computed: {\n    stageOrder(): string[] {\n      return this.stages.map((s) => s.value)\n    },\n\n    currentStageIndex(): number {\n      return this.stageOrder.indexOf(this.currentStage)\n    },\n\n    mainInstallments(): Installment[] {\n      // Filter to show only the main payment-triggering installments\n      return this.installments.filter((i) => {\n        const type = i.installment_type?.toLowerCase() || ''\n        const narration = i.narration.toLowerCase()\n        return (\n          type.includes('deposit') ||\n          type.includes('final') ||\n          type.includes('trophy') ||\n          narration.includes('deposit') ||\n          narration.includes('final') ||\n          narration.includes('trophy')\n        )\n      })\n    },\n  },\n  methods: {\n    isStageCompleted(stageValue: string): boolean {\n      if (this.currentStage === 'cancelled') return false\n      const stageIndex = this.stageOrder.indexOf(stageValue)\n      return stageIndex < this.currentStageIndex\n    },\n\n    getStageColor(stageValue: string): string {\n      if (this.currentStage === 'cancelled') {\n        return this.stageActiveColors.cancelled\n      }\n      if (this.isStageCompleted(stageValue) || this.currentStage === stageValue) {\n        return this.stageActiveColors[stageValue] || this.stageActiveColors.pending\n      }\n      return '#e0e0e0'\n    },\n\n    getShortLabel(installment: Installment): string {\n      const narration = installment.narration.toLowerCase()\n      if (narration.includes('deposit') && narration.includes('booking')) {\n        return 'Deposit'\n      }\n      if (narration.includes('2nd') || narration.includes('year prior')) {\n        return '2nd'\n      }\n      if (narration.includes('final')) {\n        return 'Final'\n      }\n      if (narration.includes('trophy')) {\n        return 'Trophy'\n      }\n      return installment.narration.substring(0, 6)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.stage-indicator {\n  padding: 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  position: relative;\n}\n\n.stage-progress {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 16px;\n}\n\n.stage-step {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  flex: 1;\n}\n\n.stage-dot {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: white;\n  z-index: 1;\n  transition: all 0.3s ease;\n}\n\n.stage-number {\n  color: white;\n}\n\n.stage-label {\n  margin-top: 8px;\n  font-size: 0.7rem;\n  font-weight: 500;\n  color: #6b7280;\n  text-align: center;\n}\n\n.stage-step.is-active .stage-label {\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-step.is-completed .stage-label {\n  color: #4caf50;\n}\n\n.stage-line {\n  position: absolute;\n  top: 16px;\n  left: 50%;\n  width: 100%;\n  height: 3px;\n  background: #e0e0e0;\n  z-index: 0;\n}\n\n.stage-line.is-filled {\n  background: #4caf50;\n}\n\n.stage-step:last-child .stage-line {\n  display: none;\n}\n\n.payment-indicators {\n  display: flex;\n  justify-content: center;\n  gap: 24px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.payment-indicator {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 4px;\n}\n\n.payment-label {\n  font-size: 0.65rem;\n  color: #9ca3af;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.payment-indicator.is-paid .payment-label {\n  color: #4caf50;\n  font-weight: 600;\n}\n\n.cancelled-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: rgba(255, 255, 255, 0.9);\n  padding: 8px 16px;\n  border-radius: 4px;\n}\n\n.stage-step.is-cancelled .stage-dot {\n  background: #f44336 !important;\n}\n\n.stage-step.is-cancelled .stage-label {\n  color: #f44336;\n}\n</style>\n","<template>\n  <div class=\"stage-indicator\">\n    <!-- Stage Progress Bar -->\n    <div class=\"stage-progress\">\n      <div\n        v-for=\"(stage, index) in stages\"\n        :key=\"stage.value\"\n        class=\"stage-step\"\n        :class=\"{\n          'is-active': currentStage === stage.value,\n          'is-completed': isStageCompleted(stage.value),\n          'is-cancelled': currentStage === 'cancelled',\n        }\"\n      >\n        <div class=\"stage-dot\" :style=\"{ backgroundColor: getStageColor(stage.value) }\">\n          <VaIcon v-if=\"isStageCompleted(stage.value)\" name=\"check\" size=\"small\" color=\"white\" />\n          <VaIcon v-else-if=\"currentStage === 'cancelled'\" name=\"close\" size=\"small\" color=\"white\" />\n          <span v-else class=\"stage-number\">{{ index + 1 }}</span>\n        </div>\n        <div class=\"stage-label\">{{ stage.label }}</div>\n        <div\n          v-if=\"index < stages.length - 1\"\n          class=\"stage-line\"\n          :class=\"{ 'is-filled': isStageCompleted(stage.value) }\"\n        ></div>\n      </div>\n    </div>\n\n    <!-- Payment Indicators -->\n    <div v-if=\"installments && installments.length > 0\" class=\"payment-indicators\">\n      <div\n        v-for=\"installment in mainInstallments\"\n        :key=\"installment.id\"\n        class=\"payment-indicator\"\n        :class=\"{ 'is-paid': installment.is_paid }\"\n        :title=\"installment.narration\"\n      >\n        <VaIcon\n          :name=\"installment.is_paid ? 'check_circle' : 'radio_button_unchecked'\"\n          :color=\"installment.is_paid ? 'success' : 'secondary'\"\n          size=\"small\"\n        />\n        <span class=\"payment-label\">{{ getShortLabel(installment) }}</span>\n      </div>\n    </div>\n\n    <!-- Cancelled Overlay -->\n    <div v-if=\"currentStage === 'cancelled'\" class=\"cancelled-overlay\">\n      <VaChip color=\"danger\" size=\"small\">CANCELLED</VaChip>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  amount_paid?: number | null\n}\n\nexport default defineComponent({\n  name: 'StageIndicator',\n  props: {\n    currentStage: {\n      type: String,\n      required: true,\n    },\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n  },\n  data() {\n    return {\n      stages: [\n        { value: 'new_inquiries', label: 'NEW' },\n        { value: 'pending', label: 'PEND' },\n        { value: 'provision_sales', label: 'PROV' },\n        { value: 'confirmed', label: 'CONF' },\n        { value: 'completed', label: 'COMP' },\n      ],\n      stageColors: {\n        new_inquiries: '#E3F2FD',\n        pending: '#FFF9C4',\n        provision_sales: '#FFE0B2',\n        confirmed: '#C8E6C9',\n        cancelled: '#FFCDD2',\n        completed: '#E1BEE7',\n      } as Record<string, string>,\n      stageActiveColors: {\n        new_inquiries: '#2196F3',\n        pending: '#FFC107',\n        provision_sales: '#FF9800',\n        confirmed: '#4CAF50',\n        cancelled: '#F44336',\n        completed: '#9C27B0',\n      } as Record<string, string>,\n    }\n  },\n  computed: {\n    stageOrder(): string[] {\n      return this.stages.map((s) => s.value)\n    },\n\n    currentStageIndex(): number {\n      return this.stageOrder.indexOf(this.currentStage)\n    },\n\n    mainInstallments(): Installment[] {\n      // Filter to show only the main payment-triggering installments\n      return this.installments.filter((i) => {\n        const type = i.installment_type?.toLowerCase() || ''\n        const narration = i.narration.toLowerCase()\n        return (\n          type.includes('deposit') ||\n          type.includes('final') ||\n          type.includes('trophy') ||\n          narration.includes('deposit') ||\n          narration.includes('final') ||\n          narration.includes('trophy')\n        )\n      })\n    },\n  },\n  methods: {\n    isStageCompleted(stageValue: string): boolean {\n      if (this.currentStage === 'cancelled') return false\n      const stageIndex = this.stageOrder.indexOf(stageValue)\n      return stageIndex < this.currentStageIndex\n    },\n\n    getStageColor(stageValue: string): string {\n      if (this.currentStage === 'cancelled') {\n        return this.stageActiveColors.cancelled\n      }\n      if (this.isStageCompleted(stageValue) || this.currentStage === stageValue) {\n        return this.stageActiveColors[stageValue] || this.stageActiveColors.pending\n      }\n      return '#e0e0e0'\n    },\n\n    getShortLabel(installment: Installment): string {\n      const narration = installment.narration.toLowerCase()\n      if (narration.includes('deposit') && narration.includes('booking')) {\n        return 'Deposit'\n      }\n      if (narration.includes('2nd') || narration.includes('year prior')) {\n        return '2nd'\n      }\n      if (narration.includes('final')) {\n        return 'Final'\n      }\n      if (narration.includes('trophy')) {\n        return 'Trophy'\n      }\n      return installment.narration.substring(0, 6)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.stage-indicator {\n  padding: 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  position: relative;\n}\n\n.stage-progress {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 16px;\n}\n\n.stage-step {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  flex: 1;\n}\n\n.stage-dot {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: white;\n  z-index: 1;\n  transition: all 0.3s ease;\n}\n\n.stage-number {\n  color: white;\n}\n\n.stage-label {\n  margin-top: 8px;\n  font-size: 0.7rem;\n  font-weight: 500;\n  color: #6b7280;\n  text-align: center;\n}\n\n.stage-step.is-active .stage-label {\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-step.is-completed .stage-label {\n  color: #4caf50;\n}\n\n.stage-line {\n  position: absolute;\n  top: 16px;\n  left: 50%;\n  width: 100%;\n  height: 3px;\n  background: #e0e0e0;\n  z-index: 0;\n}\n\n.stage-line.is-filled {\n  background: #4caf50;\n}\n\n.stage-step:last-child .stage-line {\n  display: none;\n}\n\n.payment-indicators {\n  display: flex;\n  justify-content: center;\n  gap: 24px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.payment-indicator {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 4px;\n}\n\n.payment-label {\n  font-size: 0.65rem;\n  color: #9ca3af;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.payment-indicator.is-paid .payment-label {\n  color: #4caf50;\n  font-weight: 600;\n}\n\n.cancelled-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: rgba(255, 255, 255, 0.9);\n  padding: 8px 16px;\n  border-radius: 4px;\n}\n\n.stage-step.is-cancelled .stage-dot {\n  background: #f44336 !important;\n}\n\n.stage-step.is-cancelled .stage-label {\n  color: #f44336;\n}\n</style>\n","<template>\n  <VaCard outlined class=\"payment-table-card\">\n    <VaCardTitle class=\"flex items-center justify-between\">\n      <div class=\"flex items-center gap-2\">\n        <VaIcon name=\"payments\" color=\"primary\" />\n        <span>Payment Schedule</span>\n      </div>\n      <div class=\"total-badge\">Total: {{ formatCurrency(summary?.total_due || totalAmount) }}</div>\n    </VaCardTitle>\n    <VaCardContent>\n      <!-- Loading State -->\n      <div v-if=\"loading\" class=\"loading-state\">\n        <VaProgressBar indeterminate />\n        <p class=\"text-center mt-2 text-gray-600\">Loading payment status...</p>\n      </div>\n\n      <!-- Payment Rows -->\n      <div v-else class=\"payment-rows\">\n        <div\n          v-for=\"installment in installments\"\n          :key=\"installment.id\"\n          class=\"payment-row\"\n          :class=\"{\n            'is-paid': installment.is_paid || installment.payment_status === 'paid',\n            'is-partial': installment.payment_status === 'partial',\n          }\"\n        >\n          <!-- Status Icon -->\n          <div class=\"status-icon\">\n            <VaIcon :name=\"getStatusIcon(installment)\" :color=\"getStatusIconColor(installment)\" />\n          </div>\n\n          <!-- Installment Details -->\n          <div class=\"installment-details\">\n            <div class=\"narration\">{{ installment.narration }}</div>\n            <div v-if=\"installment.triggers_stage\" class=\"triggers-badge\">\n              <VaChip size=\"small\" color=\"info\" flat> → {{ formatStageName(installment.triggers_stage) }} </VaChip>\n            </div>\n            <!-- Show partial payment info -->\n            <div v-if=\"installment.payment_status === 'partial'\" class=\"partial-info\">\n              <span class=\"text-xs text-orange-600\">\n                Paid: {{ formatCurrency(installment.amount_paid || 0) }} / Remaining:\n                {{ formatCurrency(installment.remaining_balance || 0) }}\n              </span>\n            </div>\n            <!-- Show payment count if multiple payments -->\n            <div v-if=\"installment.payments && installment.payments.length > 1\" class=\"payments-count\">\n              <VaChip size=\"small\" color=\"secondary\" flat> {{ installment.payments.length }} payments </VaChip>\n            </div>\n          </div>\n\n          <!-- Amount -->\n          <div class=\"amount-section\">\n            <span class=\"amount\">{{ formatCurrency(installment.amount_due) }}</span>\n          </div>\n\n          <!-- Payment Info / Action -->\n          <div class=\"action-section\">\n            <template v-if=\"installment.is_paid || installment.payment_status === 'paid'\">\n              <div class=\"paid-info\">\n                <span class=\"paid-badge\">PAID</span>\n                <span v-if=\"installment.paid_at\" class=\"paid-date\">\n                  {{ formatDate(installment.paid_at) }}\n                </span>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else-if=\"installment.payment_status === 'partial'\">\n              <div class=\"partial-actions\">\n                <span class=\"partial-badge\">PARTIAL</span>\n                <VaButton size=\"small\" color=\"warning\" @click=\"$emit('record-payment', installment)\">\n                  Add Payment\n                </VaButton>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else>\n              <VaButton size=\"small\" color=\"primary\" @click=\"$emit('record-payment', installment)\">\n                Record Payment\n              </VaButton>\n            </template>\n          </div>\n        </div>\n      </div>\n\n      <!-- Summary -->\n      <div v-if=\"summary\" class=\"payment-summary\">\n        <div class=\"summary-item paid\">\n          <VaIcon name=\"check_circle\" color=\"success\" size=\"small\" />\n          <span>Paid: {{ formatCurrency(summary.total_paid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item remaining\">\n          <VaIcon name=\"pending\" color=\"warning\" size=\"small\" />\n          <span>Remaining: {{ formatCurrency(summary.total_unpaid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item count\">\n          <span>\n            {{ summary.fully_paid_count || summary.paid_count }}/{{ totalInstallmentCount }} Fully Paid\n            <template v-if=\"summary.partial_paid_count\"> ({{ summary.partial_paid_count }} partial) </template>\n          </span>\n        </div>\n      </div>\n\n      <!-- Progress Bar -->\n      <div v-if=\"summary\" class=\"payment-progress\">\n        <VaProgressBar\n          :model-value=\"paymentPercentage\"\n          :color=\"paymentPercentage === 100 ? 'success' : 'primary'\"\n          show-percent\n        />\n      </div>\n    </VaCardContent>\n  </VaCard>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Payment {\n  id: number\n  amount: number\n  payment_reference?: string\n  payment_method?: string\n  paid_at: string\n}\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  paid_at?: string | null\n  amount_paid?: number | null\n  remaining_balance?: number | null\n  payment_reference?: string | null\n  paid_by?: string | null\n  payments?: Payment[]\n}\n\ninterface PaymentSummary {\n  total_due: number\n  total_paid: number\n  total_unpaid: number\n  paid_count?: number\n  unpaid_count?: number\n  fully_paid_count?: number\n  partial_paid_count?: number\n}\n\nexport default defineComponent({\n  name: 'PaymentTable',\n  props: {\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n    summary: {\n      type: Object as PropType<PaymentSummary | null>,\n      default: null,\n    },\n    totalAmount: {\n      type: Number,\n      default: 0,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n    allowUnpay: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: ['record-payment', 'unpay'],\n  computed: {\n    paymentPercentage(): number {\n      if (!this.summary || this.summary.total_due === 0) return 0\n      return Math.round((this.summary.total_paid / this.summary.total_due) * 100)\n    },\n    totalInstallmentCount(): number {\n      if (!this.summary) return this.installments.length\n      return (\n        (this.summary.fully_paid_count || this.summary.paid_count || 0) +\n        (this.summary.partial_paid_count || 0) +\n        (this.summary.unpaid_count || 0)\n      )\n    },\n  },\n  methods: {\n    getStatusIcon(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'check_circle'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'hourglass_top'\n      }\n      return 'radio_button_unchecked'\n    },\n\n    getStatusIconColor(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'success'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'warning'\n      }\n      return 'secondary'\n    },\n\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatDate(dateString: string): string {\n      if (!dateString) return ''\n      try {\n        const date = new Date(dateString)\n        return date.toLocaleDateString('en-US', {\n          month: 'short',\n          day: 'numeric',\n          year: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        provision_sales: 'Provision Sales',\n        confirmed: 'Confirmed',\n        completed: 'Completed',\n      }\n      return names[stage] || stage.replace(/_/g, ' ')\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-table-card {\n  margin-bottom: 1.5rem;\n}\n\n.total-badge {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #1f2937;\n  background: #f3f4f6;\n  padding: 4px 12px;\n  border-radius: 4px;\n}\n\n.loading-state {\n  padding: 40px 20px;\n}\n\n.payment-rows {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.payment-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  background: #f9fafb;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.payment-row:hover {\n  border-color: #d1d5db;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n\n.payment-row.is-paid {\n  background: #f0fdf4;\n  border-color: #bbf7d0;\n}\n\n.status-icon {\n  flex-shrink: 0;\n}\n\n.installment-details {\n  flex: 1;\n  min-width: 0;\n}\n\n.narration {\n  font-weight: 500;\n  color: #1f2937;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.triggers-badge {\n  margin-top: 4px;\n}\n\n.amount-section {\n  flex-shrink: 0;\n  text-align: right;\n}\n\n.amount {\n  font-weight: 600;\n  font-size: 1rem;\n  color: #1f2937;\n}\n\n.action-section {\n  flex-shrink: 0;\n  min-width: 150px;\n  text-align: right;\n}\n\n.paid-info {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  justify-content: flex-end;\n}\n\n.paid-badge {\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #16a34a;\n  background: #dcfce7;\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.paid-date {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.payment-summary {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  padding: 16px;\n  margin-top: 16px;\n  background: #f3f4f6;\n  border-radius: 8px;\n}\n\n.summary-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.9rem;\n  color: #4b5563;\n}\n\n.summary-item.paid {\n  color: #16a34a;\n  font-weight: 500;\n}\n\n.summary-item.remaining {\n  color: #d97706;\n  font-weight: 500;\n}\n\n.summary-divider {\n  color: #d1d5db;\n}\n\n.payment-progress {\n  margin-top: 16px;\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n  .payment-row {\n    flex-wrap: wrap;\n  }\n\n  .installment-details {\n    flex-basis: calc(100% - 50px);\n    order: 1;\n  }\n\n  .status-icon {\n    order: 0;\n  }\n\n  .amount-section {\n    order: 2;\n    flex-basis: 50%;\n  }\n\n  .action-section {\n    order: 3;\n    flex-basis: 50%;\n    min-width: auto;\n  }\n\n  .payment-summary {\n    flex-wrap: wrap;\n    gap: 8px;\n  }\n\n  .summary-divider {\n    display: none;\n  }\n}\n</style>\n","<template>\n  <VaCard outlined class=\"payment-table-card\">\n    <VaCardTitle class=\"flex items-center justify-between\">\n      <div class=\"flex items-center gap-2\">\n        <VaIcon name=\"payments\" color=\"primary\" />\n        <span>Payment Schedule</span>\n      </div>\n      <div class=\"total-badge\">Total: {{ formatCurrency(summary?.total_due || totalAmount) }}</div>\n    </VaCardTitle>\n    <VaCardContent>\n      <!-- Loading State -->\n      <div v-if=\"loading\" class=\"loading-state\">\n        <VaProgressBar indeterminate />\n        <p class=\"text-center mt-2 text-gray-600\">Loading payment status...</p>\n      </div>\n\n      <!-- Payment Rows -->\n      <div v-else class=\"payment-rows\">\n        <div\n          v-for=\"installment in installments\"\n          :key=\"installment.id\"\n          class=\"payment-row\"\n          :class=\"{\n            'is-paid': installment.is_paid || installment.payment_status === 'paid',\n            'is-partial': installment.payment_status === 'partial',\n          }\"\n        >\n          <!-- Status Icon -->\n          <div class=\"status-icon\">\n            <VaIcon :name=\"getStatusIcon(installment)\" :color=\"getStatusIconColor(installment)\" />\n          </div>\n\n          <!-- Installment Details -->\n          <div class=\"installment-details\">\n            <div class=\"narration\">{{ installment.narration }}</div>\n            <div v-if=\"installment.triggers_stage\" class=\"triggers-badge\">\n              <VaChip size=\"small\" color=\"info\" flat> → {{ formatStageName(installment.triggers_stage) }} </VaChip>\n            </div>\n            <!-- Show partial payment info -->\n            <div v-if=\"installment.payment_status === 'partial'\" class=\"partial-info\">\n              <span class=\"text-xs text-orange-600\">\n                Paid: {{ formatCurrency(installment.amount_paid || 0) }} / Remaining:\n                {{ formatCurrency(installment.remaining_balance || 0) }}\n              </span>\n            </div>\n            <!-- Show payment count if multiple payments -->\n            <div v-if=\"installment.payments && installment.payments.length > 1\" class=\"payments-count\">\n              <VaChip size=\"small\" color=\"secondary\" flat> {{ installment.payments.length }} payments </VaChip>\n            </div>\n          </div>\n\n          <!-- Amount -->\n          <div class=\"amount-section\">\n            <span class=\"amount\">{{ formatCurrency(installment.amount_due) }}</span>\n          </div>\n\n          <!-- Payment Info / Action -->\n          <div class=\"action-section\">\n            <template v-if=\"installment.is_paid || installment.payment_status === 'paid'\">\n              <div class=\"paid-info\">\n                <span class=\"paid-badge\">PAID</span>\n                <span v-if=\"installment.paid_at\" class=\"paid-date\">\n                  {{ formatDate(installment.paid_at) }}\n                </span>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else-if=\"installment.payment_status === 'partial'\">\n              <div class=\"partial-actions\">\n                <span class=\"partial-badge\">PARTIAL</span>\n                <VaButton size=\"small\" color=\"warning\" @click=\"$emit('record-payment', installment)\">\n                  Add Payment\n                </VaButton>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else>\n              <VaButton size=\"small\" color=\"primary\" @click=\"$emit('record-payment', installment)\">\n                Record Payment\n              </VaButton>\n            </template>\n          </div>\n        </div>\n      </div>\n\n      <!-- Summary -->\n      <div v-if=\"summary\" class=\"payment-summary\">\n        <div class=\"summary-item paid\">\n          <VaIcon name=\"check_circle\" color=\"success\" size=\"small\" />\n          <span>Paid: {{ formatCurrency(summary.total_paid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item remaining\">\n          <VaIcon name=\"pending\" color=\"warning\" size=\"small\" />\n          <span>Remaining: {{ formatCurrency(summary.total_unpaid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item count\">\n          <span>\n            {{ summary.fully_paid_count || summary.paid_count }}/{{ totalInstallmentCount }} Fully Paid\n            <template v-if=\"summary.partial_paid_count\"> ({{ summary.partial_paid_count }} partial) </template>\n          </span>\n        </div>\n      </div>\n\n      <!-- Progress Bar -->\n      <div v-if=\"summary\" class=\"payment-progress\">\n        <VaProgressBar\n          :model-value=\"paymentPercentage\"\n          :color=\"paymentPercentage === 100 ? 'success' : 'primary'\"\n          show-percent\n        />\n      </div>\n    </VaCardContent>\n  </VaCard>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Payment {\n  id: number\n  amount: number\n  payment_reference?: string\n  payment_method?: string\n  paid_at: string\n}\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  paid_at?: string | null\n  amount_paid?: number | null\n  remaining_balance?: number | null\n  payment_reference?: string | null\n  paid_by?: string | null\n  payments?: Payment[]\n}\n\ninterface PaymentSummary {\n  total_due: number\n  total_paid: number\n  total_unpaid: number\n  paid_count?: number\n  unpaid_count?: number\n  fully_paid_count?: number\n  partial_paid_count?: number\n}\n\nexport default defineComponent({\n  name: 'PaymentTable',\n  props: {\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n    summary: {\n      type: Object as PropType<PaymentSummary | null>,\n      default: null,\n    },\n    totalAmount: {\n      type: Number,\n      default: 0,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n    allowUnpay: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: ['record-payment', 'unpay'],\n  computed: {\n    paymentPercentage(): number {\n      if (!this.summary || this.summary.total_due === 0) return 0\n      return Math.round((this.summary.total_paid / this.summary.total_due) * 100)\n    },\n    totalInstallmentCount(): number {\n      if (!this.summary) return this.installments.length\n      return (\n        (this.summary.fully_paid_count || this.summary.paid_count || 0) +\n        (this.summary.partial_paid_count || 0) +\n        (this.summary.unpaid_count || 0)\n      )\n    },\n  },\n  methods: {\n    getStatusIcon(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'check_circle'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'hourglass_top'\n      }\n      return 'radio_button_unchecked'\n    },\n\n    getStatusIconColor(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'success'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'warning'\n      }\n      return 'secondary'\n    },\n\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatDate(dateString: string): string {\n      if (!dateString) return ''\n      try {\n        const date = new Date(dateString)\n        return date.toLocaleDateString('en-US', {\n          month: 'short',\n          day: 'numeric',\n          year: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        provision_sales: 'Provision Sales',\n        confirmed: 'Confirmed',\n        completed: 'Completed',\n      }\n      return names[stage] || stage.replace(/_/g, ' ')\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-table-card {\n  margin-bottom: 1.5rem;\n}\n\n.total-badge {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #1f2937;\n  background: #f3f4f6;\n  padding: 4px 12px;\n  border-radius: 4px;\n}\n\n.loading-state {\n  padding: 40px 20px;\n}\n\n.payment-rows {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.payment-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  background: #f9fafb;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.payment-row:hover {\n  border-color: #d1d5db;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n\n.payment-row.is-paid {\n  background: #f0fdf4;\n  border-color: #bbf7d0;\n}\n\n.status-icon {\n  flex-shrink: 0;\n}\n\n.installment-details {\n  flex: 1;\n  min-width: 0;\n}\n\n.narration {\n  font-weight: 500;\n  color: #1f2937;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.triggers-badge {\n  margin-top: 4px;\n}\n\n.amount-section {\n  flex-shrink: 0;\n  text-align: right;\n}\n\n.amount {\n  font-weight: 600;\n  font-size: 1rem;\n  color: #1f2937;\n}\n\n.action-section {\n  flex-shrink: 0;\n  min-width: 150px;\n  text-align: right;\n}\n\n.paid-info {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  justify-content: flex-end;\n}\n\n.paid-badge {\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #16a34a;\n  background: #dcfce7;\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.paid-date {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.payment-summary {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  padding: 16px;\n  margin-top: 16px;\n  background: #f3f4f6;\n  border-radius: 8px;\n}\n\n.summary-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.9rem;\n  color: #4b5563;\n}\n\n.summary-item.paid {\n  color: #16a34a;\n  font-weight: 500;\n}\n\n.summary-item.remaining {\n  color: #d97706;\n  font-weight: 500;\n}\n\n.summary-divider {\n  color: #d1d5db;\n}\n\n.payment-progress {\n  margin-top: 16px;\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n  .payment-row {\n    flex-wrap: wrap;\n  }\n\n  .installment-details {\n    flex-basis: calc(100% - 50px);\n    order: 1;\n  }\n\n  .status-icon {\n    order: 0;\n  }\n\n  .amount-section {\n    order: 2;\n    flex-basis: 50%;\n  }\n\n  .action-section {\n    order: 3;\n    flex-basis: 50%;\n    min-width: auto;\n  }\n\n  .payment-summary {\n    flex-wrap: wrap;\n    gap: 8px;\n  }\n\n  .summary-divider {\n    display: none;\n  }\n}\n</style>\n","<template>\n  <VaModal\n    :model-value=\"modelValue\"\n    title=\"Record Payment\"\n    size=\"medium\"\n    :hide-default-actions=\"true\"\n    @update:modelValue=\"$emit('update:modelValue', $event)\"\n  >\n    <div class=\"payment-modal-content\">\n      <!-- Installment Info -->\n      <div class=\"installment-info mb-6\">\n        <div class=\"info-header\">\n          <VaIcon name=\"receipt_long\" color=\"primary\" />\n          <span>{{ installment?.narration || 'Payment' }}</span>\n        </div>\n        <div class=\"info-amount\">\n          <span class=\"label\">Amount Due:</span>\n          <span class=\"amount\">{{ formatCurrency(installment?.amount_due || 0) }}</span>\n        </div>\n        <!-- Show partial payment info if applicable -->\n        <div v-if=\"hasPartialPayment\" class=\"partial-payment-info mt-3\">\n          <div class=\"flex justify-between text-sm\">\n            <span class=\"text-gray-600\">Already Paid:</span>\n            <span class=\"text-green-600 font-medium\">{{ formatCurrency(installment?.amount_paid || 0) }}</span>\n          </div>\n          <div class=\"flex justify-between text-sm mt-1\">\n            <span class=\"text-gray-600\">Remaining Balance:</span>\n            <span class=\"text-orange-600 font-semibold\">{{ formatCurrency(remainingBalance) }}</span>\n          </div>\n        </div>\n      </div>\n\n      <!-- Stage Change Warning -->\n      <div v-if=\"triggersStage && willCompleteInstallment\" class=\"stage-warning mb-6\">\n        <VaIcon name=\"flash_on\" color=\"warning\" />\n        <span>\n          This payment will move the sale to\n          <strong>{{ formatStageName(triggersStage) }}</strong> stage\n        </span>\n      </div>\n\n      <!-- Partial Payment Notice -->\n      <div v-if=\"!willCompleteInstallment && form.amount_paid\" class=\"partial-notice mb-6\">\n        <VaIcon name=\"info\" color=\"info\" />\n        <span>This is a partial payment.</span>\n      </div>\n\n      <!-- Payment Form -->\n      <div class=\"payment-form\">\n        <VaInput\n          v-model.number=\"form.amount_paid\"\n          type=\"number\"\n          label=\"Amount Paid\"\n          placeholder=\"Enter amount\"\n          class=\"mb-4\"\n          :rules=\"[requiredRule, positiveAmountRule]\"\n        >\n          <template #prependInner>\n            <span class=\"text-gray-500\">$</span>\n          </template>\n        </VaInput>\n\n        <VaInput\n          v-model=\"form.payment_reference\"\n          label=\"Payment Reference\"\n          placeholder=\"e.g., TRX-2025-001\"\n          class=\"mb-4\"\n        />\n\n        <VaDateInput v-model=\"form.paid_at\" label=\"Payment Date\" class=\"mb-4\" :clearable=\"false\" />\n      </div>\n\n      <!-- Actions -->\n      <div class=\"modal-actions\">\n        <VaButton preset=\"secondary\" @click=\"handleCancel\"> Cancel </VaButton>\n        <VaButton color=\"primary\" :loading=\"loading\" :disabled=\"!isFormValid\" @click=\"handleSubmit\">\n          Record Payment\n        </VaButton>\n      </div>\n    </div>\n  </VaModal>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n}\n\nexport default defineComponent({\n  name: 'PaymentModal',\n  props: {\n    modelValue: {\n      type: Boolean,\n      default: false,\n    },\n    installment: {\n      type: Object as PropType<Installment | null>,\n      default: null,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['update:modelValue', 'submit'],\n  data() {\n    return {\n      form: {\n        amount_paid: null as number | null,\n        payment_reference: '',\n        paid_at: new Date(),\n      },\n    }\n  },\n  computed: {\n    isFormValid(): boolean {\n      return !!this.form.amount_paid && this.form.amount_paid > 0\n    },\n\n    hasPartialPayment(): boolean {\n      if (!this.installment) return false\n      return this.installment.payment_status === 'partial' || (this.installment.amount_paid || 0) > 0\n    },\n\n    remainingBalance(): number {\n      if (!this.installment) return 0\n      if (this.installment.remaining_balance !== undefined) {\n        return this.installment.remaining_balance\n      }\n      return (this.installment.amount_due || 0) - (this.installment.amount_paid || 0)\n    },\n\n    willCompleteInstallment(): boolean {\n      if (!this.installment || !this.form.amount_paid) return false\n      return this.form.amount_paid >= this.remainingBalance\n    },\n\n    triggersStage(): string | null {\n      if (!this.installment) return null\n\n      // Check explicit triggers_stage from API\n      if (this.installment.triggers_stage) {\n        return this.installment.triggers_stage\n      }\n\n      // Determine from narration/type\n      const narration = this.installment.narration?.toLowerCase() || ''\n      const type = this.installment.installment_type?.toLowerCase() || ''\n\n      if (type.includes('deposit_booking') || (narration.includes('deposit') && narration.includes('booking'))) {\n        return 'provision_sales'\n      }\n      if (type.includes('final_payment') || (narration.includes('final') && narration.includes('90'))) {\n        return 'confirmed'\n      }\n      if (type.includes('trophy_deposit') || (narration.includes('trophy') && narration.includes('45'))) {\n        return 'completed'\n      }\n\n      return null\n    },\n\n    requiredRule() {\n      return (v: any) => !!v || 'Amount is required'\n    },\n\n    positiveAmountRule() {\n      return (v: any) => (v && Number(v) > 0) || 'Amount must be positive'\n    },\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal && this.installment) {\n        // Reset form without pre-filling amount\n        this.form.amount_paid = null\n        this.form.payment_reference = ''\n        this.form.paid_at = new Date()\n      }\n    },\n  },\n  methods: {\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        pending: 'PENDING',\n        provision_sales: 'PROVISION SALES',\n        confirmed: 'CONFIRMED',\n        completed: 'COMPLETED',\n      }\n      return names[stage] || stage.replace(/_/g, ' ').toUpperCase()\n    },\n\n    handleCancel() {\n      this.$emit('update:modelValue', false)\n    },\n\n    handleSubmit() {\n      if (!this.installment || !this.isFormValid) return\n\n      const payload = {\n        installment_id: this.installment.id,\n        amount_paid: this.form.amount_paid!,\n        payment_reference: this.form.payment_reference || undefined,\n        paid_at: this.form.paid_at ? this.formatDateForApi(this.form.paid_at) : undefined,\n      }\n\n      this.$emit('submit', payload)\n    },\n\n    formatDateForApi(date: Date): string {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      return `${year}-${month}-${day}`\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-modal-content {\n  padding: 16px;\n}\n\n.installment-info {\n  background: #f3f4f6;\n  border-radius: 8px;\n  padding: 16px;\n}\n\n.info-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 12px;\n}\n\n.info-amount {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.info-amount .label {\n  color: #6b7280;\n}\n\n.info-amount .amount {\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-warning {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fff9c4;\n  border-radius: 8px;\n  border-left: 4px solid #ffc107;\n  font-size: 0.9rem;\n  color: #856404;\n}\n\n.stage-warning strong {\n  color: #1f2937;\n}\n\n.partial-notice {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #e0f2fe;\n  border-radius: 8px;\n  border-left: 4px solid #2196f3;\n  font-size: 0.9rem;\n  color: #0369a1;\n}\n\n.partial-payment-info {\n  border-top: 1px solid #e5e7eb;\n  padding-top: 12px;\n}\n\n.payment-form {\n  margin-bottom: 24px;\n}\n\n.modal-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n}\n</style>\n","<template>\n  <VaModal\n    :model-value=\"modelValue\"\n    title=\"Record Payment\"\n    size=\"medium\"\n    :hide-default-actions=\"true\"\n    @update:modelValue=\"$emit('update:modelValue', $event)\"\n  >\n    <div class=\"payment-modal-content\">\n      <!-- Installment Info -->\n      <div class=\"installment-info mb-6\">\n        <div class=\"info-header\">\n          <VaIcon name=\"receipt_long\" color=\"primary\" />\n          <span>{{ installment?.narration || 'Payment' }}</span>\n        </div>\n        <div class=\"info-amount\">\n          <span class=\"label\">Amount Due:</span>\n          <span class=\"amount\">{{ formatCurrency(installment?.amount_due || 0) }}</span>\n        </div>\n        <!-- Show partial payment info if applicable -->\n        <div v-if=\"hasPartialPayment\" class=\"partial-payment-info mt-3\">\n          <div class=\"flex justify-between text-sm\">\n            <span class=\"text-gray-600\">Already Paid:</span>\n            <span class=\"text-green-600 font-medium\">{{ formatCurrency(installment?.amount_paid || 0) }}</span>\n          </div>\n          <div class=\"flex justify-between text-sm mt-1\">\n            <span class=\"text-gray-600\">Remaining Balance:</span>\n            <span class=\"text-orange-600 font-semibold\">{{ formatCurrency(remainingBalance) }}</span>\n          </div>\n        </div>\n      </div>\n\n      <!-- Stage Change Warning -->\n      <div v-if=\"triggersStage && willCompleteInstallment\" class=\"stage-warning mb-6\">\n        <VaIcon name=\"flash_on\" color=\"warning\" />\n        <span>\n          This payment will move the sale to\n          <strong>{{ formatStageName(triggersStage) }}</strong> stage\n        </span>\n      </div>\n\n      <!-- Partial Payment Notice -->\n      <div v-if=\"!willCompleteInstallment && form.amount_paid\" class=\"partial-notice mb-6\">\n        <VaIcon name=\"info\" color=\"info\" />\n        <span>This is a partial payment.</span>\n      </div>\n\n      <!-- Payment Form -->\n      <div class=\"payment-form\">\n        <VaInput\n          v-model.number=\"form.amount_paid\"\n          type=\"number\"\n          label=\"Amount Paid\"\n          placeholder=\"Enter amount\"\n          class=\"mb-4\"\n          :rules=\"[requiredRule, positiveAmountRule]\"\n        >\n          <template #prependInner>\n            <span class=\"text-gray-500\">$</span>\n          </template>\n        </VaInput>\n\n        <VaInput\n          v-model=\"form.payment_reference\"\n          label=\"Payment Reference\"\n          placeholder=\"e.g., TRX-2025-001\"\n          class=\"mb-4\"\n        />\n\n        <VaDateInput v-model=\"form.paid_at\" label=\"Payment Date\" class=\"mb-4\" :clearable=\"false\" />\n      </div>\n\n      <!-- Actions -->\n      <div class=\"modal-actions\">\n        <VaButton preset=\"secondary\" @click=\"handleCancel\"> Cancel </VaButton>\n        <VaButton color=\"primary\" :loading=\"loading\" :disabled=\"!isFormValid\" @click=\"handleSubmit\">\n          Record Payment\n        </VaButton>\n      </div>\n    </div>\n  </VaModal>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n}\n\nexport default defineComponent({\n  name: 'PaymentModal',\n  props: {\n    modelValue: {\n      type: Boolean,\n      default: false,\n    },\n    installment: {\n      type: Object as PropType<Installment | null>,\n      default: null,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['update:modelValue', 'submit'],\n  data() {\n    return {\n      form: {\n        amount_paid: null as number | null,\n        payment_reference: '',\n        paid_at: new Date(),\n      },\n    }\n  },\n  computed: {\n    isFormValid(): boolean {\n      return !!this.form.amount_paid && this.form.amount_paid > 0\n    },\n\n    hasPartialPayment(): boolean {\n      if (!this.installment) return false\n      return this.installment.payment_status === 'partial' || (this.installment.amount_paid || 0) > 0\n    },\n\n    remainingBalance(): number {\n      if (!this.installment) return 0\n      if (this.installment.remaining_balance !== undefined) {\n        return this.installment.remaining_balance\n      }\n      return (this.installment.amount_due || 0) - (this.installment.amount_paid || 0)\n    },\n\n    willCompleteInstallment(): boolean {\n      if (!this.installment || !this.form.amount_paid) return false\n      return this.form.amount_paid >= this.remainingBalance\n    },\n\n    triggersStage(): string | null {\n      if (!this.installment) return null\n\n      // Check explicit triggers_stage from API\n      if (this.installment.triggers_stage) {\n        return this.installment.triggers_stage\n      }\n\n      // Determine from narration/type\n      const narration = this.installment.narration?.toLowerCase() || ''\n      const type = this.installment.installment_type?.toLowerCase() || ''\n\n      if (type.includes('deposit_booking') || (narration.includes('deposit') && narration.includes('booking'))) {\n        return 'provision_sales'\n      }\n      if (type.includes('final_payment') || (narration.includes('final') && narration.includes('90'))) {\n        return 'confirmed'\n      }\n      if (type.includes('trophy_deposit') || (narration.includes('trophy') && narration.includes('45'))) {\n        return 'completed'\n      }\n\n      return null\n    },\n\n    requiredRule() {\n      return (v: any) => !!v || 'Amount is required'\n    },\n\n    positiveAmountRule() {\n      return (v: any) => (v && Number(v) > 0) || 'Amount must be positive'\n    },\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal && this.installment) {\n        // Reset form without pre-filling amount\n        this.form.amount_paid = null\n        this.form.payment_reference = ''\n        this.form.paid_at = new Date()\n      }\n    },\n  },\n  methods: {\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        pending: 'PENDING',\n        provision_sales: 'PROVISION SALES',\n        confirmed: 'CONFIRMED',\n        completed: 'COMPLETED',\n      }\n      return names[stage] || stage.replace(/_/g, ' ').toUpperCase()\n    },\n\n    handleCancel() {\n      this.$emit('update:modelValue', false)\n    },\n\n    handleSubmit() {\n      if (!this.installment || !this.isFormValid) return\n\n      const payload = {\n        installment_id: this.installment.id,\n        amount_paid: this.form.amount_paid!,\n        payment_reference: this.form.payment_reference || undefined,\n        paid_at: this.form.paid_at ? this.formatDateForApi(this.form.paid_at) : undefined,\n      }\n\n      this.$emit('submit', payload)\n    },\n\n    formatDateForApi(date: Date): string {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      return `${year}-${month}-${day}`\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-modal-content {\n  padding: 16px;\n}\n\n.installment-info {\n  background: #f3f4f6;\n  border-radius: 8px;\n  padding: 16px;\n}\n\n.info-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 12px;\n}\n\n.info-amount {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.info-amount .label {\n  color: #6b7280;\n}\n\n.info-amount .amount {\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-warning {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fff9c4;\n  border-radius: 8px;\n  border-left: 4px solid #ffc107;\n  font-size: 0.9rem;\n  color: #856404;\n}\n\n.stage-warning strong {\n  color: #1f2937;\n}\n\n.partial-notice {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #e0f2fe;\n  border-radius: 8px;\n  border-left: 4px solid #2196f3;\n  font-size: 0.9rem;\n  color: #0369a1;\n}\n\n.partial-payment-info {\n  border-top: 1px solid #e5e7eb;\n  padding-top: 12px;\n}\n\n.payment-form {\n  margin-bottom: 24px;\n}\n\n.modal-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n}\n</style>\n","<template>\n  <div class=\"proposal-view\">\n    <!-- Header with Logo and Title -->\n    <div class=\"proposal-header\">\n      <div class=\"flex justify-between items-start mb-6\">\n        <div class=\"logo-section\">\n          <img v-if=\"logoUrl\" :src=\"logoUrl\" alt=\"Company Logo\" class=\"h-16\" />\n          <h2 v-else class=\"text-xl font-bold text-primary\">Bushman Safari Trackers Limited</h2>\n        </div>\n        <div class=\"text-right\">\n          <h1 class=\"text-2xl font-bold text-gray-800 mb-2\">SALES CONFIRMATION</h1>\n          <p class=\"text-gray-600\">\n            Date: {{ proposal.confirmation_date_formatted || formatDate(proposal.confirmation_date) }}\n          </p>\n          <VaChip :color=\"getStatusColor(proposal.status)\" size=\"small\" class=\"mt-2\">\n            {{ formatStatus(proposal.status) }}\n          </VaChip>\n        </div>\n      </div>\n    </div>\n\n    <!-- Stage Indicator -->\n    <StageIndicator\n      v-if=\"proposal.status\"\n      :current-stage=\"proposal.status\"\n      :installments=\"paymentInstallments\"\n      class=\"mb-6\"\n    />\n\n    <!-- Action Buttons -->\n    <div class=\"action-buttons mb-6 flex flex-wrap justify-end gap-3\">\n      <VaButton preset=\"secondary\" icon=\"print\" @click=\"printProposal\"> Print </VaButton>\n      <VaButton preset=\"secondary\" icon=\"download\" @click=\"downloadPdf\"> Download PDF </VaButton>\n      <VaButton color=\"primary\" icon=\"edit\" @click=\"$emit('edit', proposal)\"> Edit </VaButton>\n\n      <!-- Manual Cancel Button (only available before completion) -->\n      <VaButton v-if=\"canBeCancelled\" color=\"secondary\" icon=\"cancel\" @click=\"changeToStage('cancelled')\">\n        Cancel\n      </VaButton>\n    </div>\n\n    <!-- Sales Agent & Client Info -->\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n      <!-- Sales Agent -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"support_agent\" color=\"primary\" />\n          Sales Agent\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Client Info -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"person\" color=\"primary\" />\n          Client Information\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value font-semibold\">{{ proposal.client?.full_name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Address:</span>\n            <span class=\"value\">{{ proposal.client?.address || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Home Tel:</span>\n            <span class=\"value\">{{ proposal.client?.home_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Work Tel:</span>\n            <span class=\"value\">{{ proposal.client?.work_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Cell:</span>\n            <span class=\"value\">{{ proposal.client?.cell || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.client?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </div>\n\n    <!-- Hunting Trip Details -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"landscape\" color=\"primary\" />\n        Hunting Trip Details\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Type of Safari:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.type || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting Area:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.hunting_area || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Outfitter:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.outfitter || 'Bushman Safari Trackers Limited' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Dates:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.dates || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Details of Trip -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"groups\" color=\"primary\" />\n        Details of Trip\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_hunters || 0 }}</div>\n            <div class=\"stat-label\">Hunters</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_observers || 0 }}</div>\n            <div class=\"stat-label\">Observers</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_companions || 0 }}</div>\n            <div class=\"stat-label\">Companions</div>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Hunt Combination (Species) -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"pets\" color=\"primary\" />\n        Hunt Combination\n      </VaCardTitle>\n      <VaCardContent>\n        <VaDataTable :items=\"proposal.hunt_combination || []\" :columns=\"speciesColumns\" hoverable striped>\n          <template #cell(species_name)=\"{ rowData }\">\n            <div class=\"flex flex-col\">\n              <span class=\"font-semibold\">{{ rowData.species_name }}</span>\n              <span class=\"text-xs text-gray-500 italic\">{{ rowData.scientific_name }}</span>\n            </div>\n          </template>\n          <template #cell(quantity)=\"{ rowData }\">\n            <VaBadge :text=\"String(rowData.quantity)\" color=\"primary\" />\n          </template>\n        </VaDataTable>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Pricing / Payment Schedule -->\n    <PaymentTable\n      :installments=\"paymentInstallments\"\n      :summary=\"paymentSummary\"\n      :total-amount=\"proposal.pricing?.total_amount || 0\"\n      :loading=\"loadingPayments\"\n      :allow-unpay=\"true\"\n      @recordPayment=\"openPaymentModal\"\n      @unpay=\"handleUnpay\"\n    />\n\n    <!-- Sales Inquiry Reference -->\n    <VaCard outlined class=\"mb-6 bg-gray-50\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"link\" color=\"info\" />\n        Linked Sales Inquiry\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Inquiry Code:</span>\n            <span class=\"value font-mono\">{{ proposal.sales_inquiry?.code || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Created Date:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.created_date || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Season:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.season || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting License:</span>\n            <span class=\"value\">{{ proposal.hunting_license || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Remarks -->\n    <VaCard v-if=\"proposal.remarks\" outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"notes\" color=\"primary\" />\n        Remarks\n      </VaCardTitle>\n      <VaCardContent>\n        <p class=\"text-gray-700\">{{ proposal.remarks }}</p>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Payment Modal -->\n    <PaymentModal\n      v-model=\"showPaymentModal\"\n      :installment=\"selectedInstallment\"\n      :loading=\"savingPayment\"\n      @submit=\"handlePaymentSubmit\"\n    />\n\n    <!-- Status Change Modal -->\n    <VaModal v-model=\"showStatusModal\" title=\"Change Proposal Status\" :hide-default-actions=\"true\">\n      <div class=\"p-4\">\n        <VaSelect v-model=\"newStatus\" :options=\"statusOptions\" label=\"Select New Status\" class=\"mb-4\" />\n        <div class=\"flex justify-end gap-3\">\n          <VaButton preset=\"secondary\" @click=\"showStatusModal = false\">Cancel</VaButton>\n          <VaButton color=\"primary\" @click=\"changeStatus\">Confirm</VaButton>\n        </div>\n      </div>\n    </VaModal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { mapState, mapActions } from 'pinia'\nimport { useSettingsStore } from '../../../../stores/settings-store'\nimport { useProposalStore } from '../../../../stores/proposal-store'\nimport StageIndicator from './StageIndicator.vue'\nimport PaymentTable from './PaymentTable.vue'\nimport PaymentModal from './PaymentModal.vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  payment_reference?: string | null\n  payments?: Array<{\n    id: number\n    amount: number\n    payment_reference: string | null\n    paid_at: string\n  }>\n}\n\nexport default defineComponent({\n  name: 'ProposalView',\n  components: {\n    StageIndicator,\n    PaymentTable,\n    PaymentModal,\n  },\n  props: {\n    proposal: {\n      type: Object as PropType<any>,\n      required: true,\n    },\n  },\n  emits: ['edit', 'status-change', 'payment-recorded'],\n  data() {\n    return {\n      showStatusModal: false,\n      showPaymentModal: false,\n      selectedInstallment: null as Installment | null,\n      newStatus: null as string | null,\n      loadingPayments: false,\n      savingPayment: false,\n      speciesColumns: [\n        { key: 'species_name', label: 'Species', sortable: true },\n        { key: 'quantity', label: 'Quantity', sortable: true, width: 120 },\n      ],\n      statusOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provisional Sale' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'declined', text: 'Declined' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n    }\n  },\n  computed: {\n    ...mapState(useSettingsStore, ['logo']),\n    ...mapState(useProposalStore, ['paymentStatus']),\n\n    logoUrl(): string | null {\n      return this.logo || null\n    },\n\n    canBeCancelled(): boolean {\n      const status = this.proposal.status\n      return status === 'pending' || status === 'provision_sales' || status === 'confirmed'\n    },\n\n    paymentInstallments(): Installment[] {\n      // Use payment status from API if available, otherwise fall back to proposal installments\n      if (this.paymentStatus?.installments) {\n        return this.paymentStatus.installments\n      }\n      // Map proposal installments with default is_paid status\n      return (this.proposal.pricing?.installments || []).map((inst: any) => ({\n        ...inst,\n        is_paid: inst.is_paid || false,\n        paid_at: inst.paid_at || null,\n        amount_paid: inst.amount_paid || null,\n        payment_reference: inst.payment_reference || null,\n      }))\n    },\n\n    paymentSummary() {\n      if (this.paymentStatus?.summary) {\n        return this.paymentStatus.summary\n      }\n      // Calculate from installments\n      const installments = this.paymentInstallments\n      const total_due = installments.reduce((sum: number, i: Installment) => sum + (i.amount_due || 0), 0)\n      const total_paid = installments.reduce(\n        (sum: number, i: Installment) => sum + (i.is_paid ? i.amount_paid || i.amount_due : 0),\n        0,\n      )\n      const paid_count = installments.filter((i: Installment) => i.is_paid).length\n      return {\n        total_due,\n        total_paid,\n        total_unpaid: total_due - total_paid,\n        paid_count,\n        unpaid_count: installments.length - paid_count,\n      }\n    },\n  },\n  watch: {\n    'proposal.id': {\n      handler() {\n        this.loadPaymentStatus()\n      },\n    },\n  },\n  mounted() {\n    this.loadPaymentStatus()\n  },\n  methods: {\n    ...mapActions(useProposalStore, ['fetchPayments', 'recordPayment', 'unpayInstallment']),\n\n    async loadPaymentStatus() {\n      if (!this.proposal?.id) return\n      this.loadingPayments = true\n      try {\n        await this.fetchPayments(this.proposal.id)\n      } catch (error) {\n        console.error('Error loading payment status:', error)\n      } finally {\n        this.loadingPayments = false\n      }\n    },\n\n    formatDate(dateString: string | undefined): string {\n      if (!dateString) return 'N/A'\n      try {\n        return new Date(dateString).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatCurrency(amount: number | undefined): string {\n      if (!amount) return '$0'\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    getStatusColor(status: string): string {\n      const colors: Record<string, string> = {\n        pending: 'warning',\n        provision_sales: 'info',\n        confirmed: 'success',\n        declined: 'danger',\n        cancelled: 'secondary',\n        completed: 'primary',\n      }\n      return colors[status] || 'secondary'\n    },\n\n    formatStatus(status: string): string {\n      if (!status) return 'N/A'\n      return status.replace(/_/g, ' ').replace(/\\b\\w/g, (c) => c.toUpperCase())\n    },\n\n    printProposal() {\n      window.print()\n    },\n\n    async downloadPdf() {\n      if (!this.proposal?.id) {\n        this.$vaToast?.init({\n          message: 'No proposal selected',\n          color: 'warning',\n        })\n        return\n      }\n\n      try {\n        this.$vaToast?.init({\n          message: 'Generating PDF...',\n          color: 'info',\n        })\n\n        const response = await fetch(\n          `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${this.proposal.id}/pdf`,\n        )\n        const data = await response.json()\n\n        if (data.success) {\n          // Convert base64 to blob and download\n          const byteCharacters = atob(data.pdf)\n          const byteNumbers = new Array(byteCharacters.length)\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i)\n          }\n          const byteArray = new Uint8Array(byteNumbers)\n          const blob = new Blob([byteArray], { type: 'application/pdf' })\n\n          // Create download link\n          const url = window.URL.createObjectURL(blob)\n          const a = document.createElement('a')\n          a.href = url\n          a.download = `Sales_Confirmation_${data.client_name || this.proposal.client?.full_name || 'Proposal'}.pdf`\n          a.click()\n\n          // Clean up\n          window.URL.revokeObjectURL(url)\n\n          this.$vaToast?.init({\n            message: 'PDF downloaded successfully',\n            color: 'success',\n          })\n        } else {\n          this.$vaToast?.init({\n            message: data.message || 'Failed to generate PDF',\n            color: 'danger',\n          })\n        }\n      } catch (error) {\n        console.error('Error downloading PDF:', error)\n        this.$vaToast?.init({\n          message: 'Failed to download PDF',\n          color: 'danger',\n        })\n      }\n    },\n\n    confirmProposal() {\n      this.newStatus = 'confirmed'\n      this.showStatusModal = true\n    },\n\n    changeToStage(stage: string) {\n      this.$emit('status-change', {\n        id: this.proposal.id,\n        status: stage,\n      })\n    },\n\n    changeStatus() {\n      if (this.newStatus) {\n        this.$emit('status-change', {\n          id: this.proposal.id,\n          status: this.newStatus,\n        })\n        this.showStatusModal = false\n        this.newStatus = null\n      }\n    },\n\n    // Payment methods\n    openPaymentModal(installment: Installment) {\n      this.selectedInstallment = installment\n      this.showPaymentModal = true\n    },\n\n    async handlePaymentSubmit(payload: {\n      installment_id: number\n      amount_paid: number\n      payment_reference?: string\n      paid_at?: string\n    }) {\n      this.savingPayment = true\n      try {\n        const result = await this.recordPayment(payload.installment_id, {\n          amount_paid: payload.amount_paid,\n          payment_reference: payload.payment_reference,\n          paid_at: payload.paid_at,\n        })\n\n        this.showPaymentModal = false\n        this.selectedInstallment = null\n\n        // Build success message based on payment status\n        let message = 'Payment recorded successfully'\n        if (result.stage_changed) {\n          message = result.message || `Payment recorded. Stage updated to ${this.formatStatus(result.new_stage || '')}`\n        } else if (result.data?.payment_status === 'partial') {\n          const remaining = this.formatCurrency(result.data.remaining_balance)\n          message = `Partial payment recorded. Remaining balance: ${remaining}`\n        }\n\n        this.$vaToast?.init({\n          message,\n          color: 'success',\n        })\n\n        // Emit event for parent to refresh if needed\n        this.$emit('payment-recorded', result)\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to record payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n\n    async handleUnpay(installment: Installment) {\n      if (!confirm(`Are you sure you want to reverse the payment for \"${installment.narration}\"?`)) {\n        return\n      }\n\n      this.savingPayment = true\n      try {\n        await this.unpayInstallment(installment.id)\n\n        this.$vaToast?.init({\n          message: 'Payment reversed successfully',\n          color: 'success',\n        })\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to reverse payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n  },\n})\n</script>\n\n<style scoped>\n.proposal-view {\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.proposal-header {\n  border-bottom: 2px solid #e5e7eb;\n  padding-bottom: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.info-row {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n\n.info-row .label {\n  color: #6b7280;\n  min-width: 100px;\n}\n\n.info-row .value {\n  color: #1f2937;\n}\n\n.stat-card {\n  background-color: #f3f4f6;\n  border-radius: 8px;\n  padding: 1.5rem;\n  text-align: center;\n}\n\n.stat-value {\n  font-size: 2rem;\n  font-weight: 700;\n  color: var(--va-primary);\n}\n\n.stat-label {\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.total-row {\n  background: linear-gradient(135deg, var(--va-primary), var(--va-primary-darken));\n}\n\n@media print {\n  .action-buttons {\n    display: none !important;\n  }\n\n  .proposal-view {\n    max-width: 100%;\n  }\n\n  :deep(.va-card) {\n    box-shadow: none !important;\n    border: 1px solid #e5e7eb !important;\n  }\n}\n</style>\n","<template>\n  <div class=\"proposal-view\">\n    <!-- Header with Logo and Title -->\n    <div class=\"proposal-header\">\n      <div class=\"flex justify-between items-start mb-6\">\n        <div class=\"logo-section\">\n          <img v-if=\"logoUrl\" :src=\"logoUrl\" alt=\"Company Logo\" class=\"h-16\" />\n          <h2 v-else class=\"text-xl font-bold text-primary\">Bushman Safari Trackers Limited</h2>\n        </div>\n        <div class=\"text-right\">\n          <h1 class=\"text-2xl font-bold text-gray-800 mb-2\">SALES CONFIRMATION</h1>\n          <p class=\"text-gray-600\">\n            Date: {{ proposal.confirmation_date_formatted || formatDate(proposal.confirmation_date) }}\n          </p>\n          <VaChip :color=\"getStatusColor(proposal.status)\" size=\"small\" class=\"mt-2\">\n            {{ formatStatus(proposal.status) }}\n          </VaChip>\n        </div>\n      </div>\n    </div>\n\n    <!-- Stage Indicator -->\n    <StageIndicator\n      v-if=\"proposal.status\"\n      :current-stage=\"proposal.status\"\n      :installments=\"paymentInstallments\"\n      class=\"mb-6\"\n    />\n\n    <!-- Action Buttons -->\n    <div class=\"action-buttons mb-6 flex flex-wrap justify-end gap-3\">\n      <VaButton preset=\"secondary\" icon=\"print\" @click=\"printProposal\"> Print </VaButton>\n      <VaButton preset=\"secondary\" icon=\"download\" @click=\"downloadPdf\"> Download PDF </VaButton>\n      <VaButton color=\"primary\" icon=\"edit\" @click=\"$emit('edit', proposal)\"> Edit </VaButton>\n\n      <!-- Manual Cancel Button (only available before completion) -->\n      <VaButton v-if=\"canBeCancelled\" color=\"secondary\" icon=\"cancel\" @click=\"changeToStage('cancelled')\">\n        Cancel\n      </VaButton>\n    </div>\n\n    <!-- Sales Agent & Client Info -->\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n      <!-- Sales Agent -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"support_agent\" color=\"primary\" />\n          Sales Agent\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Client Info -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"person\" color=\"primary\" />\n          Client Information\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value font-semibold\">{{ proposal.client?.full_name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Address:</span>\n            <span class=\"value\">{{ proposal.client?.address || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Home Tel:</span>\n            <span class=\"value\">{{ proposal.client?.home_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Work Tel:</span>\n            <span class=\"value\">{{ proposal.client?.work_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Cell:</span>\n            <span class=\"value\">{{ proposal.client?.cell || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.client?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </div>\n\n    <!-- Hunting Trip Details -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"landscape\" color=\"primary\" />\n        Hunting Trip Details\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Type of Safari:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.type || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting Area:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.hunting_area || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Outfitter:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.outfitter || 'Bushman Safari Trackers Limited' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Dates:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.dates || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Details of Trip -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"groups\" color=\"primary\" />\n        Details of Trip\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_hunters || 0 }}</div>\n            <div class=\"stat-label\">Hunters</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_observers || 0 }}</div>\n            <div class=\"stat-label\">Observers</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_companions || 0 }}</div>\n            <div class=\"stat-label\">Companions</div>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Hunt Combination (Species) -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"pets\" color=\"primary\" />\n        Hunt Combination\n      </VaCardTitle>\n      <VaCardContent>\n        <VaDataTable :items=\"proposal.hunt_combination || []\" :columns=\"speciesColumns\" hoverable striped>\n          <template #cell(species_name)=\"{ rowData }\">\n            <div class=\"flex flex-col\">\n              <span class=\"font-semibold\">{{ rowData.species_name }}</span>\n              <span class=\"text-xs text-gray-500 italic\">{{ rowData.scientific_name }}</span>\n            </div>\n          </template>\n          <template #cell(quantity)=\"{ rowData }\">\n            <VaBadge :text=\"String(rowData.quantity)\" color=\"primary\" />\n          </template>\n        </VaDataTable>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Pricing / Payment Schedule -->\n    <PaymentTable\n      :installments=\"paymentInstallments\"\n      :summary=\"paymentSummary\"\n      :total-amount=\"proposal.pricing?.total_amount || 0\"\n      :loading=\"loadingPayments\"\n      :allow-unpay=\"true\"\n      @recordPayment=\"openPaymentModal\"\n      @unpay=\"handleUnpay\"\n    />\n\n    <!-- Sales Inquiry Reference -->\n    <VaCard outlined class=\"mb-6 bg-gray-50\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"link\" color=\"info\" />\n        Linked Sales Inquiry\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Inquiry Code:</span>\n            <span class=\"value font-mono\">{{ proposal.sales_inquiry?.code || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Created Date:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.created_date || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Season:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.season || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting License:</span>\n            <span class=\"value\">{{ proposal.hunting_license || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Remarks -->\n    <VaCard v-if=\"proposal.remarks\" outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"notes\" color=\"primary\" />\n        Remarks\n      </VaCardTitle>\n      <VaCardContent>\n        <p class=\"text-gray-700\">{{ proposal.remarks }}</p>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Payment Modal -->\n    <PaymentModal\n      v-model=\"showPaymentModal\"\n      :installment=\"selectedInstallment\"\n      :loading=\"savingPayment\"\n      @submit=\"handlePaymentSubmit\"\n    />\n\n    <!-- Status Change Modal -->\n    <VaModal v-model=\"showStatusModal\" title=\"Change Proposal Status\" :hide-default-actions=\"true\">\n      <div class=\"p-4\">\n        <VaSelect v-model=\"newStatus\" :options=\"statusOptions\" label=\"Select New Status\" class=\"mb-4\" />\n        <div class=\"flex justify-end gap-3\">\n          <VaButton preset=\"secondary\" @click=\"showStatusModal = false\">Cancel</VaButton>\n          <VaButton color=\"primary\" @click=\"changeStatus\">Confirm</VaButton>\n        </div>\n      </div>\n    </VaModal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { mapState, mapActions } from 'pinia'\nimport { useSettingsStore } from '../../../../stores/settings-store'\nimport { useProposalStore } from '../../../../stores/proposal-store'\nimport StageIndicator from './StageIndicator.vue'\nimport PaymentTable from './PaymentTable.vue'\nimport PaymentModal from './PaymentModal.vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  payment_reference?: string | null\n  payments?: Array<{\n    id: number\n    amount: number\n    payment_reference: string | null\n    paid_at: string\n  }>\n}\n\nexport default defineComponent({\n  name: 'ProposalView',\n  components: {\n    StageIndicator,\n    PaymentTable,\n    PaymentModal,\n  },\n  props: {\n    proposal: {\n      type: Object as PropType<any>,\n      required: true,\n    },\n  },\n  emits: ['edit', 'status-change', 'payment-recorded'],\n  data() {\n    return {\n      showStatusModal: false,\n      showPaymentModal: false,\n      selectedInstallment: null as Installment | null,\n      newStatus: null as string | null,\n      loadingPayments: false,\n      savingPayment: false,\n      speciesColumns: [\n        { key: 'species_name', label: 'Species', sortable: true },\n        { key: 'quantity', label: 'Quantity', sortable: true, width: 120 },\n      ],\n      statusOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provisional Sale' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'declined', text: 'Declined' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n    }\n  },\n  computed: {\n    ...mapState(useSettingsStore, ['logo']),\n    ...mapState(useProposalStore, ['paymentStatus']),\n\n    logoUrl(): string | null {\n      return this.logo || null\n    },\n\n    canBeCancelled(): boolean {\n      const status = this.proposal.status\n      return status === 'pending' || status === 'provision_sales' || status === 'confirmed'\n    },\n\n    paymentInstallments(): Installment[] {\n      // Use payment status from API if available, otherwise fall back to proposal installments\n      if (this.paymentStatus?.installments) {\n        return this.paymentStatus.installments\n      }\n      // Map proposal installments with default is_paid status\n      return (this.proposal.pricing?.installments || []).map((inst: any) => ({\n        ...inst,\n        is_paid: inst.is_paid || false,\n        paid_at: inst.paid_at || null,\n        amount_paid: inst.amount_paid || null,\n        payment_reference: inst.payment_reference || null,\n      }))\n    },\n\n    paymentSummary() {\n      if (this.paymentStatus?.summary) {\n        return this.paymentStatus.summary\n      }\n      // Calculate from installments\n      const installments = this.paymentInstallments\n      const total_due = installments.reduce((sum: number, i: Installment) => sum + (i.amount_due || 0), 0)\n      const total_paid = installments.reduce(\n        (sum: number, i: Installment) => sum + (i.is_paid ? i.amount_paid || i.amount_due : 0),\n        0,\n      )\n      const paid_count = installments.filter((i: Installment) => i.is_paid).length\n      return {\n        total_due,\n        total_paid,\n        total_unpaid: total_due - total_paid,\n        paid_count,\n        unpaid_count: installments.length - paid_count,\n      }\n    },\n  },\n  watch: {\n    'proposal.id': {\n      handler() {\n        this.loadPaymentStatus()\n      },\n    },\n  },\n  mounted() {\n    this.loadPaymentStatus()\n  },\n  methods: {\n    ...mapActions(useProposalStore, ['fetchPayments', 'recordPayment', 'unpayInstallment']),\n\n    async loadPaymentStatus() {\n      if (!this.proposal?.id) return\n      this.loadingPayments = true\n      try {\n        await this.fetchPayments(this.proposal.id)\n      } catch (error) {\n        console.error('Error loading payment status:', error)\n      } finally {\n        this.loadingPayments = false\n      }\n    },\n\n    formatDate(dateString: string | undefined): string {\n      if (!dateString) return 'N/A'\n      try {\n        return new Date(dateString).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatCurrency(amount: number | undefined): string {\n      if (!amount) return '$0'\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    getStatusColor(status: string): string {\n      const colors: Record<string, string> = {\n        pending: 'warning',\n        provision_sales: 'info',\n        confirmed: 'success',\n        declined: 'danger',\n        cancelled: 'secondary',\n        completed: 'primary',\n      }\n      return colors[status] || 'secondary'\n    },\n\n    formatStatus(status: string): string {\n      if (!status) return 'N/A'\n      return status.replace(/_/g, ' ').replace(/\\b\\w/g, (c) => c.toUpperCase())\n    },\n\n    printProposal() {\n      window.print()\n    },\n\n    async downloadPdf() {\n      if (!this.proposal?.id) {\n        this.$vaToast?.init({\n          message: 'No proposal selected',\n          color: 'warning',\n        })\n        return\n      }\n\n      try {\n        this.$vaToast?.init({\n          message: 'Generating PDF...',\n          color: 'info',\n        })\n\n        const response = await fetch(\n          `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${this.proposal.id}/pdf`,\n        )\n        const data = await response.json()\n\n        if (data.success) {\n          // Convert base64 to blob and download\n          const byteCharacters = atob(data.pdf)\n          const byteNumbers = new Array(byteCharacters.length)\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i)\n          }\n          const byteArray = new Uint8Array(byteNumbers)\n          const blob = new Blob([byteArray], { type: 'application/pdf' })\n\n          // Create download link\n          const url = window.URL.createObjectURL(blob)\n          const a = document.createElement('a')\n          a.href = url\n          a.download = `Sales_Confirmation_${data.client_name || this.proposal.client?.full_name || 'Proposal'}.pdf`\n          a.click()\n\n          // Clean up\n          window.URL.revokeObjectURL(url)\n\n          this.$vaToast?.init({\n            message: 'PDF downloaded successfully',\n            color: 'success',\n          })\n        } else {\n          this.$vaToast?.init({\n            message: data.message || 'Failed to generate PDF',\n            color: 'danger',\n          })\n        }\n      } catch (error) {\n        console.error('Error downloading PDF:', error)\n        this.$vaToast?.init({\n          message: 'Failed to download PDF',\n          color: 'danger',\n        })\n      }\n    },\n\n    confirmProposal() {\n      this.newStatus = 'confirmed'\n      this.showStatusModal = true\n    },\n\n    changeToStage(stage: string) {\n      this.$emit('status-change', {\n        id: this.proposal.id,\n        status: stage,\n      })\n    },\n\n    changeStatus() {\n      if (this.newStatus) {\n        this.$emit('status-change', {\n          id: this.proposal.id,\n          status: this.newStatus,\n        })\n        this.showStatusModal = false\n        this.newStatus = null\n      }\n    },\n\n    // Payment methods\n    openPaymentModal(installment: Installment) {\n      this.selectedInstallment = installment\n      this.showPaymentModal = true\n    },\n\n    async handlePaymentSubmit(payload: {\n      installment_id: number\n      amount_paid: number\n      payment_reference?: string\n      paid_at?: string\n    }) {\n      this.savingPayment = true\n      try {\n        const result = await this.recordPayment(payload.installment_id, {\n          amount_paid: payload.amount_paid,\n          payment_reference: payload.payment_reference,\n          paid_at: payload.paid_at,\n        })\n\n        this.showPaymentModal = false\n        this.selectedInstallment = null\n\n        // Build success message based on payment status\n        let message = 'Payment recorded successfully'\n        if (result.stage_changed) {\n          message = result.message || `Payment recorded. Stage updated to ${this.formatStatus(result.new_stage || '')}`\n        } else if (result.data?.payment_status === 'partial') {\n          const remaining = this.formatCurrency(result.data.remaining_balance)\n          message = `Partial payment recorded. Remaining balance: ${remaining}`\n        }\n\n        this.$vaToast?.init({\n          message,\n          color: 'success',\n        })\n\n        // Emit event for parent to refresh if needed\n        this.$emit('payment-recorded', result)\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to record payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n\n    async handleUnpay(installment: Installment) {\n      if (!confirm(`Are you sure you want to reverse the payment for \"${installment.narration}\"?`)) {\n        return\n      }\n\n      this.savingPayment = true\n      try {\n        await this.unpayInstallment(installment.id)\n\n        this.$vaToast?.init({\n          message: 'Payment reversed successfully',\n          color: 'success',\n        })\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to reverse payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n  },\n})\n</script>\n\n<style scoped>\n.proposal-view {\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.proposal-header {\n  border-bottom: 2px solid #e5e7eb;\n  padding-bottom: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.info-row {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n\n.info-row .label {\n  color: #6b7280;\n  min-width: 100px;\n}\n\n.info-row .value {\n  color: #1f2937;\n}\n\n.stat-card {\n  background-color: #f3f4f6;\n  border-radius: 8px;\n  padding: 1.5rem;\n  text-align: center;\n}\n\n.stat-value {\n  font-size: 2rem;\n  font-weight: 700;\n  color: var(--va-primary);\n}\n\n.stat-label {\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.total-row {\n  background: linear-gradient(135deg, var(--va-primary), var(--va-primary-darken));\n}\n\n@media print {\n  .action-buttons {\n    display: none !important;\n  }\n\n  .proposal-view {\n    max-width: 100%;\n  }\n\n  :deep(.va-card) {\n    box-shadow: none !important;\n    border: 1px solid #e5e7eb !important;\n  }\n}\n</style>\n","<template>\n  <div class=\"proposal-form\">\n    <h2 class=\"text-2xl font-bold mb-6\">\n      {{ isEdit ? 'Edit Quotation' : 'Create New Quotation' }}\n    </h2>\n\n    <VaForm ref=\"formRef\">\n      <!-- Sales Inquiry Selection (only for new proposals) -->\n      <VaCard v-if=\"!isEdit\" outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"search\" color=\"primary\" />\n          Select Sales Inquiry\n        </VaCardTitle>\n        <VaCardContent>\n          <VaAlert color=\"info\" class=\"mb-4\" border=\"left\">\n            <template #title>Link to Sales Inquiry</template>\n            Select a sales inquiry to create a quotation. Client and hunting details will be automatically populated.\n          </VaAlert>\n\n          <VaSelect\n            v-model=\"form.sales_inquiry_id\"\n            :options=\"salesInquiryOptions\"\n            :loading=\"loadingInquiries\"\n            label=\"Sales Inquiry\"\n            placeholder=\"Search and select a sales inquiry...\"\n            searchable\n            highlight-matched-text\n            :rules=\"[(v: any) => !!v || 'Sales inquiry is required']\"\n            @update:modelValue=\"onInquirySelected\"\n          >\n            <template #content=\"{ value }\">\n              <div v-if=\"value\" class=\"flex flex-col\">\n                <span class=\"font-semibold\">{{ value.text }}</span>\n                <span class=\"text-xs text-gray-500\">{{ value.subtitle }}</span>\n              </div>\n            </template>\n          </VaSelect>\n\n          <!-- Selected Inquiry Preview -->\n          <div v-if=\"selectedInquiry\" class=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n            <h4 class=\"font-semibold mb-2\">Selected Inquiry Details</h4>\n            <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div>\n                <span class=\"text-gray-500\">Client:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.client_name }}</span>\n              </div>\n              <div>\n                <span class=\"text-gray-500\">Area:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.area }}</span>\n              </div>\n              <div>\n                <span class=\"text-gray-500\">Days:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.no_of_days }}</span>\n              </div>\n              <div>\n                <span class=\"text-gray-500\">Season:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.season }}</span>\n              </div>\n            </div>\n            <div v-if=\"selectedInquiry.species\" class=\"mt-2\">\n              <span class=\"text-gray-500\">Species:</span>\n              <span class=\"ml-1 font-medium\">{{ selectedInquiry.species }}</span>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Quotation Details -->\n      <VaCard outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"description\" color=\"primary\" />\n          Quotation Details\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <VaDateInput v-model=\"form.confirmation_date\" label=\"Confirmation Date\" placeholder=\"Select date\" />\n            <VaInput\n              v-model=\"form.hunting_license\"\n              label=\"Hunting License\"\n              placeholder=\"Enter license number (optional)\"\n            />\n          </div>\n          <VaTextarea\n            v-model=\"form.remarks\"\n            label=\"Remarks\"\n            placeholder=\"Add any additional notes or remarks...\"\n            class=\"mt-4\"\n            :min-rows=\"3\"\n          />\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Payment Installments -->\n      <VaCard outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center justify-between\">\n          <div class=\"flex items-center gap-2\">\n            <VaIcon name=\"payments\" color=\"primary\" />\n            Payment Installments\n          </div>\n          <VaButton preset=\"secondary\" size=\"small\" icon=\"add\" @click=\"addInstallment\"> Add Installment </VaButton>\n        </VaCardTitle>\n        <VaCardContent>\n          <VaAlert v-if=\"form.installments.length === 0\" color=\"warning\" class=\"mb-4\" border=\"left\">\n            <template #title>Required</template>\n            At least one payment installment is required to create a quotation.\n          </VaAlert>\n\n          <div v-if=\"form.installments.length === 0\" class=\"text-center text-gray-500 py-4\">\n            No installments added. Click \"Add Installment\" to create payment schedule.\n          </div>\n\n          <div\n            v-for=\"(installment, index) in form.installments\"\n            :key=\"index\"\n            class=\"installment-row mb-4 p-4 border rounded-lg\"\n          >\n            <div class=\"flex justify-between items-start mb-3\">\n              <span class=\"font-semibold text-gray-700\">Installment {{ index + 1 }}</span>\n              <VaButton preset=\"plain\" color=\"danger\" size=\"small\" icon=\"delete\" @click=\"removeInstallment(index)\" />\n            </div>\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              <VaInput\n                v-model=\"installment.narration\"\n                label=\"Description\"\n                placeholder=\"e.g., Deposit Due upon booking\"\n                :rules=\"[(v: any) => !!v || 'Description is required']\"\n              />\n              <VaInput\n                v-model=\"installment.amount_due\"\n                label=\"Amount (USD)\"\n                type=\"number\"\n                placeholder=\"5000\"\n                :rules=\"[(v: any) => v > 0 || 'Amount must be greater than 0']\"\n              />\n              <VaSelect\n                v-model=\"installment.due_days_type\"\n                :options=\"dueDaysTypeOptions\"\n                label=\"Due Type\"\n                placeholder=\"Select when due\"\n                value-by=\"value\"\n                text-by=\"text\"\n              />\n              <VaInput\n                v-model=\"installment.due_days\"\n                :label=\"installment.due_days_type === 'before_arrival' ? 'Days Before Arrival' : 'Due Days'\"\n                type=\"number\"\n                placeholder=\"e.g., 90\"\n                :disabled=\"installment.due_days_type === 'upon_booking'\"\n              />\n            </div>\n          </div>\n\n          <!-- Total -->\n          <div v-if=\"form.installments.length > 0\" class=\"mt-4 p-4 bg-primary rounded-lg text-white\">\n            <div class=\"flex justify-between items-center\">\n              <span class=\"text-lg font-semibold\">TOTAL</span>\n              <span class=\"text-2xl font-bold\">{{ formatCurrency(totalAmount) }}</span>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Status (only for edit mode) -->\n      <VaCard v-if=\"isEdit\" outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"flag\" color=\"primary\" />\n          Status\n        </VaCardTitle>\n        <VaCardContent>\n          <VaSelect\n            v-model=\"form.status\"\n            :options=\"statusOptions\"\n            label=\"Quotation Status\"\n            placeholder=\"Select status\"\n          />\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Form Actions -->\n      <div class=\"flex justify-end gap-3 mt-6\">\n        <VaButton preset=\"secondary\" @click=\"$emit('cancel')\"> Cancel </VaButton>\n        <VaButton color=\"primary\" :loading=\"saving\" :disabled=\"!canSubmit\" @click=\"submitForm\">\n          {{ isEdit ? 'Update Quotation' : 'Create Quotation' }}\n        </VaButton>\n      </div>\n    </VaForm>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { useForm } from 'vuestic-ui'\nimport { mapState } from 'pinia'\nimport { useProposalStore } from '../../../../stores/proposal-store'\nimport { format } from 'date-fns'\nimport axios from 'axios'\n\ninterface Installment {\n  narration: string\n  amount_due: number\n  due_days: number | null\n  amount_due_type: string\n  due_days_type: string\n}\n\ninterface PipelineInquiry {\n  id: number\n  code: string\n  client?: {\n    full_name: string\n    country: string\n  }\n  hunting_details?: {\n    areas: string\n    species: string\n    no_of_days: number\n    season: string\n    no_of_hunters: number\n  }\n}\n\nexport default defineComponent({\n  name: 'ProposalForm',\n  props: {\n    proposal: {\n      type: Object as PropType<any>,\n      default: null,\n    },\n    isEdit: {\n      type: Boolean,\n      default: false,\n    },\n    preselectedInquiry: {\n      type: Object as PropType<PipelineInquiry | null>,\n      default: null,\n    },\n  },\n  emits: ['save', 'cancel'],\n  setup() {\n    const { validate, reset } = useForm('formRef')\n    return { validate, reset }\n  },\n  data() {\n    return {\n      form: {\n        sales_inquiry_id: null as any,\n        confirmation_date: new Date(),\n        hunting_license: '',\n        remarks: '',\n        status: 'pending',\n        installments: [] as Installment[],\n      },\n      salesInquiryOptions: [] as any[],\n      loadingInquiries: false,\n      selectedInquiry: null as any,\n      dueDaysTypeOptions: [\n        { value: 'upon_booking', text: 'Upon Booking' },\n        { value: 'before_arrival', text: 'Days Before Arrival' },\n        { value: 'upon_completion', text: 'Upon Completion' },\n      ],\n      statusOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provisional Sale' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'declined', text: 'Declined' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n      defaultInstallments: [\n        {\n          narration: 'Deposit Due upon booking',\n          amount_due: 5000,\n          due_days: 0,\n          amount_due_type: 'fixed',\n          due_days_type: 'upon_booking',\n        },\n        {\n          narration: '2nd Deposit Due one year prior',\n          amount_due: 10000,\n          due_days: 365,\n          amount_due_type: 'fixed',\n          due_days_type: 'before_arrival',\n        },\n        {\n          narration: 'Final Payment Due 90 days prior',\n          amount_due: 15000,\n          due_days: 90,\n          amount_due_type: 'fixed',\n          due_days_type: 'before_arrival',\n        },\n        {\n          narration: 'Trophy Deposit Due 45 days prior',\n          amount_due: 2500,\n          due_days: 45,\n          amount_due_type: 'fixed',\n          due_days_type: 'before_arrival',\n        },\n      ],\n    }\n  },\n  computed: {\n    ...mapState(useProposalStore, ['saving']),\n\n    totalAmount(): number {\n      return this.form.installments.reduce((sum, inst) => sum + (Number(inst.amount_due) || 0), 0)\n    },\n\n    canSubmit(): boolean {\n      if (this.isEdit) {\n        return true\n      }\n      // Require sales inquiry and at least one installment\n      return !!this.form.sales_inquiry_id && this.form.installments.length > 0\n    },\n  },\n  mounted() {\n    this.loadNewInquiries()\n    if (this.isEdit && this.proposal) {\n      this.populateForm()\n    } else {\n      // Start with empty installments for new proposals\n      this.form.installments = []\n\n      // Handle preselected inquiry from pipeline\n      if (this.preselectedInquiry) {\n        this.handlePreselectedInquiry()\n      }\n    }\n  },\n  methods: {\n    async loadNewInquiries() {\n      this.loadingInquiries = true\n      try {\n        // Fetch only NEW inquiries from the pipeline API\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/pipeline?stage=new_inquiries`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          const newInquiries = response.data.data?.new_inquiries || []\n          this.salesInquiryOptions = newInquiries.map((item: PipelineInquiry) => ({\n            value: item.id,\n            text: `${item.code} - ${item.client?.full_name || 'Unknown'}`,\n            subtitle: `${item.hunting_details?.areas || 'N/A'} | ${item.hunting_details?.no_of_days || 0} days | ${\n              item.hunting_details?.no_of_hunters || 0\n            } hunter(s)`,\n            selfItem: {\n              id: item.id,\n              code: item.code,\n              client_name: item.client?.full_name,\n              country: item.client?.country,\n              area: item.hunting_details?.areas,\n              species: item.hunting_details?.species,\n              no_of_days: item.hunting_details?.no_of_days,\n              no_of_hunters: item.hunting_details?.no_of_hunters,\n              season: item.hunting_details?.season,\n            },\n          }))\n        }\n      } catch (error) {\n        console.error('Error loading new inquiries:', error)\n      } finally {\n        this.loadingInquiries = false\n      }\n    },\n\n    handlePreselectedInquiry() {\n      const inquiry = this.preselectedInquiry\n      if (!inquiry) return\n\n      // Set the selected inquiry details\n      this.selectedInquiry = {\n        id: inquiry.id,\n        code: inquiry.code,\n        client_name: inquiry.client?.full_name,\n        country: inquiry.client?.country,\n        area: inquiry.hunting_details?.areas,\n        species: inquiry.hunting_details?.species,\n        no_of_days: inquiry.hunting_details?.no_of_days,\n        no_of_hunters: inquiry.hunting_details?.no_of_hunters,\n        season: inquiry.hunting_details?.season,\n      }\n\n      // Create the option object for the select\n      const option = {\n        value: inquiry.id,\n        text: `${inquiry.code} - ${inquiry.client?.full_name || 'Unknown'}`,\n        subtitle: `${inquiry.hunting_details?.areas || 'N/A'} | ${inquiry.hunting_details?.no_of_days || 0} days`,\n        selfItem: this.selectedInquiry,\n      }\n\n      // Add to options if not already there\n      const exists = this.salesInquiryOptions.find((opt) => opt.value === inquiry.id)\n      if (!exists) {\n        this.salesInquiryOptions.unshift(option)\n      }\n\n      // Set the form value\n      this.form.sales_inquiry_id = option\n    },\n\n    onInquirySelected(selected: any) {\n      if (selected?.selfItem) {\n        this.selectedInquiry = selected.selfItem\n      } else {\n        this.selectedInquiry = null\n      }\n    },\n\n    populateForm() {\n      if (!this.proposal) return\n\n      this.form.confirmation_date = this.proposal.confirmation_date\n        ? new Date(this.proposal.confirmation_date)\n        : new Date()\n      this.form.hunting_license = this.proposal.hunting_license || ''\n      this.form.remarks = this.proposal.remarks || ''\n      this.form.status = this.proposal.status || 'pending'\n\n      if (this.proposal.pricing?.installments) {\n        this.form.installments = this.proposal.pricing.installments.map((inst: any) => ({\n          narration: inst.narration,\n          amount_due: inst.amount_due,\n          due_days: inst.due_days,\n          amount_due_type: inst.amount_due_type || 'fixed',\n          due_days_type: inst.due_days_type || 'upon_booking',\n        }))\n      }\n\n      if (this.proposal.sales_inquiry) {\n        this.selectedInquiry = {\n          id: this.proposal.sales_inquiry.id,\n          code: this.proposal.sales_inquiry.code,\n          client_name: this.proposal.client?.full_name,\n          area: this.proposal.hunting_trip?.hunting_area,\n          no_of_days: this.proposal.hunting_trip?.no_of_days,\n          season: this.proposal.sales_inquiry.season,\n        }\n      }\n    },\n\n    addInstallment() {\n      this.form.installments.push({\n        narration: '',\n        amount_due: 0,\n        due_days: null,\n        amount_due_type: 'fixed',\n        due_days_type: 'upon_booking',\n      })\n    },\n\n    removeInstallment(index: number) {\n      this.form.installments.splice(index, 1)\n    },\n\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    async submitForm() {\n      const isValid = await this.validate()\n      if (!isValid) return\n\n      const payload: any = {\n        confirmation_date: this.form.confirmation_date\n          ? format(new Date(this.form.confirmation_date), 'yyyy-MM-dd')\n          : format(new Date(), 'yyyy-MM-dd'),\n        hunting_license: this.form.hunting_license || null,\n        remarks: this.form.remarks || null,\n        installments: this.form.installments.map((inst) => {\n          // Handle VaSelect returning object instead of string\n          let dueType = inst.due_days_type\n          if (typeof dueType === 'object' && dueType !== null) {\n            dueType = (dueType as any).value || 'upon_booking'\n          }\n          let amountType = inst.amount_due_type\n          if (typeof amountType === 'object' && amountType !== null) {\n            amountType = (amountType as any).value || 'fixed'\n          }\n\n          return {\n            narration: inst.narration,\n            amount_due: Number(inst.amount_due),\n            due_days: inst.due_days ? Number(inst.due_days) : null,\n            amount_due_type: String(amountType || 'fixed'),\n            due_days_type: String(dueType || 'upon_booking'),\n          }\n        }),\n      }\n\n      if (!this.isEdit) {\n        payload.sales_inquiry_id = this.form.sales_inquiry_id?.value || this.form.sales_inquiry_id\n      }\n\n      if (this.isEdit) {\n        payload.status = this.form.status\n      }\n\n      this.$emit('save', payload)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.proposal-form {\n  max-width: 900px;\n  margin: 0 auto;\n}\n\n.installment-row {\n  background-color: #fafafa;\n  transition: background-color 0.2s;\n}\n\n.installment-row:hover {\n  background-color: #f0f7ff;\n}\n</style>\n","<template>\n  <div class=\"proposal-form\">\n    <h2 class=\"text-2xl font-bold mb-6\">\n      {{ isEdit ? 'Edit Quotation' : 'Create New Quotation' }}\n    </h2>\n\n    <VaForm ref=\"formRef\">\n      <!-- Sales Inquiry Selection (only for new proposals) -->\n      <VaCard v-if=\"!isEdit\" outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"search\" color=\"primary\" />\n          Select Sales Inquiry\n        </VaCardTitle>\n        <VaCardContent>\n          <VaAlert color=\"info\" class=\"mb-4\" border=\"left\">\n            <template #title>Link to Sales Inquiry</template>\n            Select a sales inquiry to create a quotation. Client and hunting details will be automatically populated.\n          </VaAlert>\n\n          <VaSelect\n            v-model=\"form.sales_inquiry_id\"\n            :options=\"salesInquiryOptions\"\n            :loading=\"loadingInquiries\"\n            label=\"Sales Inquiry\"\n            placeholder=\"Search and select a sales inquiry...\"\n            searchable\n            highlight-matched-text\n            :rules=\"[(v: any) => !!v || 'Sales inquiry is required']\"\n            @update:modelValue=\"onInquirySelected\"\n          >\n            <template #content=\"{ value }\">\n              <div v-if=\"value\" class=\"flex flex-col\">\n                <span class=\"font-semibold\">{{ value.text }}</span>\n                <span class=\"text-xs text-gray-500\">{{ value.subtitle }}</span>\n              </div>\n            </template>\n          </VaSelect>\n\n          <!-- Selected Inquiry Preview -->\n          <div v-if=\"selectedInquiry\" class=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n            <h4 class=\"font-semibold mb-2\">Selected Inquiry Details</h4>\n            <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div>\n                <span class=\"text-gray-500\">Client:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.client_name }}</span>\n              </div>\n              <div>\n                <span class=\"text-gray-500\">Area:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.area }}</span>\n              </div>\n              <div>\n                <span class=\"text-gray-500\">Days:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.no_of_days }}</span>\n              </div>\n              <div>\n                <span class=\"text-gray-500\">Season:</span>\n                <span class=\"ml-1 font-medium\">{{ selectedInquiry.season }}</span>\n              </div>\n            </div>\n            <div v-if=\"selectedInquiry.species\" class=\"mt-2\">\n              <span class=\"text-gray-500\">Species:</span>\n              <span class=\"ml-1 font-medium\">{{ selectedInquiry.species }}</span>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Quotation Details -->\n      <VaCard outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"description\" color=\"primary\" />\n          Quotation Details\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <VaDateInput v-model=\"form.confirmation_date\" label=\"Confirmation Date\" placeholder=\"Select date\" />\n            <VaInput\n              v-model=\"form.hunting_license\"\n              label=\"Hunting License\"\n              placeholder=\"Enter license number (optional)\"\n            />\n          </div>\n          <VaTextarea\n            v-model=\"form.remarks\"\n            label=\"Remarks\"\n            placeholder=\"Add any additional notes or remarks...\"\n            class=\"mt-4\"\n            :min-rows=\"3\"\n          />\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Payment Installments -->\n      <VaCard outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center justify-between\">\n          <div class=\"flex items-center gap-2\">\n            <VaIcon name=\"payments\" color=\"primary\" />\n            Payment Installments\n          </div>\n          <VaButton preset=\"secondary\" size=\"small\" icon=\"add\" @click=\"addInstallment\"> Add Installment </VaButton>\n        </VaCardTitle>\n        <VaCardContent>\n          <VaAlert v-if=\"form.installments.length === 0\" color=\"warning\" class=\"mb-4\" border=\"left\">\n            <template #title>Required</template>\n            At least one payment installment is required to create a quotation.\n          </VaAlert>\n\n          <div v-if=\"form.installments.length === 0\" class=\"text-center text-gray-500 py-4\">\n            No installments added. Click \"Add Installment\" to create payment schedule.\n          </div>\n\n          <div\n            v-for=\"(installment, index) in form.installments\"\n            :key=\"index\"\n            class=\"installment-row mb-4 p-4 border rounded-lg\"\n          >\n            <div class=\"flex justify-between items-start mb-3\">\n              <span class=\"font-semibold text-gray-700\">Installment {{ index + 1 }}</span>\n              <VaButton preset=\"plain\" color=\"danger\" size=\"small\" icon=\"delete\" @click=\"removeInstallment(index)\" />\n            </div>\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              <VaInput\n                v-model=\"installment.narration\"\n                label=\"Description\"\n                placeholder=\"e.g., Deposit Due upon booking\"\n                :rules=\"[(v: any) => !!v || 'Description is required']\"\n              />\n              <VaInput\n                v-model=\"installment.amount_due\"\n                label=\"Amount (USD)\"\n                type=\"number\"\n                placeholder=\"5000\"\n                :rules=\"[(v: any) => v > 0 || 'Amount must be greater than 0']\"\n              />\n              <VaSelect\n                v-model=\"installment.due_days_type\"\n                :options=\"dueDaysTypeOptions\"\n                label=\"Due Type\"\n                placeholder=\"Select when due\"\n                value-by=\"value\"\n                text-by=\"text\"\n              />\n              <VaInput\n                v-model=\"installment.due_days\"\n                :label=\"installment.due_days_type === 'before_arrival' ? 'Days Before Arrival' : 'Due Days'\"\n                type=\"number\"\n                placeholder=\"e.g., 90\"\n                :disabled=\"installment.due_days_type === 'upon_booking'\"\n              />\n            </div>\n          </div>\n\n          <!-- Total -->\n          <div v-if=\"form.installments.length > 0\" class=\"mt-4 p-4 bg-primary rounded-lg text-white\">\n            <div class=\"flex justify-between items-center\">\n              <span class=\"text-lg font-semibold\">TOTAL</span>\n              <span class=\"text-2xl font-bold\">{{ formatCurrency(totalAmount) }}</span>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Status (only for edit mode) -->\n      <VaCard v-if=\"isEdit\" outlined class=\"mb-6\">\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"flag\" color=\"primary\" />\n          Status\n        </VaCardTitle>\n        <VaCardContent>\n          <VaSelect\n            v-model=\"form.status\"\n            :options=\"statusOptions\"\n            label=\"Quotation Status\"\n            placeholder=\"Select status\"\n          />\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Form Actions -->\n      <div class=\"flex justify-end gap-3 mt-6\">\n        <VaButton preset=\"secondary\" @click=\"$emit('cancel')\"> Cancel </VaButton>\n        <VaButton color=\"primary\" :loading=\"saving\" :disabled=\"!canSubmit\" @click=\"submitForm\">\n          {{ isEdit ? 'Update Quotation' : 'Create Quotation' }}\n        </VaButton>\n      </div>\n    </VaForm>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { useForm } from 'vuestic-ui'\nimport { mapState } from 'pinia'\nimport { useProposalStore } from '../../../../stores/proposal-store'\nimport { format } from 'date-fns'\nimport axios from 'axios'\n\ninterface Installment {\n  narration: string\n  amount_due: number\n  due_days: number | null\n  amount_due_type: string\n  due_days_type: string\n}\n\ninterface PipelineInquiry {\n  id: number\n  code: string\n  client?: {\n    full_name: string\n    country: string\n  }\n  hunting_details?: {\n    areas: string\n    species: string\n    no_of_days: number\n    season: string\n    no_of_hunters: number\n  }\n}\n\nexport default defineComponent({\n  name: 'ProposalForm',\n  props: {\n    proposal: {\n      type: Object as PropType<any>,\n      default: null,\n    },\n    isEdit: {\n      type: Boolean,\n      default: false,\n    },\n    preselectedInquiry: {\n      type: Object as PropType<PipelineInquiry | null>,\n      default: null,\n    },\n  },\n  emits: ['save', 'cancel'],\n  setup() {\n    const { validate, reset } = useForm('formRef')\n    return { validate, reset }\n  },\n  data() {\n    return {\n      form: {\n        sales_inquiry_id: null as any,\n        confirmation_date: new Date(),\n        hunting_license: '',\n        remarks: '',\n        status: 'pending',\n        installments: [] as Installment[],\n      },\n      salesInquiryOptions: [] as any[],\n      loadingInquiries: false,\n      selectedInquiry: null as any,\n      dueDaysTypeOptions: [\n        { value: 'upon_booking', text: 'Upon Booking' },\n        { value: 'before_arrival', text: 'Days Before Arrival' },\n        { value: 'upon_completion', text: 'Upon Completion' },\n      ],\n      statusOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provisional Sale' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'declined', text: 'Declined' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n      defaultInstallments: [\n        {\n          narration: 'Deposit Due upon booking',\n          amount_due: 5000,\n          due_days: 0,\n          amount_due_type: 'fixed',\n          due_days_type: 'upon_booking',\n        },\n        {\n          narration: '2nd Deposit Due one year prior',\n          amount_due: 10000,\n          due_days: 365,\n          amount_due_type: 'fixed',\n          due_days_type: 'before_arrival',\n        },\n        {\n          narration: 'Final Payment Due 90 days prior',\n          amount_due: 15000,\n          due_days: 90,\n          amount_due_type: 'fixed',\n          due_days_type: 'before_arrival',\n        },\n        {\n          narration: 'Trophy Deposit Due 45 days prior',\n          amount_due: 2500,\n          due_days: 45,\n          amount_due_type: 'fixed',\n          due_days_type: 'before_arrival',\n        },\n      ],\n    }\n  },\n  computed: {\n    ...mapState(useProposalStore, ['saving']),\n\n    totalAmount(): number {\n      return this.form.installments.reduce((sum, inst) => sum + (Number(inst.amount_due) || 0), 0)\n    },\n\n    canSubmit(): boolean {\n      if (this.isEdit) {\n        return true\n      }\n      // Require sales inquiry and at least one installment\n      return !!this.form.sales_inquiry_id && this.form.installments.length > 0\n    },\n  },\n  mounted() {\n    this.loadNewInquiries()\n    if (this.isEdit && this.proposal) {\n      this.populateForm()\n    } else {\n      // Start with empty installments for new proposals\n      this.form.installments = []\n\n      // Handle preselected inquiry from pipeline\n      if (this.preselectedInquiry) {\n        this.handlePreselectedInquiry()\n      }\n    }\n  },\n  methods: {\n    async loadNewInquiries() {\n      this.loadingInquiries = true\n      try {\n        // Fetch only NEW inquiries from the pipeline API\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/pipeline?stage=new_inquiries`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          const newInquiries = response.data.data?.new_inquiries || []\n          this.salesInquiryOptions = newInquiries.map((item: PipelineInquiry) => ({\n            value: item.id,\n            text: `${item.code} - ${item.client?.full_name || 'Unknown'}`,\n            subtitle: `${item.hunting_details?.areas || 'N/A'} | ${item.hunting_details?.no_of_days || 0} days | ${\n              item.hunting_details?.no_of_hunters || 0\n            } hunter(s)`,\n            selfItem: {\n              id: item.id,\n              code: item.code,\n              client_name: item.client?.full_name,\n              country: item.client?.country,\n              area: item.hunting_details?.areas,\n              species: item.hunting_details?.species,\n              no_of_days: item.hunting_details?.no_of_days,\n              no_of_hunters: item.hunting_details?.no_of_hunters,\n              season: item.hunting_details?.season,\n            },\n          }))\n        }\n      } catch (error) {\n        console.error('Error loading new inquiries:', error)\n      } finally {\n        this.loadingInquiries = false\n      }\n    },\n\n    handlePreselectedInquiry() {\n      const inquiry = this.preselectedInquiry\n      if (!inquiry) return\n\n      // Set the selected inquiry details\n      this.selectedInquiry = {\n        id: inquiry.id,\n        code: inquiry.code,\n        client_name: inquiry.client?.full_name,\n        country: inquiry.client?.country,\n        area: inquiry.hunting_details?.areas,\n        species: inquiry.hunting_details?.species,\n        no_of_days: inquiry.hunting_details?.no_of_days,\n        no_of_hunters: inquiry.hunting_details?.no_of_hunters,\n        season: inquiry.hunting_details?.season,\n      }\n\n      // Create the option object for the select\n      const option = {\n        value: inquiry.id,\n        text: `${inquiry.code} - ${inquiry.client?.full_name || 'Unknown'}`,\n        subtitle: `${inquiry.hunting_details?.areas || 'N/A'} | ${inquiry.hunting_details?.no_of_days || 0} days`,\n        selfItem: this.selectedInquiry,\n      }\n\n      // Add to options if not already there\n      const exists = this.salesInquiryOptions.find((opt) => opt.value === inquiry.id)\n      if (!exists) {\n        this.salesInquiryOptions.unshift(option)\n      }\n\n      // Set the form value\n      this.form.sales_inquiry_id = option\n    },\n\n    onInquirySelected(selected: any) {\n      if (selected?.selfItem) {\n        this.selectedInquiry = selected.selfItem\n      } else {\n        this.selectedInquiry = null\n      }\n    },\n\n    populateForm() {\n      if (!this.proposal) return\n\n      this.form.confirmation_date = this.proposal.confirmation_date\n        ? new Date(this.proposal.confirmation_date)\n        : new Date()\n      this.form.hunting_license = this.proposal.hunting_license || ''\n      this.form.remarks = this.proposal.remarks || ''\n      this.form.status = this.proposal.status || 'pending'\n\n      if (this.proposal.pricing?.installments) {\n        this.form.installments = this.proposal.pricing.installments.map((inst: any) => ({\n          narration: inst.narration,\n          amount_due: inst.amount_due,\n          due_days: inst.due_days,\n          amount_due_type: inst.amount_due_type || 'fixed',\n          due_days_type: inst.due_days_type || 'upon_booking',\n        }))\n      }\n\n      if (this.proposal.sales_inquiry) {\n        this.selectedInquiry = {\n          id: this.proposal.sales_inquiry.id,\n          code: this.proposal.sales_inquiry.code,\n          client_name: this.proposal.client?.full_name,\n          area: this.proposal.hunting_trip?.hunting_area,\n          no_of_days: this.proposal.hunting_trip?.no_of_days,\n          season: this.proposal.sales_inquiry.season,\n        }\n      }\n    },\n\n    addInstallment() {\n      this.form.installments.push({\n        narration: '',\n        amount_due: 0,\n        due_days: null,\n        amount_due_type: 'fixed',\n        due_days_type: 'upon_booking',\n      })\n    },\n\n    removeInstallment(index: number) {\n      this.form.installments.splice(index, 1)\n    },\n\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    async submitForm() {\n      const isValid = await this.validate()\n      if (!isValid) return\n\n      const payload: any = {\n        confirmation_date: this.form.confirmation_date\n          ? format(new Date(this.form.confirmation_date), 'yyyy-MM-dd')\n          : format(new Date(), 'yyyy-MM-dd'),\n        hunting_license: this.form.hunting_license || null,\n        remarks: this.form.remarks || null,\n        installments: this.form.installments.map((inst) => {\n          // Handle VaSelect returning object instead of string\n          let dueType = inst.due_days_type\n          if (typeof dueType === 'object' && dueType !== null) {\n            dueType = (dueType as any).value || 'upon_booking'\n          }\n          let amountType = inst.amount_due_type\n          if (typeof amountType === 'object' && amountType !== null) {\n            amountType = (amountType as any).value || 'fixed'\n          }\n\n          return {\n            narration: inst.narration,\n            amount_due: Number(inst.amount_due),\n            due_days: inst.due_days ? Number(inst.due_days) : null,\n            amount_due_type: String(amountType || 'fixed'),\n            due_days_type: String(dueType || 'upon_booking'),\n          }\n        }),\n      }\n\n      if (!this.isEdit) {\n        payload.sales_inquiry_id = this.form.sales_inquiry_id?.value || this.form.sales_inquiry_id\n      }\n\n      if (this.isEdit) {\n        payload.status = this.form.status\n      }\n\n      this.$emit('save', payload)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.proposal-form {\n  max-width: 900px;\n  margin: 0 auto;\n}\n\n.installment-row {\n  background-color: #fafafa;\n  transition: background-color 0.2s;\n}\n\n.installment-row:hover {\n  background-color: #f0f7ff;\n}\n</style>\n","<template>\n  <VaCard class=\"w-full\">\n    <VaCardContent>\n      <!-- Header with Actions -->\n      <div class=\"flex flex-col md:flex-row gap-3 mb-6 justify-between items-center py-4 px-2 bg-gray-50 rounded-lg\">\n        <div class=\"flex flex-col md:flex-row gap-3 justify-start\">\n          <VaButton v-if=\"currentView !== 'pipeline'\" class=\"px-6\" icon=\"arrow_back\" size=\"large\" @click=\"handleGoBack\">\n            Go Back\n          </VaButton>\n        </div>\n      </div>\n\n      <!-- Pipeline Board View (Main) -->\n      <template v-if=\"currentView === 'pipeline'\">\n        <PipelineBoard\n          :pipeline=\"pipeline\"\n          :counts=\"pipelineCounts\"\n          :loading=\"loading\"\n          :saving=\"saving\"\n          :season-options=\"seasonOptions\"\n          @refresh=\"loadPipeline\"\n          @seasonChange=\"onSeasonChange\"\n          @createProposal=\"handleCreateFromInquiry\"\n          @viewProposal=\"viewProposal\"\n          @editProposal=\"editProposal\"\n          @stageChange=\"handleStageChange\"\n        />\n      </template>\n\n      <!-- View/Details -->\n      <template v-else-if=\"currentView === 'view' && currentProposal\">\n        <ProposalView\n          :proposal=\"currentProposal\"\n          @edit=\"editProposal\"\n          @statusChange=\"handleStatusChange\"\n          @paymentRecorded=\"handlePaymentRecorded\"\n        />\n      </template>\n\n      <!-- Create/Edit Form -->\n      <template v-else-if=\"currentView === 'form'\">\n        <ProposalForm\n          :proposal=\"editingProposal\"\n          :is-edit=\"isEditMode\"\n          :preselected-inquiry=\"preselectedInquiry\"\n          @save=\"handleSave\"\n          @cancel=\"handleGoBack\"\n        />\n      </template>\n    </VaCardContent>\n  </VaCard>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport { mapActions, mapState } from 'pinia'\nimport { useProposalStore } from '../../../stores/proposal-store'\nimport PipelineBoard from './components/PipelineBoard.vue'\nimport ProposalView from './components/ProposalView.vue'\nimport ProposalForm from './components/ProposalForm.vue'\nimport { useToast } from 'vuestic-ui'\nimport axios from 'axios'\n\nexport default defineComponent({\n  name: 'SalesConfirmationProposals',\n  components: {\n    PipelineBoard,\n    ProposalView,\n    ProposalForm,\n  },\n  setup() {\n    const { init } = useToast()\n    return { init }\n  },\n  data() {\n    return {\n      currentView: 'pipeline' as 'pipeline' | 'view' | 'form',\n      editingProposal: null as any,\n      isEditMode: false,\n      preselectedInquiry: null as any,\n      seasonOptions: [] as { value: number; text: string }[],\n      currentSeasonId: null as number | null,\n    }\n  },\n  computed: {\n    ...mapState(useProposalStore, [\n      'pipeline',\n      'pipelineCounts',\n      'currentProposal',\n      'paymentStatus',\n      'loading',\n      'saving',\n      'error',\n    ]),\n  },\n  mounted() {\n    this.loadPipeline()\n    this.loadSeasons()\n  },\n  methods: {\n    ...mapActions(useProposalStore, [\n      'fetchPipeline',\n      'updatePipelineStage',\n      'fetchProposalById',\n      'createProposal',\n      'updateProposal',\n      'updateProposalStatus',\n      'clearCurrentProposal',\n      'clearPaymentStatus',\n    ]),\n\n    async loadPipeline() {\n      try {\n        await this.fetchPipeline(undefined, this.currentSeasonId || undefined)\n      } catch (error) {\n        this.init({\n          message: 'Failed to load pipeline',\n          color: 'danger',\n        })\n      }\n    },\n\n    async loadSeasons() {\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}settings/seasons`\n        const response = await axios.get(url)\n        if (response.data) {\n          const seasons = Array.isArray(response.data) ? response.data : response.data.data || []\n          this.seasonOptions = seasons.map((s: any) => ({\n            value: s.id,\n            text: s.name,\n          }))\n        }\n      } catch (error) {\n        console.error('Error loading seasons:', error)\n      }\n    },\n\n    onSeasonChange(seasonId: number | null) {\n      this.currentSeasonId = seasonId\n      this.loadPipeline()\n    },\n\n    async viewProposal(item: any) {\n      try {\n        const proposalId = item.proposal_id || item.confirmation_id\n        if (proposalId) {\n          await this.fetchProposalById(proposalId)\n          this.currentView = 'view'\n        } else {\n          this.init({\n            message: 'No quotation found for this item',\n            color: 'warning',\n          })\n        }\n      } catch (error) {\n        this.init({\n          message: 'Failed to load quotation details',\n          color: 'danger',\n        })\n      }\n    },\n\n    editProposal(item: any) {\n      // If it's a pipeline item, we need to fetch the full proposal first\n      if (item.proposal_id || item.confirmation_id) {\n        const proposalId = item.proposal_id || item.confirmation_id\n        this.fetchProposalById(proposalId).then(() => {\n          this.editingProposal = this.currentProposal\n          this.isEditMode = true\n          this.preselectedInquiry = null\n          this.currentView = 'form'\n        })\n      } else {\n        this.editingProposal = item\n        this.isEditMode = true\n        this.preselectedInquiry = null\n        this.currentView = 'form'\n      }\n    },\n\n    handleCreateFromInquiry(inquiry: any) {\n      this.editingProposal = null\n      this.isEditMode = false\n      this.preselectedInquiry = inquiry\n      this.currentView = 'form'\n    },\n\n    showCreateForm() {\n      this.editingProposal = null\n      this.isEditMode = false\n      this.preselectedInquiry = null\n      this.currentView = 'form'\n    },\n\n    handleGoBack() {\n      this.currentView = 'pipeline'\n      this.editingProposal = null\n      this.isEditMode = false\n      this.preselectedInquiry = null\n      this.clearCurrentProposal()\n      this.clearPaymentStatus()\n      this.loadPipeline()\n    },\n\n    async handleSave(data: any) {\n      try {\n        if (this.isEditMode && this.editingProposal?.id) {\n          await this.updateProposal(this.editingProposal.id, data)\n          this.init({\n            message: 'Quotation updated successfully',\n            color: 'success',\n          })\n        } else {\n          await this.createProposal(data)\n          this.init({\n            message: 'Quotation created successfully',\n            color: 'success',\n          })\n        }\n        this.handleGoBack()\n      } catch (error: any) {\n        this.init({\n          message: error.response?.data?.message || 'Failed to save quotation',\n          color: 'danger',\n        })\n      }\n    },\n\n    async handleStatusChange(data: { id: number; status: string }) {\n      try {\n        await this.updateProposalStatus(data.id, data.status)\n        this.init({\n          message: `Proposal status changed to ${data.status}`,\n          color: 'success',\n        })\n        // Refresh the current proposal\n        await this.fetchProposalById(data.id)\n      } catch (error) {\n        this.init({\n          message: 'Failed to update proposal status',\n          color: 'danger',\n        })\n      }\n    },\n\n    async handleStageChange(data: { inquiryId: number; newStage: string }) {\n      try {\n        await this.updatePipelineStage(data.inquiryId, data.newStage)\n        this.init({\n          message: `Moved to ${data.newStage.replace(/_/g, ' ')}`,\n          color: 'success',\n        })\n      } catch (error: any) {\n        this.init({\n          message: error.response?.data?.message || 'Failed to update stage',\n          color: 'danger',\n        })\n      }\n    },\n\n    async handlePaymentRecorded(result: any) {\n      // If stage changed due to payment, show additional message and refresh\n      if (result.stage_changed) {\n        this.init({\n          message: `Stage updated: ${result.old_stage} → ${result.new_stage}`,\n          color: 'info',\n        })\n        // Refresh the current proposal to get updated status\n        if (this.currentProposal?.id) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n      }\n    },\n  },\n})\n</script>\n","<template>\n  <VaCard class=\"w-full\">\n    <VaCardContent>\n      <!-- Header with Actions -->\n      <div class=\"flex flex-col md:flex-row gap-3 mb-6 justify-between items-center py-4 px-2 bg-gray-50 rounded-lg\">\n        <div class=\"flex flex-col md:flex-row gap-3 justify-start\">\n          <VaButton v-if=\"currentView !== 'pipeline'\" class=\"px-6\" icon=\"arrow_back\" size=\"large\" @click=\"handleGoBack\">\n            Go Back\n          </VaButton>\n        </div>\n      </div>\n\n      <!-- Pipeline Board View (Main) -->\n      <template v-if=\"currentView === 'pipeline'\">\n        <PipelineBoard\n          :pipeline=\"pipeline\"\n          :counts=\"pipelineCounts\"\n          :loading=\"loading\"\n          :saving=\"saving\"\n          :season-options=\"seasonOptions\"\n          @refresh=\"loadPipeline\"\n          @seasonChange=\"onSeasonChange\"\n          @createProposal=\"handleCreateFromInquiry\"\n          @viewProposal=\"viewProposal\"\n          @editProposal=\"editProposal\"\n          @stageChange=\"handleStageChange\"\n        />\n      </template>\n\n      <!-- View/Details -->\n      <template v-else-if=\"currentView === 'view' && currentProposal\">\n        <ProposalView\n          :proposal=\"currentProposal\"\n          @edit=\"editProposal\"\n          @statusChange=\"handleStatusChange\"\n          @paymentRecorded=\"handlePaymentRecorded\"\n        />\n      </template>\n\n      <!-- Create/Edit Form -->\n      <template v-else-if=\"currentView === 'form'\">\n        <ProposalForm\n          :proposal=\"editingProposal\"\n          :is-edit=\"isEditMode\"\n          :preselected-inquiry=\"preselectedInquiry\"\n          @save=\"handleSave\"\n          @cancel=\"handleGoBack\"\n        />\n      </template>\n    </VaCardContent>\n  </VaCard>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport { mapActions, mapState } from 'pinia'\nimport { useProposalStore } from '../../../stores/proposal-store'\nimport PipelineBoard from './components/PipelineBoard.vue'\nimport ProposalView from './components/ProposalView.vue'\nimport ProposalForm from './components/ProposalForm.vue'\nimport { useToast } from 'vuestic-ui'\nimport axios from 'axios'\n\nexport default defineComponent({\n  name: 'SalesConfirmationProposals',\n  components: {\n    PipelineBoard,\n    ProposalView,\n    ProposalForm,\n  },\n  setup() {\n    const { init } = useToast()\n    return { init }\n  },\n  data() {\n    return {\n      currentView: 'pipeline' as 'pipeline' | 'view' | 'form',\n      editingProposal: null as any,\n      isEditMode: false,\n      preselectedInquiry: null as any,\n      seasonOptions: [] as { value: number; text: string }[],\n      currentSeasonId: null as number | null,\n    }\n  },\n  computed: {\n    ...mapState(useProposalStore, [\n      'pipeline',\n      'pipelineCounts',\n      'currentProposal',\n      'paymentStatus',\n      'loading',\n      'saving',\n      'error',\n    ]),\n  },\n  mounted() {\n    this.loadPipeline()\n    this.loadSeasons()\n  },\n  methods: {\n    ...mapActions(useProposalStore, [\n      'fetchPipeline',\n      'updatePipelineStage',\n      'fetchProposalById',\n      'createProposal',\n      'updateProposal',\n      'updateProposalStatus',\n      'clearCurrentProposal',\n      'clearPaymentStatus',\n    ]),\n\n    async loadPipeline() {\n      try {\n        await this.fetchPipeline(undefined, this.currentSeasonId || undefined)\n      } catch (error) {\n        this.init({\n          message: 'Failed to load pipeline',\n          color: 'danger',\n        })\n      }\n    },\n\n    async loadSeasons() {\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}settings/seasons`\n        const response = await axios.get(url)\n        if (response.data) {\n          const seasons = Array.isArray(response.data) ? response.data : response.data.data || []\n          this.seasonOptions = seasons.map((s: any) => ({\n            value: s.id,\n            text: s.name,\n          }))\n        }\n      } catch (error) {\n        console.error('Error loading seasons:', error)\n      }\n    },\n\n    onSeasonChange(seasonId: number | null) {\n      this.currentSeasonId = seasonId\n      this.loadPipeline()\n    },\n\n    async viewProposal(item: any) {\n      try {\n        const proposalId = item.proposal_id || item.confirmation_id\n        if (proposalId) {\n          await this.fetchProposalById(proposalId)\n          this.currentView = 'view'\n        } else {\n          this.init({\n            message: 'No quotation found for this item',\n            color: 'warning',\n          })\n        }\n      } catch (error) {\n        this.init({\n          message: 'Failed to load quotation details',\n          color: 'danger',\n        })\n      }\n    },\n\n    editProposal(item: any) {\n      // If it's a pipeline item, we need to fetch the full proposal first\n      if (item.proposal_id || item.confirmation_id) {\n        const proposalId = item.proposal_id || item.confirmation_id\n        this.fetchProposalById(proposalId).then(() => {\n          this.editingProposal = this.currentProposal\n          this.isEditMode = true\n          this.preselectedInquiry = null\n          this.currentView = 'form'\n        })\n      } else {\n        this.editingProposal = item\n        this.isEditMode = true\n        this.preselectedInquiry = null\n        this.currentView = 'form'\n      }\n    },\n\n    handleCreateFromInquiry(inquiry: any) {\n      this.editingProposal = null\n      this.isEditMode = false\n      this.preselectedInquiry = inquiry\n      this.currentView = 'form'\n    },\n\n    showCreateForm() {\n      this.editingProposal = null\n      this.isEditMode = false\n      this.preselectedInquiry = null\n      this.currentView = 'form'\n    },\n\n    handleGoBack() {\n      this.currentView = 'pipeline'\n      this.editingProposal = null\n      this.isEditMode = false\n      this.preselectedInquiry = null\n      this.clearCurrentProposal()\n      this.clearPaymentStatus()\n      this.loadPipeline()\n    },\n\n    async handleSave(data: any) {\n      try {\n        if (this.isEditMode && this.editingProposal?.id) {\n          await this.updateProposal(this.editingProposal.id, data)\n          this.init({\n            message: 'Quotation updated successfully',\n            color: 'success',\n          })\n        } else {\n          await this.createProposal(data)\n          this.init({\n            message: 'Quotation created successfully',\n            color: 'success',\n          })\n        }\n        this.handleGoBack()\n      } catch (error: any) {\n        this.init({\n          message: error.response?.data?.message || 'Failed to save quotation',\n          color: 'danger',\n        })\n      }\n    },\n\n    async handleStatusChange(data: { id: number; status: string }) {\n      try {\n        await this.updateProposalStatus(data.id, data.status)\n        this.init({\n          message: `Proposal status changed to ${data.status}`,\n          color: 'success',\n        })\n        // Refresh the current proposal\n        await this.fetchProposalById(data.id)\n      } catch (error) {\n        this.init({\n          message: 'Failed to update proposal status',\n          color: 'danger',\n        })\n      }\n    },\n\n    async handleStageChange(data: { inquiryId: number; newStage: string }) {\n      try {\n        await this.updatePipelineStage(data.inquiryId, data.newStage)\n        this.init({\n          message: `Moved to ${data.newStage.replace(/_/g, ' ')}`,\n          color: 'success',\n        })\n      } catch (error: any) {\n        this.init({\n          message: error.response?.data?.message || 'Failed to update stage',\n          color: 'danger',\n        })\n      }\n    },\n\n    async handlePaymentRecorded(result: any) {\n      // If stage changed due to payment, show additional message and refresh\n      if (result.stage_changed) {\n        this.init({\n          message: `Stage updated: ${result.old_stage} → ${result.new_stage}`,\n          color: 'info',\n        })\n        // Refresh the current proposal to get updated status\n        if (this.currentProposal?.id) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n      }\n    },\n  },\n})\n</script>\n"],"names":["useProposalStore","defineStore","state","id","p","stage","seasonId","url","params","response","axios","error","inquiryId","newStage","payload","index","_a","status","proposalId","installmentId","paymentId","_sfc_main$7","defineComponent","details","formatDate","dateStr","start","end","days","species","amount","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_14","_hoisted_16","_hoisted_18","_hoisted_19","_createElementBlock","_normalizeClass","_ctx","_cache","args","_createElementVNode","_toDisplayString","_openBlock","_createBlock","_component_VaChip","_withCtx","_createTextVNode","_createCommentVNode","_b","_createVNode","_component_VaIcon","_c","_d","_hoisted_13","_hoisted_15","_e","_hoisted_17","_component_VaButton","_withModifiers","$event","_Fragment","_sfc_main$6","PipelineCard","sum","count","currentStage","opt","item","_hoisted_20","_hoisted_21","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_31","_hoisted_32","_hoisted_33","_component_VaBadge","_component_VaSelect","_component_VaProgressBar","_normalizeStyle","_renderList","_component_PipelineCard","_hoisted_22","_hoisted_26","_hoisted_30","_component_VaModal","_sfc_main$5","s","i","type","narration","stageValue","installment","_sfc_main$4","dateString","_component_VaCard","_component_VaCardTitle","_component_VaCardContent","_sfc_main$3","v","newVal","date","year","month","day","_component_VaInput","_component_VaDateInput","_sfc_main$2","StageIndicator","PaymentTable","PaymentModal","mapState","useSettingsStore","inst","installments","total_due","total_paid","paid_count","mapActions","c","data","byteCharacters","byteNumbers","byteArray","blob","a","_f","_g","result","message","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_component_StageIndicator","_component_VaDataTable","rowData","_component_PaymentTable","_component_PaymentModal","_sfc_main$1","validate","reset","useForm","newInquiries","_h","_i","_j","_k","inquiry","option","selected","format","dueType","amountType","_component_VaForm","_component_VaAlert","value","_component_VaTextarea","_sfc_main","PipelineBoard","ProposalView","ProposalForm","init","useToast","seasons","_component_PipelineBoard","_component_ProposalView","_component_ProposalForm"],"mappings":"yVA0NO,MAAMA,EAAmBC,EAAY,YAAa,CACvD,MAAO,KAAsB,CAC3B,UAAW,CAAA,EACX,gBAAiB,KACjB,SAAU,CACR,cAAe,CAAA,EACf,QAAS,CAAA,EACT,gBAAiB,CAAA,EACjB,UAAW,CAAA,EACX,UAAW,CAAA,EACX,UAAW,CAAA,CAAC,EAEd,eAAgB,CACd,cAAe,EACf,QAAS,EACT,gBAAiB,EACjB,UAAW,EACX,UAAW,EACX,UAAW,CAAA,EAEb,cAAe,EACf,cAAe,KACf,QAAS,GACT,OAAQ,GACR,MAAO,IAAA,GAGT,QAAS,CACP,gBAAkBC,GAAWC,GACpBD,EAAM,UAAU,KAAME,GAAMA,EAAE,KAAOD,CAAE,EAGhD,iBAAmBD,GACVA,EAAM,UAAU,OAAQE,GAAMA,EAAE,SAAW,SAAS,EAG7D,mBAAqBF,GACZA,EAAM,UAAU,OAAQE,GAAMA,EAAE,SAAW,WAAW,EAI/D,aAAeF,GAAUA,EAAM,SAAS,cACxC,aAAeA,GAAUA,EAAM,SAAS,QACxC,oBAAsBA,GAAUA,EAAM,SAAS,gBAC/C,eAAiBA,GAAUA,EAAM,SAAS,UAC1C,eAAiBA,GAAUA,EAAM,SAAS,UAC1C,eAAiBA,GAAUA,EAAM,SAAS,SAAA,EAG5C,QAAS,CAEP,MAAM,cAAcG,EAAgBC,EAAmB,CACrD,KAAK,QAAU,GACf,KAAK,MAAQ,KAEb,GAAI,CACF,IAAIC,EAAM,2FACV,MAAMC,EAAS,IAAI,gBACfH,GAAOG,EAAO,OAAO,QAASH,CAAK,EACnCC,GAAUE,EAAO,OAAO,YAAa,OAAOF,CAAQ,CAAC,EACrDE,EAAO,SAAA,OAAmB,IAAIA,EAAO,UAAU,IAEnD,MAAMC,EAAW,MAAMC,EAAM,IAAIH,CAAG,EAEpC,OAAIE,EAAS,KAAK,UAChB,KAAK,SAAWA,EAAS,KAAK,KAC9B,KAAK,eAAiBA,EAAS,KAAK,OACpC,KAAK,cAAgBA,EAAS,KAAK,OAG9BA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,2BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,QAAU,EACjB,CACF,EAEA,MAAM,oBAAoBC,EAAmBC,EAAkB,CAC7D,KAAK,OAAS,GACd,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMN,EAAM,4FAAmEK,CAAS,SAClFH,EAAW,MAAMC,EAAM,IAAIH,EAAK,CAAE,MAAOM,EAAU,EAEzD,OAAIJ,EAAS,KAAK,SAEhB,MAAM,KAAK,cAAA,EAGNA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,yBAC9B,QAAQ,MAAM,iCAAkCA,CAAK,EAC/CA,CACR,QAAA,CACE,KAAK,OAAS,EAChB,CACF,EAEA,MAAM,gBAAiB,CACrB,KAAK,QAAU,GACf,KAAK,MAAQ,KAEb,GAAI,CAEF,MAAMF,EAAW,MAAMC,EAAM,IADjB,2FACwB,EAEpC,OAAID,EAAS,KAAK,QAChB,KAAK,UAAYA,EAAS,KAAK,KAE/B,KAAK,UAAY,MAAM,QAAQA,EAAS,IAAI,EAAIA,EAAS,KAAO,CAAA,EAG3DA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,4BAC9B,QAAQ,MAAM,4BAA6BA,CAAK,EAC1CA,CACR,QAAA,CACE,KAAK,QAAU,EACjB,CACF,EAEA,MAAM,kBAAkBR,EAAY,CAClC,KAAK,QAAU,GACf,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMI,EAAM,6FAAoEJ,CAAE,GAC5EM,EAAW,MAAMC,EAAM,IAAIH,CAAG,EAEpC,OAAIE,EAAS,KAAK,QAChB,KAAK,gBAAkBA,EAAS,KAAK,KAErC,KAAK,gBAAkBA,EAAS,KAG3BA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,2BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,QAAU,EACjB,CACF,EAEA,MAAM,eAAeG,EAalB,CACD,KAAK,OAAS,GACd,KAAK,MAAQ,KAEb,GAAI,CAEF,MAAML,EAAW,MAAMC,EAAM,KADjB,4FAC2BI,CAAO,EAE9C,OAAIL,EAAS,KAAK,SAAWA,EAAS,KAAK,MACzC,KAAK,UAAU,KAAKA,EAAS,KAAK,IAAI,EAGjCA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,4BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,OAAS,EAChB,CACF,EAEA,MAAM,eACJR,EACAW,EAcA,OACA,KAAK,OAAS,GACd,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMP,EAAM,6FAAoEJ,CAAE,GAC5EM,EAAW,MAAMC,EAAM,IAAIH,EAAKO,CAAO,EAE7C,GAAIL,EAAS,KAAK,SAAWA,EAAS,KAAK,KAAM,CAE/C,MAAMM,EAAQ,KAAK,UAAU,UAAW,GAAM,EAAE,KAAOZ,CAAE,EACrDY,IAAU,KACZ,KAAK,UAAUA,CAAK,EAAIN,EAAS,KAAK,QAGpCO,EAAA,KAAK,kBAAL,YAAAA,EAAsB,MAAOb,IAC/B,KAAK,gBAAkBM,EAAS,KAAK,KAEzC,CAEA,OAAOA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,4BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,OAAS,EAChB,CACF,EAEA,MAAM,qBAAqBR,EAAYc,EAAgB,CACrD,OAAO,KAAK,eAAed,EAAI,CAAE,OAAAc,EAAQ,CAC3C,EAGA,MAAM,cAAcC,EAAoB,CACtC,KAAK,QAAU,GACf,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMX,EAAM,6FAAoEW,CAAU,YACpFT,EAAW,MAAMC,EAAM,IAAIH,CAAG,EAEpC,OAAIE,EAAS,KAAK,UAChB,KAAK,cAAgBA,EAAS,KAAK,MAG9BA,CACT,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,2BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,QAAU,EACjB,CACF,EAEA,MAAM,cACJQ,EACAL,EAK0B,CAC1B,KAAK,OAAS,GACd,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMP,EAAM,gGAAuEY,CAAa,OAC1FV,EAAW,MAAMC,EAAM,KAAKH,EAAKO,CAAO,EAG9C,OAAIL,EAAS,KAAK,SAAW,KAAK,eAChC,MAAM,KAAK,cAAc,KAAK,cAAc,WAAW,EAIrDA,EAAS,KAAK,SAAW,KAAK,iBAChC,MAAM,KAAK,kBAAkB,KAAK,gBAAgB,EAAE,EAG/CA,EAAS,IAClB,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,2BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,OAAS,EAChB,CACF,EAEA,MAAM,iBAAiBQ,EAAiD,CACtE,KAAK,OAAS,GACd,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMZ,EAAM,gGAAuEY,CAAa,SAC1FV,EAAW,MAAMC,EAAM,KAAKH,CAAG,EAGrC,OAAIE,EAAS,KAAK,SAAW,KAAK,eAChC,MAAM,KAAK,cAAc,KAAK,cAAc,WAAW,EAIrDA,EAAS,KAAK,SAAW,KAAK,iBAChC,MAAM,KAAK,kBAAkB,KAAK,gBAAgB,EAAE,EAG/CA,EAAS,IAClB,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,4BAC9B,QAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,QAAA,CACE,KAAK,OAAS,EAChB,CACF,EAEA,MAAM,cAAcS,EAAmE,CACrF,KAAK,OAAS,GACd,KAAK,MAAQ,KAEb,GAAI,CACF,MAAMb,EAAM,4FAAmEa,CAAS,GAClFX,EAAW,MAAMC,EAAM,OAAOH,CAAG,EAGvC,OAAIE,EAAS,KAAK,SAAW,KAAK,eAChC,MAAM,KAAK,cAAc,KAAK,cAAc,WAAW,EAIrDA,EAAS,KAAK,SAAW,KAAK,iBAChC,MAAM,KAAK,kBAAkB,KAAK,gBAAgB,EAAE,EAG/CA,EAAS,IAClB,OAASE,EAAY,CACnB,WAAK,MAAQA,EAAM,SAAW,2BAC9B,QAAQ,MAAM,0BAA2BA,CAAK,EACxCA,CACR,QAAA,CACE,KAAK,OAAS,EAChB,CACF,EAEA,oBAAqB,CACnB,KAAK,cAAgB,IACvB,EAEA,sBAAuB,CACrB,KAAK,gBAAkB,KACvB,KAAK,cAAgB,IACvB,EAEA,YAAa,CACX,KAAK,MAAQ,IACf,CAAA,CAEJ,CAAC,ECreDU,EAAeC,EAAgB,CAC7B,KAAM,eACN,MAAO,CACL,KAAM,CACJ,KAAM,OACN,SAAU,EAAA,CACZ,EAEF,MAAO,CAAC,QAAS,kBAAmB,OAAQ,MAAM,EAClD,SAAU,CACR,iBAA0B,CACxB,MAAMC,EAAU,KAAK,KAAK,gBAC1B,GAAI,EAACA,GAAA,MAAAA,EAAS,YAAY,MAAO,MAEjC,MAAMC,EAAcC,GAAoB,CACtC,GAAI,CAEF,OADa,IAAI,KAAKA,CAAO,EACjB,mBAAmB,QAAS,CAAE,MAAO,QAAS,IAAK,UAAW,CAC5E,MAAQ,CACN,OAAOA,CACT,CACF,EAEMC,EAAQF,EAAWD,EAAQ,UAAU,EACrCI,EAAMJ,EAAQ,SAAWC,EAAWD,EAAQ,QAAQ,EAAI,GACxDK,EAAOL,EAAQ,WAAa,KAAKA,EAAQ,UAAU,KAAO,GAEhE,OAAOI,EAAM,GAAGD,CAAK,MAAMC,CAAG,GAAGC,CAAI,GAAK,GAAGF,CAAK,GAAGE,CAAI,EAC3D,CAAA,EAEF,QAAS,CACP,aAAc,CACZ,KAAK,MAAM,QAAS,KAAK,IAAI,CAC/B,EAEA,gBAAgBC,EAAqC,CACnD,OAAKA,EACDA,EAAQ,OAAS,GACZA,EAAQ,UAAU,EAAG,EAAE,EAAI,MAE7BA,EAJc,KAKvB,EAEA,eAAeC,EAA2C,CACxD,OAAKA,EACE,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CAAA,CACxB,EAAE,OAAOA,CAAM,EANI,IAOtB,CAAA,CAEJ,CAAC,EClJQC,EAAA,CAAA,MAAM,aAAA,EACHC,GAAA,CAAA,MAAM,cAAA,EAKTC,GAAA,CAAA,MAAM,aAAA,EACLC,GAAA,CAAA,MAAM,aAAA,EACPC,GAAA,CAAA,MAAM,aAAA,EAMNC,GAAA,CAAA,MAAM,iBAAA,EACJC,GAAA,CAAA,MAAM,YAAA,EAEHC,GAAA,CAAA,MAAM,sBAAA,EAETC,GAAA,CAAA,MAAM,YAAA,EAEHC,GAAA,CAAA,MAAM,aAAA,EAETC,GAAA,CAAA,MAAM,YAAA,EAEHC,GAAA,CAAA,MAAM,aAAA,MA5BpB,IAAA,EA8BgE,MAAM,yBAExDC,GAAA,CAAA,MAAM,oBAAA,MAhCpB,IAAA,EAkCkB,MAAM,cAEVC,GAAA,CAAA,MAAM,aAAA,MApCpB,IAAA,EAyCiC,MAAM,cAE3BC,GAAA,CAAA,MAAM,YAAA,EAITC,GAAA,CAAA,MAAM,cAAA,sGA9CbC,EAyDM,MAAA,CAzDD,MADPC,EAAA,CACa,gBAAe,CAAA,SAAqBC,OAAK,OAAI,SAAA,CAAA,CAAA,EAAmB,QAAKC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,IAAAC,IAAEF,EAAA,aAAAA,EAAA,YAAA,GAAAE,CAAA,EAAA,EAAA,CAEhFC,EAGM,MAHNrB,EAGM,CAFJqB,EAAiD,OAAjDpB,GAAiDqB,EAAnBJ,OAAK,IAAI,EAAA,CAAA,EACzBA,EAAA,KAAK,OAAI,YAAAK,EAAA,EAAvBC,EAAyFC,EAAA,CAL/F,IAAA,EAK8C,KAAK,QAAQ,MAAM,SAAA,EAAA,CALjE,QAAAC,EAK2E,IAAWP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CALtFQ,EAK2E,aAAW,CAAA,EAAA,EALtF,EAAA,CAAA,CAAA,GAAAC,EAAA,GAAA,EAAA,CAAA,CAAA,EASIP,EAKM,MALNnB,GAKM,CAJJmB,EAA6E,KAA7ElB,GAA6EmB,IAAlDrC,EAAAiC,EAAA,KAAK,SAAL,YAAAjC,EAAa,YAAS,gBAAA,EAAA,CAAA,EACjDoC,EAEI,IAFJjB,GAEIkB,IADCO,EAAAX,EAAA,KAAK,SAAL,YAAAW,EAAa,UAAO,KAAA,EAAY,MAAGP,EAAGJ,EAAA,KAAK,wBAA0BA,OAAK,YAAY,EAAA,CAAA,CAAA,CAAA,EAK7FG,EAqBM,MArBNhB,GAqBM,CApBJgB,EAGM,MAHNf,GAGM,CAFJwB,EAAqDC,EAAA,CAA7C,KAAK,OAAO,KAAK,QAAQ,MAAM,WAAA,CAAA,EACvCV,EAA8F,OAA9Fd,GAA8Fe,EAAxDJ,EAAA,iBAAgBc,EAAAd,EAAA,KAAK,kBAAL,YAAAc,EAAsB,OAAO,CAAA,EAAA,CAAA,CAAA,CAAA,EAErFX,EAGM,MAHNb,GAGM,CAFJsB,EAA4DC,EAAA,CAApD,KAAK,cAAc,KAAK,QAAQ,MAAM,WAAA,CAAA,EAC9CV,EAA2E,OAA3EZ,GAA2Ea,IAA9CW,EAAAf,EAAA,KAAK,kBAAL,YAAAe,EAAsB,QAAK,KAAA,EAAA,CAAA,CAAA,CAAA,EAE1DZ,EAGM,MAHNX,GAGM,CAFJoB,EAA+DC,EAAA,CAAvD,KAAK,iBAAiB,KAAK,QAAQ,MAAM,WAAA,CAAA,EACjDV,EAAsD,OAAtDV,GAAsDW,EAAzBJ,EAAA,eAAe,EAAA,CAAA,CAAA,CAAA,EAEnCA,EAAA,KAAK,OAAI,YAAmBA,EAAA,KAAK,cAAAK,EAAA,EAA5CP,EAGM,MAHNkB,GAGM,CAFJJ,EAAuDC,EAAA,CAA/C,KAAK,WAAW,KAAK,QAAQ,MAAM,SAAA,CAAA,EAC3CV,EAA+E,OAA/ET,GAA+EU,EAA3CJ,EAAA,eAAeA,OAAK,YAAY,CAAA,EAAA,CAAA,CAAA,CAAA,IAAAK,EAAA,EAEtEP,EAGM,MAHNmB,GAGM,CAFJL,EAAuDC,EAAA,CAA/C,KAAK,SAAS,KAAK,QAAQ,MAAM,WAAA,CAAA,EACzCV,EAAyF,OAAzFR,GAAyFS,IAA5Dc,EAAAlB,OAAK,kBAAL,YAAAkB,EAAsB,gBAAa,GAAQ,aAAU,CAAA,CAAA,CAAA,KAK3ElB,EAAA,KAAK,aAAAK,EAAA,EAAhBP,EAGM,MAHNqB,GAGM,CAFJP,EAAyDC,EAAA,CAAjD,KAAK,gBAAgB,KAAK,QAAQ,MAAM,MAAA,CAAA,EAChDV,EAA2D,OAA3DP,GAA2DQ,EAA/BJ,EAAA,KAAK,YAAY,IAAI,EAAA,CAAA,CAAA,CAAA,GA3CvDU,EAAA,GAAA,EAAA,EA+CIP,EAUM,MAVNN,GAUM,CATYG,EAAA,KAAK,OAAI,WAAAK,EAAA,EACvBC,EAEWc,EAAA,CAnDnB,IAAA,EAiDkB,KAAK,QAAQ,MAAM,UAAU,MAAA,GAAO,QAAKnB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAjD3DoB,EAAAC,GAiDkEtB,EAAA,MAAK,kBAAoBA,EAAA,IAAI,EAAA,CAAA,MAAA,CAAA,EAAA,EAAA,CAjD/F,QAAAQ,EAiDkG,IAE1FP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAnDRQ,EAiDkG,oBAE1F,CAAA,EAAA,EAnDR,EAAA,CAAA,CAAA,IAAAJ,EAAA,EAqDMP,EAGWyB,EAAA,CAxDjB,IAAA,GAAA,CAsDQX,EAA6FQ,EAAA,CAAnF,KAAK,QAAQ,OAAO,YAAa,QAAKnB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAtDxDoB,EAAAC,GAsD+DtB,EAAA,MAAK,OAASA,EAAA,IAAI,EAAA,CAAA,MAAA,CAAA,EAAA,EAAA,CAtDjF,QAAAQ,EAsDoF,IAAMP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAtD1FQ,EAsDoF,QAAM,CAAA,EAAA,EAtD1F,EAAA,CAAA,CAAA,EAuDQG,EAAsGQ,EAAA,CAA5F,KAAK,QAAQ,OAAO,QAAQ,MAAM,OAAQ,QAAKnB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAvDjEoB,EAAAC,GAuDwEtB,EAAA,MAAK,OAASA,EAAA,IAAI,EAAA,CAAA,MAAA,CAAA,EAAA,EAAA,CAvD1F,QAAAQ,EAuD6F,IAAMP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAvDnGQ,EAuD6F,QAAM,CAAA,EAAA,EAvDnG,EAAA,CAAA,CAAA,4EC2PAe,GAAenD,EAAgB,CAC7B,KAAM,gBACN,WAAY,CACV,aAAAoD,EAAA,EAEF,MAAO,CACL,SAAU,CACR,KAAM,OACN,SAAU,EAAA,EAEZ,OAAQ,CACN,KAAM,OACN,SAAU,EAAA,EAEZ,QAAS,CACP,KAAM,QACN,QAAS,EAAA,EAEX,OAAQ,CACN,KAAM,QACN,QAAS,EAAA,EAEX,cAAe,CACb,KAAM,MACN,QAAS,IAAM,CAAA,CAAC,CAClB,EAEF,MAAO,CAAC,UAAW,gBAAiB,kBAAmB,gBAAiB,gBAAiB,cAAc,EACvG,MAAO,CACL,MAAO,CACL,aAAc,KACd,eAAgB,GAChB,aAAc,KACd,YAAa,KACb,YAAa,CACX,cAAe,UACf,QAAS,UACT,gBAAiB,OACjB,UAAW,UACX,UAAW,YACX,UAAW,SAAA,EAEb,aAAc,CACZ,CAAE,MAAO,UAAW,KAAM,SAAA,EAC1B,CAAE,MAAO,kBAAmB,KAAM,iBAAA,EAClC,CAAE,MAAO,YAAa,KAAM,WAAA,EAC5B,CAAE,MAAO,YAAa,KAAM,WAAA,EAC5B,CAAE,MAAO,YAAa,KAAM,WAAA,CAAY,CAC1C,CAEJ,EACA,SAAU,CACR,YAAqB,CACnB,OAAO,OAAO,OAAO,KAAK,MAAM,EAAE,OAAO,CAACC,EAAKC,IAAUD,EAAMC,EAAO,CAAC,CACzE,EAEA,SAAmB,CACjB,OAAO,KAAK,WAAa,CAC3B,EAEA,iBAAqD,CACnD,GAAI,CAAC,KAAK,aAAc,OAAO,KAAK,aAEpC,MAAMC,EAAe,KAAK,aAAa,QAAU,MAAQ,gBAAkB,KAAK,aAAa,MAC7F,OAAO,KAAK,aAAa,OAAQC,GAAQA,EAAI,QAAUD,CAAY,CACrE,CAAA,EAEF,QAAS,CACP,iBAAkB,CAChB,KAAK,MAAM,SAAS,CACtB,EAEA,eAAevE,EAAyB,CACtC,KAAK,MAAM,gBAAiBA,CAAQ,CACtC,EAEA,gBAAgByE,EAAoB,CAG9BA,EAAK,OAAS,YAChB,KAAK,MAAM,gBAAiBA,CAAI,CAEpC,EAEA,eAAeA,EAAoB,CACjC,KAAK,aAAeA,EACpB,KAAK,YAAc,KACnB,KAAK,eAAiB,EACxB,EAEA,oBAAqB,CACf,KAAK,cAAgB,KAAK,cAC5B,KAAK,MAAM,eAAgB,CACzB,UAAW,KAAK,aAAa,GAC7B,SAAU,KAAK,WAAA,CAChB,EACD,KAAK,eAAiB,GACtB,KAAK,aAAe,KACpB,KAAK,YAAc,KAEvB,CAAA,CAEJ,CAAC,EChWMhD,GAAA,CAAA,MAAM,gBAAA,EAEJC,GAAA,CAAA,MAAM,cAAA,EACJC,GAAA,CAAA,MAAM,yBAAA,EAINC,GAAA,CAAA,MAAM,YAAA,MARjB,IAAA,EAsBoC,MAAM,yBAtB1C,IAAA,EA4BgB,MAAM,oBAEXG,GAAA,CAAA,MAAM,+BAAA,EAEFC,GAAA,CAAA,MAAM,cAAA,EAMRC,GAAA,CAAA,MAAM,gBAAA,MAtCnB,IAAA,EAuC0D,MAAM,gBAerDE,GAAA,CAAA,MAAM,yBAAA,EAEFC,GAAA,CAAA,MAAM,cAAA,EAMRuB,GAAA,CAAA,MAAM,gBAAA,MA9DnB,IAAA,EA+DoD,MAAM,gBAgB/CC,GAAA,CAAA,MAAM,iCAAA,EAEFtB,GAAA,CAAA,MAAM,cAAA,EAMRwB,GAAA,CAAA,MAAM,gBAAA,MAvFnB,IAAA,EAwF4D,MAAM,gBAgBvDtB,GAAA,CAAA,MAAM,2BAAA,EAEFkC,GAAA,CAAA,MAAM,cAAA,EAMRC,GAAA,CAAA,MAAM,gBAAA,MAhHnB,IAAA,EAiHsD,MAAM,gBAgBjDC,GAAA,CAAA,MAAM,2BAAA,EAEFC,GAAA,CAAA,MAAM,cAAA,EAMRC,GAAA,CAAA,MAAM,gBAAA,MAzInB,IAAA,EA0IsD,MAAM,gBAgBjDC,GAAA,CAAA,MAAM,2BAAA,EAEFC,GAAA,CAAA,MAAM,cAAA,EAMRC,GAAA,CAAA,MAAM,gBAAA,MAlKnB,IAAA,EAmKsD,MAAM,gBAkBjDC,GAAA,CAAA,MAAM,KAAA,EACNC,GAAA,CAAA,MAAM,MAAA,EAIJC,GAAA,CAAA,MAAM,wBAAA,sJAzLjB,OAAApC,EAAA,EAAAP,EAiMM,MAjMNhB,GAiMM,CA/LJqB,EAgBM,MAhBNpB,GAgBM,CAfJoB,EAGM,MAHNnB,GAGM,CAAAiB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAFJE,EAA4E,KAAA,CAAxE,MAAM,iCAAA,EAAkC,8BAA2B,EAAA,GACvES,EAAsD8B,EAAA,CAA5C,KAAM,OAAO1C,EAAA,UAAU,EAAG,MAAM,SAAA,EAAA,KAAA,EAAA,CAAA,MAAA,CAAA,IAE5CG,EAUM,MAVNlB,GAUM,CATJ2B,EAOE+B,EAAA,CAhBV,WAUmB3C,EAAA,aAVnB,sBAAA,CAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAUmBtB,EAAA,aAAYsB,GAKDtB,EAAA,cAAA,EAJnB,QAASA,EAAA,cACV,YAAY,cACZ,MAAM,OACN,UAAA,EAAA,EAAA,KAAA,EAAA,CAAA,aAAA,UAAA,qBAAA,CAAA,EAGFY,EAA4GQ,EAAA,CAAlG,OAAO,YAAY,KAAK,UAAW,QAASpB,EAAA,QAAU,QAAOA,EAAA,eAAA,EAAA,CAjB/E,QAAAQ,EAiBgG,IAASP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAjBzGQ,EAiBgG,WAAS,CAAA,EAAA,EAjBzG,EAAA,CAAA,EAAA,EAAA,CAAA,UAAA,SAAA,CAAA,MAsBeT,EAAA,SAAO,CAAKA,EAAA,SAAAK,IAAvBP,EAGM,MAHNZ,GAGM,CAFJ0B,EAA+BgC,GAAhB,cAAA,EAAA,CAAa,EAAA3C,EAAA,CAAA,IAAAA,EAAA,CAAA,EAC5BE,EAAiE,IAAA,CAA9D,MAAM,kCAAiC,sBAAmB,EAAA,EAAA,CAAA,IAAAE,EAAA,EAI/DP,EAqJM,MArJNX,GAqJM,CAnJJgB,EAqBM,MArBNf,GAqBM,CApBJe,EAMM,MAAA,CAND,MAAM,gBAAiB,MA/BpC0C,EAAA,CAAA,YA+B0D7C,EAAA,YAAY,aAAA,CAAa,CAAA,EAAA,CACzEG,EAGM,MAHNd,GAGM,CAFJuB,EAA8DC,EAAA,CAAtD,KAAK,YAAa,MAAOb,EAAA,YAAY,aAAA,EAAA,KAAA,EAAA,CAAA,OAAA,CAAA,EAC7CC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAA0B,YAApB,gBAAa,EAAA,EAAA,CAAA,EAErBS,EAAmF8B,EAAA,CAAzE,KAAM,OAAO1C,EAAA,OAAO,aAAa,EAAI,MAAOA,EAAA,YAAY,aAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,MAEpEG,EAYM,MAZNb,GAYM,CAXOU,WAAS,cAAc,SAAM,GAAAK,IAAxCP,EAGM,MAHNP,GAGM,CAFJqB,EAAqDC,EAAA,CAA7C,KAAK,QAAQ,KAAK,OAAO,MAAM,WAAA,CAAA,EACvCZ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAA6B,YAAvB,mBAAgB,EAAA,EAAA,CAAA,GAzClCO,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EA2CUP,EAMEyB,EAAA,KAjDZuB,EA4C2B9C,EAAA,SAAS,cAAjB8B,QADTxB,EAMEyC,EAAA,CAJC,IAAG,OAASjB,EAAK,EAAE,GACnB,KAAAA,EACA,iBAAcR,GAAEtB,EAAA,MAAK,kBAAoB8B,CAAI,EAC7C,QAAKR,GAAEtB,EAAA,gBAAgB8B,CAAI,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,mBAAA,SAAA,CAAA,cAMlC3B,EAsBM,MAtBNX,GAsBM,CArBJW,EAMM,MAAA,CAND,MAAM,gBAAiB,MAvDpC0C,EAAA,CAAA,YAuD0D7C,EAAA,YAAY,OAAA,CAAO,CAAA,EAAA,CACnEG,EAGM,MAHNV,GAGM,CAFJmB,EAA8DC,EAAA,CAAtD,KAAK,kBAAmB,MAAOb,EAAA,YAAY,OAAA,EAAA,KAAA,EAAA,CAAA,OAAA,CAAA,EACnDC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAAoB,YAAd,UAAO,EAAA,EAAA,CAAA,EAEfS,EAAuE8B,EAAA,CAA7D,KAAM,OAAO1C,EAAA,OAAO,OAAO,EAAI,MAAOA,EAAA,YAAY,OAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,MAE9DG,EAaM,MAbNa,GAaM,CAZOhB,WAAS,QAAQ,SAAM,GAAAK,IAAlCP,EAGM,MAHNJ,GAGM,CAFJkB,EAA+DC,EAAA,CAAvD,KAAK,kBAAkB,KAAK,OAAO,MAAM,WAAA,CAAA,EACjDZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAA6B,YAAvB,mBAAgB,EAAA,EAAA,CAAA,GAjElCO,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EAmEUP,EAOEyB,EAAA,KA1EZuB,EAoE2B9C,EAAA,SAAS,QAAjB8B,QADTxB,EAOEyC,EAAA,CALC,IAAG,WAAajB,EAAK,EAAE,GACvB,KAAAA,EACA,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,QAAKR,GAAEtB,EAAA,gBAAgB8B,CAAI,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,SAAA,SAAA,SAAA,CAAA,cAMlC3B,EAsBM,MAtBNc,GAsBM,CArBJd,EAMM,MAAA,CAND,MAAM,gBAAiB,MAhFpC0C,EAAA,CAAA,YAgF0D7C,EAAA,YAAY,eAAA,CAAe,CAAA,EAAA,CAC3EG,EAGM,MAHNR,GAGM,CAFJiB,EAAsEC,EAAA,CAA9D,KAAK,kBAAmB,MAAOb,EAAA,YAAY,eAAA,EAAA,KAAA,EAAA,CAAA,OAAA,CAAA,EACnDC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAA4B,YAAtB,kBAAe,EAAA,EAAA,CAAA,EAEvBS,EAAuF8B,EAAA,CAA7E,KAAM,OAAO1C,EAAA,OAAO,eAAe,EAAI,MAAOA,EAAA,YAAY,eAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,MAEtEG,EAaM,MAbNgB,GAaM,CAZOnB,WAAS,gBAAgB,SAAM,GAAAK,IAA1CP,EAGM,MAHNF,GAGM,CAFJgB,EAA+DC,EAAA,CAAvD,KAAK,kBAAkB,KAAK,OAAO,MAAM,WAAA,CAAA,EACjDZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAAiC,YAA3B,uBAAoB,EAAA,EAAA,CAAA,GA1FtCO,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EA4FUP,EAOEyB,EAAA,KAnGZuB,EA6F2B9C,EAAA,SAAS,gBAAjB8B,QADTxB,EAOEyC,EAAA,CALC,IAAG,aAAejB,EAAK,EAAE,GACzB,KAAAA,EACA,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,QAAKR,GAAEtB,EAAA,gBAAgB8B,CAAI,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,SAAA,SAAA,SAAA,CAAA,cAMlC3B,EAsBM,MAtBNN,GAsBM,CArBJM,EAMM,MAAA,CAND,MAAM,gBAAiB,MAzGpC0C,EAAA,CAAA,YAyG0D7C,EAAA,YAAY,SAAA,CAAS,CAAA,EAAA,CACrEG,EAGM,MAHN4B,GAGM,CAFJnB,EAA6DC,EAAA,CAArD,KAAK,eAAgB,MAAOb,EAAA,YAAY,SAAA,EAAA,KAAA,EAAA,CAAA,OAAA,CAAA,EAChDC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAAsB,YAAhB,YAAS,EAAA,EAAA,CAAA,EAEjBS,EAA2E8B,EAAA,CAAjE,KAAM,OAAO1C,EAAA,OAAO,SAAS,EAAI,MAAOA,EAAA,YAAY,SAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,MAEhEG,EAaM,MAbN6B,GAaM,CAZOhC,WAAS,UAAU,SAAM,GAAAK,IAApCP,EAGM,MAHNkD,GAGM,CAFJpC,EAA4DC,EAAA,CAApD,KAAK,eAAe,KAAK,OAAO,MAAM,WAAA,CAAA,EAC9CZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAA+B,YAAzB,qBAAkB,EAAA,EAAA,CAAA,GAnHpCO,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EAqHUP,EAOEyB,EAAA,KA5HZuB,EAsH2B9C,EAAA,SAAS,UAAjB8B,QADTxB,EAOEyC,EAAA,CALC,IAAG,aAAejB,EAAK,EAAE,GACzB,KAAAA,EACA,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,QAAKR,GAAEtB,EAAA,gBAAgB8B,CAAI,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,SAAA,SAAA,SAAA,CAAA,cAMlC3B,EAsBM,MAtBN8B,GAsBM,CArBJ9B,EAMM,MAAA,CAND,MAAM,gBAAiB,MAlIpC0C,EAAA,CAAA,YAkI0D7C,EAAA,YAAY,SAAA,CAAS,CAAA,EAAA,CACrEG,EAGM,MAHN+B,GAGM,CAFJtB,EAAuDC,EAAA,CAA/C,KAAK,SAAU,MAAOb,EAAA,YAAY,SAAA,EAAA,KAAA,EAAA,CAAA,OAAA,CAAA,EAC1CC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAAsB,YAAhB,YAAS,EAAA,EAAA,CAAA,EAEjBS,EAA2E8B,EAAA,CAAjE,KAAM,OAAO1C,EAAA,OAAO,SAAS,EAAI,MAAOA,EAAA,YAAY,SAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,MAEhEG,EAaM,MAbNgC,GAaM,CAZOnC,WAAS,UAAU,SAAM,GAAAK,IAApCP,EAGM,MAHNmD,GAGM,CAFJrC,EAAsDC,EAAA,CAA9C,KAAK,SAAS,KAAK,OAAO,MAAM,WAAA,CAAA,EACxCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAA+B,YAAzB,qBAAkB,EAAA,EAAA,CAAA,GA5IpCO,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EA8IUP,EAOEyB,EAAA,KArJZuB,EA+I2B9C,EAAA,SAAS,UAAjB8B,QADTxB,EAOEyC,EAAA,CALC,IAAG,aAAejB,EAAK,EAAE,GACzB,KAAAA,EACA,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,QAAKR,GAAEtB,EAAA,gBAAgB8B,CAAI,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,SAAA,SAAA,SAAA,CAAA,cAMlC3B,EAsBM,MAtBNiC,GAsBM,CArBJjC,EAMM,MAAA,CAND,MAAM,gBAAiB,MA3JpC0C,EAAA,CAAA,YA2J0D7C,EAAA,YAAY,SAAA,CAAS,CAAA,EAAA,CACrEG,EAGM,MAHNkC,GAGM,CAFJzB,EAAyDC,EAAA,CAAjD,KAAK,WAAY,MAAOb,EAAA,YAAY,SAAA,EAAA,KAAA,EAAA,CAAA,OAAA,CAAA,EAC5CC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAAsB,YAAhB,YAAS,EAAA,EAAA,CAAA,EAEjBS,EAA2E8B,EAAA,CAAjE,KAAM,OAAO1C,EAAA,OAAO,SAAS,EAAI,MAAOA,EAAA,YAAY,SAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,MAEhEG,EAaM,MAbNmC,GAaM,CAZOtC,WAAS,UAAU,SAAM,GAAAK,IAApCP,EAGM,MAHNoD,GAGM,CAFJtC,EAAwDC,EAAA,CAAhD,KAAK,WAAW,KAAK,OAAO,MAAM,WAAA,CAAA,EAC1CZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAE,EAA+B,YAAzB,qBAAkB,EAAA,EAAA,CAAA,GArKpCO,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EAuKUP,EAOEyB,EAAA,KA9KZuB,EAwK2B9C,EAAA,SAAS,UAAjB8B,QADTxB,EAOEyC,EAAA,CALC,IAAG,aAAejB,EAAK,EAAE,GACzB,KAAAA,EACA,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,OAAIR,GAAEtB,EAAA,MAAK,gBAAkB8B,CAAI,EACjC,QAAKR,GAAEtB,EAAA,gBAAgB8B,CAAI,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,SAAA,SAAA,SAAA,CAAA,iBAOpClB,EAaUuC,EAAA,CAjMd,WAoLsBnD,EAAA,eApLtB,qCAoLsBA,EAAA,eAAcsB,GAAE,MAAM,gBAAgB,KAAK,QAAS,uBAAsB,EAAA,EAAA,CApLhG,QAAAd,EAqLM,IAAA,OAWM,OAXNL,EAWM,MAXNoC,GAWM,CAVJpC,EAEI,IAFJqC,GAEI,CAAAvC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAxLZQ,EAsLwB,QACT,GAAAN,EAAyC,SAAA,KAAAC,GAA9BrC,EAAAiC,iBAAA,YAAAjC,EAAc,IAAI,EAAA,CAAA,EAAAkC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAvL5CQ,EAuLwD,OAChD,EAAA,CAAA,EACAG,EAA+F+B,EAAA,CAzLvG,WAyL2B3C,EAAA,YAzL3B,qCAyL2BA,EAAA,YAAWsB,GAAG,QAAStB,EAAA,gBAAiB,MAAM,eAAe,MAAM,MAAA,EAAA,KAAA,EAAA,CAAA,aAAA,SAAA,CAAA,EACtFG,EAKM,MALNsC,GAKM,CAJJ7B,EAAgFQ,EAAA,CAAtE,OAAO,YAAa,QAAKnB,eAAED,EAAA,eAAc,GAAA,EAAA,CA3L7D,QAAAQ,EA2LuE,IAAQP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CA3L/EQ,EA2LuE,UAAQ,CAAA,EAAA,EA3L/E,EAAA,CAAA,CAAA,EA4LUG,EAEWQ,EAAA,CAFD,MAAM,UAAW,QAASpB,EAAA,OAAS,SAAQ,CAAGA,EAAA,YAAc,QAAOA,EAAA,kBAAA,EAAA,CA5LvF,QAAAQ,EA4L2G,IAEjGP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CA9LVQ,EA4L2G,QAEjG,CAAA,EAAA,EA9LV,EAAA,CAAA,EAAA,EAAA,CAAA,UAAA,WAAA,SAAA,CAAA,SAAA,EAAA,CAAA,EAAA,EAAA,CAAA,YAAA,CAAA,mECkEA2C,GAAe/E,EAAgB,CAC7B,KAAM,iBACN,MAAO,CACL,aAAc,CACZ,KAAM,OACN,SAAU,EAAA,EAEZ,aAAc,CACZ,KAAM,MACN,QAAS,IAAM,CAAA,CAAC,CAClB,EAEF,MAAO,CACL,MAAO,CACL,OAAQ,CACN,CAAE,MAAO,gBAAiB,MAAO,KAAA,EACjC,CAAE,MAAO,UAAW,MAAO,MAAA,EAC3B,CAAE,MAAO,kBAAmB,MAAO,MAAA,EACnC,CAAE,MAAO,YAAa,MAAO,MAAA,EAC7B,CAAE,MAAO,YAAa,MAAO,MAAA,CAAO,EAEtC,YAAa,CACX,cAAe,UACf,QAAS,UACT,gBAAiB,UACjB,UAAW,UACX,UAAW,UACX,UAAW,SAAA,EAEb,kBAAmB,CACjB,cAAe,UACf,QAAS,UACT,gBAAiB,UACjB,UAAW,UACX,UAAW,UACX,UAAW,SAAA,CACb,CAEJ,EACA,SAAU,CACR,YAAuB,CACrB,OAAO,KAAK,OAAO,IAAKgF,GAAMA,EAAE,KAAK,CACvC,EAEA,mBAA4B,CAC1B,OAAO,KAAK,WAAW,QAAQ,KAAK,YAAY,CAClD,EAEA,kBAAkC,CAEhC,OAAO,KAAK,aAAa,OAAQC,GAAM,OACrC,MAAMC,IAAOxF,EAAAuF,EAAE,mBAAF,YAAAvF,EAAoB,gBAAiB,GAC5CyF,EAAYF,EAAE,UAAU,YAAA,EAC9B,OACEC,EAAK,SAAS,SAAS,GACvBA,EAAK,SAAS,OAAO,GACrBA,EAAK,SAAS,QAAQ,GACtBC,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,OAAO,GAC1BA,EAAU,SAAS,QAAQ,CAE/B,CAAC,CACH,CAAA,EAEF,QAAS,CACP,iBAAiBC,EAA6B,CAC5C,OAAI,KAAK,eAAiB,YAAoB,GAC3B,KAAK,WAAW,QAAQA,CAAU,EACjC,KAAK,iBAC3B,EAEA,cAAcA,EAA4B,CACxC,OAAI,KAAK,eAAiB,YACjB,KAAK,kBAAkB,UAE5B,KAAK,iBAAiBA,CAAU,GAAK,KAAK,eAAiBA,EACtD,KAAK,kBAAkBA,CAAU,GAAK,KAAK,kBAAkB,QAE/D,SACT,EAEA,cAAcC,EAAkC,CAC9C,MAAMF,EAAYE,EAAY,UAAU,YAAA,EACxC,OAAIF,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,SAAS,EACxD,UAELA,EAAU,SAAS,KAAK,GAAKA,EAAU,SAAS,YAAY,EACvD,MAELA,EAAU,SAAS,OAAO,EACrB,QAELA,EAAU,SAAS,QAAQ,EACtB,SAEFE,EAAY,UAAU,UAAU,EAAG,CAAC,CAC7C,CAAA,CAEJ,CAAC,ECnKM5E,GAAA,CAAA,MAAM,iBAAA,EAEJC,GAAA,CAAA,MAAM,gBAAA,MAHf,IAAA,EAiBuB,MAAM,gBAEhBE,GAAA,CAAA,MAAM,aAAA,MAnBnB,IAAA,EA6BwD,MAAM,sBA7B9DE,GAAA,CAAA,OAAA,EA0CcC,GAAA,CAAA,MAAM,eAAA,MA1CpB,IAAA,EA+C6C,MAAM,gFA9CjD,OAAAiB,EAAA,EAAAP,EAiDM,MAjDNhB,GAiDM,CA/CJqB,EAuBM,MAvBNpB,GAuBM,EAAAsB,EAAA,EAAA,EAtBJP,EAqBMyB,EAAA,KAzBZuB,EAKiC9C,EAAA,OALjC,CAKgB5C,EAAOU,SADjBgC,EAqBM,MAAA,CAnBH,IAAK1C,EAAM,MACZ,MAPR2C,GAOc,aAAY,CAAA,YACeC,iBAAiB5C,EAAM,MAAA,eAAiC4C,EAAA,iBAAiB5C,EAAM,KAAK,EAAA,eAA6B4C,EAAA,eAAY,WAAA,CAAA,CAAA,IAM9JG,EAIM,MAAA,CAJD,MAAM,YAAa,MAdhC0C,EAAA,CAAA,gBAc0D7C,EAAA,cAAc5C,EAAM,KAAK,CAAA,CAAA,CAAA,EAAA,CAC3D4C,EAAA,iBAAiB5C,EAAM,KAAK,GAAAiD,EAAA,EAA1CC,EAAuFO,EAAA,CAfjG,IAAA,EAeuD,KAAK,QAAQ,KAAK,QAAQ,MAAM,OAAA,CAAA,GAC1Db,EAAA,eAAY,iBAA/BM,EAA2FO,EAAA,CAhBrG,IAAA,EAgB2D,KAAK,QAAQ,KAAK,QAAQ,MAAM,OAAA,CAAA,IAAAR,IACjFP,EAAwD,OAAxDd,GAAwDoB,EAAnBtC,EAAK,CAAA,EAAA,CAAA,EAAA,EAAA,CAAA,EAE5CqC,EAAgD,MAAhDlB,GAAgDmB,EAApBhD,EAAM,KAAK,EAAA,CAAA,EAE/BU,EAAQkC,EAAA,OAAO,OAAM,GAAAK,EAAA,EAD7BP,EAIO,MAAA,CAxBf,IAAA,EAsBU,MAtBVC,EAAA,CAsBgB,aAAY,CAAA,YACKC,EAAA,iBAAiB5C,EAAM,KAAK,EAAA,CAAA,CAAA,EAAA,KAAA,CAAA,GAvB7DsD,EAAA,GAAA,EAAA,CAAA,EAAA,CAAA,YA6BeV,EAAA,cAAgBA,EAAA,aAAa,OAAM,GAAAK,IAA9CP,EAeM,MAfNZ,GAeM,EAAAmB,EAAA,EAAA,EAdJP,EAaMyB,EAAA,KA3CZuB,EA+B8B9C,EAAA,iBAAf0D,QADT5D,EAaM,MAAA,CAXH,IAAK4D,EAAY,GAClB,MAjCR3D,EAAA,CAiCc,oBAAmB,CAAA,UACJ2D,EAAY,OAAA,CAAO,CAAA,EACvC,MAAOA,EAAY,SAAA,EAAA,CAEpB9C,EAIEC,EAAA,CAHC,KAAM6C,EAAY,QAAO,eAAA,yBACzB,MAAOA,EAAY,QAAO,UAAA,YAC3B,KAAK,OAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,EAEPvD,EAAmE,OAAnEf,GAAmEgB,EAApCJ,EAAA,cAAc0D,CAAW,CAAA,EAAA,CAAA,CAAA,EAAA,GA1ChEvE,EAAA,EAAA,EAAA,GAAA,EAAA,CAAA,GAAAuB,EAAA,GAAA,EAAA,EA+CeV,EAAA,eAAY,aAAAK,EAAA,EAAvBP,EAEM,MAFNT,GAEM,CADJuB,EAAsDL,EAAA,CAA9C,MAAM,SAAS,KAAK,OAAA,EAAA,CAhDlC,QAAAC,EAgD0C,IAASP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAhDnDQ,EAgD0C,WAAS,CAAA,EAAA,EAhDnD,EAAA,CAAA,CAAA,CAAA,CAAA,GAAAC,EAAA,GAAA,EAAA,CAAA,CAAA,iEC0KAiD,GAAetF,EAAgB,CAC7B,KAAM,eACN,MAAO,CACL,aAAc,CACZ,KAAM,MACN,QAAS,IAAM,CAAA,CAAC,EAElB,QAAS,CACP,KAAM,OACN,QAAS,IAAA,EAEX,YAAa,CACX,KAAM,OACN,QAAS,CAAA,EAEX,QAAS,CACP,KAAM,QACN,QAAS,EAAA,EAEX,WAAY,CACV,KAAM,QACN,QAAS,EAAA,CACX,EAEF,MAAO,CAAC,iBAAkB,OAAO,EACjC,SAAU,CACR,mBAA4B,CAC1B,MAAI,CAAC,KAAK,SAAW,KAAK,QAAQ,YAAc,EAAU,EACnD,KAAK,MAAO,KAAK,QAAQ,WAAa,KAAK,QAAQ,UAAa,GAAG,CAC5E,EACA,uBAAgC,CAC9B,OAAK,KAAK,SAEP,KAAK,QAAQ,kBAAoB,KAAK,QAAQ,YAAc,IAC5D,KAAK,QAAQ,oBAAsB,IACnC,KAAK,QAAQ,cAAgB,GAJN,KAAK,aAAa,MAM9C,CAAA,EAEF,QAAS,CACP,cAAcqF,EAAkC,CAC9C,OAAIA,EAAY,SAAWA,EAAY,iBAAmB,OACjD,eAELA,EAAY,iBAAmB,UAC1B,gBAEF,wBACT,EAEA,mBAAmBA,EAAkC,CACnD,OAAIA,EAAY,SAAWA,EAAY,iBAAmB,OACjD,UAELA,EAAY,iBAAmB,UAC1B,UAEF,WACT,EAEA,eAAe7E,EAAwB,CACrC,OAAO,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CAAA,CACxB,EAAE,OAAOA,CAAM,CAClB,EAEA,WAAW+E,EAA4B,CACrC,GAAI,CAACA,EAAY,MAAO,GACxB,GAAI,CAEF,OADa,IAAI,KAAKA,CAAU,EACpB,mBAAmB,QAAS,CACtC,MAAO,QACP,IAAK,UACL,KAAM,SAAA,CACP,CACH,MAAQ,CACN,OAAOA,CACT,CACF,EAEA,gBAAgBxG,EAAuB,CAMrC,MALsC,CACpC,gBAAiB,kBACjB,UAAW,YACX,UAAW,WAAA,EAEAA,CAAK,GAAKA,EAAM,QAAQ,KAAM,GAAG,CAChD,CAAA,CAEJ,CAAC,ECnQU0B,GAAA,CAAA,MAAM,yBAAA,EAINC,GAAA,CAAA,MAAM,aAAA,MAPjB,IAAA,EAW0B,MAAM,qBAXhC,IAAA,EAiBkB,MAAM,gBAWTG,GAAA,CAAA,MAAM,aAAA,EAKNC,GAAA,CAAA,MAAM,qBAAA,EACJC,GAAA,CAAA,MAAM,WAAA,MAlCvB,IAAA,EAmCmD,MAAM,sBAnCzD,IAAA,EAuCiE,MAAM,gBACnDG,GAAA,CAAA,MAAM,yBAAA,MAxC1B,IAAA,EA8CgF,MAAM,kBAMvEE,GAAA,CAAA,MAAM,gBAAA,EACHuB,GAAA,CAAA,MAAM,QAAA,EAITtB,GAAA,CAAA,MAAM,gBAAA,MAzDrB,IAAA,EA2DmB,MAAM,iBA3DzB,IAAA,EA6DiD,MAAM,iBA7DvD,IAAA,EA4EmB,MAAM,uBA5EzB,IAAA,EAsG0B,MAAM,mBACnBG,GAAA,CAAA,MAAM,mBAAA,EAKNkC,GAAA,CAAA,MAAM,wBAAA,EAKNC,GAAA,CAAA,MAAM,oBAAA,MAjHnB,IAAA,EA0H0B,MAAM,qLAzH9B1B,EAiISuD,EAAA,CAjID,SAAA,GAAS,MAAM,oBAAA,EAAA,CADzB,QAAArD,EAEI,IAMc,CANdI,EAMckD,EAAA,CAND,MAAM,mCAAA,EAAmC,CAF1D,UAGM,IAAA,OAGM,OAHN3D,EAGM,MAHNrB,GAGM,CAFJ8B,EAA0CC,EAAA,CAAlC,KAAK,WAAW,MAAM,SAAA,CAAA,EAC9BZ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAA6B,YAAvB,mBAAgB,EAAA,EAAA,CAAA,EAExBA,EAA6F,MAA7FpB,GAAyB,UAAOqB,EAAGJ,EAAA,iBAAejC,EAAAiC,EAAA,UAAA,YAAAjC,EAAS,YAAaiC,EAAA,WAAW,CAAA,EAAA,CAAA,CAAA,EAAA,EAPzF,EAAA,CAAA,CAAA,EASIY,EAwHgBmD,EAAA,KAAA,CAjIpB,UAWM,IAGM,CAHK/D,EAAA,SAAAK,EAAA,EAAXP,EAGM,MAHNd,GAGM,CAFJ4B,EAA+BgC,GAAhB,cAAA,EAAA,CAAa,EAAA3C,EAAA,CAAA,IAAAA,EAAA,CAAA,EAC5BE,EAAuE,IAAA,CAApE,MAAM,kCAAiC,4BAAyB,EAAA,EAAA,CAAA,IAAAE,EAAA,EAIrEP,EAkFM,MAlFNb,GAkFM,EAAAoB,EAAA,EAAA,EAjFJP,EAgFMyB,EAAA,KAlGduB,EAmBgC9C,EAAA,aAAf0D,QADT5D,EAgFM,MAAA,CA9EH,IAAK4D,EAAY,GAClB,MArBV3D,GAqBgB,cAAa,CAAA,UACc2D,EAAY,SAAWA,EAAY,iBAAc,OAAA,aAAuCA,EAAY,iBAAc,SAAA,CAAA,CAAA,IAMnJvD,EAEM,MAFNjB,GAEM,CADJ0B,EAAsFC,EAAA,CAA7E,KAAMb,gBAAc0D,CAAW,EAAI,MAAO1D,qBAAmB0D,CAAW,CAAA,EAAA,KAAA,EAAA,CAAA,OAAA,OAAA,CAAA,IAInFvD,EAgBM,MAhBNhB,GAgBM,CAfJgB,EAAwD,MAAxDf,GAAwDgB,EAA9BsD,EAAY,SAAS,EAAA,CAAA,EACpCA,EAAY,gBAAArD,EAAA,EAAvBP,EAEM,MAFNT,GAEM,CADJuB,EAAqGL,EAAA,CAA7F,KAAK,QAAQ,MAAM,OAAO,KAAA,EAAA,EAAA,CApChD,QAAAC,EAoCqD,IAAG,CApCxDC,EAoCqD,MAAGL,EAAGJ,EAAA,gBAAgB0D,EAAY,cAAc,CAAA,EAAA,CAAA,CAAA,CAAA,EApCrG,EAAA,CAAA,EAAA,IAAA,CAAA,CAAA,GAAAhD,EAAA,GAAA,EAAA,EAuCuBgD,EAAY,iBAAc,WAAArD,EAAA,EAArCP,EAKM,MALNR,GAKM,CAJJa,EAGO,OAHPZ,GAAsC,UAC9Ba,EAAGJ,EAAA,eAAe0D,EAAY,aAAW,CAAA,CAAA,EAAS,iBACxDtD,EAAGJ,EAAA,eAAe0D,EAAY,mBAAiB,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,GA1C/DhD,EAAA,GAAA,EAAA,EA8CuBgD,EAAY,UAAYA,EAAY,SAAS,OAAM,GAAArD,IAA9DP,EAEM,MAFNN,GAEM,CADJoB,EAAiGL,EAAA,CAAzF,KAAK,QAAQ,MAAM,YAAY,KAAA,EAAA,EAAA,CA/CrD,QAAAC,EA+C2D,IAAiC,CA/C5FC,EAAAL,EA+C8DsD,EAAY,SAAS,MAAM,EAAG,aAAU,CAAA,CAAA,CAAA,EA/CtG,EAAA,CAAA,EAAA,IAAA,CAAA,CAAA,GAAAhD,EAAA,GAAA,EAAA,CAAA,CAAA,EAoDUP,EAEM,MAFNV,GAEM,CADJU,EAAwE,OAAxEa,GAAwEZ,EAAhDJ,EAAA,eAAe0D,EAAY,UAAU,CAAA,EAAA,CAAA,CAAA,CAAA,EAI/DvD,EAwCM,MAxCNT,GAwCM,CAvCYgE,EAAY,SAAWA,EAAY,iBAAc,QAAArD,IAC/DP,EAcM,MAdNmB,GAcM,CAAAhB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAbJE,EAAoC,OAAA,CAA9B,MAAM,YAAA,EAAa,OAAI,EAAA,GACjBuD,EAAY,aAAxB5D,EAEO,OAFPH,GAEOS,EADFJ,EAAA,WAAW0D,EAAY,OAAO,CAAA,EAAA,CAAA,GA9DnDhD,EAAA,GAAA,EAAA,EAiEwBV,kBADRM,EAQEc,EAAA,CAxElB,IAAA,EAkEkB,OAAO,QACP,KAAK,QACL,MAAM,YACN,KAAK,OACL,MAAM,uBACL,QAAKE,GAAEtB,EAAA,MAAK,QAAU0D,CAAW,CAAA,EAAA,KAAA,EAAA,CAAA,SAAA,CAAA,GAvEpDhD,EAAA,GAAA,EAAA,CAAA,CAAA,GA2EiCgD,EAAY,iBAAc,WAAArD,EAAA,EAC7CP,EAcM,MAdNqB,GAcM,CAAAlB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAbJE,EAA0C,OAAA,CAApC,MAAM,eAAA,EAAgB,UAAO,EAAA,GACnCS,EAEWQ,EAAA,CAFD,KAAK,QAAQ,MAAM,UAAW,QAAKE,GAAEtB,EAAA,MAAK,iBAAmB0D,CAAW,CAAA,EAAA,CA9ElG,QAAAlD,EA8EqG,IAErFP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAhFhBQ,EA8EqG,eAErF,CAAA,EAAA,EAhFhB,EAAA,CAAA,EAAA,KAAA,CAAA,SAAA,CAAA,EAkFwBT,EAAA,YAAAK,IADRC,EAQEc,EAAA,CAzFlB,IAAA,EAmFkB,OAAO,QACP,KAAK,QACL,MAAM,YACN,KAAK,OACL,MAAM,uBACL,QAAKE,GAAEtB,EAAA,MAAK,QAAU0D,CAAW,CAAA,EAAA,KAAA,EAAA,CAAA,SAAA,CAAA,GAxFpDhD,EAAA,GAAA,EAAA,CAAA,CAAA,IAAAL,EAAA,EA6FcC,EAEWc,EAAA,CA/FzB,IAAA,EA6FwB,KAAK,QAAQ,MAAM,UAAW,QAAKE,GAAEtB,EAAA,MAAK,iBAAmB0D,CAAW,CAAA,EAAA,CA7FhG,QAAAlD,EA6FmG,IAErFP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CA/FdQ,EA6FmG,kBAErF,CAAA,EAAA,EA/Fd,EAAA,CAAA,EAAA,KAAA,CAAA,SAAA,CAAA,oBAsGiBT,EAAA,SAAAK,EAAA,EAAXP,EAiBM,MAjBNF,GAiBM,CAhBJO,EAGM,MAHNN,GAGM,CAFJe,EAA2DC,EAAA,CAAnD,KAAK,eAAe,MAAM,UAAU,KAAK,OAAA,CAAA,EACjDV,EAA2D,OAAA,KAArD,SAAMC,EAAGJ,EAAA,eAAeA,UAAQ,UAAU,CAAA,EAAA,CAAA,CAAA,CAAA,EAElDC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAAoC,MAAA,CAA/B,MAAM,iBAAA,EAAkB,IAAC,EAAA,GAC9BA,EAGM,MAHN4B,GAGM,CAFJnB,EAAsDC,EAAA,CAA9C,KAAK,UAAU,MAAM,UAAU,KAAK,OAAA,CAAA,EAC5CV,EAAkE,OAAA,KAA5D,cAAWC,EAAGJ,EAAA,eAAeA,UAAQ,YAAY,CAAA,EAAA,CAAA,CAAA,CAAA,EAEzDC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAAoC,MAAA,CAA/B,MAAM,iBAAA,EAAkB,IAAC,EAAA,GAC9BA,EAKM,MALN6B,GAKM,CAJJ7B,EAGO,OAAA,KAAA,CArHjBM,EAAAL,EAmHeJ,EAAA,QAAQ,kBAAoBA,EAAA,QAAQ,UAAU,EAAG,IAACI,EAAGJ,EAAA,qBAAqB,EAAG,eAChF,CAAA,EAAgBA,EAAA,QAAQ,oBAAAK,EAAA,EAAxBP,EAAmGyB,EAAA,CApH/G,IAAA,GAAA,CAAAd,EAoHwD,KAAEL,EAAGJ,EAAA,QAAQ,kBAAkB,EAAG,aAAU,CAAA,CAAA,EAAA,EAAA,GApHpGU,EAAA,GAAA,EAAA,CAAA,CAAA,GAAA,CAAA,GAAAA,EAAA,GAAA,EAAA,EA0HiBV,EAAA,SAAAK,EAAA,EAAXP,EAMM,MANNkD,GAMM,CALJpC,EAIEgC,EAAA,CAHC,cAAa5C,EAAA,kBACb,MAAOA,EAAA,oBAAiB,IAAA,UAAA,UACzB,eAAA,EAAA,EAAA,KAAA,EAAA,CAAA,cAAA,OAAA,CAAA,CA9HV,CAAA,GAAAU,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,iECkGAsD,GAAe3F,EAAgB,CAC7B,KAAM,eACN,MAAO,CACL,WAAY,CACV,KAAM,QACN,QAAS,EAAA,EAEX,YAAa,CACX,KAAM,OACN,QAAS,IAAA,EAEX,QAAS,CACP,KAAM,QACN,QAAS,EAAA,CACX,EAEF,MAAO,CAAC,oBAAqB,QAAQ,EACrC,MAAO,CACL,MAAO,CACL,KAAM,CACJ,YAAa,KACb,kBAAmB,GACnB,YAAa,IAAK,CACpB,CAEJ,EACA,SAAU,CACR,aAAuB,CACrB,MAAO,CAAC,CAAC,KAAK,KAAK,aAAe,KAAK,KAAK,YAAc,CAC5D,EAEA,mBAA6B,CAC3B,OAAK,KAAK,YACH,KAAK,YAAY,iBAAmB,YAAc,KAAK,YAAY,aAAe,GAAK,EADhE,EAEhC,EAEA,kBAA2B,CACzB,OAAK,KAAK,YACN,KAAK,YAAY,oBAAsB,OAClC,KAAK,YAAY,mBAElB,KAAK,YAAY,YAAc,IAAM,KAAK,YAAY,aAAe,GAJ/C,CAKhC,EAEA,yBAAmC,CACjC,MAAI,CAAC,KAAK,aAAe,CAAC,KAAK,KAAK,YAAoB,GACjD,KAAK,KAAK,aAAe,KAAK,gBACvC,EAEA,eAA+B,SAC7B,GAAI,CAAC,KAAK,YAAa,OAAO,KAG9B,GAAI,KAAK,YAAY,eACnB,OAAO,KAAK,YAAY,eAI1B,MAAMmF,IAAYzF,EAAA,KAAK,YAAY,YAAjB,YAAAA,EAA4B,gBAAiB,GACzDwF,IAAO5C,EAAA,KAAK,YAAY,mBAAjB,YAAAA,EAAmC,gBAAiB,GAEjE,OAAI4C,EAAK,SAAS,iBAAiB,GAAMC,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,SAAS,EAC7F,kBAELD,EAAK,SAAS,eAAe,GAAMC,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,IAAI,EACpF,YAELD,EAAK,SAAS,gBAAgB,GAAMC,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,IAAI,EACtF,YAGF,IACT,EAEA,cAAe,CACb,OAAQS,GAAW,CAAC,CAACA,GAAK,oBAC5B,EAEA,oBAAqB,CACnB,OAAQA,GAAYA,GAAK,OAAOA,CAAC,EAAI,GAAM,yBAC7C,CAAA,EAEF,MAAO,CACL,WAAWC,EAAQ,CACbA,GAAU,KAAK,cAEjB,KAAK,KAAK,YAAc,KACxB,KAAK,KAAK,kBAAoB,GAC9B,KAAK,KAAK,QAAU,IAAI,KAE5B,CAAA,EAEF,QAAS,CACP,eAAerF,EAAwB,CACrC,OAAO,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CAAA,CACxB,EAAE,OAAOA,CAAM,CAClB,EAEA,gBAAgBzB,EAAuB,CAOrC,MANsC,CACpC,QAAS,UACT,gBAAiB,kBACjB,UAAW,YACX,UAAW,WAAA,EAEAA,CAAK,GAAKA,EAAM,QAAQ,KAAM,GAAG,EAAE,YAAA,CAClD,EAEA,cAAe,CACb,KAAK,MAAM,oBAAqB,EAAK,CACvC,EAEA,cAAe,CACb,GAAI,CAAC,KAAK,aAAe,CAAC,KAAK,YAAa,OAE5C,MAAMS,EAAU,CACd,eAAgB,KAAK,YAAY,GACjC,YAAa,KAAK,KAAK,YACvB,kBAAmB,KAAK,KAAK,mBAAqB,OAClD,QAAS,KAAK,KAAK,QAAU,KAAK,iBAAiB,KAAK,KAAK,OAAO,EAAI,MAAA,EAG1E,KAAK,MAAM,SAAUA,CAAO,CAC9B,EAEA,iBAAiBsG,EAAoB,CACnC,MAAMC,EAAOD,EAAK,YAAA,EACZE,EAAQ,OAAOF,EAAK,SAAA,EAAa,CAAC,EAAE,SAAS,EAAG,GAAG,EACnDG,EAAM,OAAOH,EAAK,QAAA,CAAS,EAAE,SAAS,EAAG,GAAG,EAClD,MAAO,GAAGC,CAAI,IAAIC,CAAK,IAAIC,CAAG,EAChC,CAAA,CAEJ,CAAC,EClOQxF,GAAA,CAAA,MAAM,uBAAA,EAEJC,GAAA,CAAA,MAAM,uBAAA,EACJC,GAAA,CAAA,MAAM,aAAA,EAINC,GAAA,CAAA,MAAM,aAAA,EAEHC,GAAA,CAAA,MAAM,QAAA,MAjBtB,IAAA,EAoBsC,MAAM,6BAC7BE,GAAA,CAAA,MAAM,8BAAA,EAEHC,GAAA,CAAA,MAAM,4BAAA,EAETC,GAAA,CAAA,MAAM,mCAAA,EAEHC,GAAA,CAAA,MAAM,+BAAA,MA3BxB,IAAA,EAiC2D,MAAM,0BAjCjE,IAAA,EA0C+D,MAAM,uBAM1DyB,GAAA,CAAA,MAAM,cAAA,EAyBNtB,GAAA,CAAA,MAAM,eAAA,2HAxEfY,EA+EU6C,EAAA,CA9EP,cAAanD,EAAA,WACd,MAAM,iBACN,KAAK,SACJ,uBAAsB,GACtB,sBAAiBC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAAEtB,EAAA,MAAK,oBAAsBsB,CAAM,EAAA,EAAA,CANzD,QAAAd,EAQI,IAAA,WAuEM,OAvENL,EAuEM,MAvENrB,GAuEM,CArEJqB,EAoBM,MApBNpB,GAoBM,CAnBJoB,EAGM,MAHNnB,GAGM,CAFJ4B,EAA8CC,EAAA,CAAtC,KAAK,eAAe,MAAM,SAAA,CAAA,EAClCV,EAAsD,OAAA,KAAAC,IAA7CrC,EAAAiC,gBAAA,YAAAjC,EAAa,YAAS,SAAA,EAAA,CAAA,CAAA,CAAA,EAEjCoC,EAGM,MAHNlB,GAGM,CAAAgB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAFJE,EAAsC,OAAA,CAAhC,MAAM,OAAA,EAAQ,cAAW,EAAA,GAC/BA,EAA8E,OAA9EjB,GAA8EkB,EAAtDJ,EAAA,iBAAeW,EAAAX,gBAAA,YAAAW,EAAa,aAAU,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,EAGrDX,EAAA,mBAAAK,EAAA,EAAXP,EASM,MATNX,GASM,CARJgB,EAGM,MAHNf,GAGM,CAAAa,EAAA,CAAA,IAAAA,EAAA,CAAA,EAFJE,EAAgD,OAAA,CAA1C,MAAM,eAAA,EAAgB,gBAAa,EAAA,GACzCA,EAAmG,OAAnGd,GAAmGe,EAAvDJ,EAAA,iBAAec,EAAAd,gBAAA,YAAAc,EAAa,cAAW,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,EAErFX,EAGM,MAHNb,GAGM,CAAAW,EAAA,CAAA,IAAAA,EAAA,CAAA,EAFJE,EAAqD,OAAA,CAA/C,MAAM,eAAA,EAAgB,qBAAkB,EAAA,GAC9CA,EAAyF,OAAzFZ,GAAyFa,EAA1CJ,iBAAeA,EAAA,gBAAgB,CAAA,EAAA,CAAA,CAAA,CAAA,CA3B1F,CAAA,GAAAU,EAAA,GAAA,EAAA,CAAA,CAAA,EAiCiBV,EAAA,eAAiBA,EAAA,yBAAAK,EAAA,EAA5BP,EAMM,MANNN,GAMM,CALJoB,EAA0CC,EAAA,CAAlC,KAAK,WAAW,MAAM,SAAA,CAAA,EAC9BV,EAGO,OAAA,KAAA,CAAAF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAtCfQ,EAmCc,sCAEJ,GAAAN,EAAqD,SAAA,KAAAC,EAA1CJ,kBAAgBA,EAAA,aAAa,CAAA,EAAA,CAAA,EAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EArClDQ,EAqC+D,SACvD,EAAA,CAAA,CAtCR,CAAA,GAAAC,EAAA,GAAA,EAAA,EAAA,CA0CkBV,EAAA,yBAA2BA,EAAA,KAAK,aAAAK,IAA5CP,EAGM,MAHNL,GAGM,CAFJmB,EAAmCC,EAAA,CAA3B,KAAK,OAAO,MAAM,MAAA,CAAA,EAC1BZ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAE,EAAuC,YAAjC,6BAA0B,EAAA,EAAA,CAAA,GA5CxCO,EAAA,GAAA,EAAA,EAgDMP,EAsBM,MAtBNa,GAsBM,CArBJJ,EAWU2D,EAAA,CA5DlB,WAkD0BvE,EAAA,KAAK,YAlD/B,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAkD0BtB,OAAK,YAAWsB,GAlD1C,eAkDU,CAAA,OAAA,EAAA,EACA,KAAK,SACL,MAAM,cACN,YAAY,eACZ,MAAM,OACL,MAAK,CAAGtB,EAAA,aAAcA,EAAA,kBAAkB,CAAA,EAAA,CAE9B,aAAYQ,EACrB,IAAoCP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CAApCE,EAAoC,OAAA,CAA9B,MAAM,eAAA,EAAgB,IAAC,EAAA,CAAA,EAAA,EA1DzC,EAAA,CAAA,EAAA,EAAA,CAAA,aAAA,OAAA,CAAA,EA8DQS,EAKE2D,EAAA,CAnEV,WA+DmBvE,EAAA,KAAK,kBA/DxB,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GA+DmBtB,OAAK,kBAAiBsB,GAC/B,MAAM,oBACN,YAAY,qBACZ,MAAM,MAAA,EAAA,KAAA,EAAA,CAAA,YAAA,CAAA,EAGRV,EAA2F4D,EAAA,CArEnG,WAqE8BxE,EAAA,KAAK,QArEnC,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAqE8BtB,OAAK,QAAOsB,GAAE,MAAM,eAAe,MAAM,OAAQ,UAAW,EAAA,EAAA,KAAA,EAAA,CAAA,YAAA,CAAA,IAIpFnB,EAKM,MALNT,GAKM,CAJJkB,EAAsEQ,EAAA,CAA5D,OAAO,YAAa,QAAOpB,EAAA,YAAA,EAAA,CA1E7C,QAAAQ,EA0E2D,IAAQP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CA1EnEQ,EA0E2D,UAAQ,CAAA,EAAA,EA1EnE,EAAA,CAAA,EAAA,EAAA,CAAA,SAAA,CAAA,EA2EQG,EAEWQ,EAAA,CAFD,MAAM,UAAW,QAASpB,EAAA,QAAU,SAAQ,CAAGA,EAAA,YAAc,QAAOA,EAAA,YAAA,EAAA,CA3EtF,QAAAQ,EA2EoG,IAE5FP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CA7ERQ,EA2EoG,kBAE5F,CAAA,EAAA,EA7ER,EAAA,CAAA,EAAA,EAAA,CAAA,UAAA,WAAA,SAAA,CAAA,SAAA,EAAA,CAAA,EAAA,EAAA,CAAA,aAAA,CAAA,iEC6QAgE,GAAepG,EAAgB,CAC7B,KAAM,eACN,WAAY,CACV,eAAAqG,GACA,aAAAC,GACA,aAAAC,EAAA,EAEF,MAAO,CACL,SAAU,CACR,KAAM,OACN,SAAU,EAAA,CACZ,EAEF,MAAO,CAAC,OAAQ,gBAAiB,kBAAkB,EACnD,MAAO,CACL,MAAO,CACL,gBAAiB,GACjB,iBAAkB,GAClB,oBAAqB,KACrB,UAAW,KACX,gBAAiB,GACjB,cAAe,GACf,eAAgB,CACd,CAAE,IAAK,eAAgB,MAAO,UAAW,SAAU,EAAA,EACnD,CAAE,IAAK,WAAY,MAAO,WAAY,SAAU,GAAM,MAAO,GAAA,CAAI,EAEnE,cAAe,CACb,CAAE,MAAO,UAAW,KAAM,SAAA,EAC1B,CAAE,MAAO,kBAAmB,KAAM,kBAAA,EAClC,CAAE,MAAO,YAAa,KAAM,WAAA,EAC5B,CAAE,MAAO,WAAY,KAAM,UAAA,EAC3B,CAAE,MAAO,YAAa,KAAM,WAAA,EAC5B,CAAE,MAAO,YAAa,KAAM,WAAA,CAAY,CAC1C,CAEJ,EACA,SAAU,CACR,GAAGC,EAASC,EAAkB,CAAC,MAAM,CAAC,EACtC,GAAGD,EAAS9H,EAAkB,CAAC,eAAe,CAAC,EAE/C,SAAyB,CACvB,OAAO,KAAK,MAAQ,IACtB,EAEA,gBAA0B,CACxB,MAAMiB,EAAS,KAAK,SAAS,OAC7B,OAAOA,IAAW,WAAaA,IAAW,mBAAqBA,IAAW,WAC5E,EAEA,qBAAqC,SAEnC,OAAID,EAAA,KAAK,gBAAL,MAAAA,EAAoB,aACf,KAAK,cAAc,gBAGpB4C,EAAA,KAAK,SAAS,UAAd,YAAAA,EAAuB,eAAgB,IAAI,IAAKoE,IAAe,CACrE,GAAGA,EACH,QAASA,EAAK,SAAW,GACzB,QAASA,EAAK,SAAW,KACzB,YAAaA,EAAK,aAAe,KACjC,kBAAmBA,EAAK,mBAAqB,IAAA,EAC7C,CACJ,EAEA,gBAAiB,OACf,IAAIhH,EAAA,KAAK,gBAAL,MAAAA,EAAoB,QACtB,OAAO,KAAK,cAAc,QAG5B,MAAMiH,EAAe,KAAK,oBACpBC,EAAYD,EAAa,OAAO,CAACtD,EAAa4B,IAAmB5B,GAAO4B,EAAE,YAAc,GAAI,CAAC,EAC7F4B,EAAaF,EAAa,OAC9B,CAACtD,EAAa4B,IAAmB5B,GAAO4B,EAAE,QAAUA,EAAE,aAAeA,EAAE,WAAa,GACpF,CAAA,EAEI6B,EAAaH,EAAa,OAAQ1B,GAAmBA,EAAE,OAAO,EAAE,OACtE,MAAO,CACL,UAAA2B,EACA,WAAAC,EACA,aAAcD,EAAYC,EAC1B,WAAAC,EACA,aAAcH,EAAa,OAASG,CAAA,CAExC,CAAA,EAEF,MAAO,CACL,cAAe,CACb,SAAU,CACR,KAAK,kBAAA,CACP,CAAA,CACF,EAEF,SAAU,CACR,KAAK,kBAAA,CACP,EACA,QAAS,CACP,GAAGC,EAAWrI,EAAkB,CAAC,gBAAiB,gBAAiB,kBAAkB,CAAC,EAEtF,MAAM,mBAAoB,OACxB,IAAKgB,EAAA,KAAK,WAAL,MAAAA,EAAe,GACpB,MAAK,gBAAkB,GACvB,GAAI,CACF,MAAM,KAAK,cAAc,KAAK,SAAS,EAAE,CAC3C,OAASL,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,CACtD,QAAA,CACE,KAAK,gBAAkB,EACzB,EACF,EAEA,WAAWkG,EAAwC,CACjD,GAAI,CAACA,EAAY,MAAO,MACxB,GAAI,CACF,OAAO,IAAI,KAAKA,CAAU,EAAE,mBAAmB,QAAS,CACtD,KAAM,UACN,MAAO,OACP,IAAK,SAAA,CACN,CACH,MAAQ,CACN,OAAOA,CACT,CACF,EAEA,eAAe/E,EAAoC,CACjD,OAAKA,EACE,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CAAA,CACxB,EAAE,OAAOA,CAAM,EANI,IAOtB,EAEA,eAAeb,EAAwB,CASrC,MARuC,CACrC,QAAS,UACT,gBAAiB,OACjB,UAAW,UACX,SAAU,SACV,UAAW,YACX,UAAW,SAAA,EAECA,CAAM,GAAK,WAC3B,EAEA,aAAaA,EAAwB,CACnC,OAAKA,EACEA,EAAO,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAUqH,GAAMA,EAAE,YAAA,CAAa,EADpD,KAEtB,EAEA,eAAgB,CACd,OAAO,MAAA,CACT,EAEA,MAAM,aAAc,mBAClB,GAAI,GAACtH,EAAA,KAAK,WAAL,MAAAA,EAAe,IAAI,EACtB4C,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAAS,uBACT,MAAO,SAAA,GAET,MACF,CAEA,GAAI,EACFG,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAAS,oBACT,MAAO,MAAA,GAMT,MAAMwE,EAAO,MAHI,MAAM,MACrB,6FAAoE,KAAK,SAAS,EAAE,MAAA,GAE1D,KAAA,EAE5B,GAAIA,EAAK,QAAS,CAEhB,MAAMC,EAAiB,KAAKD,EAAK,GAAG,EAC9BE,EAAc,IAAI,MAAMD,EAAe,MAAM,EACnD,QAASjC,EAAI,EAAGA,EAAIiC,EAAe,OAAQjC,IACzCkC,EAAYlC,CAAC,EAAIiC,EAAe,WAAWjC,CAAC,EAE9C,MAAMmC,EAAY,IAAI,WAAWD,CAAW,EACtCE,EAAO,IAAI,KAAK,CAACD,CAAS,EAAG,CAAE,KAAM,kBAAmB,EAGxDnI,EAAM,OAAO,IAAI,gBAAgBoI,CAAI,EACrCC,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOrI,EACTqI,EAAE,SAAW,sBAAsBL,EAAK,eAAevE,EAAA,KAAK,SAAS,SAAd,YAAAA,EAAsB,YAAa,UAAU,OACpG4E,EAAE,MAAA,EAGF,OAAO,IAAI,gBAAgBrI,CAAG,GAE9B4D,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAAS,8BACT,MAAO,SAAA,EAEX,MACE0E,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAASN,EAAK,SAAW,yBACzB,MAAO,QAAA,EAGb,OAAS5H,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,GAC7CmI,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAAS,yBACT,MAAO,QAAA,EAEX,CACF,EAEA,iBAAkB,CAChB,KAAK,UAAY,YACjB,KAAK,gBAAkB,EACzB,EAEA,cAAczI,EAAe,CAC3B,KAAK,MAAM,gBAAiB,CAC1B,GAAI,KAAK,SAAS,GAClB,OAAQA,CAAA,CACT,CACH,EAEA,cAAe,CACT,KAAK,YACP,KAAK,MAAM,gBAAiB,CAC1B,GAAI,KAAK,SAAS,GAClB,OAAQ,KAAK,SAAA,CACd,EACD,KAAK,gBAAkB,GACvB,KAAK,UAAY,KAErB,EAGA,iBAAiBsG,EAA0B,CACzC,KAAK,oBAAsBA,EAC3B,KAAK,iBAAmB,EAC1B,EAEA,MAAM,oBAAoB7F,EAKvB,eACD,KAAK,cAAgB,GACrB,GAAI,CACF,MAAMiI,EAAS,MAAM,KAAK,cAAcjI,EAAQ,eAAgB,CAC9D,YAAaA,EAAQ,YACrB,kBAAmBA,EAAQ,kBAC3B,QAASA,EAAQ,OAAA,CAClB,EAED,KAAK,iBAAmB,GACxB,KAAK,oBAAsB,KAG3B,IAAIkI,EAAU,gCACVD,EAAO,cACTC,EAAUD,EAAO,SAAW,sCAAsC,KAAK,aAAaA,EAAO,WAAa,EAAE,CAAC,KAClG/H,EAAA+H,EAAO,OAAP,YAAA/H,EAAa,kBAAmB,YAEzCgI,EAAU,gDADQ,KAAK,eAAeD,EAAO,KAAK,iBAAiB,CACA,KAGrEnF,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAAAoF,EACA,MAAO,SAAA,GAIT,KAAK,MAAM,mBAAoBD,CAAM,EAGrC,MAAM,KAAK,kBAAA,CACb,OAASpI,EAAY,EACnBwD,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,UAASH,GAAAD,EAAApD,EAAM,WAAN,YAAAoD,EAAgB,OAAhB,YAAAC,EAAsB,UAAW,2BAC1C,MAAO,QAAA,EAEX,QAAA,CACE,KAAK,cAAgB,EACvB,CACF,EAEA,MAAM,YAAY2C,EAA0B,aAC1C,GAAK,QAAQ,qDAAqDA,EAAY,SAAS,IAAI,EAI3F,MAAK,cAAgB,GACrB,GAAI,CACF,MAAM,KAAK,iBAAiBA,EAAY,EAAE,GAE1C3F,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,QAAS,gCACT,MAAO,SAAA,GAIT,MAAM,KAAK,kBAAA,CACb,OAASL,EAAY,EACnBqD,EAAA,KAAK,WAAL,MAAAA,EAAe,KAAK,CAClB,UAASD,GAAAH,EAAAjD,EAAM,WAAN,YAAAiD,EAAgB,OAAhB,YAAAG,EAAsB,UAAW,4BAC1C,MAAO,QAAA,EAEX,QAAA,CACE,KAAK,cAAgB,EACvB,EACF,CAAA,CAEJ,CAAC,ECtkBMhC,GAAA,CAAA,MAAM,eAAA,EAEJC,GAAA,CAAA,MAAM,iBAAA,EACJC,GAAA,CAAA,MAAM,uCAAA,EACJC,GAAA,CAAA,MAAM,cAAA,EALnBC,GAAA,CAAA,KAAA,MAAA,IAAA,EAOqB,MAAM,kCAEdE,GAAA,CAAA,MAAM,YAAA,EAENC,GAAA,CAAA,MAAM,eAAA,EAmBVC,GAAA,CAAA,MAAM,sDAAA,EAYNC,GAAA,CAAA,MAAM,4CAAA,EAQAC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAETuB,GAAA,CAAA,MAAM,UAAA,EAEHtB,GAAA,CAAA,MAAM,OAAA,EAYTuB,GAAA,CAAA,MAAM,UAAA,EAEHtB,GAAA,CAAA,MAAM,qBAAA,EAETwB,GAAA,CAAA,MAAM,UAAA,EAEHvB,GAAA,CAAA,MAAM,OAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHkC,GAAA,CAAA,MAAM,OAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHgB,GAAA,CAAA,MAAM,OAAA,EAETf,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHc,GAAA,CAAA,MAAM,OAAA,EAaXb,GAAA,CAAA,MAAM,sDAAA,EACJC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAETY,GAAA,CAAA,MAAM,UAAA,EAEHX,GAAA,CAAA,MAAM,OAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAETuD,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAaXC,GAAA,CAAA,MAAM,uCAAA,EACJC,GAAA,CAAA,MAAM,WAAA,EACJC,GAAA,CAAA,MAAM,YAAA,EAGRC,GAAA,CAAA,MAAM,WAAA,EACJC,GAAA,CAAA,MAAM,YAAA,EAGRC,GAAA,CAAA,MAAM,WAAA,EACJC,GAAA,CAAA,MAAM,YAAA,EAgBNC,GAAA,CAAA,MAAM,eAAA,EACHC,GAAA,CAAA,MAAM,eAAA,EACNC,GAAA,CAAA,MAAM,8BAAA,EA4BbC,GAAA,CAAA,MAAM,uCAAA,EACJC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,iBAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAETC,GAAA,CAAA,MAAM,UAAA,EAEHC,GAAA,CAAA,MAAM,OAAA,EAabC,GAAA,CAAA,MAAM,eAAA,EAcNC,GAAA,CAAA,MAAM,KAAA,EAEJC,GAAA,CAAA,MAAM,wBAAA,wQAtOjB,OAAAlH,EAAA,EAAAP,EA4OM,MA5ONhB,GA4OM,CA1OJqB,EAgBM,MAhBNpB,GAgBM,CAfJoB,EAcM,MAdNnB,GAcM,CAbJmB,EAGM,MAHNlB,GAGM,CAFOe,eAAXF,EAAqE,MAAA,CAN/E,IAAA,EAM+B,IAAKE,EAAA,QAAS,IAAI,eAAe,MAAM,MAAA,EAAA,KAAA,EANtEd,EAAA,IAAAmB,EAAA,EAOUP,EAAsF,KAAtFX,GAAkD,iCAA+B,EAAA,CAAA,EAEnFgB,EAQM,MARNf,GAQM,CAAAa,EAAA,CAAA,IAAAA,EAAA,CAAA,EAPJE,EAAyE,KAAA,CAArE,MAAM,uCAAA,EAAwC,qBAAkB,EAAA,GACpEA,EAEI,IAFJd,GAAyB,UACjBe,EAAGJ,EAAA,SAAS,6BAA+BA,EAAA,WAAWA,EAAA,SAAS,iBAAiB,CAAA,EAAA,CAAA,EAExFY,EAESL,EAAA,CAFA,MAAOP,EAAA,eAAeA,EAAA,SAAS,MAAM,EAAG,KAAK,QAAQ,MAAM,MAAA,EAAA,CAd9E,QAAAQ,EAeY,IAAmC,CAf/CC,EAAAL,EAeeJ,EAAA,aAAaA,EAAA,SAAS,MAAM,CAAA,EAAA,CAAA,CAAA,CAAA,EAf3C,EAAA,CAAA,EAAA,EAAA,CAAA,OAAA,CAAA,QAuBYA,EAAA,SAAS,YADjBM,EAKEkH,EAAA,CA3BN,IAAA,EAwBO,gBAAexH,EAAA,SAAS,OACxB,aAAcA,EAAA,oBACf,MAAM,MAAA,EAAA,KAAA,EAAA,CAAA,gBAAA,cAAA,CAAA,GA1BZU,EAAA,GAAA,EAAA,EA8BIP,EASM,MATNb,GASM,CARJsB,EAAmFQ,EAAA,CAAzE,OAAO,YAAY,KAAK,QAAS,QAAOpB,EAAA,aAAA,EAAA,CA/BxD,QAAAQ,EA+BuE,IAAOP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CA/B9EQ,EA+BuE,SAAO,CAAA,EAAA,EA/B9E,EAAA,CAAA,EAAA,EAAA,CAAA,SAAA,CAAA,EAgCMG,EAA2FQ,EAAA,CAAjF,OAAO,YAAY,KAAK,WAAY,QAAOpB,EAAA,WAAA,EAAA,CAhC3D,QAAAQ,EAgCwE,IAAcP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAhCtFQ,EAgCwE,gBAAc,CAAA,EAAA,EAhCtF,EAAA,CAAA,EAAA,EAAA,CAAA,SAAA,CAAA,EAiCMG,EAAwFQ,EAAA,CAA9E,MAAM,UAAU,KAAK,OAAQ,QAAKnB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAAEtB,EAAA,MAAK,OAASA,EAAA,QAAQ,EAAA,EAAA,CAjC1E,QAAAQ,EAiC6E,IAAMP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAjCnFQ,EAiC6E,QAAM,CAAA,EAAA,EAjCnF,EAAA,CAAA,CAAA,EAoCsBT,EAAA,gBAAAK,IAAhBC,EAEWc,EAAA,CAtCjB,IAAA,EAoCsC,MAAM,YAAY,KAAK,SAAU,QAAKnB,eAAED,EAAA,cAAa,WAAA,EAAA,EAAA,CApC3F,QAAAQ,EAoC0G,IAEpGP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CAtCNQ,EAoC0G,UAEpG,CAAA,EAAA,EAtCN,EAAA,CAAA,CAAA,GAAAC,EAAA,GAAA,EAAA,CAAA,CAAA,EA0CIP,EAoDM,MApDNZ,GAoDM,CAlDJqB,EAeSiD,GAfD,SAAA,EAAA,EAAQ,CA5CtB,UA6CQ,IAGc,CAHdjD,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CA7CpD,UA8CU,IAA+C,CAA/ClD,EAA+CC,EAAA,CAAvC,KAAK,gBAAgB,MAAM,SAAA,CAAA,EA9C7CZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EA8CyD,eAEjD,EAAA,CAAA,EAhDR,EAAA,CAAA,CAAA,EAiDQG,EASgBmD,EAAA,KAAA,CA1DxB,UAkDU,IAAA,SAGM,OAHN5D,EAGM,MAHNX,GAGM,CAAAS,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAgC,OAAA,CAA1B,MAAM,OAAA,EAAQ,QAAK,EAAA,GACzBA,EAAoE,OAApEV,GAAoEW,IAA7CrC,EAAAiC,EAAA,SAAS,cAAT,YAAAjC,EAAsB,OAAI,KAAA,EAAA,CAAA,CAAA,CAAA,EAEnDoC,EAGM,MAHNa,GAGM,CAAAf,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAiC,OAAA,CAA3B,MAAM,OAAA,EAAQ,SAAM,EAAA,GAC1BA,EAAqE,OAArET,GAAqEU,IAA9CO,EAAAX,EAAA,SAAS,cAAT,YAAAW,EAAsB,QAAK,KAAA,EAAA,CAAA,CAAA,CAAA,KAxD9D,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EA8DMC,EA+BSiD,GA/BD,SAAA,EAAA,EAAQ,CA9DtB,UA+DQ,IAGc,CAHdjD,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CA/DpD,UAgEU,IAAwC,CAAxClD,EAAwCC,EAAA,CAAhC,KAAK,SAAS,MAAM,SAAA,CAAA,EAhEtCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAgEkD,sBAE1C,EAAA,CAAA,EAlER,EAAA,CAAA,CAAA,EAmEQG,EAyBgBmD,EAAA,KAAA,CA5FxB,UAoEU,IAAA,iBAGM,OAHN5D,EAGM,MAHNc,GAGM,CAAAhB,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAgC,OAAA,CAA1B,MAAM,OAAA,EAAQ,QAAK,EAAA,GACzBA,EAAkF,OAAlFR,GAAkFS,IAA7CrC,EAAAiC,EAAA,SAAS,SAAT,YAAAjC,EAAiB,YAAS,KAAA,EAAA,CAAA,CAAA,CAAA,EAEjEoC,EAGM,MAHNgB,GAGM,CAAAlB,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAmC,OAAA,CAA7B,MAAM,OAAA,EAAQ,WAAQ,EAAA,GAC5BA,EAAkE,OAAlEP,GAAkEQ,IAA3CO,EAAAX,EAAA,SAAS,SAAT,YAAAW,EAAiB,UAAO,KAAA,EAAA,CAAA,CAAA,CAAA,EAEjDR,EAGM,MAHNN,GAGM,CAAAI,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAoC,OAAA,CAA9B,MAAM,OAAA,EAAQ,YAAS,EAAA,GAC7BA,EAAmE,OAAnE4B,GAAmE3B,IAA5CU,EAAAd,EAAA,SAAS,SAAT,YAAAc,EAAiB,WAAQ,KAAA,EAAA,CAAA,CAAA,CAAA,EAElDX,EAGM,MAHN6B,GAGM,CAAA/B,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAoC,OAAA,CAA9B,MAAM,OAAA,EAAQ,YAAS,EAAA,GAC7BA,EAAmE,OAAnE6C,GAAmE5C,IAA5CW,EAAAf,EAAA,SAAS,SAAT,YAAAe,EAAiB,WAAQ,KAAA,EAAA,CAAA,CAAA,CAAA,EAElDZ,EAGM,MAHN8B,GAGM,CAAAhC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAgC,OAAA,CAA1B,MAAM,OAAA,EAAQ,QAAK,EAAA,GACzBA,EAA+D,OAA/D+B,GAA+D9B,IAAxCc,EAAAlB,EAAA,SAAS,SAAT,YAAAkB,EAAiB,OAAI,KAAA,EAAA,CAAA,CAAA,CAAA,EAE9Cf,EAGM,MAHNgC,GAGM,CAAAlC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAiC,OAAA,CAA3B,MAAM,OAAA,EAAQ,SAAM,EAAA,GAC1BA,EAAgE,OAAhE8C,GAAgE7C,IAAzCwF,EAAA5F,EAAA,SAAS,SAAT,YAAA4F,EAAiB,QAAK,KAAA,EAAA,CAAA,CAAA,CAAA,KA1FzD,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,IAiGIhF,EAyBSiD,EAAA,CAzBD,SAAA,GAAS,MAAM,MAAA,EAAA,CAjG3B,QAAArD,EAkGM,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CAlGlD,UAmGQ,IAA2C,CAA3ClD,EAA2CC,EAAA,CAAnC,KAAK,YAAY,MAAM,SAAA,CAAA,EAnGvCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAmGmD,wBAE7C,EAAA,CAAA,EArGN,EAAA,CAAA,CAAA,EAsGMG,EAmBgBmD,EAAA,KAAA,CAzHtB,UAuGQ,IAAA,aAiBM,OAjBN5D,EAiBM,MAjBNiC,GAiBM,CAhBJjC,EAGM,MAHNkC,GAGM,CAAApC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAA0C,OAAA,CAApC,MAAM,OAAA,EAAQ,kBAAe,EAAA,GACnCA,EAAqE,OAArEmC,GAAqElC,IAA9CrC,EAAAiC,EAAA,SAAS,eAAT,YAAAjC,EAAuB,OAAI,KAAA,EAAA,CAAA,CAAA,CAAA,EAEpDoC,EAGM,MAHN+C,GAGM,CAAAjD,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAwC,OAAA,CAAlC,MAAM,OAAA,EAAQ,gBAAa,EAAA,GACjCA,EAA6E,OAA7EoC,GAA6EnC,IAAtDO,EAAAX,EAAA,SAAS,eAAT,YAAAW,EAAuB,eAAY,KAAA,EAAA,CAAA,CAAA,CAAA,EAE5DR,EAGM,MAHNqC,GAGM,CAAAvC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAqC,OAAA,CAA/B,MAAM,OAAA,EAAQ,aAAU,EAAA,GAC9BA,EAAsG,OAAtGsC,GAAsGrC,IAA/EU,EAAAd,EAAA,SAAS,eAAT,YAAAc,EAAuB,YAAS,iCAAA,EAAA,CAAA,CAAA,CAAA,EAEzDX,EAGM,MAHN6F,GAGM,CAAA/F,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAiC,OAAA,CAA3B,MAAM,OAAA,EAAQ,SAAM,EAAA,GAC1BA,EAAsE,OAAtE8F,GAAsE7F,IAA/CW,EAAAf,EAAA,SAAS,eAAT,YAAAe,EAAuB,QAAK,KAAA,EAAA,CAAA,CAAA,CAAA,OAtH/D,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EA6HIH,EAqBSiD,EAAA,CArBD,SAAA,GAAS,MAAM,MAAA,EAAA,CA7H3B,QAAArD,EA8HM,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CA9HlD,UA+HQ,IAAwC,CAAxClD,EAAwCC,EAAA,CAAhC,KAAK,SAAS,MAAM,SAAA,CAAA,EA/HpCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EA+HgD,mBAE1C,EAAA,CAAA,EAjIN,EAAA,CAAA,CAAA,EAkIMG,EAegBmD,EAAA,KAAA,CAjJtB,UAmIQ,IAAA,WAaM,OAbN5D,EAaM,MAbN+F,GAaM,CAZJ/F,EAGM,MAHNgG,GAGM,CAFJhG,EAA6E,MAA7EiG,GAA6EhG,IAAlDrC,EAAAiC,EAAA,SAAS,eAAT,YAAAjC,EAAuB,gBAAa,CAAA,EAAA,CAAA,EAAAkC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAC/DE,EAAqC,MAAA,CAAhC,MAAM,cAAa,UAAO,EAAA,EAAA,CAAA,EAEjCA,EAGM,MAHNkG,GAGM,CAFJlG,EAA+E,MAA/EmG,GAA+ElG,IAApDO,EAAAX,EAAA,SAAS,eAAT,YAAAW,EAAuB,kBAAe,CAAA,EAAA,CAAA,EAAAV,EAAA,EAAA,IAAAA,EAAA,EAAA,EACjEE,EAAuC,MAAA,CAAlC,MAAM,cAAa,YAAS,EAAA,EAAA,CAAA,EAEnCA,EAGM,MAHNoG,GAGM,CAFJpG,EAAgF,MAAhFqG,GAAgFpG,IAArDU,EAAAd,EAAA,SAAS,eAAT,YAAAc,EAAuB,mBAAgB,CAAA,EAAA,CAAA,EAAAb,EAAA,EAAA,IAAAA,EAAA,EAAA,EAClEE,EAAwC,MAAA,CAAnC,MAAM,cAAa,aAAU,EAAA,EAAA,CAAA,OA9I9C,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EAqJIS,EAkBSiD,EAAA,CAlBD,SAAA,GAAS,MAAM,MAAA,EAAA,CArJ3B,QAAArD,EAsJM,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CAtJlD,UAuJQ,IAAsC,CAAtClD,EAAsCC,EAAA,CAA9B,KAAK,OAAO,MAAM,SAAA,CAAA,EAvJlCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAuJ8C,oBAExC,EAAA,CAAA,EAzJN,EAAA,CAAA,CAAA,EA0JMG,EAYgBmD,EAAA,KAAA,CAtKtB,UA2JQ,IAUc,CAVdnD,EAUc6G,EAAA,CAVA,MAAOzH,WAAS,kBAAgB,CAAA,EAAS,QAASA,EAAA,eAAgB,UAAA,GAAU,QAAA,EAAA,EAAA,CAC7E,qBAAkBQ,EAC3B,CAGM,CAJyB,QAAAkH,KAAO,CACtCvH,EAGM,MAHNsG,GAGM,CAFJtG,EAA6D,OAA7DuG,GAA6DtG,EAA9BsH,EAAQ,YAAY,EAAA,CAAA,EACnDvH,EAA+E,OAA/EwG,GAA+EvG,EAAjCsH,EAAQ,eAAe,EAAA,CAAA,CAAA,CAAA,IAG9D,iBAAclH,EACvB,CAA4D,CADjC,QAAAkH,KAAO,CAClC9G,EAA4D8B,EAAA,CAAlD,KAAM,OAAOgF,EAAQ,QAAQ,EAAG,MAAM,SAAA,EAAA,KAAA,EAAA,CAAA,MAAA,CAAA,IAnK5D,EAAA,CAAA,EAAA,EAAA,CAAA,QAAA,SAAA,CAAA,IAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EA0KI9G,EAQE+G,EAAA,CAPC,aAAc3H,EAAA,oBACd,QAASA,EAAA,eACT,iBAAcjC,EAAAiC,EAAA,SAAS,UAAT,YAAAjC,EAAkB,eAAY,EAC5C,QAASiC,EAAA,gBACT,cAAa,GACb,gBAAeA,EAAA,iBACf,QAAOA,EAAA,WAAA,EAAA,KAAA,EAAA,CAAA,eAAA,UAAA,eAAA,UAAA,kBAAA,SAAA,CAAA,EAIVY,EAyBSiD,EAAA,CAzBD,SAAA,GAAS,MAAM,iBAAA,EAAA,CArL3B,QAAArD,EAsLM,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CAtLlD,UAuLQ,IAAmC,CAAnClD,EAAmCC,EAAA,CAA3B,KAAK,OAAO,MAAM,MAAA,CAAA,EAvLlCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAuL2C,wBAErC,EAAA,CAAA,EAzLN,EAAA,CAAA,CAAA,EA0LMG,EAmBgBmD,EAAA,KAAA,CA7MtB,UA2LQ,IAAA,WAiBM,OAjBN5D,EAiBM,MAjBNyG,GAiBM,CAhBJzG,EAGM,MAHN0G,GAGM,CAAA5G,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAwC,OAAA,CAAlC,MAAM,OAAA,EAAQ,gBAAa,EAAA,GACjCA,EAAgF,OAAhF2G,GAAgF1G,IAA/CrC,EAAAiC,EAAA,SAAS,gBAAT,YAAAjC,EAAwB,OAAI,KAAA,EAAA,CAAA,CAAA,CAAA,EAE/DoC,EAGM,MAHN4G,GAGM,CAAA9G,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAwC,OAAA,CAAlC,MAAM,OAAA,EAAQ,gBAAa,EAAA,GACjCA,EAA8E,OAA9E6G,GAA8E5G,IAAvDO,EAAAX,EAAA,SAAS,gBAAT,YAAAW,EAAwB,eAAY,KAAA,EAAA,CAAA,CAAA,CAAA,EAE7DR,EAGM,MAHN8G,GAGM,CAAAhH,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAkC,OAAA,CAA5B,MAAM,OAAA,EAAQ,UAAO,EAAA,GAC3BA,EAAwE,OAAxE+G,GAAwE9G,IAAjDU,EAAAd,EAAA,SAAS,gBAAT,YAAAc,EAAwB,SAAM,KAAA,EAAA,CAAA,CAAA,CAAA,EAEvDX,EAGM,MAHNgH,GAGM,CAAAlH,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAA2C,OAAA,CAArC,MAAM,OAAA,EAAQ,mBAAgB,EAAA,GACpCA,EAAkE,OAAlEiH,GAAkEhH,EAA3CJ,WAAS,iBAAe,KAAA,EAAA,CAAA,CAAA,CAAA,OA1M3D,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EAiNkBA,EAAA,SAAS,aAAvBM,EAQSuD,EAAA,CAzNb,IAAA,EAiNoC,SAAA,GAAS,MAAM,MAAA,EAAA,CAjNnD,QAAArD,EAkNM,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CAlNlD,UAmNQ,IAAuC,CAAvClD,EAAuCC,EAAA,CAA/B,KAAK,QAAQ,MAAM,SAAA,CAAA,EAnNnCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAmN+C,WAEzC,EAAA,CAAA,EArNN,EAAA,CAAA,CAAA,EAsNMG,EAEgBmD,EAAA,KAAA,CAxNtB,UAuNQ,IAAmD,CAAnD5D,EAAmD,IAAnDkH,GAAmDjH,EAAvBJ,WAAS,OAAO,EAAA,CAAA,CAAA,CAAA,EAvNpD,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAAU,EAAA,GAAA,EAAA,EA4NIE,EAKEgH,EAAA,CAjON,WA6Ne5H,EAAA,iBA7Nf,qCA6NeA,EAAA,iBAAgBsB,GACxB,YAAatB,EAAA,oBACb,QAASA,EAAA,cACT,SAAQA,EAAA,mBAAA,EAAA,KAAA,EAAA,CAAA,aAAA,cAAA,UAAA,UAAA,CAAA,EAIXY,EAQUuC,EAAA,CA5Od,WAoOsBnD,EAAA,gBApOtB,qCAoOsBA,EAAA,gBAAesB,GAAE,MAAM,yBAA0B,uBAAsB,EAAA,EAAA,CApO7F,QAAAd,EAqOM,IAMM,CANNL,EAMM,MANNmH,GAMM,CALJ1G,EAAgG+B,EAAA,CAtOxG,WAsO2B3C,EAAA,UAtO3B,qCAsO2BA,EAAA,UAASsB,GAAG,QAAStB,EAAA,cAAe,MAAM,oBAAoB,MAAM,MAAA,EAAA,KAAA,EAAA,CAAA,aAAA,SAAA,CAAA,EACvFG,EAGM,MAHNoH,GAGM,CAFJ3G,EAA+EQ,EAAA,CAArE,OAAO,YAAa,QAAKnB,eAAED,EAAA,gBAAe,GAAA,EAAA,CAxO9D,QAAAQ,EAwOwE,IAAMP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CAxO9EQ,EAwOwE,QAAM,CAAA,EAAA,EAxO9E,EAAA,CAAA,CAAA,EAyOUG,EAAkEQ,EAAA,CAAxD,MAAM,UAAW,QAAOpB,EAAA,YAAA,EAAA,CAzO5C,QAAAQ,EAyO0D,IAAOP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CAzOjEQ,EAyO0D,SAAO,CAAA,EAAA,EAzOjE,EAAA,CAAA,EAAA,EAAA,CAAA,SAAA,CAAA,QAAA,EAAA,CAAA,EAAA,EAAA,CAAA,YAAA,CAAA,mEC6NAoH,GAAexJ,EAAgB,CAC7B,KAAM,eACN,MAAO,CACL,SAAU,CACR,KAAM,OACN,QAAS,IAAA,EAEX,OAAQ,CACN,KAAM,QACN,QAAS,EAAA,EAEX,mBAAoB,CAClB,KAAM,OACN,QAAS,IAAA,CACX,EAEF,MAAO,CAAC,OAAQ,QAAQ,EACxB,OAAQ,CACN,KAAM,CAAE,SAAAyJ,EAAU,MAAAC,GAAUC,EAAQ,SAAS,EAC7C,MAAO,CAAE,SAAAF,EAAU,MAAAC,CAAA,CACrB,EACA,MAAO,CACL,MAAO,CACL,KAAM,CACJ,iBAAkB,KAClB,sBAAuB,KACvB,gBAAiB,GACjB,QAAS,GACT,OAAQ,UACR,aAAc,CAAA,CAAC,EAEjB,oBAAqB,CAAA,EACrB,iBAAkB,GAClB,gBAAiB,KACjB,mBAAoB,CAClB,CAAE,MAAO,eAAgB,KAAM,cAAA,EAC/B,CAAE,MAAO,iBAAkB,KAAM,qBAAA,EACjC,CAAE,MAAO,kBAAmB,KAAM,iBAAA,CAAkB,EAEtD,cAAe,CACb,CAAE,MAAO,UAAW,KAAM,SAAA,EAC1B,CAAE,MAAO,kBAAmB,KAAM,kBAAA,EAClC,CAAE,MAAO,YAAa,KAAM,WAAA,EAC5B,CAAE,MAAO,WAAY,KAAM,UAAA,EAC3B,CAAE,MAAO,YAAa,KAAM,WAAA,EAC5B,CAAE,MAAO,YAAa,KAAM,WAAA,CAAY,EAE1C,oBAAqB,CACnB,CACE,UAAW,2BACX,WAAY,IACZ,SAAU,EACV,gBAAiB,QACjB,cAAe,cAAA,EAEjB,CACE,UAAW,iCACX,WAAY,IACZ,SAAU,IACV,gBAAiB,QACjB,cAAe,gBAAA,EAEjB,CACE,UAAW,kCACX,WAAY,KACZ,SAAU,GACV,gBAAiB,QACjB,cAAe,gBAAA,EAEjB,CACE,UAAW,mCACX,WAAY,KACZ,SAAU,GACV,gBAAiB,QACjB,cAAe,gBAAA,CACjB,CACF,CAEJ,EACA,SAAU,CACR,GAAGlD,EAAS9H,EAAkB,CAAC,QAAQ,CAAC,EAExC,aAAsB,CACpB,OAAO,KAAK,KAAK,aAAa,OAAO,CAAC2E,EAAKqD,IAASrD,GAAO,OAAOqD,EAAK,UAAU,GAAK,GAAI,CAAC,CAC7F,EAEA,WAAqB,CACnB,OAAI,KAAK,OACA,GAGF,CAAC,CAAC,KAAK,KAAK,kBAAoB,KAAK,KAAK,aAAa,OAAS,CACzE,CAAA,EAEF,SAAU,CACR,KAAK,iBAAA,EACD,KAAK,QAAU,KAAK,SACtB,KAAK,aAAA,GAGL,KAAK,KAAK,aAAe,CAAA,EAGrB,KAAK,oBACP,KAAK,yBAAA,EAGX,EACA,QAAS,CACP,MAAM,kBAAmB,OACvB,KAAK,iBAAmB,GACxB,GAAI,CAGF,MAAMvH,EAAW,MAAMC,EAAM,IADjB,8GACwB,EAEpC,GAAID,EAAS,KAAK,QAAS,CACzB,MAAMyK,IAAelK,EAAAP,EAAS,KAAK,OAAd,YAAAO,EAAoB,gBAAiB,CAAA,EAC1D,KAAK,oBAAsBkK,EAAa,IAAKnG,GAAA,2BAA2B,OACtE,MAAOA,EAAK,GACZ,KAAM,GAAGA,EAAK,IAAI,QAAM/D,EAAA+D,EAAK,SAAL,YAAA/D,EAAa,YAAa,SAAS,GAC3D,SAAU,KAAG4C,EAAAmB,EAAK,kBAAL,YAAAnB,EAAsB,QAAS,KAAK,QAAMG,EAAAgB,EAAK,kBAAL,YAAAhB,EAAsB,aAAc,CAAC,aAC1FC,EAAAe,EAAK,kBAAL,YAAAf,EAAsB,gBAAiB,CACzC,aACA,SAAU,CACR,GAAIe,EAAK,GACT,KAAMA,EAAK,KACX,aAAaZ,EAAAY,EAAK,SAAL,YAAAZ,EAAa,UAC1B,SAAS0E,EAAA9D,EAAK,SAAL,YAAA8D,EAAa,QACtB,MAAMC,EAAA/D,EAAK,kBAAL,YAAA+D,EAAsB,MAC5B,SAASqC,EAAApG,EAAK,kBAAL,YAAAoG,EAAsB,QAC/B,YAAYC,EAAArG,EAAK,kBAAL,YAAAqG,EAAsB,WAClC,eAAeC,EAAAtG,EAAK,kBAAL,YAAAsG,EAAsB,cACrC,QAAQC,EAAAvG,EAAK,kBAAL,YAAAuG,EAAsB,MAAA,CAChC,EACA,CACJ,CACF,OAAS3K,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,CACrD,QAAA,CACE,KAAK,iBAAmB,EAC1B,CACF,EAEA,0BAA2B,yBACzB,MAAM4K,EAAU,KAAK,mBACrB,GAAI,CAACA,EAAS,OAGd,KAAK,gBAAkB,CACrB,GAAIA,EAAQ,GACZ,KAAMA,EAAQ,KACd,aAAavK,EAAAuK,EAAQ,SAAR,YAAAvK,EAAgB,UAC7B,SAAS4C,EAAA2H,EAAQ,SAAR,YAAA3H,EAAgB,QACzB,MAAMG,EAAAwH,EAAQ,kBAAR,YAAAxH,EAAyB,MAC/B,SAASC,EAAAuH,EAAQ,kBAAR,YAAAvH,EAAyB,QAClC,YAAYG,EAAAoH,EAAQ,kBAAR,YAAApH,EAAyB,WACrC,eAAe0E,EAAA0C,EAAQ,kBAAR,YAAA1C,EAAyB,cACxC,QAAQC,EAAAyC,EAAQ,kBAAR,YAAAzC,EAAyB,MAAA,EAInC,MAAM0C,EAAS,CACb,MAAOD,EAAQ,GACf,KAAM,GAAGA,EAAQ,IAAI,QAAMJ,EAAAI,EAAQ,SAAR,YAAAJ,EAAgB,YAAa,SAAS,GACjE,SAAU,KAAGC,EAAAG,EAAQ,kBAAR,YAAAH,EAAyB,QAAS,KAAK,QAAMC,EAAAE,EAAQ,kBAAR,YAAAF,EAAyB,aAAc,CAAC,QAClG,SAAU,KAAK,eAAA,EAIF,KAAK,oBAAoB,KAAMvG,GAAQA,EAAI,QAAUyG,EAAQ,EAAE,GAE5E,KAAK,oBAAoB,QAAQC,CAAM,EAIzC,KAAK,KAAK,iBAAmBA,CAC/B,EAEA,kBAAkBC,EAAe,CAC3BA,GAAA,MAAAA,EAAU,SACZ,KAAK,gBAAkBA,EAAS,SAEhC,KAAK,gBAAkB,IAE3B,EAEA,cAAe,aACR,KAAK,WAEV,KAAK,KAAK,kBAAoB,KAAK,SAAS,kBACxC,IAAI,KAAK,KAAK,SAAS,iBAAiB,EACxC,IAAI,KACR,KAAK,KAAK,gBAAkB,KAAK,SAAS,iBAAmB,GAC7D,KAAK,KAAK,QAAU,KAAK,SAAS,SAAW,GAC7C,KAAK,KAAK,OAAS,KAAK,SAAS,QAAU,WAEvCzK,EAAA,KAAK,SAAS,UAAd,MAAAA,EAAuB,eACzB,KAAK,KAAK,aAAe,KAAK,SAAS,QAAQ,aAAa,IAAKgH,IAAe,CAC9E,UAAWA,EAAK,UAChB,WAAYA,EAAK,WACjB,SAAUA,EAAK,SACf,gBAAiBA,EAAK,iBAAmB,QACzC,cAAeA,EAAK,eAAiB,cAAA,EACrC,GAGA,KAAK,SAAS,gBAChB,KAAK,gBAAkB,CACrB,GAAI,KAAK,SAAS,cAAc,GAChC,KAAM,KAAK,SAAS,cAAc,KAClC,aAAapE,EAAA,KAAK,SAAS,SAAd,YAAAA,EAAsB,UACnC,MAAMG,EAAA,KAAK,SAAS,eAAd,YAAAA,EAA4B,aAClC,YAAYC,EAAA,KAAK,SAAS,eAAd,YAAAA,EAA4B,WACxC,OAAQ,KAAK,SAAS,cAAc,MAAA,GAG1C,EAEA,gBAAiB,CACf,KAAK,KAAK,aAAa,KAAK,CAC1B,UAAW,GACX,WAAY,EACZ,SAAU,KACV,gBAAiB,QACjB,cAAe,cAAA,CAChB,CACH,EAEA,kBAAkBjD,EAAe,CAC/B,KAAK,KAAK,aAAa,OAAOA,EAAO,CAAC,CACxC,EAEA,eAAee,EAAwB,CACrC,OAAO,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CAAA,CACxB,EAAE,OAAOA,CAAM,CAClB,EAEA,MAAM,YAAa,OAEjB,GAAI,CADY,MAAM,KAAK,SAAA,EACb,OAEd,MAAMhB,EAAe,CACnB,kBAAmB,KAAK,KAAK,kBACzB4K,EAAO,IAAI,KAAK,KAAK,KAAK,iBAAiB,EAAG,YAAY,EAC1DA,EAAO,IAAI,KAAQ,YAAY,EACnC,gBAAiB,KAAK,KAAK,iBAAmB,KAC9C,QAAS,KAAK,KAAK,SAAW,KAC9B,aAAc,KAAK,KAAK,aAAa,IAAK1D,GAAS,CAEjD,IAAI2D,EAAU3D,EAAK,cACf,OAAO2D,GAAY,UAAYA,IAAY,OAC7CA,EAAWA,EAAgB,OAAS,gBAEtC,IAAIC,EAAa5D,EAAK,gBACtB,OAAI,OAAO4D,GAAe,UAAYA,IAAe,OACnDA,EAAcA,EAAmB,OAAS,SAGrC,CACL,UAAW5D,EAAK,UAChB,WAAY,OAAOA,EAAK,UAAU,EAClC,SAAUA,EAAK,SAAW,OAAOA,EAAK,QAAQ,EAAI,KAClD,gBAAiB,OAAO4D,GAAc,OAAO,EAC7C,cAAe,OAAOD,GAAW,cAAc,CAAA,CAEnD,CAAC,CAAA,EAGE,KAAK,SACR7K,EAAQ,mBAAmBE,EAAA,KAAK,KAAK,mBAAV,YAAAA,EAA4B,QAAS,KAAK,KAAK,kBAGxE,KAAK,SACPF,EAAQ,OAAS,KAAK,KAAK,QAG7B,KAAK,MAAM,OAAQA,CAAO,CAC5B,CAAA,CAEJ,CAAC,ECxfMiB,GAAA,CAAA,MAAM,eAAA,EACLC,GAAA,CAAA,MAAM,yBAAA,MAFd,IAAA,EA+BgC,MAAM,iBAChBE,GAAA,CAAA,MAAM,eAAA,EACNC,GAAA,CAAA,MAAM,uBAAA,MAjC5B,IAAA,EAuCsC,MAAM,kCAE3BE,GAAA,CAAA,MAAM,+CAAA,EAGDC,GAAA,CAAA,MAAM,kBAAA,EAINC,GAAA,CAAA,MAAM,kBAAA,EAINC,GAAA,CAAA,MAAM,kBAAA,EAINC,GAAA,CAAA,MAAM,kBAAA,MAxD5B,IAAA,EA2DgD,MAAM,QAElCwB,GAAA,CAAA,MAAM,kBAAA,EAaXtB,GAAA,CAAA,MAAM,uCAAA,EAqBNuB,GAAA,CAAA,MAAM,yBAAA,MA/FrB,IAAA,EA2GqD,MAAM,kCAS1CE,GAAA,CAAA,MAAM,uCAAA,EACHvB,GAAA,CAAA,MAAM,6BAAA,EAGTC,GAAA,CAAA,MAAM,uCAAA,MAxHvB,IAAA,EAyJmD,MAAM,6CACxCmC,GAAA,CAAA,MAAM,mCAAA,EAEHgB,GAAA,CAAA,MAAM,oBAAA,EAuBff,GAAA,CAAA,MAAM,6BAAA,sNAlLf,OAAA5B,EAAA,EAAAP,EAyLM,MAzLNhB,GAyLM,CAxLJqB,EAEK,KAFLpB,GAEKqB,EADAJ,EAAA,OAAM,iBAAA,sBAAA,EAAA,CAAA,EAGXY,EAmLSgI,EAAA,CAnLD,IAAI,SAAA,EAAS,CANzB,UAQM,IAyDS,CAzDM5I,SARrBU,EAAA,GAAA,EAAA,OAQMJ,EAyDSuD,EAAA,CAjEf,IAAA,EAQ6B,SAAA,GAAS,MAAM,MAAA,EAAA,CAR5C,QAAArD,EASQ,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CATpD,UAUU,IAAwC,CAAxClD,EAAwCC,EAAA,CAAhC,KAAK,SAAS,MAAM,SAAA,CAAA,EAVtCZ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAQ,EAUkD,wBAE1C,EAAA,CAAA,EAZR,EAAA,CAAA,CAAA,EAaQG,EAmDgBmD,EAAA,KAAA,CAhExB,UAcU,IAGU,CAHVnD,EAGUiI,EAAA,CAHD,MAAM,OAAO,MAAM,OAAO,OAAO,MAAA,EAAA,CAC7B,MAAKrI,EAAC,IAAqBP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAflDQ,EAe6B,uBAAqB,CAAA,EAAA,EAflD,QAAAD,EAe6D,IAEnD,CAAAP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAjBVQ,EAe6D,6GAEnD,EAAA,CAAA,EAjBV,EAAA,CAAA,CAAA,EAmBUG,EAiBW+B,EAAA,CApCrB,WAoBqB3C,EAAA,KAAK,iBApB1B,sBAAA,CAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAoBqBtB,OAAK,iBAAgBsB,GAQVtB,EAAA,iBAAA,EAPnB,QAASA,EAAA,oBACT,QAASA,EAAA,iBACV,MAAM,gBACN,YAAY,uCACZ,WAAA,GACA,yBAAA,GACC,MAAK,CAAIiE,GAAM,CAAA,CAAOA,GAAC,2BAAA,CAAA,EAAA,CAGb,QAAOzD,EAChB,CAGM,CAJc,MAAAsI,KAAK,CACdA,GAAAzI,EAAA,EAAXP,EAGM,MAHNd,GAGM,CAFJmB,EAAmD,OAAnDlB,GAAmDmB,EAApB0I,EAAM,IAAI,EAAA,CAAA,EACzC3I,EAA+D,OAA/DjB,GAA+DkB,EAAxB0I,EAAM,QAAQ,EAAA,CAAA,CAAA,CAAA,GAjCrEpI,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,EAAA,CAAA,EAAA,EAAA,CAAA,aAAA,UAAA,UAAA,QAAA,qBAAA,CAAA,EAuCqBV,EAAA,iBAAAK,EAAA,EAAXP,EAwBM,MAxBNX,GAwBM,CAAAc,EAAA,EAAA,IAAAA,EAAA,EAAA,EAvBJE,EAA4D,KAAA,CAAxD,MAAM,oBAAA,EAAqB,2BAAwB,EAAA,GACvDA,EAiBM,MAjBNf,GAiBM,CAhBJe,EAGM,MAAA,KAAA,CAAAF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAFJE,EAA0C,OAAA,CAApC,MAAM,eAAA,EAAgB,UAAO,EAAA,GACnCA,EAAuE,OAAvEd,GAAuEe,EAArCJ,kBAAgB,WAAW,EAAA,CAAA,CAAA,CAAA,EAE/DG,EAGM,MAAA,KAAA,CAAAF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAwC,OAAA,CAAlC,MAAM,eAAA,EAAgB,QAAK,EAAA,GACjCA,EAAgE,OAAhEb,GAAgEc,EAA9BJ,kBAAgB,IAAI,EAAA,CAAA,CAAA,CAAA,EAExDG,EAGM,MAAA,KAAA,CAAAF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAwC,OAAA,CAAlC,MAAM,eAAA,EAAgB,QAAK,EAAA,GACjCA,EAAsE,OAAtEZ,GAAsEa,EAApCJ,kBAAgB,UAAU,EAAA,CAAA,CAAA,CAAA,EAE9DG,EAGM,MAAA,KAAA,CAAAF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAA0C,OAAA,CAApC,MAAM,eAAA,EAAgB,UAAO,EAAA,GACnCA,EAAkE,OAAlEX,GAAkEY,EAAhCJ,kBAAgB,MAAM,EAAA,CAAA,CAAA,CAAA,IAGjDA,EAAA,gBAAgB,SAAAK,EAAA,EAA3BP,EAGM,MAHNL,GAGM,CAAAQ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAA2C,OAAA,CAArC,MAAM,eAAA,EAAgB,WAAQ,EAAA,GACpCA,EAAmE,OAAnEa,GAAmEZ,EAAjCJ,kBAAgB,OAAO,EAAA,CAAA,CAAA,CAAA,GA7DvEU,EAAA,GAAA,EAAA,CAAA,CAAA,GAAAA,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAoEME,EAsBSiD,EAAA,CAtBD,SAAA,GAAS,MAAM,MAAA,EAAA,CApE7B,QAAArD,EAqEQ,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CArEpD,UAsEU,IAA6C,CAA7ClD,EAA6CC,EAAA,CAArC,KAAK,cAAc,MAAM,SAAA,CAAA,EAtE3CZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAsEuD,qBAE/C,EAAA,CAAA,EAxER,EAAA,CAAA,CAAA,EAyEQG,EAgBgBmD,EAAA,KAAA,CAzFxB,UA0EU,IAOM,CAPN5D,EAOM,MAPNT,GAOM,CANJkB,EAAoG4D,EAAA,CA3EhH,WA2EkCxE,EAAA,KAAK,kBA3EvC,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GA2EkCtB,OAAK,kBAAiBsB,GAAE,MAAM,oBAAoB,YAAY,aAAA,EAAA,KAAA,EAAA,CAAA,YAAA,CAAA,EACpFV,EAIE2D,EAAA,CAhFd,WA6EuBvE,EAAA,KAAK,gBA7E5B,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GA6EuBtB,OAAK,gBAAesB,GAC7B,MAAM,kBACN,YAAY,iCAAA,EAAA,KAAA,EAAA,CAAA,YAAA,CAAA,IAGhBV,EAMEmI,EAAA,CAxFZ,WAmFqB/I,EAAA,KAAK,QAnF1B,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GAmFqBtB,OAAK,QAAOsB,GACrB,MAAM,UACN,YAAY,yCACZ,MAAM,OACL,WAAU,CAAA,EAAA,KAAA,EAAA,CAAA,YAAA,CAAA,IAvFvB,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EA6FMV,EAmESiD,EAAA,CAnED,SAAA,GAAS,MAAM,MAAA,EAAA,CA7F7B,QAAArD,EA8FQ,IAMc,CANdI,EAMckD,EAAA,CAND,MAAM,mCAAA,EAAmC,CA9F9D,UA+FU,IAGM,CAHN3D,EAGM,MAHNc,GAGM,CAFJL,EAA0CC,EAAA,CAAlC,KAAK,WAAW,MAAM,SAAA,CAAA,EAhG1CZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAgGsD,wBAE5C,EAAA,CAAA,EACAG,EAAyGQ,EAAA,CAA/F,OAAO,YAAY,KAAK,QAAQ,KAAK,MAAO,QAAOpB,EAAA,cAAA,EAAA,CAnGvE,QAAAQ,EAmGuF,IAAiBP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CAnGxGQ,EAmGuF,mBAAiB,CAAA,EAAA,EAnGxG,EAAA,CAAA,EAAA,EAAA,CAAA,SAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EAqGQG,EA0DgBmD,EAAA,KAAA,CA/JxB,UAsGU,IAGU,CAHK/D,EAAA,KAAK,aAAa,SAAM,GAAAK,EAAA,EAAvCC,EAGUuI,EAAA,CAzGpB,IAAA,EAsGyD,MAAM,UAAU,MAAM,OAAO,OAAO,MAAA,EAAA,CACtE,MAAKrI,EAAC,IAAQP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CAvGrCQ,EAuG6B,UAAQ,CAAA,EAAA,EAvGrC,QAAAD,EAuGgD,IAEtC,CAAAP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAzGVQ,EAuGgD,uEAEtC,EAAA,CAAA,EAzGV,EAAA,CAAA,CAAA,GAAAC,EAAA,GAAA,EAAA,EA2GqBV,EAAA,KAAK,aAAa,SAAM,GAAAK,EAAA,EAAnCP,EAEM,MAFNH,GAAkF,8EAElF,GA7GVe,EAAA,GAAA,EAAA,GAAAL,EAAA,EAAA,EA+GUP,EAuCMyB,EAAA,KAtJhBuB,EAgH2C9C,OAAK,aAhHhD,CAgHoB0D,EAAa5F,SADvBgC,EAuCM,MAAA,CArCH,IAAKhC,EACN,MAAM,4CAAA,EAAA,CAENqC,EAGM,MAHNgB,GAGM,CAFJhB,EAA4E,OAA5EP,GAA0C,eAAYQ,EAAGtC,EAAK,CAAA,EAAA,CAAA,EAC9D8C,EAAuGQ,EAAA,CAA7F,OAAO,QAAQ,MAAM,SAAS,KAAK,QAAQ,KAAK,SAAU,QAAKE,GAAEtB,EAAA,kBAAkBlC,CAAK,CAAA,EAAA,KAAA,EAAA,CAAA,SAAA,CAAA,IAEpGqC,EA6BM,MA7BNN,GA6BM,CA5BJe,EAKE2D,EAAA,CA9HhB,WA0HyBb,EAAY,UA1HrC,sBAAApC,GA0HyBoC,EAAY,UAASpC,EAC9B,MAAM,cACN,YAAY,iCACX,MAAK,CAAI2C,GAAM,CAAA,CAAOA,GAAC,yBAAA,CAAA,EAAA,KAAA,EAAA,CAAA,aAAA,sBAAA,OAAA,CAAA,EAE1BrD,EAME2D,EAAA,CArIhB,WAgIyBb,EAAY,WAhIrC,sBAAApC,GAgIyBoC,EAAY,WAAUpC,EAC/B,MAAM,eACN,KAAK,SACL,YAAY,OACX,MAAK,CAAI2C,GAAWA,EAAC,GAAA,+BAAA,CAAA,EAAA,KAAA,EAAA,CAAA,aAAA,sBAAA,OAAA,CAAA,EAExBrD,EAOE+B,EAAA,CA7IhB,WAuIyBe,EAAY,cAvIrC,sBAAApC,GAuIyBoC,EAAY,cAAapC,EACjC,QAAStB,EAAA,mBACV,MAAM,WACN,YAAY,kBACZ,WAAS,QACT,UAAQ,MAAA,EAAA,KAAA,EAAA,CAAA,aAAA,sBAAA,SAAA,CAAA,EAEVY,EAME2D,EAAA,CApJhB,WA+IyBb,EAAY,SA/IrC,sBAAApC,GA+IyBoC,EAAY,SAAQpC,EAC5B,MAAOoC,EAAY,gBAAa,iBAAA,sBAAA,WACjC,KAAK,SACL,YAAY,WACX,SAAUA,EAAY,gBAAa,cAAA,EAAA,KAAA,EAAA,CAAA,aAAA,sBAAA,QAAA,UAAA,CAAA,cAM/B1D,EAAA,KAAK,aAAa,OAAM,GAAAK,IAAnCP,EAKM,MALNiC,GAKM,CAJJ5B,EAGM,MAHN6B,GAGM,CAAA/B,EAAA,EAAA,IAAAA,EAAA,EAAA,EAFJE,EAAgD,OAAA,CAA1C,MAAM,uBAAA,EAAwB,QAAK,EAAA,GACzCA,EAAyE,OAAzE6C,GAAyE5C,EAArCJ,iBAAeA,EAAA,WAAW,CAAA,EAAA,CAAA,CAAA,CAAA,CA5J5E,CAAA,GAAAU,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,EAmKoBV,EAAA,QAAAK,IAAdC,EAaSuD,EAAA,CAhLf,IAAA,EAmK4B,SAAA,GAAS,MAAM,MAAA,EAAA,CAnK3C,QAAArD,EAoKQ,IAGc,CAHdI,EAGckD,EAAA,CAHD,MAAM,yBAAA,EAAyB,CApKpD,UAqKU,IAAsC,CAAtClD,EAAsCC,EAAA,CAA9B,KAAK,OAAO,MAAM,SAAA,CAAA,EArKpCZ,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAQ,EAqKgD,UAExC,EAAA,CAAA,EAvKR,EAAA,CAAA,CAAA,EAwKQG,EAOgBmD,EAAA,KAAA,CA/KxB,UAyKU,IAKE,CALFnD,EAKE+B,EAAA,CA9KZ,WA0KqB3C,EAAA,KAAK,OA1K1B,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAqB,GA0KqBtB,OAAK,OAAMsB,GACnB,QAAStB,EAAA,cACV,MAAM,mBACN,YAAY,eAAA,EAAA,KAAA,EAAA,CAAA,aAAA,SAAA,CAAA,IA7KxB,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA,GAAAU,EAAA,GAAA,EAAA,EAmLMP,EAKM,MALN8B,GAKM,CAJJrB,EAAyEQ,EAAA,CAA/D,OAAO,YAAa,QAAKnB,eAAED,EAAA,MAAK,QAAA,EAAA,EAAA,CApLlD,QAAAQ,EAoL8D,IAAQP,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,CApLtEQ,EAoL8D,UAAQ,CAAA,EAAA,EApLtE,EAAA,CAAA,CAAA,EAqLQG,EAEWQ,EAAA,CAFD,MAAM,UAAW,QAASpB,EAAA,OAAS,SAAQ,CAAGA,EAAA,UAAY,QAAOA,EAAA,UAAA,EAAA,CArLnF,QAAAQ,EAsLU,IAAsD,CAtLhEC,IAsLaT,EAAA,OAAM,mBAAA,kBAAA,EAAA,CAAA,CAAA,CAAA,EAtLnB,EAAA,CAAA,EAAA,EAAA,CAAA,UAAA,WAAA,SAAA,CAAA,MAAA,EAAA,CAAA,EAAA,GAAA,mEC+DAgJ,GAAe3K,EAAgB,CAC7B,KAAM,6BACN,WAAY,CACV,cAAA4K,GACA,aAAAC,GACA,aAAAC,EAAA,EAEF,OAAQ,CACN,KAAM,CAAE,KAAAC,CAAA,EAASC,EAAA,EACjB,MAAO,CAAE,KAAAD,CAAA,CACX,EACA,MAAO,CACL,MAAO,CACL,YAAa,WACb,gBAAiB,KACjB,WAAY,GACZ,mBAAoB,KACpB,cAAe,CAAA,EACf,gBAAiB,IAAA,CAErB,EACA,SAAU,CACR,GAAGvE,EAAS9H,EAAkB,CAC5B,WACA,iBACA,kBACA,gBACA,UACA,SACA,OAAA,CACD,CAAA,EAEH,SAAU,CACR,KAAK,aAAA,EACL,KAAK,YAAA,CACP,EACA,QAAS,CACP,GAAGqI,EAAWrI,EAAkB,CAC9B,gBACA,sBACA,oBACA,iBACA,iBACA,uBACA,uBACA,oBAAA,CACD,EAED,MAAM,cAAe,CACnB,GAAI,CACF,MAAM,KAAK,cAAc,OAAW,KAAK,iBAAmB,MAAS,CACvE,MAAgB,CACd,KAAK,KAAK,CACR,QAAS,0BACT,MAAO,QAAA,CACR,CACH,CACF,EAEA,MAAM,aAAc,CAClB,GAAI,CAEF,MAAMS,EAAW,MAAMC,EAAM,IADjB,+EACwB,EACpC,GAAID,EAAS,KAAM,CACjB,MAAM8L,EAAU,MAAM,QAAQ9L,EAAS,IAAI,EAAIA,EAAS,KAAOA,EAAS,KAAK,MAAQ,CAAA,EACrF,KAAK,cAAgB8L,EAAQ,IAAKjG,IAAY,CAC5C,MAAOA,EAAE,GACT,KAAMA,EAAE,IAAA,EACR,CACJ,CACF,OAAS3F,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,CAC/C,CACF,EAEA,eAAeL,EAAyB,CACtC,KAAK,gBAAkBA,EACvB,KAAK,aAAA,CACP,EAEA,MAAM,aAAayE,EAAW,CAC5B,GAAI,CACF,MAAM7D,EAAa6D,EAAK,aAAeA,EAAK,gBACxC7D,GACF,MAAM,KAAK,kBAAkBA,CAAU,EACvC,KAAK,YAAc,QAEnB,KAAK,KAAK,CACR,QAAS,mCACT,MAAO,SAAA,CACR,CAEL,MAAgB,CACd,KAAK,KAAK,CACR,QAAS,mCACT,MAAO,QAAA,CACR,CACH,CACF,EAEA,aAAa6D,EAAW,CAEtB,GAAIA,EAAK,aAAeA,EAAK,gBAAiB,CAC5C,MAAM7D,EAAa6D,EAAK,aAAeA,EAAK,gBAC5C,KAAK,kBAAkB7D,CAAU,EAAE,KAAK,IAAM,CAC5C,KAAK,gBAAkB,KAAK,gBAC5B,KAAK,WAAa,GAClB,KAAK,mBAAqB,KAC1B,KAAK,YAAc,MACrB,CAAC,CACH,MACE,KAAK,gBAAkB6D,EACvB,KAAK,WAAa,GAClB,KAAK,mBAAqB,KAC1B,KAAK,YAAc,MAEvB,EAEA,wBAAwBwG,EAAc,CACpC,KAAK,gBAAkB,KACvB,KAAK,WAAa,GAClB,KAAK,mBAAqBA,EAC1B,KAAK,YAAc,MACrB,EAEA,gBAAiB,CACf,KAAK,gBAAkB,KACvB,KAAK,WAAa,GAClB,KAAK,mBAAqB,KAC1B,KAAK,YAAc,MACrB,EAEA,cAAe,CACb,KAAK,YAAc,WACnB,KAAK,gBAAkB,KACvB,KAAK,WAAa,GAClB,KAAK,mBAAqB,KAC1B,KAAK,qBAAA,EACL,KAAK,mBAAA,EACL,KAAK,aAAA,CACP,EAEA,MAAM,WAAWhD,EAAW,WAC1B,GAAI,CACE,KAAK,cAAcvH,EAAA,KAAK,kBAAL,MAAAA,EAAsB,KAC3C,MAAM,KAAK,eAAe,KAAK,gBAAgB,GAAIuH,CAAI,EACvD,KAAK,KAAK,CACR,QAAS,iCACT,MAAO,SAAA,CACR,IAED,MAAM,KAAK,eAAeA,CAAI,EAC9B,KAAK,KAAK,CACR,QAAS,iCACT,MAAO,SAAA,CACR,GAEH,KAAK,aAAA,CACP,OAAS5H,EAAY,CACnB,KAAK,KAAK,CACR,UAASoD,GAAAH,EAAAjD,EAAM,WAAN,YAAAiD,EAAgB,OAAhB,YAAAG,EAAsB,UAAW,2BAC1C,MAAO,QAAA,CACR,CACH,CACF,EAEA,MAAM,mBAAmBwE,EAAsC,CAC7D,GAAI,CACF,MAAM,KAAK,qBAAqBA,EAAK,GAAIA,EAAK,MAAM,EACpD,KAAK,KAAK,CACR,QAAS,8BAA8BA,EAAK,MAAM,GAClD,MAAO,SAAA,CACR,EAED,MAAM,KAAK,kBAAkBA,EAAK,EAAE,CACtC,MAAgB,CACd,KAAK,KAAK,CACR,QAAS,mCACT,MAAO,QAAA,CACR,CACH,CACF,EAEA,MAAM,kBAAkBA,EAA+C,SACrE,GAAI,CACF,MAAM,KAAK,oBAAoBA,EAAK,UAAWA,EAAK,QAAQ,EAC5D,KAAK,KAAK,CACR,QAAS,YAAYA,EAAK,SAAS,QAAQ,KAAM,GAAG,CAAC,GACrD,MAAO,SAAA,CACR,CACH,OAAS5H,EAAY,CACnB,KAAK,KAAK,CACR,UAASiD,GAAA5C,EAAAL,EAAM,WAAN,YAAAK,EAAgB,OAAhB,YAAA4C,EAAsB,UAAW,yBAC1C,MAAO,QAAA,CACR,CACH,CACF,EAEA,MAAM,sBAAsBmF,EAAa,OAEnCA,EAAO,gBACT,KAAK,KAAK,CACR,QAAS,kBAAkBA,EAAO,SAAS,MAAMA,EAAO,SAAS,GACjE,MAAO,MAAA,CACR,GAEG/H,EAAA,KAAK,kBAAL,MAAAA,EAAsB,IACxB,MAAM,KAAK,kBAAkB,KAAK,gBAAgB,EAAE,EAG1D,CAAA,CAEJ,CAAC,EC/QUe,GAAA,CAAA,MAAM,mGAAA,EACJC,GAAA,CAAA,MAAM,+CAAA,4JAJjBuB,EAiDSuD,EAAA,CAjDD,MAAM,UAAQ,CADxB,UAEI,IA+CgB,CA/ChBjD,EA+CgBmD,EAAA,KAAA,CAjDpB,UAIM,IAMM,CANN5D,EAMM,MANNrB,GAMM,CALJqB,EAIM,MAJNpB,GAIM,CAHYiB,EAAA,cAAW,gBAA3BM,EAEWc,EAAA,CARrB,IAAA,EAMsD,MAAM,OAAO,KAAK,aAAa,KAAK,QAAS,QAAOpB,EAAA,YAAA,EAAA,CAN1G,QAAAQ,EAMwH,IAE9GP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CARVQ,EAMwH,WAE9G,CAAA,EAAA,EARV,EAAA,CAAA,EAAA,EAAA,CAAA,SAAA,CAAA,GAAAC,EAAA,GAAA,EAAA,CAAA,CAAA,IAasBV,EAAA,cAAW,gBACzBM,EAYEiJ,EAAA,CA1BV,IAAA,EAeW,SAAUvJ,EAAA,SACV,OAAQA,EAAA,eACR,QAASA,EAAA,QACT,OAAQA,EAAA,OACR,iBAAgBA,EAAA,cAChB,UAASA,EAAA,aACT,eAAcA,EAAA,eACd,iBAAgBA,EAAA,wBAChB,eAAcA,EAAA,aACd,eAAcA,EAAA,aACd,cAAaA,EAAA,iBAAA,EAAA,KAAA,EAAA,CAAA,WAAA,SAAA,UAAA,SAAA,iBAAA,YAAA,iBAAA,mBAAA,iBAAA,iBAAA,eAAA,CAAA,GAKGA,EAAA,cAAW,QAAeA,EAAA,iBAAAK,IAC7CC,EAKEkJ,EAAA,CApCV,IAAA,EAgCW,SAAUxJ,EAAA,gBACV,OAAMA,EAAA,aACN,eAAcA,EAAA,mBACd,kBAAiBA,EAAA,qBAAA,EAAA,KAAA,EAAA,CAAA,WAAA,SAAA,iBAAA,mBAAA,CAAA,GAKDA,EAAA,cAAW,YAC9BM,EAMEmJ,EAAA,CA/CV,IAAA,EA0CW,SAAUzJ,EAAA,gBACV,UAASA,EAAA,WACT,sBAAqBA,EAAA,mBACrB,OAAMA,EAAA,WACN,SAAQA,EAAA,YAAA,EAAA,KAAA,EAAA,CAAA,WAAA,UAAA,sBAAA,SAAA,UAAA,CAAA,GA9CnBU,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,EAAA,CAAA,CAAA,IAAA,EAAA,CAAA,CAAA"}