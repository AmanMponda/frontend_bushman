import{d as E,_ as N,g as m,e as s,v as V,t as d,b as n,i as c,a as q,w as r,h as v,G as U,F as S,f as T,o as l,l as B,k as O,q as D,m as j,H as Q}from"./index-P4QeRV7n.js";import{u as A,P as R}from"./ProposalView-Cc2Z3Jqy.js";import{u as L}from"./useToast-DVuIP6Z-.js";import{u as G}from"./useForm-XQT-jLAz.js";import{f as M}from"./format-Cn4G_mmc.js";import"./settings-store-BoS8g_yz.js";const H=E({name:"PipelineCard",props:{item:{type:Object,required:!0}},emits:["click","create-proposal","view","edit"],computed:{formatDateRange(){const e=this.item.hunting_details;if(!(e!=null&&e.start_date))return"N/A";const t=_=>{try{return new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return _}},y=t(e.start_date),u=e.end_date?t(e.end_date):"",i=e.no_of_days?` (${e.no_of_days}d)`:"";return u?`${y} - ${u}${i}`:`${y}${i}`}},methods:{handleClick(){this.$emit("click",this.item)},truncateSpecies(e){return e?e.length>30?e.substring(0,30)+"...":e:"N/A"},formatCurrency(e){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"}}}),J={class:"card-header"},K={class:"inquiry-code"},W={class:"client-info"},X={class:"client-name"},Y={class:"client-meta"},Z={class:"hunting-details"},x={class:"detail-row"},ee={class:"detail-text truncate"},te={class:"detail-row"},se={class:"detail-text"},ne={class:"detail-row"},oe={class:"detail-text"},ae={key:0,class:"detail-row amount-row"},ie={class:"detail-text amount"},le={key:1,class:"detail-row"},re={class:"detail-text"},de={key:0,class:"agent-info"},ue={class:"agent-name"},me={class:"card-actions"};function pe(e,t,y,u,i,_){var w,k,C,f,h;const a=c("VaIcon"),$=c("VaButton");return l(),m("div",{class:T(["pipeline-card",{"is-new":e.item.type==="inquiry"}]),onClick:t[3]||(t[3]=(...g)=>e.handleClick&&e.handleClick(...g))},[s("div",J,[s("span",K,d(e.item.code),1)]),s("div",W,[s("h4",X,d(((w=e.item.client)==null?void 0:w.full_name)||"Unknown Client"),1),s("p",Y,d(((k=e.item.client)==null?void 0:k.country)||"N/A")+" â€¢ "+d(e.item.created_date_formatted||e.item.created_date),1)]),s("div",Z,[s("div",x,[n(a,{name:"pets",size:"small",color:"secondary"}),s("span",ee,d(e.truncateSpecies((C=e.item.hunting_details)==null?void 0:C.species)),1)]),s("div",te,[n(a,{name:"location_on",size:"small",color:"secondary"}),s("span",se,d(((f=e.item.hunting_details)==null?void 0:f.areas)||"N/A"),1)]),s("div",ne,[n(a,{name:"calendar_today",size:"small",color:"secondary"}),s("span",oe,d(e.formatDateRange),1)]),e.item.type==="proposal"&&e.item.total_amount?(l(),m("div",ae,[n(a,{name:"payments",size:"small",color:"success"}),s("span",ie,d(e.formatCurrency(e.item.total_amount)),1)])):(l(),m("div",le,[n(a,{name:"person",size:"small",color:"secondary"}),s("span",re,d(((h=e.item.hunting_details)==null?void 0:h.no_of_hunters)||0)+" hunter(s)",1)]))]),e.item.sales_agent?(l(),m("div",de,[n(a,{name:"support_agent",size:"small",color:"info"}),s("span",ue,d(e.item.sales_agent.name),1)])):V("",!0),s("div",me,[e.item.type==="inquiry"?(l(),q($,{key:0,size:"small",color:"primary",block:"",onClick:t[0]||(t[0]=U(g=>e.$emit("create-proposal",e.item),["stop"]))},{default:r(()=>t[4]||(t[4]=[v(" Create Quotation ")])),_:1})):(l(),m(S,{key:1},[n($,{size:"small",preset:"secondary",onClick:t[1]||(t[1]=U(g=>e.$emit("view",e.item),["stop"]))},{default:r(()=>t[5]||(t[5]=[v(" View ")])),_:1}),n($,{size:"small",preset:"plain",color:"info",onClick:t[2]||(t[2]=U(g=>e.$emit("edit",e.item),["stop"]))},{default:r(()=>t[6]||(t[6]=[v(" Edit ")])),_:1})],64))])],2)}const ce=N(H,[["render",pe],["__scopeId","data-v-dafd24fa"]]),ye=E({name:"ConfirmedPackageCard",props:{item:{type:Object,required:!0}},emits:["click","view"],computed:{formatDateRange(){const e=this.item.hunting_details;if(!(e!=null&&e.start_date))return"N/A";const t=_=>{try{return new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return _}},y=t(e.start_date),u=e.end_date?t(e.end_date):"",i=e.no_of_days?` (${e.no_of_days} days)`:"";return u?`${y} - ${u}${i}`:`${y}${i}`}},methods:{handleClick(){this.$emit("click",this.item)},truncateSpecies(e){return e?e.length>25?e.substring(0,25)+"...":e:"N/A"},formatCurrency(e){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"},formatDate(e){try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return e}}}}),fe={class:"card-header"},_e={class:"package-code"},he={class:"client-info"},ge={class:"client-name"},ve={class:"client-meta"},$e={class:"package-details"},Ce={class:"detail-row"},Ve={class:"detail-value"},ke={class:"detail-row"},we={class:"detail-value"},be={class:"detail-row"},qe={class:"detail-value truncate"},Ie={class:"detail-row"},Pe={class:"detail-value"},Se={key:0,class:"amount-section"},De={class:"amount-value"},Fe={key:1,class:"agent-info"},Ue={class:"agent-name"},Ee={class:"confirmation-date"},Ne={class:"card-actions"};function ze(e,t,y,u,i,_){var k,C,f,h,g;const a=c("VaIcon"),$=c("VaChip"),w=c("VaButton");return l(),m("div",{class:"confirmed-package-card",onClick:t[1]||(t[1]=(...P)=>e.handleClick&&e.handleClick(...P))},[s("div",fe,[s("span",_e,d(e.item.code),1),n($,{size:"small",color:"success"},{default:r(()=>[n(a,{name:"verified",size:"small",class:"mr-1"}),t[2]||(t[2]=v(" Confirmed "))]),_:1})]),s("div",he,[s("h4",ge,d(((k=e.item.client)==null?void 0:k.full_name)||"Unknown Client"),1),s("p",ve,[n(a,{name:"flag",size:"small"}),v(" "+d(((C=e.item.client)==null?void 0:C.country)||"N/A"),1)])]),s("div",$e,[s("div",Ce,[n(a,{name:"inventory_2",size:"small",color:"success"}),t[3]||(t[3]=s("span",{class:"detail-label"},"Package:",-1)),s("span",Ve,d(((f=e.item.hunting_details)==null?void 0:f.season)||"N/A"),1)]),s("div",ke,[n(a,{name:"location_on",size:"small",color:"success"}),t[4]||(t[4]=s("span",{class:"detail-label"},"Area:",-1)),s("span",we,d(((h=e.item.hunting_details)==null?void 0:h.areas)||"N/A"),1)]),s("div",be,[n(a,{name:"pets",size:"small",color:"success"}),t[5]||(t[5]=s("span",{class:"detail-label"},"Species:",-1)),s("span",qe,d(e.truncateSpecies((g=e.item.hunting_details)==null?void 0:g.species)),1)]),s("div",Ie,[n(a,{name:"calendar_today",size:"small",color:"success"}),t[6]||(t[6]=s("span",{class:"detail-label"},"Dates:",-1)),s("span",Pe,d(e.formatDateRange),1)])]),e.item.total_amount?(l(),m("div",Se,[t[7]||(t[7]=s("div",{class:"amount-label"},"Total Amount",-1)),s("div",De,d(e.formatCurrency(e.item.total_amount)),1)])):V("",!0),e.item.sales_agent?(l(),m("div",Fe,[n(a,{name:"support_agent",size:"small",color:"info"}),s("span",Ue,d(e.item.sales_agent.name),1)])):V("",!0),s("div",Ee,[n(a,{name:"event_available",size:"small",color:"secondary"}),s("span",null,"Confirmed: "+d(e.item.created_date_formatted||e.formatDate(e.item.created_date)),1)]),s("div",Ne,[n(w,{size:"small",preset:"secondary",block:"",onClick:t[0]||(t[0]=U(P=>e.$emit("view",e.item),["stop"]))},{default:r(()=>[n(a,{name:"visibility",size:"small",class:"mr-1"}),t[8]||(t[8]=v(" View Details "))]),_:1})])])}const Ae=N(ye,[["render",ze],["__scopeId","data-v-cff7cc22"]]),Me=E({name:"ProposalForm",props:{proposal:{type:Object,default:null},isEdit:{type:Boolean,default:!1},preselectedInquiry:{type:Object,default:null}},emits:["save","cancel"],setup(){const{validate:e,reset:t}=G("formRef");return{validate:e,reset:t}},data(){return{form:{sales_inquiry_id:null,confirmation_date:new Date,hunting_license:"",remarks:"",status:"pending",installments:[]},salesInquiryOptions:[],loadingInquiries:!1,selectedInquiry:null,dueDaysTypeOptions:[{value:"upon_booking",text:"Upon Booking"},{value:"before_arrival",text:"Days Before Arrival"},{value:"upon_completion",text:"Upon Completion"}],statusOptions:[{value:"pending",text:"Pending"},{value:"provision_sales",text:"Provisional Sale"},{value:"confirmed",text:"Confirmed"},{value:"declined",text:"Declined"},{value:"cancelled",text:"Cancelled"},{value:"completed",text:"Completed"}],defaultInstallments:[{narration:"Deposit Due upon booking",amount_due:5e3,due_days:0,amount_due_type:"fixed",due_days_type:"upon_booking"},{narration:"2nd Deposit Due one year prior",amount_due:1e4,due_days:365,amount_due_type:"fixed",due_days_type:"before_arrival"},{narration:"Final Payment Due 90 days prior",amount_due:15e3,due_days:90,amount_due_type:"fixed",due_days_type:"before_arrival"},{narration:"Trophy Deposit Due 45 days prior",amount_due:2500,due_days:45,amount_due_type:"fixed",due_days_type:"before_arrival"}]}},computed:{...B(A,["saving"]),totalAmount(){return this.form.installments.reduce((e,t)=>e+(Number(t.amount_due)||0),0)},canSubmit(){return this.isEdit?!0:!!this.form.sales_inquiry_id&&this.form.installments.length>0}},mounted(){this.loadNewInquiries(),this.isEdit&&this.proposal?this.populateForm():(this.form.installments=[],this.preselectedInquiry&&this.handlePreselectedInquiry())},methods:{async loadNewInquiries(){var e;this.loadingInquiries=!0;try{const y=await O.get("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/pipeline?stage=new_inquiries");if(y.data.success){const u=((e=y.data.data)==null?void 0:e.new_inquiries)||[];this.salesInquiryOptions=u.map(i=>{var _,a,$,w,k,C,f,h,g,P,I;return{value:i.id,text:`${i.code} - ${((_=i.client)==null?void 0:_.full_name)||"Unknown"}`,subtitle:`${((a=i.hunting_details)==null?void 0:a.areas)||"N/A"} | ${(($=i.hunting_details)==null?void 0:$.no_of_days)||0} days | ${((w=i.hunting_details)==null?void 0:w.no_of_hunters)||0} hunter(s)`,selfItem:{id:i.id,code:i.code,client_name:(k=i.client)==null?void 0:k.full_name,country:(C=i.client)==null?void 0:C.country,area:(f=i.hunting_details)==null?void 0:f.areas,species:(h=i.hunting_details)==null?void 0:h.species,no_of_days:(g=i.hunting_details)==null?void 0:g.no_of_days,no_of_hunters:(P=i.hunting_details)==null?void 0:P.no_of_hunters,season:(I=i.hunting_details)==null?void 0:I.season}}})}}catch(t){console.error("Error loading new inquiries:",t)}finally{this.loadingInquiries=!1}},handlePreselectedInquiry(){var u,i,_,a,$,w,k,C,f,h;const e=this.preselectedInquiry;if(!e)return;this.selectedInquiry={id:e.id,code:e.code,client_name:(u=e.client)==null?void 0:u.full_name,country:(i=e.client)==null?void 0:i.country,area:(_=e.hunting_details)==null?void 0:_.areas,species:(a=e.hunting_details)==null?void 0:a.species,no_of_days:($=e.hunting_details)==null?void 0:$.no_of_days,no_of_hunters:(w=e.hunting_details)==null?void 0:w.no_of_hunters,season:(k=e.hunting_details)==null?void 0:k.season};const t={value:e.id,text:`${e.code} - ${((C=e.client)==null?void 0:C.full_name)||"Unknown"}`,subtitle:`${((f=e.hunting_details)==null?void 0:f.areas)||"N/A"} | ${((h=e.hunting_details)==null?void 0:h.no_of_days)||0} days`,selfItem:this.selectedInquiry};this.salesInquiryOptions.find(g=>g.value===e.id)||this.salesInquiryOptions.unshift(t),this.form.sales_inquiry_id=t},onInquirySelected(e){e!=null&&e.selfItem?this.selectedInquiry=e.selfItem:this.selectedInquiry=null},populateForm(){var e,t,y,u;this.proposal&&(this.form.confirmation_date=this.proposal.confirmation_date?new Date(this.proposal.confirmation_date):new Date,this.form.hunting_license=this.proposal.hunting_license||"",this.form.remarks=this.proposal.remarks||"",this.form.status=this.proposal.status||"pending",(e=this.proposal.pricing)!=null&&e.installments&&(this.form.installments=this.proposal.pricing.installments.map(i=>({narration:i.narration,amount_due:i.amount_due,due_days:i.due_days,amount_due_type:i.amount_due_type||"fixed",due_days_type:i.due_days_type||"upon_booking"}))),this.proposal.sales_inquiry&&(this.selectedInquiry={id:this.proposal.sales_inquiry.id,code:this.proposal.sales_inquiry.code,client_name:(t=this.proposal.client)==null?void 0:t.full_name,area:(y=this.proposal.hunting_trip)==null?void 0:y.hunting_area,no_of_days:(u=this.proposal.hunting_trip)==null?void 0:u.no_of_days,season:this.proposal.sales_inquiry.season}))},addInstallment(){this.form.installments.push({narration:"",amount_due:0,due_days:null,amount_due_type:"fixed",due_days_type:"upon_booking"})},removeInstallment(e){this.form.installments.splice(e,1)},formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},async submitForm(){var y;if(!await this.validate())return;const t={confirmation_date:this.form.confirmation_date?M(new Date(this.form.confirmation_date),"yyyy-MM-dd"):M(new Date,"yyyy-MM-dd"),hunting_license:this.form.hunting_license||null,remarks:this.form.remarks||null,installments:this.form.installments.map(u=>{let i=u.due_days_type;typeof i=="object"&&i!==null&&(i=i.value||"upon_booking");let _=u.amount_due_type;return typeof _=="object"&&_!==null&&(_=_.value||"fixed"),{narration:u.narration,amount_due:Number(u.amount_due),due_days:u.due_days?Number(u.due_days):null,amount_due_type:String(_||"fixed"),due_days_type:String(i||"upon_booking")}})};this.isEdit||(t.sales_inquiry_id=((y=this.form.sales_inquiry_id)==null?void 0:y.value)||this.form.sales_inquiry_id),this.isEdit&&(t.status=this.form.status),this.$emit("save",t)}}}),Be={class:"proposal-form"},Oe={class:"text-2xl font-bold mb-6"},Te={key:0,class:"flex flex-col"},je={class:"font-semibold"},Qe={class:"text-xs text-gray-500"},Re={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg"},Le={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},Ge={class:"ml-1 font-medium"},He={class:"ml-1 font-medium"},Je={class:"ml-1 font-medium"},Ke={class:"ml-1 font-medium"},We={key:0,class:"mt-2"},Xe={class:"ml-1 font-medium"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"flex items-center gap-2"},xe={key:1,class:"text-center text-gray-500 py-4"},et={class:"flex justify-between items-start mb-3"},tt={class:"font-semibold text-gray-700"},st={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},nt={key:2,class:"mt-4 p-4 bg-primary rounded-lg text-white"},ot={class:"flex justify-between items-center"},at={class:"text-2xl font-bold"},it={class:"flex justify-end gap-3 mt-6"};function lt(e,t,y,u,i,_){const a=c("VaIcon"),$=c("VaCardTitle"),w=c("VaAlert"),k=c("VaSelect"),C=c("VaCardContent"),f=c("VaCard"),h=c("VaDateInput"),g=c("VaInput"),P=c("VaTextarea"),I=c("VaButton"),z=c("VaForm");return l(),m("div",Be,[s("h2",Oe,d(e.isEdit?"Edit Quotation":"Create New Quotation"),1),n(z,{ref:"formRef"},{default:r(()=>[e.isEdit?V("",!0):(l(),q(f,{key:0,outlined:"",class:"mb-6"},{default:r(()=>[n($,{class:"flex items-center gap-2"},{default:r(()=>[n(a,{name:"search",color:"primary"}),t[6]||(t[6]=v(" Select Sales Inquiry "))]),_:1}),n(C,null,{default:r(()=>[n(w,{color:"info",class:"mb-4",border:"left"},{title:r(()=>t[7]||(t[7]=[v("Link to Sales Inquiry")])),default:r(()=>[t[8]||(t[8]=v(" Select a sales inquiry to create a quotation. Client and hunting details will be automatically populated. "))]),_:1}),n(k,{modelValue:e.form.sales_inquiry_id,"onUpdate:modelValue":[t[0]||(t[0]=p=>e.form.sales_inquiry_id=p),e.onInquirySelected],options:e.salesInquiryOptions,loading:e.loadingInquiries,label:"Sales Inquiry",placeholder:"Search and select a sales inquiry...",searchable:"","highlight-matched-text":"",rules:[p=>!!p||"Sales inquiry is required"]},{content:r(({value:p})=>[p?(l(),m("div",Te,[s("span",je,d(p.text),1),s("span",Qe,d(p.subtitle),1)])):V("",!0)]),_:1},8,["modelValue","options","loading","rules","onUpdate:modelValue"]),e.selectedInquiry?(l(),m("div",Re,[t[14]||(t[14]=s("h4",{class:"font-semibold mb-2"},"Selected Inquiry Details",-1)),s("div",Le,[s("div",null,[t[9]||(t[9]=s("span",{class:"text-gray-500"},"Client:",-1)),s("span",Ge,d(e.selectedInquiry.client_name),1)]),s("div",null,[t[10]||(t[10]=s("span",{class:"text-gray-500"},"Area:",-1)),s("span",He,d(e.selectedInquiry.area),1)]),s("div",null,[t[11]||(t[11]=s("span",{class:"text-gray-500"},"Days:",-1)),s("span",Je,d(e.selectedInquiry.no_of_days),1)]),s("div",null,[t[12]||(t[12]=s("span",{class:"text-gray-500"},"Season:",-1)),s("span",Ke,d(e.selectedInquiry.season),1)])]),e.selectedInquiry.species?(l(),m("div",We,[t[13]||(t[13]=s("span",{class:"text-gray-500"},"Species:",-1)),s("span",Xe,d(e.selectedInquiry.species),1)])):V("",!0)])):V("",!0)]),_:1})]),_:1})),n(f,{outlined:"",class:"mb-6"},{default:r(()=>[n($,{class:"flex items-center gap-2"},{default:r(()=>[n(a,{name:"description",color:"primary"}),t[15]||(t[15]=v(" Quotation Details "))]),_:1}),n(C,null,{default:r(()=>[s("div",Ye,[n(h,{modelValue:e.form.confirmation_date,"onUpdate:modelValue":t[1]||(t[1]=p=>e.form.confirmation_date=p),label:"Confirmation Date",placeholder:"Select date"},null,8,["modelValue"]),n(g,{modelValue:e.form.hunting_license,"onUpdate:modelValue":t[2]||(t[2]=p=>e.form.hunting_license=p),label:"Hunting License",placeholder:"Enter license number (optional)"},null,8,["modelValue"])]),n(P,{modelValue:e.form.remarks,"onUpdate:modelValue":t[3]||(t[3]=p=>e.form.remarks=p),label:"Remarks",placeholder:"Add any additional notes or remarks...",class:"mt-4","min-rows":3},null,8,["modelValue"])]),_:1})]),_:1}),n(f,{outlined:"",class:"mb-6"},{default:r(()=>[n($,{class:"flex items-center justify-between"},{default:r(()=>[s("div",Ze,[n(a,{name:"payments",color:"primary"}),t[16]||(t[16]=v(" Payment Installments "))]),n(I,{preset:"secondary",size:"small",icon:"add",onClick:e.addInstallment},{default:r(()=>t[17]||(t[17]=[v(" Add Installment ")])),_:1},8,["onClick"])]),_:1}),n(C,null,{default:r(()=>[e.form.installments.length===0?(l(),q(w,{key:0,color:"warning",class:"mb-4",border:"left"},{title:r(()=>t[18]||(t[18]=[v("Required")])),default:r(()=>[t[19]||(t[19]=v(" At least one payment installment is required to create a quotation. "))]),_:1})):V("",!0),e.form.installments.length===0?(l(),m("div",xe,' No installments added. Click "Add Installment" to create payment schedule. ')):V("",!0),(l(!0),m(S,null,D(e.form.installments,(p,F)=>(l(),m("div",{key:F,class:"installment-row mb-4 p-4 border rounded-lg"},[s("div",et,[s("span",tt,"Installment "+d(F+1),1),n(I,{preset:"plain",color:"danger",size:"small",icon:"delete",onClick:o=>e.removeInstallment(F)},null,8,["onClick"])]),s("div",st,[n(g,{modelValue:p.narration,"onUpdate:modelValue":o=>p.narration=o,label:"Description",placeholder:"e.g., Deposit Due upon booking",rules:[o=>!!o||"Description is required"]},null,8,["modelValue","onUpdate:modelValue","rules"]),n(g,{modelValue:p.amount_due,"onUpdate:modelValue":o=>p.amount_due=o,label:"Amount (USD)",type:"number",placeholder:"5000",rules:[o=>o>0||"Amount must be greater than 0"]},null,8,["modelValue","onUpdate:modelValue","rules"]),n(k,{modelValue:p.due_days_type,"onUpdate:modelValue":o=>p.due_days_type=o,options:e.dueDaysTypeOptions,label:"Due Type",placeholder:"Select when due","value-by":"value","text-by":"text"},null,8,["modelValue","onUpdate:modelValue","options"]),n(g,{modelValue:p.due_days,"onUpdate:modelValue":o=>p.due_days=o,label:p.due_days_type==="before_arrival"?"Days Before Arrival":"Due Days",type:"number",placeholder:"e.g., 90",disabled:p.due_days_type==="upon_booking"},null,8,["modelValue","onUpdate:modelValue","label","disabled"])])]))),128)),e.form.installments.length>0?(l(),m("div",nt,[s("div",ot,[t[20]||(t[20]=s("span",{class:"text-lg font-semibold"},"TOTAL",-1)),s("span",at,d(e.formatCurrency(e.totalAmount)),1)])])):V("",!0)]),_:1})]),_:1}),e.isEdit?(l(),q(f,{key:1,outlined:"",class:"mb-6"},{default:r(()=>[n($,{class:"flex items-center gap-2"},{default:r(()=>[n(a,{name:"flag",color:"primary"}),t[21]||(t[21]=v(" Status "))]),_:1}),n(C,null,{default:r(()=>[n(k,{modelValue:e.form.status,"onUpdate:modelValue":t[4]||(t[4]=p=>e.form.status=p),options:e.statusOptions,label:"Quotation Status",placeholder:"Select status"},null,8,["modelValue","options"])]),_:1})]),_:1})):V("",!0),s("div",it,[n(I,{preset:"secondary",onClick:t[5]||(t[5]=p=>e.$emit("cancel"))},{default:r(()=>t[22]||(t[22]=[v(" Cancel ")])),_:1}),n(I,{color:"primary",loading:e.saving,disabled:!e.canSubmit,onClick:e.submitForm},{default:r(()=>[v(d(e.isEdit?"Update Quotation":"Create Quotation"),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1},512)])}const rt=N(Me,[["render",lt],["__scopeId","data-v-d3fd6ab2"]]),dt=E({name:"SalesPipeline",components:{PipelineCard:ce,ConfirmedPackageCard:Ae,ProposalView:R,ProposalForm:rt},setup(){const{init:e}=L(),t=Q();return{init:e,globalStore:t}},data(){return{seasonFilter:null,seasonOptions:[],showViewModal:!1,showFormModal:!1,editingProposal:null,isEditMode:!1,preselectedInquiry:null}},computed:{...B(A,["pipeline","pipelineCounts","currentProposal","loading","saving"]),counts(){return this.pipelineCounts||{new_inquiries:0,pending:0,provision_sales:0,confirmed:0,cancelled:0,completed:0}},hasData(){return Object.values(this.counts).reduce((e,t)=>e+t,0)>0}},mounted(){this.globalStore.isSidebarMinimized=!0,this.loadPipeline(),this.loadSeasons()},methods:{...j(A,["fetchPipeline","fetchProposalById","createProposal","updateProposal","updateProposalStatus","clearCurrentProposal"]),async loadPipeline(){try{await this.fetchPipeline(void 0,this.seasonFilter||void 0)}catch{this.init({message:"Failed to load pipeline",color:"danger"})}},async loadSeasons(){try{const t=await O.get("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/seasons");if(t.data){const y=Array.isArray(t.data)?t.data:t.data.data||[];this.seasonOptions=y.map(u=>({value:u.id,text:u.name}))}}catch(e){console.error("Error loading seasons:",e)}},handleCardClick(e){e.type==="proposal"&&this.handleViewProposal(e)},async handleViewProposal(e){try{const t=e.proposal_id||e.confirmation_id;t?(await this.fetchProposalById(t),this.showViewModal=!0):this.init({message:"No quotation found for this item",color:"warning"})}catch{this.init({message:"Failed to load quotation details",color:"danger"})}},handleEditProposal(e){const t=e.proposal_id||e.confirmation_id;t&&this.fetchProposalById(t).then(()=>{this.editingProposal=this.currentProposal,this.isEditMode=!0,this.preselectedInquiry=null,this.showFormModal=!0})},handleEditFromView(){this.showViewModal=!1,this.editingProposal=this.currentProposal,this.isEditMode=!0,this.preselectedInquiry=null,this.showFormModal=!0},handleCreateProposal(e){this.editingProposal=null,this.isEditMode=!1,this.preselectedInquiry=e,this.showFormModal=!0},async handleSaveProposal(e){var t,y,u;try{this.isEditMode&&((t=this.editingProposal)!=null&&t.id)?(await this.updateProposal(this.editingProposal.id,e),this.init({message:"Quotation updated successfully",color:"success"})):(await this.createProposal(e),this.init({message:"Quotation created successfully",color:"success"})),this.showFormModal=!1,this.loadPipeline()}catch(i){this.init({message:((u=(y=i.response)==null?void 0:y.data)==null?void 0:u.message)||"Failed to save quotation",color:"danger"})}},async handleStatusChange(e){try{await this.updateProposalStatus(e.id,e.status),this.init({message:`Proposal status changed to ${e.status}`,color:"success"}),await this.fetchProposalById(e.id),this.loadPipeline()}catch{this.init({message:"Failed to update proposal status",color:"danger"})}}}}),ut={class:"flex items-center gap-2"},mt={class:"flex items-center gap-3"},pt={key:0,class:"loading-container py-8"},ct={key:1,class:"pipeline-columns"},yt={class:"pipeline-column"},ft={class:"column-header",style:{borderColor:"#f59e0b"}},_t={class:"column-title"},ht={class:"column-content"},gt={key:0,class:"empty-column"},vt={class:"pipeline-column"},$t={class:"column-header",style:{borderColor:"#f59e0b"}},Ct={class:"column-title"},Vt={class:"column-content"},kt={key:0,class:"empty-column"},wt={class:"pipeline-column"},bt={class:"column-header",style:{borderColor:"#3b82f6"}},qt={class:"column-title"},It={class:"column-content"},Pt={key:0,class:"empty-column"},St={class:"pipeline-column confirmed-column"},Dt={class:"column-header",style:{borderColor:"#10b981"}},Ft={class:"column-title"},Ut={class:"column-content"},Et={key:0,class:"empty-column"},Nt={class:"pipeline-column"},zt={class:"column-header",style:{borderColor:"#6b7280"}},At={class:"column-title"},Mt={class:"column-content"},Bt={key:0,class:"empty-column"},Ot={class:"pipeline-column"},Tt={class:"column-header",style:{borderColor:"#6366f1"}},jt={class:"column-title"},Qt={class:"column-content"},Rt={key:0,class:"empty-column"},Lt={class:"flex justify-end mt-4"};function Gt(e,t,y,u,i,_){const a=c("VaIcon"),$=c("VaSelect"),w=c("VaButton"),k=c("VaCardTitle"),C=c("VaProgressBar"),f=c("VaBadge"),h=c("PipelineCard"),g=c("ConfirmedPackageCard"),P=c("ProposalView"),I=c("VaModal"),z=c("ProposalForm"),p=c("VaCardContent"),F=c("VaCard");return l(),q(F,null,{default:r(()=>[n(k,{class:"flex justify-between items-center"},{default:r(()=>[s("div",ut,[n(a,{name:"view_kanban",color:"primary"}),t[5]||(t[5]=s("span",null,"Sales Pipeline",-1))]),s("div",mt,[n($,{modelValue:e.seasonFilter,"onUpdate:modelValue":[t[0]||(t[0]=o=>e.seasonFilter=o),e.loadPipeline],options:e.seasonOptions,placeholder:"All Seasons",class:"w-48",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"]),n(w,{preset:"secondary",icon:"refresh",loading:e.loading,onClick:e.loadPipeline},{default:r(()=>t[6]||(t[6]=[v(" Refresh ")])),_:1},8,["loading","onClick"])])]),_:1}),n(p,null,{default:r(()=>[e.loading&&!e.hasData?(l(),m("div",pt,[n(C,{indeterminate:""}),t[7]||(t[7]=s("p",{class:"text-center mt-4 text-gray-600"},"Loading pipeline...",-1))])):(l(),m("div",ct,[s("div",yt,[s("div",ft,[s("div",_t,[n(a,{name:"fiber_new",color:"warning"}),t[8]||(t[8]=s("span",null,"New Inquiries",-1))]),n(f,{text:String(e.counts.new_inquiries),color:"warning"},null,8,["text"])]),s("div",ht,[e.pipeline.new_inquiries.length===0?(l(),m("div",gt,[n(a,{name:"inbox",size:"2rem",color:"secondary"}),t[9]||(t[9]=s("span",null,"No new inquiries",-1))])):V("",!0),(l(!0),m(S,null,D(e.pipeline.new_inquiries,o=>(l(),q(h,{key:`new-${o.id}`,item:o,onCreateProposal:b=>e.handleCreateProposal(o),onClick:b=>e.handleCardClick(o)},null,8,["item","onCreateProposal","onClick"]))),128))])]),s("div",vt,[s("div",$t,[s("div",Ct,[n(a,{name:"hourglass_empty",color:"warning"}),t[10]||(t[10]=s("span",null,"Quotation",-1))]),n(f,{text:String(e.counts.pending),color:"warning"},null,8,["text"])]),s("div",Vt,[e.pipeline.pending.length===0?(l(),m("div",kt,[n(a,{name:"hourglass_empty",size:"2rem",color:"secondary"}),t[11]||(t[11]=s("span",null,"No quotation items",-1))])):V("",!0),(l(!0),m(S,null,D(e.pipeline.pending,o=>(l(),q(h,{key:`pending-${o.id}`,item:o,onView:b=>e.handleViewProposal(o),onEdit:b=>e.handleEditProposal(o),onClick:b=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])]),s("div",wt,[s("div",bt,[s("div",qt,[n(a,{name:"pending_actions",color:"info"}),t[12]||(t[12]=s("span",null,"Provision Sales",-1))]),n(f,{text:String(e.counts.provision_sales),color:"info"},null,8,["text"])]),s("div",It,[e.pipeline.provision_sales.length===0?(l(),m("div",Pt,[n(a,{name:"pending_actions",size:"2rem",color:"secondary"}),t[13]||(t[13]=s("span",null,"No provisional sales",-1))])):V("",!0),(l(!0),m(S,null,D(e.pipeline.provision_sales,o=>(l(),q(h,{key:`provision-${o.id}`,item:o,onView:b=>e.handleViewProposal(o),onEdit:b=>e.handleEditProposal(o),onClick:b=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])]),s("div",St,[s("div",Dt,[s("div",Ft,[n(a,{name:"check_circle",color:"success"}),t[14]||(t[14]=s("span",null,"Sales Confirmation",-1))]),n(f,{text:String(e.counts.confirmed),color:"success"},null,8,["text"])]),s("div",Ut,[e.pipeline.confirmed.length===0?(l(),m("div",Et,[n(a,{name:"check_circle",size:"2rem",color:"secondary"}),t[15]||(t[15]=s("span",null,"No confirmed packages",-1))])):V("",!0),(l(!0),m(S,null,D(e.pipeline.confirmed,o=>(l(),q(g,{key:`confirmed-${o.id}`,item:o,onView:b=>e.handleViewProposal(o),onClick:b=>e.handleCardClick(o)},null,8,["item","onView","onClick"]))),128))])]),s("div",Nt,[s("div",zt,[s("div",At,[n(a,{name:"cancel",color:"secondary"}),t[16]||(t[16]=s("span",null,"Cancelled",-1))]),n(f,{text:String(e.counts.cancelled),color:"secondary"},null,8,["text"])]),s("div",Mt,[e.pipeline.cancelled.length===0?(l(),m("div",Bt,[n(a,{name:"cancel",size:"2rem",color:"secondary"}),t[17]||(t[17]=s("span",null,"No cancelled items",-1))])):V("",!0),(l(!0),m(S,null,D(e.pipeline.cancelled,o=>(l(),q(h,{key:`cancelled-${o.id}`,item:o,onView:b=>e.handleViewProposal(o),onClick:b=>e.handleCardClick(o)},null,8,["item","onView","onClick"]))),128))])]),s("div",Ot,[s("div",Tt,[s("div",jt,[n(a,{name:"task_alt",color:"primary"}),t[18]||(t[18]=s("span",null,"Completed",-1))]),n(f,{text:String(e.counts.completed),color:"primary"},null,8,["text"])]),s("div",Qt,[e.pipeline.completed.length===0?(l(),m("div",Rt,[n(a,{name:"task_alt",size:"2rem",color:"secondary"}),t[19]||(t[19]=s("span",null,"No completed items",-1))])):V("",!0),(l(!0),m(S,null,D(e.pipeline.completed,o=>(l(),q(h,{key:`completed-${o.id}`,item:o,onView:b=>e.handleViewProposal(o),onClick:b=>e.handleCardClick(o)},null,8,["item","onView","onClick"]))),128))])])])),n(I,{modelValue:e.showViewModal,"onUpdate:modelValue":t[2]||(t[2]=o=>e.showViewModal=o),size:"large","hide-default-actions":!0,title:"Proposal Details"},{default:r(()=>[e.currentProposal?(l(),q(P,{key:0,proposal:e.currentProposal,onEdit:e.handleEditFromView,onStatusChange:e.handleStatusChange},null,8,["proposal","onEdit","onStatusChange"])):V("",!0),s("div",Lt,[n(w,{preset:"secondary",onClick:t[1]||(t[1]=o=>e.showViewModal=!1)},{default:r(()=>t[20]||(t[20]=[v("Close")])),_:1})])]),_:1},8,["modelValue"]),n(I,{modelValue:e.showFormModal,"onUpdate:modelValue":t[4]||(t[4]=o=>e.showFormModal=o),size:"large","hide-default-actions":!0,title:e.isEditMode?"Edit Quotation":"Create Quotation"},{default:r(()=>[n(z,{proposal:e.editingProposal,"is-edit":e.isEditMode,"preselected-inquiry":e.preselectedInquiry,onSave:e.handleSaveProposal,onCancel:t[3]||(t[3]=o=>e.showFormModal=!1)},null,8,["proposal","is-edit","preselected-inquiry","onSave"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1})}const Zt=N(dt,[["render",Gt],["__scopeId","data-v-ff0e7c63"]]);export{Zt as default};
//# sourceMappingURL=SalesPipeline-Bq-nhKts.js.map
