import{d as v,m as u,s as Q,_ as V,a as A,w as n,e as _,b as i,i as d,h as c,t as h,o as S}from"./index-YknbmV_z.js";import{u as p}from"./quota-store-D1n978KD.js";import{u as k}from"./useToast-BEDWU_wG.js";import{d as O}from"./pdfDownloader-DiRJnS-k.js";import"./format-Cn4G_mmc.js";const q=v({setup(){const e=[{key:"id",sortable:!0},{key:"area",sortable:!0},{key:"name",sortable:!0},{key:"scientific_name",sortable:!0},{key:"no_of_species",sortable:!0},{key:"provision_sales",sortable:!0},{key:"confirmed",sortable:!0},{key:"canceled",sortable:!0},{key:"taken",sortable:!0}];return{filter:Q(""),columns:e}},data(){const{init:e}=k();return{speciesItems:[],area:null,quota:null,species:null,currentQuota:null,areasOptions:[],yearOptions:[],speciesOptions:[],init:e,logo:"/logo.png",selectQuota:null,with:12,height:100,loading:!1,base64Pdf:"",loadingQuota:!1,downloadPdf:O}},mounted(){this.getAllSpeces(),this.getQuota(),this.getSpeciesItems(),this.getAreas()},methods:{...u(p,["getAllSpeciesPerQuotaPerArea"]),...u(p,["getQuotas"]),...u(p,["getSpeciesList"]),...u(p,["getAreaList"]),...u(p,["generateQuotaYear"]),async getAllSpeces(){var e,t,s,r,m,f;this.loading=!0;try{this.currentQuota=this.yearOptions.find(l=>l.value===this.quota);const a=await this.getAllSpeciesPerQuotaPerArea(this.quota,this.area,this.species);a.status===200?(this.loading=!1,((e=a==null?void 0:a.data)==null?void 0:e.pdf)!==null&&(this.base64Pdf=(t=a==null?void 0:a.data)==null?void 0:t.pdf),((r=(s=a==null?void 0:a.data)==null?void 0:s.data)==null?void 0:r.length)>0&&(this.loading=!1,this.speciesItems=[]),this.speciesItems=(f=(m=a==null?void 0:a.data)==null?void 0:m.data)==null?void 0:f.map(l=>({id:l.id,name:l.species.name,area:l.area.name,scientific_name:l.species.scientific_name,no_of_species:l.quantity,provision_sales:l.provision_quantity,confirmed:l.confirmed_quantity,canceled:l.declined_quantity||l.cancelled_quantity,taken:l.completed_quantity}))):(this.init({message:a.message,color:"danger"}),this.loading=!1)}catch(a){this.loading=!1,console.log(a)}},async getQuota(){this.loadingQuota=!0;try{const e=await this.getQuotas(null);if(e.status===200){this.loadingQuota=!1;const t=e.data[0];this.quota=t.id,this.currentQuota=t,this.yearOptions=e.data.map(s=>{const r=this.generateQuotaYear(s.start_date,s.end_date);return{value:s.id,text:`${r} - ${s.name}`,name:s.name,start_date:s.start_date,end_date:s.end_date}})}}catch(e){this.loadingQuota=!1,console.log(e)}},async getSpeciesItems(){try{const e=await this.getSpeciesList();this.speciesOptions=[{value:"all",text:"All"}];const t=e.data.map(s=>({value:s.id,text:s.name}));this.speciesOptions=this.speciesOptions.concat(t)}catch(e){console.log(e)}},async getAreas(){try{const e=await this.getAreaList();if(e.status===200){this.areasOptions=[{value:"all",text:"All"}];const t=e.data.map(s=>({value:s.id,text:s.name}));this.areasOptions=this.areasOptions.concat(t)}}catch(e){console.log(e)}}}}),w={class:"grid md:grid-cols-4 gap-6 mb-6"};function P(e,t,s,r,m,f){const a=d("VaSelect"),l=d("VaButton"),g=d("VaChip"),y=d("VaDataTable"),b=d("VaCard");return S(),A(b,{class:"w-full p-2"},{default:n(()=>[_("div",w,[i(a,{modelValue:e.area,"onUpdate:modelValue":[t[0]||(t[0]=o=>e.area=o),t[1]||(t[1]=o=>e.getAllSpeces())],placeholder:"Filter by Area",options:e.areasOptions,searchable:"","value-by":"value",lable:"Area"},null,8,["modelValue","options"]),i(a,{modelValue:e.quota,"onUpdate:modelValue":[t[2]||(t[2]=o=>e.quota=o),t[3]||(t[3]=o=>e.getAllSpeces())],placeholder:"Filter by Quota year",options:e.yearOptions,"value-by":"value",lable:"Quota year"},null,8,["modelValue","options"]),i(a,{modelValue:e.species,"onUpdate:modelValue":[t[4]||(t[4]=o=>e.species=o),t[5]||(t[5]=o=>e.getAllSpeces())],placeholder:"Filter by Species",options:e.speciesOptions,"value-by":"value",lable:"Species"},null,8,["modelValue","options"]),i(l,{icon:"download",onClick:t[6]||(t[6]=o=>e.downloadPdf(e.base64Pdf))},{default:n(()=>t[7]||(t[7]=[c(" Download ")])),_:1})]),i(y,{items:e.speciesItems,columns:e.columns,filter:e.filter,loading:e.loading},{"cell(provision_sales)":n(({value:o})=>[i(g,{color:"warning",size:"small"},{default:n(()=>[c(h(o),1)]),_:2},1024)]),"cell(confirmed)":n(({value:o})=>[i(g,{color:"success",size:"small"},{default:n(()=>[c(h(o),1)]),_:2},1024)]),"cell(canceled)":n(({value:o})=>[i(g,{color:"danger",size:"small"},{default:n(()=>[c(h(o),1)]),_:2},1024)]),"cell(taken)":n(({value:o})=>[i(g,{color:"primary",size:"small"},{default:n(()=>[c(h(o),1)]),_:2},1024)]),_:1},8,["items","columns","filter","loading"])]),_:1})}const D=V(q,[["render",P],["__scopeId","data-v-f23b48b9"]]);export{D as default};
//# sourceMappingURL=QuotaPage-BiyJrdO4.js.map
