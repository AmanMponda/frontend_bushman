import{u as q}from"./quota-store-3Npdv5Xt.js";import{j as T,k as f,d as I,m as b,A as N,z as v,p as j,a as c,w as r,e as n,h as B,b as l,s as F,r as m,i as g,t as V,o as p}from"./index-Dg6zTblr.js";import{u as H}from"./useForm-DyYUDtxi.js";import{u as S}from"./useToast-Bi2Ekdco.js";import{h as w}from"./errorHandler-DijQ3xmc.js";const E=T("hunting-area-store",{state:()=>({}),actions:{async createHuntingArea(t){const e=JSON.stringify({name:t.name,description:t.description,coordinates_type:"Point",coordinates:t.coordinates,is_disabled:!1}),a={method:"post",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/hunting-areas/",headers:{"Content-Type":"application/json"},data:e};return await f.request(a)},async updateHuntingArea(t,e){const a=JSON.stringify({name:e.name,description:e.description,coordinates_type:"Point",coordinates:e.coordinates,is_disabled:!1}),o={method:"put",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/hunting-areas/"+t+"/",headers:{"Content-Type":"application/json"},data:a};return await f.request(o)},async deleteHuntingArea(t,e=!1){const a={method:"delete",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/hunting-areas/"+t+"/"+(e?"?force=true":""),headers:{"Content-Type":"application/json"}};return await f.request(a)},async getHuntingAreaById(t){const e={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/hunting-areas/"+t+"/",headers:{"Content-Type":"application/json"}};return await f.request(e)}}}),O={name:"",start_date:null,end_date:null},U=I({name:"ManageArea",setup(){const t=v(null),e=v(null),{isValid:a,validate:o,resetValidation:i}=H(t),{isValid:u,validate:d,resetValidation:A,reset:y}=H(e);return{isValidForm:a,validateForm:o,resetValidationForm:i,isValidareaForm:u,validateareaForm:d,resetValidationareaForm:A,resetareaForm:y,formRef:t,areaFormRef:e}},data(){const t=[],e=N({id:null,name:null,description:"",lat:null,lng:null,location:null}),a=[{key:"name",sortable:!0},{key:"description",sortable:!0},{key:"lat",label:"Latitude",sortable:!1},{key:"lng",label:"Longitude",sortable:!1},{key:"actions",label:"Actions",sortable:!1}],o=[];return{items:t,columns:a,editedItemId:null,editedItem:null,createdItem:{...O},toast:S(),areaForm:e,speciesOptions:[],areasOptions:[],speciesObjects:[],showCreatenewForm:!1,quotasOptions:o,showHuntingAreaList:!0,quotaItems:[],saving:!1,loading:!1,editMode:!1,showDeleteModal:!1,itemToDelete:null,deleting:!1}},mounted(){this.getAreas()},methods:{...b(q,["getAreaList"]),...b(E,["createHuntingArea","updateHuntingArea","deleteHuntingArea"]),toggleFormAndList(){this.showHuntingAreaList=!this.showHuntingAreaList,this.showHuntingAreaList&&(this.resetForm(),this.getAreas())},showCreateForm(){this.editMode=!1,this.resetForm(),this.showHuntingAreaList=!1},showHuntingArea(){this.showHuntingAreaList=!this.showHuntingAreaList},editHuntingArea(t){this.editMode=!0,this.areaForm.id=t.id,this.areaForm.name=t.name,this.areaForm.description=t.description,this.areaForm.lat=t.lat,this.areaForm.lng=t.lng,this.showHuntingAreaList=!1},cancelEdit(){this.resetForm(),this.toggleFormAndList()},resetForm(){this.editMode=!1,this.areaForm.id=null,this.areaForm.name=null,this.areaForm.description="",this.areaForm.lat=null,this.areaForm.lng=null,this.resetValidationareaForm()},confirmDelete(t){this.itemToDelete=t,this.showDeleteModal=!0},async deleteHuntingAreaConfirmed(){var t,e,a,o;if(this.itemToDelete){this.deleting=!0;try{const i=await this.deleteHuntingArea(this.itemToDelete.id,!0);(i.status===204||i.status===200)&&(this.toast.init({message:"Hunting Area deleted successfully",color:"success"}),this.showDeleteModal=!1,this.itemToDelete=null,this.getAreas())}catch(i){this.deleting=!1;const u=((e=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:e.detail)||((o=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:o.message);this.toast.init({message:u||"Failed to delete hunting area",color:"danger"})}finally{this.deleting=!1}}},async updateExistingHuntingArea(){this.saving=!0;const t=[{lat:this.areaForm.lat,lng:this.areaForm.lng}],e={name:this.areaForm.name,description:this.areaForm.description,coordinates:t};try{(await this.updateHuntingArea(this.areaForm.id,e)).status===200&&(this.saving=!1,this.toast.init({message:"Hunting Area updated successfully",color:"success"}),this.resetForm(),this.toggleFormAndList())}catch(a){this.saving=!1;const o=w(a);this.toast.init({message:`
`+o.map((i,u)=>`${u+1}. ${i}`).join(`
`),color:"danger"})}},async createNewHuntingArea(){this.saving=!0;const t=[{lat:this.areaForm.lat,lng:this.areaForm.lng}],e={name:this.areaForm.name,description:this.areaForm.description,coordinates:t};try{const a=await this.createHuntingArea(e);a.status===201?(this.saving=!1,this.toast.init({message:"Hunting Area created successfully",color:"success"}),this.resetareaForm()):console.log(a)}catch(a){this.saving=!1;const o=w(a);this.toast.init({message:`
`+o.map((i,u)=>`${u+1}. ${i}`).join(`
`),color:"danger"})}},formatDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${o}`},async getAreas(){try{this.loading=!0;const t=await this.getAreaList();this.areasOptions=t.data.map(e=>({value:e.id,text:e.name})),t.status===200?(this.items=t.data.map(e=>{var o,i,u,d;const a=JSON.parse(((i=(o=e==null?void 0:e.location)==null?void 0:o.geo_coordinates)==null?void 0:i.coordinates)||"[]");return{id:e==null?void 0:e.id,name:e==null?void 0:e.name,description:e==null?void 0:e.description,lat:(u=a[0])==null?void 0:u.lat,lng:(d=a[0])==null?void 0:d.lng}}),this.loading=!1):(this.loading=!1,this.toast.init({message:"No hunting areas found",color:"info"}))}catch{this.loading=!1}}}}),P={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},z={class:"flex flex-col md:flex-row gap-2 justify-start"},G={class:"flex gap-2"},J={key:1,class:"p-2"},Q={class:"font-bold text-lg mb-2"},R={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},W={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Y={class:"mb-6 flex gap-2"},K={class:"p-4"},X={class:"mb-4"},Z={class:"flex gap-2 justify-end"};function x(t,e,a,o,i,u){const d=m("VaButton"),A=m("VaButtonGroup"),y=m("VaDataTable"),h=m("VaInput"),k=m("VaForm"),L=m("VaIcon"),C=m("VaAlert"),D=m("VaModal"),M=m("VaCard");return p(),c(M,{class:"p-6"},{default:r(()=>[n("div",P,[n("div",z,[t.showHuntingAreaList?F("",!0):(p(),c(d,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e[0]||(e[0]=s=>t.toggleFormAndList())},{default:r(()=>e[11]||(e[11]=[g(" Go Back ")])),_:1}))]),t.showHuntingAreaList?(p(),c(A,{key:0},{default:r(()=>[l(d,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add",size:"small",onClick:e[1]||(e[1]=s=>t.showCreateForm())},{default:r(()=>e[12]||(e[12]=[g("Add a New Hunting Area")])),_:1})]),_:1})):F("",!0)]),t.showHuntingAreaList?(p(),c(y,{key:0,items:t.items,columns:t.columns,loading:t.loading,hoverable:"",striped:""},{"cell(actions)":r(({rowData:s})=>[n("div",G,[l(d,{preset:"plain",icon:"edit",color:"primary",onClick:$=>t.editHuntingArea(s)},null,8,["onClick"]),l(d,{preset:"plain",icon:"delete",color:"danger",onClick:$=>t.confirmDelete(s)},null,8,["onClick"])])]),_:1},8,["items","columns","loading"])):(p(),B("div",J,[l(k,{ref:"areaFormRef",class:"mb-6"},{default:r(()=>[n("h3",Q,V(t.editMode?"Edit Hunting Area":"New Hunting Area"),1),n("div",R,[l(h,{modelValue:t.areaForm.name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.areaForm.name=s),label:"Name",placeholder:"Enter Hunting Area Name",rules:[s=>!!s||"Hunting Area Name is required"],required:""},null,8,["modelValue","rules"]),l(h,{modelValue:t.areaForm.description,"onUpdate:modelValue":e[3]||(e[3]=s=>t.areaForm.description=s),type:"textarea",label:"Description",placeholder:"Enter Hunting Area Description",rules:[s=>!!s||"Hunting Area Description is required"],required:""},null,8,["modelValue","rules"])]),e[13]||(e[13]=n("h3",{class:"font-bold text-lg mb-2"},"Area Location",-1)),n("div",W,[l(h,{modelValue:t.areaForm.lat,"onUpdate:modelValue":e[4]||(e[4]=s=>t.areaForm.lat=s),label:"Latitude",type:"text",placeholder:"Enter Hunting Area Latitude eg. 12.3456789",rules:[s=>!!s||"Latitude is required"],required:""},null,8,["modelValue","rules"]),l(h,{modelValue:t.areaForm.lng,"onUpdate:modelValue":e[5]||(e[5]=s=>t.areaForm.lng=s),label:"Longitude",placeholder:"Enter Hunting Area Longitude eg. 12.3456789",type:"text",rules:[s=>!!s||"Longitude is required"],required:""},null,8,["modelValue","rules"])])]),_:1},512),n("div",Y,[l(d,{disabled:!t.isValidareaForm,color:"primary",icon:t.editMode?"save":"add",loading:t.saving,"icon-color":"#fff",onClick:e[6]||(e[6]=s=>t.validateareaForm()&&(t.editMode?t.updateExistingHuntingArea():t.createNewHuntingArea()))},{default:r(()=>[g(V(t.editMode?"Update":"Save"),1)]),_:1},8,["disabled","icon","loading"]),t.editMode?(p(),c(d,{key:0,preset:"secondary",onClick:e[7]||(e[7]=s=>t.cancelEdit())},{default:r(()=>e[14]||(e[14]=[g(" Cancel ")])),_:1})):F("",!0)])])),l(D,{modelValue:t.showDeleteModal,"onUpdate:modelValue":e[10]||(e[10]=s=>t.showDeleteModal=s),"hide-default-actions":""},{header:r(()=>e[15]||(e[15]=[n("h3",{class:"va-h6"},"Confirm Delete",-1)])),footer:r(()=>[n("div",Z,[l(d,{preset:"secondary",onClick:e[8]||(e[8]=s=>t.showDeleteModal=!1)},{default:r(()=>e[22]||(e[22]=[g("Cancel")])),_:1}),l(d,{color:"danger",loading:t.deleting,onClick:e[9]||(e[9]=s=>t.deleteHuntingAreaConfirmed())},{default:r(()=>e[23]||(e[23]=[g(" Force Delete ")])),_:1},8,["loading"])])]),default:r(()=>{var s;return[n("div",K,[n("p",X,[e[16]||(e[16]=g(" Are you sure you want to delete the hunting area ")),n("strong",null,V((s=t.itemToDelete)==null?void 0:s.name),1),e[17]||(e[17]=g("? "))]),l(C,{color:"danger",class:"mb-4"},{icon:r(()=>[l(L,{name:"warning"})]),default:r(()=>[e[18]||(e[18]=n("strong",null,"Warning:",-1)),e[19]||(e[19]=g(" This will permanently delete this hunting area and may affect: ")),e[20]||(e[20]=n("ul",{class:"list-disc ml-6 mt-2"},[n("li",null,"Sales Packages using this area"),n("li",null,"Price Lists referencing this area"),n("li",null,"Quotas assigned to this area"),n("li",null,"Trophy Fees for this area"),n("li",null,"Sales Inquiries linked to this area")],-1)),e[21]||(e[21]=n("p",{class:"mt-2 font-bold"},"This action cannot be undone!",-1))]),_:1})])]}),_:1},8,["modelValue"])]),_:1})}const ne=j(U,[["render",x]]);export{ne as default};
//# sourceMappingURL=ManageArea-D-ViJArN.js.map
