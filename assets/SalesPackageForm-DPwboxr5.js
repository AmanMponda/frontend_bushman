import{u as C}from"./useForm-uHGFwDD4.js";import{d as O,m as i,l as w,E as I,x as E,y as B,z as Q,A as _,B as A,s as r,_ as U,g as b,b as l,e as o,w as L,i as c,F as q,q as $,t as N,a as R,v as T,h as D,o as g}from"./index-CfFSTcA4.js";import{u as H}from"./useToast-CtGmr2K3.js";import{h as F}from"./errorHandler-DijQ3xmc.js";import{v as z}from"./utils-BWc0LXoO.js";import{u as f}from"./quota-store-BGCfYSQG.js";import{u as d}from"./settings-store-BM0E0G-d.js";import{u as j}from"./price-list-store-BE1BCzVS.js";import{u as M}from"./regulatrory-store-CbyYumak.js";const W=O({components:{VaForm:_,VaInput:Q,VaSelect:B,VaButton:E},setup(){const e=r(),{isValid:a,validate:t,resetValidation:n,reset:m}=C(e),{init:P}=H(),h=r(!1),p=A({package_name:"",description:"",species:null,quantity:1,area:null,licence:null}),S=A({id:null,client_id:null,contact:"",contact_type:null,contactable:!1}),V=r([]),y=r([]),k=r([]),v=r([]),s=r([]),u=r(0);return{formRef:e,form:p,contactForm:S,showEditForm:h,countries:V,nationality:y,categoryOptions:k,contactsTypes:v,clients:s,step:u,init:P,isValidForm:a,validateForm:t,resetValidationForm:n,resetForm:m,validators:z}},data(){return{defaultColDef:{editable:!0},settingsStore:d(),speciesOptions:[],areasOptions:[],saving:!1,regulatoryPackagesOptions:[],loadingLicenceOptions:!1,loading:!1,originalQuantities:A({}),quntityChangedsaved:!1}},computed:{...I(d,["licenceAreaSpecies"]),...w(d,["laodinglicenceAreaSpecies"])},mounted(){this.getLicencePackages(),this.getAreas(),this.settingsStore.licenceAreaSpecies=[]},methods:{...i(f,["getSpeciesList"]),...i(f,["getAllSpeciesPerQuotaPerArea"]),...i(f,["getAreaList"]),...i(d,["getHuntingsTypes"]),...i(d,["getCurrencies"]),...i(f,["getQuotas"]),...i(j,["createPriceList","createSalesPackage","getSalesPackageList"]),...i(M,["getRegulatoryPackages"]),...i(d,["getHuntingLicenseAreaSpecies"]),async submit(){if(this.saving=!0,this.licenceAreaSpecies.length===0){this.init({message:"Please select at least one species.",color:"warning"});return}const e={name:this.form.package_name,description:this.form.description,areaId:this.form.area.value,licenceId:this.form.licence.value,speciesObjectList:this.licenceAreaSpecies};try{const a=await this.createSalesPackage(e);a.status===201&&(this.saving=!1,console.log(a),this.init({message:a.data.message,color:"success"}),this.getSalesPackages())}catch(a){this.saving=!1;const t=F(a.response);console.log(t),this.init({message:a instanceof Error?a.message:"An error occurred",color:"danger"})}},async getLicencePackages(){this.loadingLicenceOptions=!0;try{const e=await this.getRegulatoryPackages();if(e.status===200){this.loadingLicenceOptions=!1;const a=e.data;this.regulatoryPackagesOptions=a.map(t=>({value:t.id,text:t.name+"->"+t.duration+"  days"}))}}catch(e){console.log(e)}},async getAreas(){try{const e=await this.getAreaList();this.areasOptions=e.data.map(a=>({value:a.id,text:a.name}))}catch(e){console.log(e)}},async getLicenceAreaSpeciesList(){const e={areaId:this.form.area.value,licenceId:this.form.licence.value};try{const a=await this.getHuntingLicenseAreaSpecies(e);if(a.status===200){const t=a.data;this.speciesOptions=t.map(n=>({value:n.id,text:n.name}))}}catch(a){const t=F(a.response);console.log(t),this.init({message:a instanceof Error?a.message:"An error occurred",color:"danger"})}},async getSalesPackages(){this.loading=!0;try{(await this.getSalesPackageList(!0)).status===200&&(this.loading=!1)}catch(e){console.log(e)}},onChange(e,a){if(!(e in this.originalQuantities)){const n=this.licenceAreaSpecies.find(m=>m.id===e);this.originalQuantities[e]=n.quantity}const t=this.licenceAreaSpecies.find(n=>n.id===e);t&&(t.quantity=a,this.licenceAreaSpecies=[...this.licenceAreaSpecies]),this.init({message:`Quantity for ${t.name} has been updated to ${a} quantity(s).`,color:"success",position:"bottom-right"})}}}),G={class:"p-1"},J={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},K={class:"grid grid-cols-1 md:grid-cols gap-4"},X=["disabled"],Y={class:"va-table"},Z={class:"mt-4 d-flex p-2"};function x(e,a,t,n,m,P){const h=c("VaInput"),p=c("VaSelect"),S=c("VaTextarea"),V=c("VaForm"),y=c("VaCounter"),k=c("VaInnerLoading"),v=c("VaButton");return g(),b(q,null,[l(V,{ref:"formRef"},{default:L(()=>[o("div",G,[o("div",J,[l(h,{modelValue:e.form.package_name,"onUpdate:modelValue":a[0]||(a[0]=s=>e.form.package_name=s),type:"text",placeholder:"Enter Package Name",rules:[s=>s&&s.length>0||"Package name is required"],label:"Package name","required-mark":""},null,8,["modelValue","rules"]),l(p,{modelValue:e.form.licence,"onUpdate:modelValue":a[1]||(a[1]=s=>e.form.licence=s),label:"Licence",options:e.regulatoryPackagesOptions,placeholder:"Select Licence","required-mark":"",rules:[s=>!!s||"Licence is required"],required:""},null,8,["modelValue","options","rules"]),l(p,{modelValue:e.form.area,"onUpdate:modelValue":[a[2]||(a[2]=s=>e.form.area=s),e.getLicenceAreaSpeciesList],label:"Area",options:e.areasOptions,placeholder:"Select area","required-mark":"",rules:[s=>!!s||"Area is required"],required:"",disabled:e.laodinglicenceAreaSpecies||e.form.licence===null,loading:e.laodinglicenceAreaSpecies},null,8,["modelValue","options","rules","disabled","loading","onUpdate:modelValue"])]),o("div",K,[l(S,{modelValue:e.form.description,"onUpdate:modelValue":a[3]||(a[3]=s=>e.form.description=s),"max-length":"120",label:"Description",counter:"","required-mark":"",placeholder:"Enter Description",rules:[s=>s&&s.length>0||"Required",s=>s&&s.length<60||"Maximum 120 characters"]},null,8,["modelValue","rules"])])])]),_:1},512),a[7]||(a[7]=o("h3",{class:"font-bold text-lg mb-2"},"Species",-1)),l(k,{loading:e.laodinglicenceAreaSpecies,size:30},{default:L(()=>[o("div",{class:"va-table-responsive",disabled:e.laodinglicenceAreaSpecies},[o("table",Y,[a[5]||(a[5]=o("thead",null,[o("tr",null,[o("th",null,"Name"),o("th",null,"Quantity")])],-1)),o("tbody",null,[(g(!0),b(q,null,$(e.licenceAreaSpecies,s=>(g(),b("tr",{key:s.id},[o("td",null,N(s.name),1),o("td",null,[l(y,{modelValue:s.quantity,"onUpdate:modelValue":[u=>s.quantity=u,u=>e.onChange(s.id,u)],"increase-icon":"add_circle_outline","decrease-icon":"remove_circle_outline",class:"w-100 p-0",success:e.quntityChangedsaved,"manual-input":"",color:"#6938D1",max:"100",min:"0","max-length":"3"},null,8,["modelValue","onUpdate:modelValue","success"])])]))),128))])])],8,X)]),_:1},8,["loading"]),o("div",Z,[e.showEditForm?T("",!0):(g(),R(v,{key:0,icon:"save",loading:e.saving,class:"mr-3 mb-2",disabled:!e.isValidForm,onClick:a[4]||(a[4]=s=>e.validateForm()&&e.submit())},{default:L(()=>a[6]||(a[6]=[D(" Save ")])),_:1},8,["loading","disabled"]))])],64)}const ce=U(W,[["render",x]]);export{ce as S};
//# sourceMappingURL=SalesPackageForm-DPwboxr5.js.map
