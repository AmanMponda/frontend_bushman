import{j as O,k as T,d as D,m as S,B as $,s as M,_ as I,a as f,w as o,e as l,g as F,v as h,t as b,i as p,h as u,b as t,o as d}from"./index-C9vSFmy5.js";import{u as U}from"./useForm-BYrNbDub.js";import{u as j}from"./useToast-6DeNNyrn.js";import{h as w}from"./errorHandler-DijQ3xmc.js";import{M as B}from"./ModuleTable-DxtBXkjM.js";import{u as z}from"./quota-store-Trz1doDf.js";import"./format-Cn4G_mmc.js";const N=O("trophyFees",{state:()=>({trophyFees:[],loading:!1}),actions:{async fetchTrophyFees(e={}){this.loading=!0;const r={method:"get",url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/",params:e,headers:{"Content-Type":"application/json"}};try{const a=await T.request(r);return this.trophyFees=a.data.data||a.data,a}finally{this.loading=!1}},async createTrophyFee(e){const r={method:"post",url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/",data:e,headers:{"Content-Type":"application/json"}};return await T.request(r)},async updateTrophyFee(e,s){const a={method:"put",url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/${e}/`,data:s,headers:{"Content-Type":"application/json"}};return await T.request(a)},async deleteTrophyFeeById(e){const r={method:"delete",url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/${e}/`,headers:{"Content-Type":"application/json"}};return await T.request(r)}}}),P=D({name:"ManageTrophyFeesPage",components:{ModuleTable:B},setup(){const e=M(null),{isValid:s,validate:r,resetValidation:a,reset:y}=U(e);return{isValidTrophyFeeForm:s,validateTrophyFeeForm:r,resetValidationTrophyFeeForm:a,resetTrophyFeeForm:y,trophyFeeFormRef:e,columns:[{key:"id",label:"ID",sortable:!0,width:80},{key:"species_name",label:"Species Name",sortable:!0},{key:"area_name",label:"Hunting Area",sortable:!0},{key:"sequence_order",label:"Sequence Order",sortable:!0,width:150},{key:"price_usd",label:"Price (USD)",sortable:!0,width:130},{key:"availability_days",label:"Available Days",sortable:!1,width:180},{key:"actions",label:"Actions",width:120}]}},data(){const e=[],s=$({id:null,species:null,area:null,sequence_order:1,price_usd:null,safari_day_ids:[]});return{items:e,trophyFeeForm:s,showTrophyFeesList:!0,loading:!1,saving:!1,editMode:!1,toast:j(),speciesOptions:[],areaOptions:[],safariDaysOptions:[],selectedSpecies:null,selectedArea:null}},computed:{uniqueSpeciesCount(){return new Set(this.items.map(s=>{var r;return(r=s._raw)==null?void 0:r.species_id})).size},uniqueAreasCount(){return new Set(this.items.map(s=>{var r;return(r=s._raw)==null?void 0:r.area_id})).size}},mounted(){this.getTrophyFees(),this.loadSpecies(),this.loadAreas()},methods:{...S(N,["fetchTrophyFees","createTrophyFee","updateTrophyFee","deleteTrophyFeeById"]),...S(z,["getSpeciesList","getAreaList"]),async getTrophyFees(){this.loading=!0;try{const e={};this.selectedSpecies&&(e.species_id=this.selectedSpecies.value),this.selectedArea&&(e.area_id=this.selectedArea.value);const s=await this.fetchTrophyFees(e);if(s.status===200){const r=s.data.data||s.data;s.data.safari_days&&(this.safariDaysOptions=s.data.safari_days.map(a=>({value:a.id,text:a.description||`${a.days}-day safari`,days:a.days}))),this.items=r.map(a=>{var y,_;return{id:a.id,species_name:((y=a.species)==null?void 0:y.name)||"N/A",area_name:((_=a.area)==null?void 0:_.name)||"N/A",sequence_order:this.getSequenceLabel(a.sequence_order),price_usd:`$${parseFloat(a.price_usd).toFixed(2)}`,availability_days:this.formatAvailabilityDays(a.availability||[]),_raw:a}})}}catch(e){w(e),this.toast.init({message:"Failed to load trophy fees",color:"danger"})}finally{this.loading=!1}},async loadSpecies(){try{const e=await this.getSpeciesList();this.speciesOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Failed to load species",e)}},async loadAreas(){try{const e=await this.getAreaList();this.areaOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Failed to load areas",e)}},clearFilters(){this.selectedSpecies=null,this.selectedArea=null,this.getTrophyFees()},getSequenceLabel(e){const s=["th","st","nd","rd"],r=e%100;return e+(s[(r-20)%10]||s[r]||s[0])},formatAvailabilityDays(e){return!e||e.length===0?"All Days":e.map(s=>{var r,a;return((r=s.safari_day)==null?void 0:r.description)||`${(a=s.safari_day)==null?void 0:a.days}-day`}).join(", ")},toggleFormAndList(){this.showTrophyFeesList=!this.showTrophyFeesList,this.showTrophyFeesList&&this.resetForm()},editTrophyFee(e){this.editMode=!0,this.showTrophyFeesList=!1;const s=e._raw;this.trophyFeeForm.id=s.id,this.trophyFeeForm.species=this.speciesOptions.find(r=>{var a;return r.value===((a=s.species)==null?void 0:a.id)}),this.trophyFeeForm.area=this.areaOptions.find(r=>{var a;return r.value===((a=s.area)==null?void 0:a.id)}),this.trophyFeeForm.sequence_order=s.sequence_order,this.trophyFeeForm.price_usd=s.price_usd,this.trophyFeeForm.safari_day_ids=(s.availability||[]).map(r=>{var a;return r.safari_day_id||((a=r.safari_day)==null?void 0:a.id)}).filter(r=>r!=null)},async saveTrophyFee(){this.saving=!0;try{const e={species_id:this.trophyFeeForm.species.value,area_id:this.trophyFeeForm.area.value,sequence_order:this.trophyFeeForm.sequence_order,price_usd:this.trophyFeeForm.price_usd};this.trophyFeeForm.safari_day_ids&&this.trophyFeeForm.safari_day_ids.length>0&&(e.safari_day_ids=this.trophyFeeForm.safari_day_ids);let s;this.editMode?s=await this.updateTrophyFee(this.trophyFeeForm.id,e):s=await this.createTrophyFee(e),(s.status===200||s.status===201)&&(this.toast.init({message:this.editMode?"Trophy fee updated successfully":"Trophy fee created successfully",color:"success"}),this.toggleFormAndList(),this.getTrophyFees())}catch(e){w(e),this.toast.init({message:"Failed to save trophy fee",color:"danger"})}finally{this.saving=!1}},async deleteTrophyFee(e){if(confirm("Are you sure you want to delete this trophy fee?"))try{const s=await this.deleteTrophyFeeById(e.id);(s.status===200||s.status===204)&&(this.toast.init({message:"Trophy fee deleted successfully",color:"success"}),this.getTrophyFees())}catch(s){w(s),this.toast.init({message:"Failed to delete trophy fee",color:"danger"})}},cancelEdit(){this.resetForm(),this.toggleFormAndList()},resetForm(){this.editMode=!1,this.trophyFeeForm.id=null,this.trophyFeeForm.species=null,this.trophyFeeForm.area=null,this.trophyFeeForm.sequence_order=1,this.trophyFeeForm.price_usd=null,this.trophyFeeForm.safari_day_ids=[],this.resetValidationTrophyFeeForm()}}}),E={class:"flex flex-col md:flex-row gap-4 mb-6 justify-between items-center"},H={key:0,class:"text-2xl font-semibold"},x={key:1,class:"text-2xl font-semibold"},R={key:2,class:"text-secondary text-sm mt-1"},Q={class:"flex gap-2"},G={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},J={class:"text-2xl font-bold"},K={class:"text-2xl font-bold"},W={class:"text-2xl font-bold"},X={class:"flex items-center gap-2 mb-3"},Y={class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4"},Z={class:"flex items-end"},ee={key:2},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={class:"flex items-center gap-2"},oe={class:"mb-3 text-sm text-secondary"},re={key:0,class:"text-secondary text-sm mt-2"},ie={class:"flex gap-3 justify-end"};function le(e,s,r,a,y,_){const g=p("VaButton"),n=p("VaIcon"),m=p("VaCardContent"),c=p("VaCard"),v=p("VaSelect"),A=p("ModuleTable"),V=p("VaCardTitle"),q=p("VaPopover"),k=p("VaInput"),C=p("VaOptionList"),L=p("VaForm");return d(),f(c,{class:"p-6"},{default:o(()=>[l("div",E,[l("div",null,[e.showTrophyFeesList?(d(),F("h2",H,"Trophy Fees Management")):(d(),F("h2",x,b(e.editMode?"Edit Trophy Fee":"Add New Trophy Fee"),1)),e.showTrophyFeesList?(d(),F("p",R," Manage trophy fees for different species and hunting areas ")):h("",!0)]),l("div",Q,[e.showTrophyFeesList?h("",!0):(d(),f(g,{key:0,icon:"arrow_back",preset:"secondary",onClick:s[0]||(s[0]=i=>e.toggleFormAndList())},{default:o(()=>s[10]||(s[10]=[u(" Back to List ")])),_:1})),e.showTrophyFeesList?(d(),f(g,{key:1,color:"primary",icon:"add",onClick:s[1]||(s[1]=i=>e.toggleFormAndList())},{default:o(()=>s[11]||(s[11]=[u(" Add Trophy Fee ")])),_:1})):h("",!0)])]),e.showTrophyFeesList&&!e.loading?(d(),F("div",G,[t(c,{stripe:""},{default:o(()=>[t(m,{class:"flex items-center gap-4"},{default:o(()=>[t(n,{name:"military_tech",size:"large",color:"primary"}),l("div",null,[l("div",J,b(e.items.length),1),s[12]||(s[12]=l("div",{class:"text-sm text-secondary"},"Total Trophy Fees",-1))])]),_:1})]),_:1}),t(c,{stripe:""},{default:o(()=>[t(m,{class:"flex items-center gap-4"},{default:o(()=>[t(n,{name:"pets",size:"large",color:"success"}),l("div",null,[l("div",K,b(e.uniqueSpeciesCount),1),s[13]||(s[13]=l("div",{class:"text-sm text-secondary"},"Unique Species",-1))])]),_:1})]),_:1}),t(c,{stripe:""},{default:o(()=>[t(m,{class:"flex items-center gap-4"},{default:o(()=>[t(n,{name:"location_on",size:"large",color:"warning"}),l("div",null,[l("div",W,b(e.uniqueAreasCount),1),s[14]||(s[14]=l("div",{class:"text-sm text-secondary"},"Hunting Areas",-1))])]),_:1})]),_:1})])):h("",!0),e.showTrophyFeesList?(d(),f(A,{key:1,items:e.items,columns:e.columns,loading:e.loading,onOnView:e.editTrophyFee,onOnDelete:e.deleteTrophyFee},{"filter-elements-and-download-btn":o(()=>[t(c,{stripe:"","stripe-color":"primary",class:"mb-4"},{default:o(()=>[t(m,null,{default:o(()=>[l("div",X,[t(n,{name:"filter_list"}),s[15]||(s[15]=l("span",{class:"font-semibold"},"Filter Trophy Fees",-1))]),l("div",Y,[t(v,{modelValue:e.selectedSpecies,"onUpdate:modelValue":[s[2]||(s[2]=i=>e.selectedSpecies=i),e.getTrophyFees],options:e.speciesOptions,label:"Filter by Species",placeholder:"All Species",clearable:"",searchable:""},{prepend:o(()=>[t(n,{name:"pets",size:"small"})]),_:1},8,["modelValue","options","onUpdate:modelValue"]),t(v,{modelValue:e.selectedArea,"onUpdate:modelValue":[s[3]||(s[3]=i=>e.selectedArea=i),e.getTrophyFees],options:e.areaOptions,label:"Filter by Hunting Area",placeholder:"All Areas",clearable:"",searchable:""},{prepend:o(()=>[t(n,{name:"location_on",size:"small"})]),_:1},8,["modelValue","options","onUpdate:modelValue"]),l("div",Z,[e.selectedSpecies||e.selectedArea?(d(),f(g,{key:0,preset:"plain",icon:"clear",onClick:e.clearFilters},{default:o(()=>s[16]||(s[16]=[u(" Clear Filters ")])),_:1},8,["onClick"])):h("",!0)])])]),_:1})]),_:1})]),_:1},8,["items","columns","loading","onOnView","onOnDelete"])):(d(),F("div",ee,[t(L,{ref:"trophyFeeFormRef"},{default:o(()=>[t(c,{stripe:"","stripe-color":"primary",class:"mb-4"},{default:o(()=>[t(V,null,{default:o(()=>s[17]||(s[17]=[u("Species & Area Information")])),_:1}),t(m,null,{default:o(()=>[l("div",se,[t(v,{modelValue:e.trophyFeeForm.species,"onUpdate:modelValue":s[4]||(s[4]=i=>e.trophyFeeForm.species=i),options:e.speciesOptions,label:"Species",placeholder:"Select a species",rules:[i=>!!i||"Species is required"],searchable:"","highlight-matched-text":"","required-mark":""},{prepend:o(()=>[t(n,{name:"pets"})]),_:1},8,["modelValue","options","rules"]),t(v,{modelValue:e.trophyFeeForm.area,"onUpdate:modelValue":s[5]||(s[5]=i=>e.trophyFeeForm.area=i),options:e.areaOptions,label:"Hunting Area",placeholder:"Select a hunting area",rules:[i=>!!i||"Hunting area is required"],searchable:"","highlight-matched-text":"","required-mark":""},{prepend:o(()=>[t(n,{name:"location_on"})]),_:1},8,["modelValue","options","rules"])])]),_:1})]),_:1}),t(c,{stripe:"","stripe-color":"success",class:"mb-4"},{default:o(()=>[t(V,null,{default:o(()=>s[18]||(s[18]=[u("Pricing Details")])),_:1}),t(m,null,{default:o(()=>[l("div",te,[t(k,{modelValue:e.trophyFeeForm.sequence_order,"onUpdate:modelValue":s[6]||(s[6]=i=>e.trophyFeeForm.sequence_order=i),label:"Sequence Order",type:"number",min:"1",placeholder:"Enter sequence number",rules:[i=>i>0||"Sequence must be greater than 0"],"required-mark":""},{prepend:o(()=>[t(n,{name:"format_list_numbered"})]),appendInner:o(()=>[t(q,{message:"Sequence order represents the trophy number (1st, 2nd, 3rd, etc.). Different sequences can have different prices for the same species.",placement:"top"},{default:o(()=>[t(n,{name:"info",size:"small",color:"info"})]),_:1})]),_:1},8,["modelValue","rules"]),t(k,{modelValue:e.trophyFeeForm.price_usd,"onUpdate:modelValue":s[7]||(s[7]=i=>e.trophyFeeForm.price_usd=i),label:"Price (USD)",type:"number",step:"0.01",min:"0",placeholder:"0.00",rules:[i=>i>0||"Price must be greater than 0"],"required-mark":""},{prepend:o(()=>[t(n,{name:"attach_money"})]),_:1},8,["modelValue","rules"])])]),_:1})]),_:1}),t(c,{stripe:"","stripe-color":"info",class:"mb-4"},{default:o(()=>[t(V,null,{default:o(()=>[l("div",ae,[t(n,{name:"calendar_today"}),s[19]||(s[19]=u(" Safari Days Availability "))])]),_:1}),t(m,null,{default:o(()=>[l("div",oe,[t(n,{name:"info",size:"small",class:"mr-1"}),s[20]||(s[20]=u(" Select which safari day packages this trophy fee applies to. Leave empty to make it available for all safari days. "))]),t(C,{modelValue:e.trophyFeeForm.safari_day_ids,"onUpdate:modelValue":s[8]||(s[8]=i=>e.trophyFeeForm.safari_day_ids=i),options:e.safariDaysOptions,type:"checkbox","value-by":"value","text-by":"text",class:"safari-days-options"},null,8,["modelValue","options"]),e.safariDaysOptions.length===0?(d(),F("div",re,[t(n,{name:"warning",size:"small",color:"warning",class:"mr-1"}),s[21]||(s[21]=u(" No safari days configured. Trophy fee will be available for all packages. "))])):h("",!0)]),_:1})]),_:1}),l("div",ie,[e.editMode?(d(),f(g,{key:0,preset:"secondary",icon:"close",onClick:e.cancelEdit},{default:o(()=>s[22]||(s[22]=[u(" Cancel ")])),_:1},8,["onClick"])):h("",!0),t(g,{disabled:!e.isValidTrophyFeeForm,color:"primary",icon:"save",loading:e.saving,onClick:s[9]||(s[9]=i=>e.validateTrophyFeeForm()&&e.saveTrophyFee())},{default:o(()=>[u(b(e.editMode?"Update Trophy Fee":"Save Trophy Fee"),1)]),_:1},8,["disabled","loading"])])]),_:1},512)]))]),_:1})}const ye=I(P,[["render",le],["__scopeId","data-v-31d0e6bf"]]);export{ye as default};
//# sourceMappingURL=ManageTrophyFees-Cf_EMauv.js.map
