import{u as F}from"./quota-store-C74f-cSp.js";import{d as M,m as g,B as _,s as v,_ as T,a as u,w as i,e as n,g as S,v as y,i as s,h as p,b as o,F as D,q as A,t as I,o as d}from"./index-mc8yIoJz.js";import{u as N}from"./useForm-B0KXMGch.js";import{u as z}from"./useToast-CzWLUixe.js";import{h as U}from"./errorHandler-DijQ3xmc.js";import{M as G}from"./ModuleTable-CkO475L8.js";import{u as O}from"./regulatrory-store-YnGf4YFI.js";import"./format-Cn4G_mmc.js";const P={name:"",start_date:null,end_date:null},Y=M({name:"QuotaPage",components:{ModuleTable:G},setup(){const e=v(null),a=v(null),{isValid:l,validate:r,resetValidation:c,reset:k}=N(e),{isValid:m,validate:f,resetValidation:V,reset:h}=N(a);return{isValidForm:l,validateForm:r,resetValidationForm:c,isValidpackageForm:m,validatepackageForm:f,resetValidationpackageForm:V,resetForm:k,resetpackageForm:h,formRef:e,packageFormRef:a}},data(){const e=[],a=_({id:null,name:"",start_date:null,end_date:null,description:""}),l=_({id:null,duration:null,name:null,quantity:0,salesQuota:null,area:null}),r=[{key:"name",sortable:!0},{key:"duration",sortable:!0}],c=[{value:"Regular",text:"Regular Safari"},{value:"Premium",text:"Premium Safari"},{value:"Major",text:"Major Safari"}],k=[];return{items:e,columns:r,editedItemId:null,editedItem:null,createdItem:{...P},toast:z(),form:a,packageForm:l,speciesOptions:[],areasOptions:[],speciesObjects:[],shopackaform:!1,quotasOptions:k,showpackForm:!0,quotaItems:[],packageNamesOptions:c,loading:!1,saving:!1}},mounted(){this.getQs(),this.getSpeciesItems(),this.getPackages()},methods:{...g(F,["getQuotas"]),...g(F,["getSpeciesList"]),...g(F,["generateQuotaYear"]),...g(O,["createNewRegulatoryPackage"]),...g(O,["getRegulatoryPackages"]),resetEditedItem(){this.editedItem=null,this.editedItemId=null},resetCreatedItem(){this.createdItem={...P}},showNewPackageForm(){this.showpackForm=!this.showpackForm,this.getPackages()},addNewSpeciesItemToStorage(){if(!this.packageForm.id||!this.packageForm.id.value||!this.packageForm.id.text||!this.packageForm.quantity){console.error("Error: Some required fields are null or undefined.");return}if(Number(this.packageForm.quantity)<=0)return;this.speciesObjects.some(a=>a.id===this.packageForm.id.value)?console.log("Species item already exists:",this.packageForm.id):(this.speciesObjects.push({id:this.packageForm.id.value,name:this.packageForm.id.text,quantity:this.packageForm.quantity}),console.log("New species item added:",this.speciesObjects))},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async addNewRegulatoryPackage(){if(this.speciesObjects.length===0){this.toast.init({message:"Please add at least one species item.",color:"warning"});return}const e={name:this.packageForm.name,duration:this.packageForm.duration,speciesObjectList:this.speciesObjects};try{const a=await this.createNewRegulatoryPackage(e);a.status===201?(this.toast.init({message:a.data.message,color:"success"}),this.resetpackageForm(),this.resetCreatedItem(),this.speciesObjects=[]):console.log(a.data)}catch(a){U(a),this.toast.init({message:a instanceof Error?a.message:"An error occurred",color:"danger"})}},async getQs(e=null){try{const a=await this.getQuotas(e);if(a.status===200){const l=a.data;this.quotasOptions=l.map(r=>{const c=this.generateQuotaYear(r.start_date,r.end_date);return{value:r.id,text:`${c} - ${r.name}`}})}}catch(a){console.log(a)}},async getPackages(){this.loading=!0;try{const e=await this.getRegulatoryPackages();if(e.status===200){this.loading=!1;const a=e.data;this.items=a.map(l=>({id:l.id,name:l.name,duration:l.duration}))}}catch(e){this.loading=!1,console.log(e)}},async getSpeciesItems(){try{const a=(await this.getSpeciesList()).data.map(l=>({value:l.id,text:l.name}));this.speciesOptions=this.speciesOptions.concat(a)}catch(e){console.log(e)}}}}),H={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},J={class:"flex flex-col md:flex-row gap-2 justify-start"},K={key:1,class:"p-2"},W={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-4"},X={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Z={class:"flex flex-col md:flex-row gap-2 justify-start"},ee={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-4"},ae={class:"mb-6"},te={class:"mb-6"};function se(e,a,l,r,c,k){const m=s("VaButton"),f=s("VaButtonGroup"),V=s("ModuleTable"),h=s("VaInput"),q=s("VaDivider"),L=s("VaSelect"),C=s("VaCounter"),j=s("VaForm"),R=s("VaListLabel"),Q=s("VaIcon"),b=s("VaListItemLabel"),B=s("VaListItemSection"),$=s("VaListItem"),x=s("VaList"),E=s("VaCard");return d(),u(E,{class:"p-6"},{default:i(()=>[n("div",H,[n("div",J,[e.showpackForm?y("",!0):(d(),u(m,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e.showNewPackageForm},{default:i(()=>a[6]||(a[6]=[p(" Go Back ")])),_:1},8,["onClick"]))]),e.showpackForm?(d(),u(f,{key:0},{default:i(()=>[o(m,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add",size:"small",onClick:e.showNewPackageForm},{default:i(()=>a[7]||(a[7]=[p("Add package")])),_:1},8,["onClick"])]),_:1})):y("",!0)]),e.showpackForm?(d(),u(V,{key:0,items:e.items,columns:e.columns,loading:e.loading,onOnView:e.showNewPackageForm},null,8,["items","columns","loading","onOnView"])):(d(),S("div",K,[o(j,{ref:"packageFormRef",class:"mb-6"},{default:i(()=>[n("div",W,[o(h,{modelValue:e.packageForm.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.packageForm.name=t),label:"Name",placeholder:"Enter package Name",type:"text",rules:[t=>!!t||"Package Name is required"],required:""},null,8,["modelValue","rules"]),o(h,{modelValue:e.packageForm.duration,"onUpdate:modelValue":a[1]||(a[1]=t=>e.packageForm.duration=t),label:"Duration",placeholder:"Enter package Duration",type:"number",rules:[t=>!!t||"Duration is required"],required:""},null,8,["modelValue","rules"])]),o(q,{orientation:"left",class:"py-6"},{default:i(()=>a[8]||(a[8]=[n("span",{caption:"",class:"px-2"},"Add a List of Species",-1)])),_:1}),n("div",X,[n("div",Z,[n("div",ee,[o(L,{modelValue:e.packageForm.id,"onUpdate:modelValue":a[2]||(a[2]=t=>e.packageForm.id=t),label:"Species",options:e.speciesOptions,placeholder:"Select Species",rules:[t=>!!t||"Species is required"],required:""},null,8,["modelValue","options","rules"]),o(C,{modelValue:e.packageForm.quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>e.packageForm.quantity=t),label:"Quantity","manual-input":"",min:1,max:100},null,8,["modelValue"])])]),o(f,null,{default:i(()=>[o(m,{class:"px-0 py-0",color:"primary",icon:"add",size:"small",round:"",onClick:a[4]||(a[4]=t=>e.addNewSpeciesItemToStorage())})]),_:1})])]),_:1},512),n("div",ae,[o(x,null,{default:i(()=>[e.speciesObjects.length>0?(d(),u(R,{key:0,class:"text-md mb-2 text-left"},{default:i(()=>a[9]||(a[9]=[p("Selected Species")])),_:1})):y("",!0),(d(!0),S(D,null,A(e.speciesObjects,(t,w)=>(d(),u($,{key:w,class:"list__item"},{default:i(()=>[o(B,null,{default:i(()=>[o(b,null,{default:i(()=>[p(" Name: "+I(t.name)+" ",1),o(Q,{name:"delete",size:"small",color:"primary",onClick:oe=>e.deleteFromStorage(w)},null,8,["onClick"])]),_:2},1024),o(b,{caption:""},{default:i(()=>[p("Quantity: "+I(t.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),n("div",te,[o(m,{disabled:!e.isValidpackageForm,color:"primary",icon:"add","icon-color":"#fff",onClick:a[5]||(a[5]=t=>e.validatepackageForm()&&e.addNewRegulatoryPackage())},{default:i(()=>a[10]||(a[10]=[p(" Submit New ")])),_:1},8,["disabled"])])]))]),_:1})}const pe=T(Y,[["render",se]]);export{pe as default};
//# sourceMappingURL=ManageRegulatoryPackage-C0poBclV.js.map
