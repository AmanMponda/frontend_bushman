import{h as F}from"./errorHandler-DijQ3xmc.js";import{v as $}from"./utils-BWc0LXoO.js";import{u as T}from"./useForm-C2zo2Lif.js";import{u as E}from"./useToast-MdJILhkk.js";import{_,g as b,e as s,t as n,h as l,F as q,q as Q,o as u,d as j,m as p,l as B,B as O,s as f,b as d,w as r,i as h,a as C,v as V}from"./index-CepPxMNg.js";import{u as D}from"./quota-store-Ch_FUFDF.js";import{u as A}from"./settings-store-CCBWwQZx.js";import{u as M}from"./price-list-store-kXDfM-Ev.js";import{u as R}from"./regulatrory-store-D8eK6Cv1.js";import{S as z}from"./SalesPackageForm-CjSehBEK.js";import"./format-Cn4G_mmc.js";const G={props:{item:{type:Object,required:!0}}},H={class:"species-details"},U={class:"header"},J={class:"description"},K={class:"area-info"},W={class:"regulatory-package-info"},X={class:"va-table-responsive"},Y={class:"va-table va-table--clickable"};function Z(t,e,a,i,g,N){var o,y,P,w,k;return u(),b("div",H,[e[9]||(e[9]=s("h1",{class:"title"},"Sales Package Details",-1)),s("div",U,[s("h2",null,"Packages Name: "+n(a.item.name||"N/A"),1),s("p",J,[e[0]||(e[0]=s("strong",null,"Description:",-1)),l(" "+n(a.item.description||"No description available"),1)])]),s("div",K,[e[3]||(e[3]=s("h3",null,"Area Information",-1)),s("p",null,[e[1]||(e[1]=s("strong",null,"Area Name:",-1)),l(" "+n(((o=a.item.area)==null?void 0:o.name)||"N/A"),1)]),s("p",null,[e[2]||(e[2]=s("strong",null,"Area Description:",-1)),l(" "+n(((y=a.item.area)==null?void 0:y.description)||"No description available"),1)])]),s("div",W,[e[7]||(e[7]=s("h3",null,"Licence Information",-1)),s("p",null,[e[4]||(e[4]=s("strong",null,"Package Name:",-1)),l(" "+n(((P=a.item.regulatory_package)==null?void 0:P.name)||"N/A"),1)]),s("p",null,[e[5]||(e[5]=s("strong",null,"Duration:",-1)),l(" "+n(((w=a.item.regulatory_package)==null?void 0:w.duration)||"N/A")+" days",1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"Created Date:",-1)),l(" "+n(((k=a.item.regulatory_package)==null?void 0:k.created_at)||"N/A"),1)])]),s("div",X,[s("table",Y,[e[8]||(e[8]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"Species Name"),s("th",null,"Scientific Name"),s("th",null,"Quantity")])],-1)),s("tbody",null,[(u(!0),b(q,null,Q(a.item.species,c=>{var S,v;return u(),b("tr",{key:c.id},[s("td",null,n(c.id||"N/A"),1),s("td",null,n(((S=c.species)==null?void 0:S.name)||"N/A"),1),s("td",null,n(((v=c.species)==null?void 0:v.scientific_name)||"N/A"),1),s("td",null,n(c.quantity!==null?c.quantity:"N/A"),1)])}),128))])])])])}const x=_(G,[["render",Z],["__scopeId","data-v-e004d657"]]),ee=j({components:{SalesPackageDetails:x,SalesPackageForm:z},setup(){const t=f(),{isValid:e,validate:a,resetValidation:i,reset:g}=T(t),{init:N}=E(),o=f(!1),y=O({package_name:"",description:"",species:null,quantity:1,area:null,licence:null}),P=O({id:null,client_id:null,contact:"",contact_type:null,contactable:!1}),w=f([]),k=f([]),c=f([]),S=f([]),v=f([]),L=f(0);return{formRef:t,form:y,contactForm:P,showEditForm:o,countries:w,nationality:k,categoryOptions:c,contactsTypes:S,clients:v,step:L,init:N,isValidForm:e,validateForm:a,resetValidationForm:i,resetForm:g,validators:$}},data(){return{defaultColDef:{editable:!0},columnDefs:[{field:"name"},{field:"quantity"}],preferred_species:[],speciesOptions:[],speciesObjects:[],areasOptions:[],huntingTypesOptions:[],salesQuotasOptions:[],speciesItemOptions:[],currencyOptions:[],showPackageList:!0,showCreateNewPackageForm:!1,showEditPackageForm:!1,packages:[],columns:[{key:"id",sortable:!0,sortingOptions:["desc","asc"]},{key:"name",sortable:!0},{key:"area_name",label:"Area",sortable:!0},{key:"regulatory_package_name",label:"Licence",sortable:!0},{key:"actions",sortable:!0}],loading:!1,saving:!1,regulatoryPackagesOptions:[],loadingLicenceOptions:!1,loadingSpeciesOptions:!1,isChanged:!1,originalQuantities:O({}),quntityChangedsaved:!1,showDetailsPage:!1,selectItem:null,showDeleteModal:!1,itemToDelete:null,deleting:!1}},computed:{...B(A,["licenceAreaSpecies","laodinglicenceAreaSpecies"]),itemChanged(){return t=>{const e=this.originalQuantities[t],a=this.licenceAreaSpecies.find(i=>i.id===t).quantity;return console.log("Original value:",e,"Current value:",a),e&&e!==a||this.isChanged}}},mounted(){this.loading=!0,this.getSpeciesItems(),this.getSalesPackages(),this.getLicencePackages(),this.getAreas()},methods:{...p(D,["getSpeciesList"]),...p(D,["getAllSpeciesPerQuotaPerArea"]),...p(D,["getAreaList"]),...p(A,["getHuntingsTypes"]),...p(A,["getCurrencies"]),...p(D,["getQuotas"]),...p(M,["createPriceList","createSalesPackage","getSalesPackageList","updateSalesPackage","deleteSalesPackage"]),...p(R,["getRegulatoryPackages"]),...p(A,["getHuntingLicenseAreaSpecies"]),showCreateNewPackaeListFormMethod(){this.showCreateNewPackageForm=!0,this.showPackageList=!1},goBack(){this.showCreateNewPackageForm=!1,this.showPackageList=!0,this.showDetailsPage=!1,this.showEditPackageForm=!1,this.getSalesPackages()},editPackage(t){this.selectItem=t.selfItem,this.showEditPackageForm=!0,this.showPackageList=!1},onEditSaved(){this.showEditPackageForm=!1,this.showPackageList=!0,this.getSalesPackages()},confirmDelete(t){this.itemToDelete=t,this.showDeleteModal=!0},async deletePackage(){if(this.itemToDelete){this.deleting=!0;try{const t=await this.deleteSalesPackage(this.itemToDelete.id,!0);(t.status===200||t.status===204)&&(this.init({message:"Package deleted successfully.",color:"success"}),this.showDeleteModal=!1,this.itemToDelete=null,this.getSalesPackages())}catch(t){const e=F(t.response);this.init({message:e.join(", ")||"Failed to delete package.",color:"danger"})}finally{this.deleting=!1}}},async submit(){if(this.saving=!0,this.licenceAreaSpecies.length===0){this.init({message:"Please select at least one species.",color:"warning"});return}const t={name:this.form.package_name,description:this.form.description,areaId:this.form.area.value,licenceId:this.form.licence.value,speciesObjectList:this.licenceAreaSpecies};try{const e=await this.createSalesPackage(t);e.status===201&&(this.saving=!1,console.log(e),this.init({message:e.data.message,color:"success"}),this.licenceAreaSpecies=[])}catch(e){this.saving=!1;const a=F(e.response);console.log(a),this.init({message:`
`+a.map((i,g)=>`${g+1}. ${i}`).join(`
`),color:"danger"})}},async getSpeciesItems(){this.loadingSpeciesOptions=!0;try{const t=await this.getSpeciesList();t.status===200&&(this.loadingSpeciesOptions=!1,this.speciesItemOptions=t.data.map(e=>({value:e.id,text:e.name})))}catch(t){console.log(t)}},showDetails(t){console.log("Show details for:",t),this.showDetailsPage=!0,this.selectItem=t.selfItem||t},async getSalesPackages(){this.loading=!0;try{const t=await this.getSalesPackageList();t.status===200&&(this.packages=t.data.map(e=>{var a,i;return{id:e.id,name:e.name,area_name:((a=e==null?void 0:e.area)==null?void 0:a.name)??"N/A",regulatory_package_name:((i=e==null?void 0:e.regulatory_package)==null?void 0:i.name)??"N/A",selfItem:e}}),this.loading=!1)}catch{this.loading=!1}},async getLicencePackages(){this.loadingLicenceOptions=!0;try{const t=await this.getRegulatoryPackages();if(t.status===200){this.loadingLicenceOptions=!1;const e=t.data;this.regulatoryPackagesOptions=e.map(a=>({value:a.id,text:a.name}))}}catch(t){console.log(t)}},async getAreas(){try{const t=await this.getAreaList();this.areasOptions=t.data.map(e=>({value:e.id,text:e.name}))}catch(t){console.log(t)}},async getLicenceAreaSpeciesList(){const t={areaId:this.form.area.value,licenceId:this.form.licence.value};try{const e=await this.getHuntingLicenseAreaSpecies(t);if(e.status===200){const a=e.data;this.speciesOptions=a.map(i=>({value:i.id,text:i.name}))}}catch(e){const a=F(e.response);console.log(a),this.init({message:`
`+a.map((i,g)=>`${g+1}. ${i}`).join(`
`),color:"danger"})}},onChange(t,e){if(console.log("Quantity changed:",t,e),!(t in this.originalQuantities)){const i=this.licenceAreaSpecies.find(g=>g.id===t);this.originalQuantities[t]=i.quantity}const a=this.licenceAreaSpecies.find(i=>i.id===t);a&&(a.quantity=e,this.licenceAreaSpecies=[...this.licenceAreaSpecies]),this.init({message:`Quantity for ${a.name} has been updated to ${e} quantity(s).`,color:"success",position:"bottom-right"}),console.log("updated item list:",this.licenceAreaSpecies)},addNewSpeciesItemToStorage(){if(!this.form.species||!this.form.quantity){this.init({message:"Please fill all required fields.",color:"warning"});return}if(Number(this.form.quantity)<=0){this.init({message:"Quantity must be greater than zero.",color:"warning"});return}this.speciesObjects.some(e=>e.species_id===this.form.species.value)?console.log("Species item already exists:",this.form.species.value):this.speciesObjects.push({id:this.form.species.value,name:this.form.species.text,quantity:this.form.quantity})},deleteFromStorage(t){this.speciesObjects.splice(t,1),console.log("Species item deleted:",t)}}}),te={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},se={class:"flex flex-col md:flex-row gap-2 justify-start"},ae={class:"flex gap-2"},ie={class:"flex gap-2 justify-end"};function oe(t,e,a,i,g,N){const o=h("VaButton"),y=h("VaButtonGroup"),P=h("VaDivider"),w=h("SalesPackageDetails"),k=h("SalesPackageForm"),c=h("VaDataTable"),S=h("VaCardContent"),v=h("VaCard"),L=h("VaModal");return u(),b(q,null,[d(v,null,{default:r(()=>[d(S,null,{default:r(()=>[s("div",te,[s("div",se,[!t.showPackageList||t.showDetailsPage||t.showEditPackageForm?(u(),C(o,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:t.goBack},{default:r(()=>e[2]||(e[2]=[l(" Go Back ")])),_:1},8,["onClick"])):V("",!0)]),!t.showCreateNewPackageForm&&!t.showDetailsPage&&!t.showEditPackageForm?(u(),C(y,{key:0},{default:r(()=>[d(o,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add","border-color":"primary",round:"",preset:"secondary",size:"small",onClick:t.showCreateNewPackaeListFormMethod},{default:r(()=>e[3]||(e[3]=[l(" Add a package ")])),_:1},8,["onClick"])]),_:1})):V("",!0)]),d(P),t.showDetailsPage?(u(),C(w,{key:0,item:t.selectItem},null,8,["item"])):t.showCreateNewPackageForm&&!t.showDetailsPage?(u(),C(k,{key:1})):t.showEditPackageForm?(u(),C(k,{key:2,"edit-mode":!0,"edit-item":t.selectItem,onSaved:t.onEditSaved},null,8,["edit-item","onSaved"])):t.showPackageList?(u(),C(c,{key:3,items:t.packages,columns:t.columns,loading:t.loading,hoverable:"",striped:""},{"cell(actions)":r(({rowData:m})=>[s("div",ae,[d(o,{preset:"plain",icon:"visibility",title:"View",onClick:I=>t.showDetails(m)},null,8,["onClick"]),d(o,{preset:"plain",icon:"edit",color:"warning",title:"Edit",onClick:I=>t.editPackage(m)},null,8,["onClick"]),d(o,{preset:"plain",icon:"delete",color:"danger",title:"Delete",onClick:I=>t.confirmDelete(m)},null,8,["onClick"])])]),_:1},8,["items","columns","loading"])):V("",!0)]),_:1})]),_:1}),d(L,{modelValue:t.showDeleteModal,"onUpdate:modelValue":e[1]||(e[1]=m=>t.showDeleteModal=m),"hide-default-actions":""},{header:r(()=>e[4]||(e[4]=[s("h3",{class:"va-h6"},"Confirm Delete",-1)])),footer:r(()=>[s("div",ie,[d(o,{preset:"secondary",onClick:e[0]||(e[0]=m=>t.showDeleteModal=!1)},{default:r(()=>e[7]||(e[7]=[l("Cancel")])),_:1}),d(o,{color:"danger",loading:t.deleting,onClick:t.deletePackage},{default:r(()=>e[8]||(e[8]=[l("Delete")])),_:1},8,["loading","onClick"])])]),default:r(()=>{var m;return[s("p",null,[e[5]||(e[5]=l(" Are you sure you want to delete ")),s("strong",null,n((m=t.itemToDelete)==null?void 0:m.name),1),e[6]||(e[6]=l("? "))])]}),_:1},8,["modelValue"])],64)}const ke=_(ee,[["render",oe]]);export{ke as default};
//# sourceMappingURL=ManageSalesPackage-DPlDANvV.js.map
