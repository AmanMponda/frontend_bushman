import{u as z}from"./quota-store-C74f-cSp.js";import{d as R,m as I,B as _,s as q,_ as H,a as f,w as l,e as r,g as k,b as o,v as L,i as n,h as m,F as Y,q as G,t as O,o as p}from"./index-mc8yIoJz.js";import{u as $}from"./useForm-B0KXMGch.js";import{u as P}from"./useToast-CzWLUixe.js";import{h as V}from"./errorHandler-DijQ3xmc.js";import{M as J}from"./ModuleTable-CkO475L8.js";import{u as K}from"./settings-store-DQMLUdNX.js";import"./format-Cn4G_mmc.js";const F={name:"",start_date:null,end_date:null},W=R({name:"QuotaPage",components:{ModuleTable:J},setup(){const e=q(null),t=q(null),{isValid:i,validate:a,resetValidation:d,reset:S}=$(e),u=[{key:"id",sortable:!0,sortingOptions:["desc","asc"]},{key:"name",sortable:!0},{key:"start_date",sortable:!0},{key:"end_date",sortable:!0},{key:"actions",width:80}],{isValid:g,validate:Q,resetValidation:h,reset:c}=$(t);return{isValidForm:i,validateForm:a,resetValidationForm:d,isValidSForm:g,validateSForm:Q,resetValidationSForm:h,resetForm:S,resetSForm:c,formRef:e,sformRef:t,columns:u}},data(){const e=[],t=_({id:null,name:"",start_date:null,end_date:null,description:""}),i=_({id:null,quantity:1,salesQuota:null,area:null}),a=[];return{items:e,editedItemId:null,editedItem:null,createdItem:{...F},toast:P(),form:t,sform:i,speciesOptions:[],areasOptions:[],speciesObjects:[],showModal:!1,quotasOptions:a,showQuotaList:!0,quotaItems:[],savingQuotaSpecies:!1,loadingQuotas:!1,savingQuota:!1}},mounted(){this.getQs(),this.getSpeciesItems(),this.getAreas()},methods:{...I(z,["getQuotas","createQuota","updateQuota","deleteQuota","getSpeciesList","getAreaList","generateQuotaYear","createQuotaAreaSpecies"]),...I(K,["getLicenceRegulatoryHuntingPackageSpecies"]),resetEditedItem(){this.editedItem=null,this.editedItemId=null},resetCreatedItem(){this.createdItem={...F}},showAddQuotaModal(){this.showModal=!this.showModal},showQuota(e){this.showQuotaList=!this.showQuotaList,this.sform.salesQuota={value:e.id,text:this.generateQuotaYear(e.start_date,e.end_date)+` - ${e.name}`},this.getSpeciesItems()},updateQuantitySelectedSpecies(e){this.sform.quantity=e.quantity},addNewSpeciesItemToStorage(){if(!this.sform.id||!this.sform.id.value||!this.sform.id.text||!this.sform.quantity){console.error("Error: Some required fields are null or undefined.");return}if(Number(this.sform.quantity)<=0)return;this.speciesObjects.some(t=>t.id===this.sform.id.value)?console.log("Species item already exists:",this.sform.id):(this.speciesObjects.push({id:this.sform.id.value,name:this.sform.id.text,quantity:this.sform.quantity}),console.log("New species item added:",this.speciesObjects))},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async addNewSpeciesToQuota(){if(this.savingQuotaSpecies=!0,this.speciesObjects.length===0){this.toast.init({message:"Please add at least one species item.",color:"warning"});return}const e={area_id:this.sform.area.value,quota_id:this.sform.salesQuota.value,speciesObjects:this.speciesObjects};try{const t=await this.createQuotaAreaSpecies(e);t.status===201&&(this.savingQuotaSpecies=!1,this.toast.init({message:t.data.message,color:"success"}),this.resetSForm(),this.resetCreatedItem(),this.speciesObjects=[])}catch(t){const i=V(t);this.savingQuotaSpecies=!1,this.toast.init({message:`
`+i.map((a,d)=>`${d+1}. ${a}`).join(`
`),color:"danger"})}},async createNewQuota(){this.savingQuota=!0;const e={name:this.form.name,start_date:this.form.start_date,end_date:this.form.end_date,description:this.form.description};try{const t=await this.createQuota(e);if(t.status===201)this.savingQuota=!1,this.toast.init({message:t.data.message,color:"success"}),this.resetForm(),this.getQs(),this.showAddQuotaModal(),this.resetCreatedItem();else{const i=V(t);this.toast.init({message:`
`+i.map((a,d)=>`${d+1}. ${a}`).join(`
`)})}}catch(t){this.savingQuota=!1;const i=V(t);this.toast.init({message:`
`+i.map((a,d)=>`${d+1}. ${a}`).join(`
`),color:"danger"})}},formatDate(e){const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${a}`},async editItem(){console.log(this.editedItem);try{const e={id:this.form.id,name:this.form.name,start_date:this.formatDate(new Date(this.form.start_date)),end_date:this.formatDate(new Date(this.form.end_date))},t=await this.updateQuota(e);t.status===200&&(this.getQs(null),this.toast.init({message:t.data.message,color:"success"}),this.resetEditedItem())}catch(e){const t=V(e);console.log(e),this.toast.init({message:`
`+t.map((i,a)=>`${a+1}. ${i}`).join(`
`),color:"danger"})}},async getQs(e=null){this.loadingQuotas=!0;try{const t=await this.getQuotas(e);if(t.status===200){const i=t.data;this.loadingQuotas=!1,this.quotasOptions=i.map(a=>{const d=this.generateQuotaYear(a.start_date,a.end_date);return{value:a.id,text:`${d} - ${a.name}`}}),this.items=i.map(a=>({id:a.id,name:a.name,start_date:a.start_date,end_date:a.end_date}))}}catch(t){this.loadingQuotas=!1,console.log(t)}},async getSpeciesItems(){try{const t=(await this.getSpeciesList()).data.map(i=>({value:i.id,text:i.name}));this.speciesOptions=this.speciesOptions.concat(t)}catch(e){console.log(e)}},async getAreas(){try{const e=await this.getAreaList();this.areasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}}}}),X={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Z={class:"flex flex-col md:flex-row gap-2 justify-start"},x={key:1,class:"p-2"},ee={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-4"},te={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},se={class:"flex flex-col md:flex-row gap-2 justify-start"},ae={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-4"},oe={class:"mb-6"},ie={class:"mb-6"},le={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"},ne={class:"mb-4"};function re(e,t,i,a,d,S){const u=n("VaButton"),g=n("VaButtonGroup"),Q=n("ModuleTable"),h=n("VaIcon"),c=n("VaSelect"),j=n("VaValue"),C=n("VaDivider"),N=n("VaCounter"),y=n("VaForm"),A=n("VaListLabel"),v=n("VaListItemLabel"),M=n("VaListItemSection"),D=n("VaListItem"),B=n("VaList"),U=n("VaInput"),b=n("VaDateInput"),T=n("VaModal"),E=n("VaCard");return p(),f(E,{class:"p-6"},{default:l(()=>[r("div",X,[r("div",Z,[e.showQuotaList?L("",!0):(p(),f(u,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e.showQuota},{default:l(()=>t[13]||(t[13]=[m(" Go Back ")])),_:1},8,["onClick"]))]),o(g,null,{default:l(()=>[o(u,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add",size:"small",onClick:t[0]||(t[0]=s=>e.showAddQuotaModal())},{default:l(()=>t[14]||(t[14]=[m("Add a New Quota")])),_:1})]),_:1})]),e.showQuotaList?(p(),f(Q,{key:0,items:e.items,columns:e.columns,loading:e.loadingQuotas,onOnView:e.showQuota},null,8,["items","columns","loading","onOnView"])):(p(),k("div",x,[o(y,{ref:"sformRef",class:"mb-6"},{default:l(()=>[r("div",ee,[o(j,{"default-value":!1},{default:l(()=>[o(c,{modelValue:e.sform.salesQuota,"onUpdate:modelValue":[t[1]||(t[1]=s=>e.sform.salesQuota=s),e.getSpeciesItems],options:e.quotasOptions,label:"Sales Quota",rules:[s=>!!s||"Sales Quota is required"],placeholder:"Select Sales Quota"},{appendInner:l(()=>[o(h,{name:"av_timer",size:"small",color:"primary"})]),_:1},8,["modelValue","options","rules","onUpdate:modelValue"])]),_:1}),o(c,{modelValue:e.sform.area,"onUpdate:modelValue":t[2]||(t[2]=s=>e.sform.area=s),label:"Hunting Area",options:e.areasOptions,placeholder:"Select Hunting Area",rules:[s=>!!s||"Hunting Area is required"],required:""},null,8,["modelValue","options","rules"])]),o(C,{orientation:"left",class:"py-12"},{default:l(()=>t[15]||(t[15]=[r("span",{caption:"",class:"px-2"},"Add a List of Species",-1)])),_:1}),r("div",te,[r("div",se,[r("div",ae,[o(c,{modelValue:e.sform.id,"onUpdate:modelValue":[t[3]||(t[3]=s=>e.sform.id=s),e.updateQuantitySelectedSpecies],label:"Species",options:e.speciesOptions,placeholder:"Select Species",rules:[s=>!!s||"Species is required"],required:""},null,8,["modelValue","options","rules","onUpdate:modelValue"]),o(N,{modelValue:e.sform.quantity,"onUpdate:modelValue":t[4]||(t[4]=s=>e.sform.quantity=s),label:"Quantity","manual-input":"",min:1,max:100},null,8,["modelValue"])])]),o(g,null,{default:l(()=>[o(u,{class:"px-0 py-0",color:"primary",icon:"add",size:"small",round:"",onClick:t[5]||(t[5]=s=>e.addNewSpeciesItemToStorage())})]),_:1})])]),_:1},512),r("div",oe,[o(B,null,{default:l(()=>[e.speciesObjects.length>0?(p(),f(A,{key:0,class:"text-md mb-2 text-left"},{default:l(()=>t[16]||(t[16]=[m("Selected Species")])),_:1})):L("",!0),(p(!0),k(Y,null,G(e.speciesObjects,(s,w)=>(p(),f(D,{key:w,class:"list__item"},{default:l(()=>[o(M,null,{default:l(()=>[o(v,null,{default:l(()=>[m(" Name: "+O(s.name)+" ",1),o(h,{name:"delete",size:"small",color:"primary",onClick:de=>e.deleteFromStorage(w)},null,8,["onClick"])]),_:2},1024),o(v,{caption:""},{default:l(()=>[m("Quantity: "+O(s.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),r("div",ie,[o(u,{disabled:!e.isValidSForm,color:"primary",loading:e.savingQuotaSpecies,icon:"save","icon-color":"#fff",onClick:t[6]||(t[6]=s=>e.validateSForm()&&e.addNewSpeciesToQuota())},{default:l(()=>t[17]||(t[17]=[m(" save ")])),_:1},8,["disabled","loading"])])])),o(T,{modelValue:e.showModal,"onUpdate:modelValue":t[11]||(t[11]=s=>e.showModal=s),"z-index":"1",overlay:!1,"ok-text":"Save",size:"small",onOk:t[12]||(t[12]=s=>e.validateForm()&&e.createNewQuota())},{default:l(()=>[o(y,{ref:"formRef",class:"p-6"},{default:l(()=>[t[19]||(t[19]=r("h3",{class:"font-bold text-lg mb-4"},"Add Quota",-1)),r("div",le,[o(U,{modelValue:e.form.name,"onUpdate:modelValue":t[7]||(t[7]=s=>e.form.name=s),label:"Name",placeholder:"Enter Quota Name",type:"text",rules:[s=>!!s||"Name is required"],required:""},null,8,["modelValue","rules"]),o(b,{modelValue:e.form.start_date,"onUpdate:modelValue":t[8]||(t[8]=s=>e.form.start_date=s),label:"Start Date",rules:[s=>!!s||"Start Date is required"],"manual-input":"",placeholder:"Select a date"},null,8,["modelValue","rules"]),o(b,{modelValue:e.form.end_date,"onUpdate:modelValue":t[9]||(t[9]=s=>e.form.end_date=s),label:"End Date",rules:[s=>!!s||"End Date is required"],"manual-input":"",placeholder:"Select a date"},null,8,["modelValue","rules"])]),r("div",ne,[o(u,{loading:e.savingQuota,disabled:!e.isValidForm||e.savingQuota,color:"primary",onClick:t[10]||(t[10]=s=>e.createNewQuota())},{default:l(()=>t[18]||(t[18]=[m("Save")])),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1},8,["modelValue"])]),_:1})}const Qe=H(W,[["render",re]]);export{Qe as default};
//# sourceMappingURL=ManageQuota-CJQXPBC9.js.map
