const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-B9h-8Axk.js","assets/index-P4QeRV7n.js","assets/index-BunwbW71.css"])))=>i.map(i=>d[i]);
import{d as Q,m as A,I as D,s as N,_ as I,a as V,w as h,g as w,v as C,e as d,b as f,t as y,i as _,h as T,o as F}from"./index-P4QeRV7n.js";import{u as q}from"./quota-store-Bck9cnCu.js";import{u as O}from"./useToast-DVuIP6Z-.js";const M=Q({setup(){const a=[{key:"id",sortable:!0},{key:"area",sortable:!0},{key:"name",sortable:!0},{key:"scientific_name",sortable:!0},{key:"no_of_species",sortable:!0},{key:"provision_sales",sortable:!0},{key:"confirmed",sortable:!0},{key:"cancelled",sortable:!0},{key:"taken",sortable:!0}];return{filter:N(""),columns:a}},data(){const{init:a}=O();return{quotaStats:null,detailedData:[],area:null,quota:null,species:null,currentQuota:null,areasOptions:[],yearOptions:[],speciesOptions:[],init:a,logo:"/logo.png",selectQuota:null,with:12,height:100,loading:!1,base64Pdf:"",loadingQuota:!1,downloading:!1,showMessage:""}},mounted(){this.getAllSpeces(),this.getQuota(),this.getSpeciesItems(),this.getAreas()},methods:{...A(q,["getAllSpeciesPerQuotaPerArea"]),...A(q,["getQuotas"]),...A(q,["getSpeciesList"]),...A(q,["getAreaList"]),...A(q,["generateQuotaYear"]),async downloadPDF(){var a,s;if(!this.quotaStats){this.init({message:"No data to download",color:"warning"});return}this.downloading=!0;try{const c=await D(()=>import("./jspdf.es.min-B9h-8Axk.js").then(i=>i.j),__vite__mapDeps([0,1,2])),r=c.jsPDF||c.default;try{await D(()=>import("./jspdf.plugin.autotable-bUJAAMeG.js"),[])}catch(i){console.warn("jspdf-autotable not available:",i)}const t=new r("p","mm","a4");let e=10;const o=50;try{const i=new Image;i.onload=()=>{t.addImage(i,"PNG",14,e,30,30)},i.src="/logo.png"}catch(i){console.warn("Could not load logo:",i)}t.setFontSize(14),t.setTextColor(40,40,40),t.setFont(void 0,"bold"),t.text("BUSHMAN TANZANIA",o,e+5),t.setFontSize(9),t.setTextColor(60,60,60),t.setFont(void 0,"normal");const l=["Plot 61-64, Kihonda Industrial Area","Morogoro, Tanzania","Tel: +255 756 888 222","Email: info@bushman.co.tz","Website: www.bushman.co"];let m=e+5;l.forEach(i=>{t.text(i,o,m),m+=5}),e=e+35,t.setDrawColor(200,200,200),t.line(14,e,196,e),t.setFontSize(16),t.setTextColor(40,40,40),t.setFont(void 0,"bold"),t.text("QUOTA MANAGEMENT REPORT",105,e+10,{align:"center"}),t.setFontSize(9),t.setTextColor(100,100,100),t.setFont(void 0,"normal"),t.text(`Generated: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`,105,e+18,{align:"center"});let u=e+28;const n=[];if(this.quota&&this.quota!=="all"&&this.quota!==null){const i=this.yearOptions.find(g=>g.value===this.quota);n.push(`Quota: ${(i==null?void 0:i.text)||String(this.quota)}`)}if(this.area&&this.area!=="all"&&this.area!==null){const i=this.areasOptions.find(g=>g.value===this.area);n.push(`Area: ${(i==null?void 0:i.text)||String(this.area)}`)}if(this.species&&this.species!=="all"&&this.species!==null){const i=this.speciesOptions.find(g=>g.value===this.species);n.push(`Species: ${(i==null?void 0:i.text)||String(this.species)}`)}if(n.length>0&&(t.setFontSize(9),t.setTextColor(80,80,80),t.setFont(void 0,"normal"),t.text(`Filters: ${n.join(" | ")}`,14,u),u+=8),u+=5,t.setFontSize(11),t.setTextColor(40,40,40),t.setFont(void 0,"bold"),t.text("SUMMARY STATISTICS",14,u),u+=7,typeof t.autoTable=="function"){const i=[["Total Quota Balance",String(this.quotaStats.total_quota_balance)],["Available Quota",String(this.quotaStats.available_quota)],["Confirmed",String(this.quotaStats.confirmed)],["Provisioned",String(this.quotaStats.provisioned)],["Cancelled",String(this.quotaStats.cancelled)],["Taken",String(this.quotaStats.taken)],["Total Allocated",String(this.quotaStats.total_allocated)],["Utilisation Rate",`${this.quotaStats.utilisation_percentage}%`]];t.autoTable({head:[["Metric","Value"]],body:i,startY:u,theme:"grid",styles:{fontSize:9,cellPadding:5,overflow:"linebreak",halign:"left",valign:"middle"},headStyles:{fillColor:[41,128,185],textColor:[255,255,255],fontStyle:"bold",fontSize:10,halign:"center"},bodyStyles:{textColor:[50,50,50]},alternateRowStyles:{fillColor:[240,248,255]},columnStyles:{0:{halign:"left",cellWidth:90},1:{halign:"center",cellWidth:50}},margin:{left:14,right:14},pageBreak:"avoid"}),u=t.lastAutoTable.finalY+10}else{const i=[["Total Quota Balance",String(this.quotaStats.total_quota_balance)],["Available Quota",String(this.quotaStats.available_quota)],["Confirmed",String(this.quotaStats.confirmed)],["Provisioned",String(this.quotaStats.provisioned)],["Cancelled",String(this.quotaStats.cancelled)],["Taken",String(this.quotaStats.taken)],["Total Allocated",String(this.quotaStats.total_allocated)],["Utilisation Rate",`${this.quotaStats.utilisation_percentage}%`]];let g=u;const S=80,k=110,v=7;t.setFillColor(41,128,185),t.setTextColor(255,255,255),t.setFont(void 0,"bold"),t.setFontSize(9),t.rect(14,g,S,v,"F"),t.rect(14+S,g,70,v,"F"),t.text("Metric",16,g+4.5),t.text("Value",k,g+4.5),g+=v,t.setTextColor(50,50,50),t.setFont(void 0,"normal"),t.setFontSize(9);let x=!1;i.forEach(([$,E])=>{x?(t.setFillColor(240,248,255),t.rect(14,g,S,v,"F"),t.rect(14+S,g,70,v,"F")):(t.setDrawColor(200,200,200),t.rect(14,g,S,v),t.rect(14+S,g,70,v)),t.text(String($),16,g+4.5),t.text(String(E),k+10,g+4.5),g+=v,x=!x}),u=g+10}if(this.detailedData&&this.detailedData.length>0)if(t.setFontSize(11),t.setTextColor(40,40,40),t.setFont(void 0,"bold"),t.text("DETAILED QUOTA DATA",14,u),u+=7,typeof t.autoTable=="function"){const i=["Area","Species","Scientific Name","Total","Provision","Confirmed","Cancelled","Taken"],g=this.detailedData.map(S=>[(S.area||"N/A").substring(0,12),(S.name||"N/A").substring(0,12),(S.scientific_name||"N/A").substring(0,12),String(S.no_of_species||0),String(S.provision_sales||0),String(S.confirmed||0),String(S.cancelled||0),String(S.taken||0)]);t.autoTable({head:[i],body:g,startY:u,theme:"grid",styles:{fontSize:8,cellPadding:4,overflow:"linebreak",halign:"center",valign:"middle"},headStyles:{fillColor:[41,128,185],textColor:[255,255,255],fontStyle:"bold",fontSize:9,halign:"center"},bodyStyles:{textColor:[50,50,50]},alternateRowStyles:{fillColor:[240,248,255]},margin:{left:14,right:14},pageBreak:"auto"})}else this.drawManualTable(t,u);else t.setFontSize(10),t.setTextColor(150,150,150),t.text("No detailed data available",14,u);const b=((s=(a=t.internal).getNumberOfPages)==null?void 0:s.call(a))||1,p=285,P=["Bushman Tanzania | Plot 61-64, Kihonda Industrial Area | Morogoro, Tanzania","Tel: +255 756 888 222 | Email: info@bushman.co.tz | www.bushman.co"];for(let i=1;i<=b;i++){t.setPage(i),t.setDrawColor(200,200,200),t.line(14,280,196,280),t.setFontSize(7),t.setTextColor(100,100,100),t.setFont(void 0,"normal"),t.text(P[0],105,p,{align:"center"}),t.text(P[1],105,p+3,{align:"center"});const g=t.internal.pageSize.width||210;t.text(`Page ${i} of ${b}`,g-25,p)}const z=`quota-report-${new Date().toISOString().split("T")[0]}.pdf`;t.save(z),this.init({message:"PDF downloaded successfully!",color:"success"})}catch(c){console.error("PDF generation error:",c);try{await this.generateSimplePDF()}catch(r){console.error("Simple PDF also failed:",r),this.init({message:(c==null?void 0:c.message)||"Failed to generate PDF. Please try backend PDF generation.",color:"danger"})}}finally{this.downloading=!1}},drawManualTable(a,s){const c=["Area","Species","Total","Provision","Confirmed","Cancelled","Taken"],r=[30,30,20,20,20,20,20],t=8;let e=s,o=14;a.setFillColor(66,135,245),a.setTextColor(255,255,255),a.setFont(void 0,"bold"),c.forEach((l,m)=>{a.rect(o,e,r[m],t,"F"),a.text(l,o+2,e+t/2+2),o+=r[m]}),e+=t,a.setFillColor(255,255,255),a.setTextColor(0,0,0),a.setFont(void 0,"normal"),this.detailedData.forEach((l,m)=>{e>270&&(a.addPage(),e=20),o=14;const u=[(l.area||"N/A").substring(0,10),(l.name||"N/A").substring(0,10),String(l.no_of_species||0),String(l.provision_sales||0),String(l.confirmed||0),String(l.cancelled||0),String(l.taken||0)];if(m%2===0){a.setFillColor(245,245,245);const n=r.reduce((b,p)=>b+p,0);a.rect(o,e,n,t,"F")}u.forEach((n,b)=>{a.text(String(n),o+2,e+t/2+2),o+=r[b]}),e+=t})},async generateSimplePDF(){var a,s;try{const c=await D(()=>import("./jspdf.es.min-B9h-8Axk.js").then(n=>n.j),__vite__mapDeps([0,1,2])),r=c.jsPDF||c.default,t=new r("p","mm","a4");let e=10;t.setFontSize(12),t.setTextColor(40,40,40),t.setFont("","bold"),t.text("BUSHMAN TANZANIA",105,e,{align:"center"}),e+=5,t.setFontSize(8),t.setTextColor(60,60,60),t.setFont("","normal"),["Plot 61-64, Kihonda Industrial Area, Morogoro, Tanzania","Tel: +255 756 888 222 | Email: info@bushman.co.tz | www.bushman.co"].forEach(n=>{t.text(n,105,e,{align:"center"}),e+=4}),t.setDrawColor(200,200,200),t.line(14,e+2,196,e+2),e+=8,t.setFontSize(14),t.setTextColor(40,40,40),t.setFont("","bold"),t.text("QUOTA REPORT",20,e),e+=8,t.setFontSize(9),t.setTextColor(100,100,100),t.setFont("","normal"),t.text(`Generated: ${new Date().toLocaleString()}`,20,e),e+=10,this.quotaStats&&(t.setFontSize(11),t.setTextColor(40,40,40),t.setFont("","bold"),t.text("SUMMARY STATISTICS:",20,e),e+=8,t.setFontSize(9),t.setTextColor(50,50,50),t.setFont("","normal"),[`Total Quota: ${this.quotaStats.total_quota_balance}`,`Available: ${this.quotaStats.available_quota}`,`Confirmed: ${this.quotaStats.confirmed}`,`Provisioned: ${this.quotaStats.provisioned}`,`Cancelled: ${this.quotaStats.cancelled}`,`Taken: ${this.quotaStats.taken}`,`Utilisation: ${this.quotaStats.utilisation_percentage}%`].forEach(b=>{t.text(b,25,e),e+=6}),e+=8),this.detailedData&&this.detailedData.length>0&&(t.setFontSize(11),t.setTextColor(40,40,40),t.setFont("","bold"),t.text("DETAILED DATA:",20,e),e+=8,t.setFontSize(8),t.setTextColor(50,50,50),t.setFont("","normal"),this.detailedData.forEach(n=>{e>270&&(t.addPage(),e=20);const b=`${n.area||"N/A"} - ${n.name||"N/A"}: Total ${n.no_of_species||0}, Prov ${n.provision_sales||0}, Conf ${n.confirmed||0}, Can ${n.cancelled||0}, Taken ${n.taken||0}`;t.text(b.substring(0,100),20,e),e+=6}));const l=((s=(a=t.internal).getNumberOfPages)==null?void 0:s.call(a))||1,m=285;t.setFontSize(7),t.setTextColor(100,100,100),t.setFont("","normal");for(let n=1;n<=l;n++)t.setPage(n),t.line(14,280,196,280),t.text("Bushman Tanzania | Plot 61-64, Kihonda Industrial Area, Morogoro",105,m,{align:"center"}),t.text(`Page ${n} of ${l}`,14,m);const u=new Date().toISOString().split("T")[0];t.save(`quota-report-${u}.pdf`),this.init({message:"PDF downloaded successfully!",color:"success"})}catch{}},async getAllSpeces(){var a,s,c,r;this.loading=!0,this.showMessage="",this.quotaStats=null,this.detailedData=[];try{const t=await this.getAllSpeciesPerQuotaPerArea(this.quota,this.area,this.species);if(console.log("API Response:",t.data),(a=t.data)!=null&&a.success){const e=t.data.data;e&&typeof e=="object"?(this.quotaStats={total_quota_balance:e.total_quota_balance||0,available_quota:e.available_quota||0,confirmed:e.confirmed||0,provisioned:e.provisioned||0,cancelled:e.cancelled||0,taken:e.taken||0,total_allocated:e.total_allocated||0,utilisation_percentage:e.utilisation_percentage||0},t.data.detailed_data&&Array.isArray(t.data.detailed_data)&&(this.detailedData=t.data.detailed_data.map(o=>{var l,m,u;return{id:o.id||0,name:o.name||((l=o.species)==null?void 0:l.name)||"N/A",area:o.area||((m=o.huntingArea)==null?void 0:m.name)||"N/A",scientific_name:o.scientific_name||((u=o.species)==null?void 0:u.scientific_name)||"N/A",no_of_species:o.no_of_species||o.quantity||0,provision_sales:o.provision_sales||o.provision_quantity||0,confirmed:o.confirmed||o.confirmed_quantity||0,cancelled:o.cancelled||o.declined_quantity||o.cancelled_quantity||0,taken:o.taken||o.completed_quantity||0}}))):this.showMessage=t.data.message||"No data available"}else this.showMessage=((s=t.data)==null?void 0:s.message)||"Failed to load quota data"}catch(t){console.error("Error fetching quota data:",t),this.showMessage=((r=(c=t.response)==null?void 0:c.data)==null?void 0:r.message)||t.message||"Failed to fetch quota data",this.init({message:this.showMessage,color:"danger"})}finally{this.loading=!1}},async getQuota(){var a,s,c;this.loadingQuota=!0;try{const r=await this.getQuotas(null);let t=[];if((a=r.data)!=null&&a.success&&Array.isArray(r.data.data)?t=r.data.data:Array.isArray(r.data)&&(t=r.data),t.length>0){const e=t[0];this.quota=e.id,this.currentQuota=e,this.yearOptions=t.map(o=>{const l=this.generateQuotaYear(o.start_date,o.end_date);return{value:o.id,text:`${l} - ${o.name}`,name:o.name,start_date:o.start_date,end_date:o.end_date}})}else this.init({message:"No quotas found",color:"warning"})}catch(r){console.error("Error fetching quotas:",r);const t=((c=(s=r.response)==null?void 0:s.data)==null?void 0:c.message)||r.message||"Failed to fetch quotas";this.init({message:t,color:"danger"})}finally{this.loadingQuota=!1}},async getSpeciesItems(){var a,s,c,r;try{const t=await this.getSpeciesList();let e=[];(a=t.data)!=null&&a.success&&Array.isArray(t.data.data)?e=t.data.data:Array.isArray(t.data)?e=t.data:(s=t.data)!=null&&s.data&&Array.isArray(t.data.data)&&(e=t.data.data),this.speciesOptions=[{value:"all",text:"All"}];const o=e.map(l=>({value:l.id,text:l.name}));this.speciesOptions=this.speciesOptions.concat(o)}catch(t){console.error("Error fetching species list:",t);const e=((r=(c=t.response)==null?void 0:c.data)==null?void 0:r.message)||t.message||"Failed to fetch species list";this.init({message:e,color:"danger"})}},async getAreas(){var a,s,c,r;try{const t=await this.getAreaList();let e=[];(a=t.data)!=null&&a.success&&Array.isArray(t.data.data)?e=t.data.data:Array.isArray(t.data)?e=t.data:(s=t.data)!=null&&s.data&&Array.isArray(t.data.data)&&(e=t.data.data),this.areasOptions=[{value:"all",text:"All"}];const o=e.map(l=>({value:l.id,text:l.name}));this.areasOptions=this.areasOptions.concat(o)}catch(t){console.error("Error fetching areas:",t);const e=((r=(c=t.response)==null?void 0:c.data)==null?void 0:r.message)||t.message||"Failed to fetch areas";this.init({message:e,color:"danger"})}}}}),B={key:0,class:"mb-8"},R={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},j={class:"flex items-center justify-between"},U={class:"text-2xl font-bold"},L={class:"flex items-center justify-between"},Y={class:"text-2xl font-bold"},W={class:"flex items-center justify-between"},G={class:"text-2xl font-bold"},H={class:"flex items-center justify-between"},K={class:"text-2xl font-bold"},X={class:"grid md:grid-cols-4 gap-6 mb-6"},Z={key:1,class:"mb-6"},J={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},tt={class:"text-lg font-semibold text-success"},et={class:"text-lg font-semibold text-warning"},at={class:"text-lg font-semibold text-danger"},st={class:"text-lg font-semibold text-info"},ot={key:2,class:"mt-6"},lt={key:3,class:"text-center py-8"};function it(a,s,c,r,t,e){const o=_("VaIcon"),l=_("VaCard"),m=_("VaSelect"),u=_("VaButton"),n=_("VaChip"),b=_("VaDataTable");return F(),V(l,{class:"w-full p-2"},{default:h(()=>[a.quotaStats?(F(),w("div",B,[s[10]||(s[10]=d("h3",{class:"va-h3 mb-4"},"Quota Summary Statistics",-1)),d("div",R,[f(l,{class:"p-4",color:"primary",gradient:""},{default:h(()=>[d("div",j,[d("div",null,[s[6]||(s[6]=d("p",{class:"text-sm opacity-80"},"Total Quota Balance",-1)),d("h3",U,y(a.quotaStats.total_quota_balance),1)]),f(o,{name:"bar_chart",size:"large"})])]),_:1}),f(l,{class:"p-4",color:"success",gradient:""},{default:h(()=>[d("div",L,[d("div",null,[s[7]||(s[7]=d("p",{class:"text-sm opacity-80"},"Available Quota",-1)),d("h3",Y,y(a.quotaStats.available_quota),1)]),f(o,{name:"check_circle",size:"large"})])]),_:1}),f(l,{class:"p-4",color:"warning",gradient:""},{default:h(()=>[d("div",W,[d("div",null,[s[8]||(s[8]=d("p",{class:"text-sm opacity-80"},"Confirmed",-1)),d("h3",G,y(a.quotaStats.confirmed),1)]),f(o,{name:"verified",size:"large"})])]),_:1}),f(l,{class:"p-4",color:"info",gradient:""},{default:h(()=>[d("div",H,[d("div",null,[s[9]||(s[9]=d("p",{class:"text-sm opacity-80"},"Utilisation Rate",-1)),d("h3",K,y(a.quotaStats.utilisation_percentage)+"%",1)]),f(o,{name:"trending_up",size:"large"})])]),_:1})])])):C("",!0),d("div",X,[f(m,{modelValue:a.area,"onUpdate:modelValue":[s[0]||(s[0]=p=>a.area=p),s[1]||(s[1]=p=>a.getAllSpeces())],placeholder:"Filter by Area",options:a.areasOptions,searchable:"","value-by":"value",label:"Area"},null,8,["modelValue","options"]),f(m,{modelValue:a.quota,"onUpdate:modelValue":[s[2]||(s[2]=p=>a.quota=p),s[3]||(s[3]=p=>a.getAllSpeces())],placeholder:"Filter by Quota year",options:a.yearOptions,"value-by":"value",label:"Quota year"},null,8,["modelValue","options"]),f(m,{modelValue:a.species,"onUpdate:modelValue":[s[4]||(s[4]=p=>a.species=p),s[5]||(s[5]=p=>a.getAllSpeces())],placeholder:"Filter by Species",options:a.speciesOptions,"value-by":"value",label:"Species"},null,8,["modelValue","options"]),f(u,{icon:"download",loading:a.downloading,disabled:!a.quotaStats,onClick:a.downloadPDF},{default:h(()=>[T(y(a.downloading?"Generating PDF...":"Download Report"),1)]),_:1},8,["loading","disabled","onClick"])]),a.quotaStats?(F(),w("div",Z,[s[15]||(s[15]=d("h4",{class:"va-h4 mb-3"},"Status Breakdown",-1)),d("div",J,[f(l,{class:"p-3 text-center"},{default:h(()=>[d("div",tt,y(a.quotaStats.confirmed),1),s[11]||(s[11]=d("div",{class:"text-sm opacity-70"},"Confirmed",-1))]),_:1}),f(l,{class:"p-3 text-center"},{default:h(()=>[d("div",et,y(a.quotaStats.provisioned),1),s[12]||(s[12]=d("div",{class:"text-sm opacity-70"},"Provisioned",-1))]),_:1}),f(l,{class:"p-3 text-center"},{default:h(()=>[d("div",at,y(a.quotaStats.cancelled),1),s[13]||(s[13]=d("div",{class:"text-sm opacity-70"},"Cancelled",-1))]),_:1}),f(l,{class:"p-3 text-center"},{default:h(()=>[d("div",st,y(a.quotaStats.taken),1),s[14]||(s[14]=d("div",{class:"text-sm opacity-70"},"Taken",-1))]),_:1})])])):C("",!0),a.detailedData.length>0?(F(),w("div",ot,[s[16]||(s[16]=d("h4",{class:"va-h4 mb-3"},"Detailed Quota Data",-1)),f(b,{items:a.detailedData,columns:a.columns,filter:a.filter,loading:a.loading},{"cell(provision_sales)":h(({value:p})=>[f(n,{color:"warning",size:"small"},{default:h(()=>[T(y(p),1)]),_:2},1024)]),"cell(confirmed)":h(({value:p})=>[f(n,{color:"success",size:"small"},{default:h(()=>[T(y(p),1)]),_:2},1024)]),"cell(cancelled)":h(({value:p})=>[f(n,{color:"danger",size:"small"},{default:h(()=>[T(y(p),1)]),_:2},1024)]),"cell(taken)":h(({value:p})=>[f(n,{color:"primary",size:"small"},{default:h(()=>[T(y(p),1)]),_:2},1024)]),_:1},8,["items","columns","filter","loading"])])):C("",!0),!a.loading&&!a.quotaStats&&!a.showMessage?(F(),w("div",lt,[f(o,{name:"info",size:"large",class:"mb-2"}),s[17]||(s[17]=d("p",{class:"text-lg"},"No quota data available for the selected filters",-1))])):C("",!0)]),_:1})}const ut=I(M,[["render",it],["__scopeId","data-v-aa7ccf75"]]);export{ut as default};
//# sourceMappingURL=QuotaPage-zMbzpSU1.js.map
