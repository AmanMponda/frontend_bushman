{"version":3,"file":"pdfDownloader-DiRJnS-k.js","sources":["../../src/utils/pdfDownloader.ts"],"sourcesContent":["const downloadPdf = async (base64OrUrl: string, filename = 'price-list-report.pdf') => {\n  if (!base64OrUrl) {\n    // eslint-disable-next-line no-console\n    console.warn('downloadPdf: no data provided')\n    return\n  }\n\n  try {\n    // If value looks like a URL, fetch it as blob and download\n    if (typeof base64OrUrl === 'string' && /^https?:\\/\\//i.test(base64OrUrl)) {\n      const res = await fetch(base64OrUrl)\n      if (!res.ok) throw new Error(`Failed to fetch PDF from URL (status ${res.status})`)\n      const blob = await res.blob()\n      const objectUrl = URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = objectUrl\n      a.download = filename\n      document.body.appendChild(a)\n      a.click()\n      a.remove()\n      URL.revokeObjectURL(objectUrl)\n      return\n    }\n\n    // If it contains a data: prefix, strip it\n    const cleaned = (base64OrUrl || '').replace(/^data:application\\/pdf;base64,/, '')\n\n    // Try to detect HTML payload (some backends return HTML reports encoded as base64)\n    let decoded: string | null = null\n    try {\n      decoded = atob(cleaned)\n    } catch (e) {\n      // atob can throw on huge payloads or non-base64 â€” we'll fallback to treating as base64 without decoding check\n      decoded = null\n    }\n\n    if (decoded && (decoded.includes('<!DOCTYPE') || decoded.includes('<html'))) {\n      // HTML content - download as .html\n      const blob = new Blob([decoded], { type: 'text/html' })\n      const url = URL.createObjectURL(blob)\n      const link = document.createElement('a')\n      link.href = url\n      link.download = filename.replace(/\\.pdf$/i, '.html')\n      document.body.appendChild(link)\n      link.click()\n      link.remove()\n      URL.revokeObjectURL(url)\n      return\n    }\n\n    // Otherwise assume PDF base64. Convert to byte array in chunks to avoid memory spikes\n    const b64 = cleaned\n    const sliceSize = 1024\n    const byteArrays: Uint8Array[] = []\n    for (let offset = 0; offset < b64.length; offset += sliceSize) {\n      const slice = b64.slice(offset, offset + sliceSize)\n      const byteChars = atob(slice)\n      const byteNumbers = new Array(byteChars.length)\n      for (let i = 0; i < byteChars.length; i++) {\n        byteNumbers[i] = byteChars.charCodeAt(i)\n      }\n      const byteArray = new Uint8Array(byteNumbers)\n      byteArrays.push(byteArray)\n    }\n\n    const blob = new Blob(byteArrays, { type: 'application/pdf' })\n    const objectUrl = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = objectUrl\n    a.download = filename\n    document.body.appendChild(a)\n    a.click()\n    a.remove()\n    URL.revokeObjectURL(objectUrl)\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('downloadPdf error:', err)\n  }\n}\n\nexport default downloadPdf\n"],"names":["downloadPdf","base64OrUrl","filename","res","blob","objectUrl","a","cleaned","decoded","url","link","b64","sliceSize","byteArrays","offset","slice","byteChars","byteNumbers","i","byteArray","err"],"mappings":"AAAA,MAAMA,EAAc,MAAOC,EAAqBC,EAAW,0BAA4B,CACrF,GAAI,CAACD,EAAa,CAEhB,QAAQ,KAAK,+BAA+B,EAC5C,MACF,CAEA,GAAI,CAEF,GAAI,OAAOA,GAAgB,UAAY,gBAAgB,KAAKA,CAAW,EAAG,CACxE,MAAME,EAAM,MAAM,MAAMF,CAAW,EACnC,GAAI,CAACE,EAAI,GAAI,MAAM,IAAI,MAAM,wCAAwCA,EAAI,MAAM,GAAG,EAClF,MAAMC,EAAO,MAAMD,EAAI,KAAA,EACjBE,EAAY,IAAI,gBAAgBD,CAAI,EACpCE,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAWJ,EACb,SAAS,KAAK,YAAYI,CAAC,EAC3BA,EAAE,MAAA,EACFA,EAAE,OAAA,EACF,IAAI,gBAAgBD,CAAS,EAC7B,MACF,CAGA,MAAME,GAAWN,GAAe,IAAI,QAAQ,iCAAkC,EAAE,EAGhF,IAAIO,EAAyB,KAC7B,GAAI,CACFA,EAAU,KAAKD,CAAO,CACxB,MAAY,CAEVC,EAAU,IACZ,CAEA,GAAIA,IAAYA,EAAQ,SAAS,WAAW,GAAKA,EAAQ,SAAS,OAAO,GAAI,CAE3E,MAAMJ,EAAO,IAAI,KAAK,CAACI,CAAO,EAAG,CAAE,KAAM,YAAa,EAChDC,EAAM,IAAI,gBAAgBL,CAAI,EAC9BM,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWR,EAAS,QAAQ,UAAW,OAAO,EACnD,SAAS,KAAK,YAAYQ,CAAI,EAC9BA,EAAK,MAAA,EACLA,EAAK,OAAA,EACL,IAAI,gBAAgBD,CAAG,EACvB,MACF,CAGA,MAAME,EAAMJ,EACNK,EAAY,KACZC,EAA2B,CAAA,EACjC,QAASC,EAAS,EAAGA,EAASH,EAAI,OAAQG,GAAUF,EAAW,CAC7D,MAAMG,EAAQJ,EAAI,MAAMG,EAAQA,EAASF,CAAS,EAC5CI,EAAY,KAAKD,CAAK,EACtBE,EAAc,IAAI,MAAMD,EAAU,MAAM,EAC9C,QAASE,EAAI,EAAGA,EAAIF,EAAU,OAAQE,IACpCD,EAAYC,CAAC,EAAIF,EAAU,WAAWE,CAAC,EAEzC,MAAMC,EAAY,IAAI,WAAWF,CAAW,EAC5CJ,EAAW,KAAKM,CAAS,CAC3B,CAEA,MAAMf,EAAO,IAAI,KAAKS,EAAY,CAAE,KAAM,kBAAmB,EACvDR,EAAY,IAAI,gBAAgBD,CAAI,EACpCE,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAWJ,EACb,SAAS,KAAK,YAAYI,CAAC,EAC3BA,EAAE,MAAA,EACFA,EAAE,OAAA,EACF,IAAI,gBAAgBD,CAAS,CAC/B,OAASe,EAAK,CAEZ,QAAQ,MAAM,qBAAsBA,CAAG,CACzC,CACF"}