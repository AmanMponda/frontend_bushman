import{d as B,_ as O,g as v,e as o,v as k,h as d,t as c,o as r,m as F,l as M,s as R,B as H,a as C,w as i,b as s,i as l,F as N,q}from"./index-D35lDKvM.js";import{u as E}from"./contracts-store-D4cG_QqQ.js";import{d as G}from"./pdfDownloader-Cg_wDO9M.js";import{f as L}from"./utils-BWc0LXoO.js";import{u as Y}from"./useForm-BgfHwkqf.js";import{u as K}from"./useToast-CJAf_JXJ.js";import{u as U}from"./sales-store-BGGms5Xm.js";import{h as Q}from"./errorHandler-DijQ3xmc.js";import"./format-Cn4G_mmc.js";const J=B({props:{contractItem:{type:Object,required:!0}},setup(){return{formatDateTime:L}}}),W={class:"contract-details"},X={class:"contract-info"},Z={class:"info-item"},x={class:"info-item"},tt={class:"info-item"},et={class:"info-item"},ot={class:"info-item"},nt={class:"info-item"},st={key:0,class:"sales-confirmation"},at={class:"proposal-info"},lt={class:"info-item"},it={class:"info-item"},rt={class:"info-item"},dt={key:1,class:"client-info"},mt={class:"info-item"},ct={class:"info-item"},ut={class:"info-item"},pt={key:2,class:"price-breakdown"};function ft(t,e,a,p,w,I){var u,g,b,f,V,_,y,h,D,S,A,m,T,n,$,P,j,z;return r(),v("div",W,[e[17]||(e[17]=o("h1",{class:"contract-title"},"Contract Details",-1)),o("div",X,[o("div",Z,[e[0]||(e[0]=o("strong",null,"Contract Number:",-1)),d(" "+c(((u=t.contractItem)==null?void 0:u.contract_number)||"N/A"),1)]),o("div",x,[e[1]||(e[1]=o("strong",null,"Description:",-1)),d(" "+c(((g=t.contractItem)==null?void 0:g.description)||"N/A"),1)]),o("div",tt,[e[2]||(e[2]=o("strong",null,"Start Date:",-1)),d(" "+c(t.formatDateTime((b=t.contractItem)==null?void 0:b.start_date)||"N/A"),1)]),o("div",et,[e[3]||(e[3]=o("strong",null,"End Date:",-1)),d(" "+c(t.formatDateTime((f=t.contractItem)==null?void 0:f.end_date)||"N/A"),1)]),o("div",ot,[e[4]||(e[4]=o("strong",null,"Created At:",-1)),d(" "+c(t.formatDateTime((V=t.contractItem)==null?void 0:V.created_at)||"N/A"),1)]),o("div",nt,[e[5]||(e[5]=o("strong",null,"Updated At:",-1)),d(" "+c(t.formatDateTime((_=t.contractItem)==null?void 0:_.updated_at)||"N/A"),1)])]),(y=t.contractItem)!=null&&y.sales_confirmation_proposal?(r(),v("section",st,[e[9]||(e[9]=o("h2",null,"Sales Confirmation Proposal",-1)),o("div",at,[o("div",lt,[e[6]||(e[6]=o("strong",null,"Sales Inquiry ID:",-1)),d(" "+c(((h=t.contractItem.sales_confirmation_proposal.sales_inquiry)==null?void 0:h.id)||"N/A"),1)]),o("div",it,[e[7]||(e[7]=o("strong",null,"Preferred Date:",-1)),d(" "+c(t.formatDateTime((D=t.contractItem.sales_confirmation_proposal.preference)==null?void 0:D.preferred_date)||"N/A"),1)]),o("div",rt,[e[8]||(e[8]=o("strong",null,"Area:",-1)),d(" "+c(((S=t.contractItem.sales_confirmation_proposal.area)==null?void 0:S.length)>0?(m=(A=t.contractItem.sales_confirmation_proposal.area[0])==null?void 0:A.area)==null?void 0:m.name:"N/A"),1)])])])):k("",!0),(T=t.contractItem)!=null&&T.entity?(r(),v("section",dt,[e[13]||(e[13]=o("h2",null,"Client Information",-1)),o("div",mt,[e[10]||(e[10]=o("strong",null,"Full Name:",-1)),d(" "+c(t.contractItem.entity.full_name||"N/A"),1)]),o("div",ct,[e[11]||(e[11]=o("strong",null,"Country:",-1)),d(" "+c(((n=t.contractItem.entity.country)==null?void 0:n.name)||"N/A"),1)]),o("div",ut,[e[12]||(e[12]=o("strong",null,"Email:",-1)),d(" "+c(((P=($=t.contractItem.entity.contacts)==null?void 0:$[0])==null?void 0:P.contact)||"N/A"),1)])])):k("",!0),t.contractItem.price_break_down?(r(),v("section",pt,[e[16]||(e[16]=o("h2",null,"Price Breakdown",-1)),o("div",null,[e[14]||(e[14]=o("strong",null,"Total Amount:",-1)),d(" "+c((j=t.contractItem.price_break_down.total_amount.currency)==null?void 0:j.symbol)+c(t.contractItem.price_break_down.total_amount.amount||"N/A"),1)]),o("div",null,[e[15]||(e[15]=o("strong",null,"Number of Companions:",-1)),d(" "+c(((z=t.contractItem.price_break_down.companion_cost_details)==null?void 0:z.number_of_companions)||"N/A"),1)])])):k("",!0)])}const gt=O(J,[["render",ft],["__scopeId","data-v-4a9ee03d"]]),yt=B({setup(){const{init:t}=K(),e=R(null),{isValid:a,validate:p,resetValidation:w,reset:I}=Y(e),u=R(!0),g=f=>{console.log(f),(f.value=="prior"||f.value=="after")&&(u.value=!1)},b=H({proposal:null,enity_id:null,start_date:null,end_date:null,description:"",doc_type:null,documents:[],uploadedDocuments:[]});return{iformRef:e,isValidForm:a,validateForm:p,resetValidationForm:w,resetForm:I,form:b,init:t,onInputChange:g,isNotUpBookingSelected:u}},data(){const t=[{icon:"feed",title:"Main Hunter ",content:"main_hunter_contract"},{icon:"feed",title:"Companion Hunter ",content:"companion_contract"}];return{packages:[],installments:[],regulatoryPackages:[],proposalOptions:[],documentTypes:[{text:"Travel Packet (Passport Copy)",value:"Passport_Copy"},{text:"Travel Packet (Passport Photo)",value:"Passport_Photo"},{text:"Visa",value:"Visa"},{text:"Gun Permits",value:"Gun_Permits"},{text:"CITES Documentation",value:"CITES_Documentation"},{text:"Sales Invoice",value:"sales_invoice"},{text:"Receipt",value:"receipt"}],loadingSales:!1,salesItem:null,tabs:t,value:t[0].title}},computed:{...M(U,["companions"]),currentTab(){return this.tabs.find(({title:t})=>t===this.value)}},mounted(){this.getSalesProposalOptions()},methods:{...F(E,["createContract"]),...F(U,["getallSalesConfirmation"]),...F(U,["getCompanions"]),onValueChange(t){if(!t)return;const e=t.selfitem||t;console.log("Selected proposal full object:",e),this.salesItem=e,e!=null&&e.id?(console.log("Fetching companions for sales_confirmation_id:",e.id),this.getCompanions(e.id,!0).then(a=>{var p;((p=a==null?void 0:a.response)==null?void 0:p.status)===404&&(console.warn("Companions endpoint returned 404 - no companions available or endpoint not found"),this.init({message:"Could not load companions list. You can still create a contract without a companion.",color:"warning"}))}).catch(a=>{console.warn("Error fetching companions:",a)})):console.warn("Missing proposal ID for fetching companions")},async onSubmit(){var w,I,u,g,b,f,V;let t=null,e=null;this.form.proposal&&(typeof this.form.proposal=="object"&&this.form.proposal.value?(t=this.form.proposal.value,e=this.form.proposal.selfitem):typeof this.form.proposal=="number"&&(t=this.form.proposal));let a=null;if(((w=this.currentTab)==null?void 0:w.content)==="companion_contract"?this.form.enity_id?typeof this.form.enity_id=="object"&&this.form.enity_id.value?a=this.form.enity_id.value:typeof this.form.enity_id=="number"&&(a=this.form.enity_id):a=((u=(I=e==null?void 0:e.sales_inquiry)==null?void 0:I.entity)==null?void 0:u.id)||null:a=((b=(g=e==null?void 0:e.sales_inquiry)==null?void 0:g.entity)==null?void 0:b.id)||null,!t){this.init({message:"Sales confirmation is required",color:"warning"});return}if(!e||!e.id){this.init({message:"Invalid sales confirmation selected. Please select again from the list.",color:"warning"});return}if(!this.form.start_date||!this.form.end_date){this.init({message:"Start date and end date are required",color:"warning"});return}if(!a){this.init({message:"Entity information is missing. Please select a valid sales confirmation.",color:"warning"});return}if(new Date(this.form.start_date)>=new Date(this.form.end_date)){this.init({message:"End date must be after start date",color:"warning"});return}const p={sales_confirmation_proposal_id:t,entity_id:a,start_date:this.form.start_date,end_date:this.form.end_date,contractor_type:((f=this.currentTab)==null?void 0:f.content)==="companion_contract"?"COMPANION_HUNTER":"MAIN_HUNTER",description:this.form.description};console.log("Form submission data:",p),console.log("Selected proposal object:",e);try{(await this.createContract(p)).status===201&&(this.init({message:"Contract created successfully",color:"success"}),this.resetForm(),this.resetValidationForm())}catch(_){const y=(V=_.response)==null?void 0:V.data,h=(y==null?void 0:y.error)||(y==null?void 0:y.message)||"";if(h.includes("Duplicate entry")||h.includes("constraint"))this.init({message:"A contract already exists for this sales confirmation and client combination. Please select a different sales confirmation to create a new contract.",color:"danger"});else if(h.includes("FOREIGN KEY"))this.init({message:"The selected sales confirmation is no longer available. Please refresh and select a different one.",color:"danger"}),this.getSalesProposalOptions();else{const D=Q(_.response);this.init({message:`
`+D.map((S,A)=>`${A+1}. ${S}`).join(`
`),color:"danger"})}}},async getSalesProposalOptions(){var e;this.loadingSales=!0;const t=await this.getallSalesConfirmation();if(t&&t.status===200){this.loadingSales=!1;const a=Array.isArray(t.data)?t.data:((e=t.data)==null?void 0:e.data)||[];this.proposalOptions=a.filter(p=>p&&p.id).map(p=>{var u,g;const w=((g=(u=p.sales_inquiry)==null?void 0:u.entity)==null?void 0:g.full_name)||p.client_name||"Unknown Client";return{text:`#${p.id} - ${w}`,value:p.id,selfitem:p}})}else this.loadingSales=!1},addDocument(){if(this.form.doc_type&&this.form.documents.length>0){const t=this.form.doc_type.text||this.form.doc_type;this.form.uploadedDocuments.push({type:t,file:this.form.documents[0]}),this.form.doc_type=null,this.form.documents=[],this.init({message:"Document added successfully",color:"success"})}},removeDocument(t){this.form.uploadedDocuments.splice(t,1),this.init({message:"Document removed",color:"info"})}}}),ht={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},bt={key:1,class:"text-sm text-warning italic"},Ct={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},_t={class:"grid grid-cols-1 md:grid-cols-1 gap-4 mb-4"},vt={class:"mb-4 border-t pt-4"},Vt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},kt={key:0,class:"mt-4"},wt={class:"space-y-2"},Tt={class:"flex justify-end"};function It(t,e,a,p,w,I){const u=l("VaIcon"),g=l("VaTab"),b=l("VaCardTitle"),f=l("VaSelect"),V=l("VaDateInput"),_=l("VaTextarea"),y=l("VaFileUpload"),h=l("VaButton"),D=l("VaForm"),S=l("VaCardContent"),A=l("VaCard"),m=l("VaTabs"),T=l("VaInnerLoading");return r(),C(T,{loading:t.loadingSales},{default:i(()=>[s(m,{modelValue:t.value,"onUpdate:modelValue":e[8]||(e[8]=n=>t.value=n),vertical:"",grow:""},{tabs:i(()=>[(r(!0),v(N,null,q(t.tabs,n=>(r(),C(g,{key:n.title,name:n.title},{default:i(()=>[s(u,{name:n.icon,size:"small",class:"mr-2"},null,8,["name"]),d(" "+c(n.title),1)]),_:2},1032,["name"]))),128))]),default:i(()=>[s(A,{square:"",outlined:""},{default:i(()=>[s(b,{class:"mb-4"},{default:i(()=>[d(c(t.currentTab.title),1)]),_:1}),s(S,null,{default:i(()=>[s(D,{ref:"iformRef"},{default:i(()=>[o("div",ht,[s(f,{modelValue:t.form.proposal,"onUpdate:modelValue":[e[0]||(e[0]=n=>t.form.proposal=n),t.onValueChange],options:t.proposalOptions,rules:[n=>n||"Sales confirmation is required"],placeholder:"Select confirmation ",label:"Choose sales confirmation"},null,8,["modelValue","options","rules","onUpdate:modelValue"]),t.currentTab.content==="companion_contract"?(r(),C(f,{key:0,modelValue:t.form.enity_id,"onUpdate:modelValue":e[1]||(e[1]=n=>t.form.enity_id=n),options:t.companions,placeholder:"Select companion (optional)",label:"Choose companion",clearable:""},null,8,["modelValue","options"])):k("",!0),t.currentTab.content==="companion_contract"&&t.companions.length===0?(r(),v("div",bt," Companion list unavailable. The contract will use the main client from the sales confirmation. ")):k("",!0)]),o("div",Ct,[s(V,{modelValue:t.form.start_date,"onUpdate:modelValue":e[2]||(e[2]=n=>t.form.start_date=n),placeholder:"Choose start date",rules:[n=>n||"Start date is required"],label:"Start Date"},null,8,["modelValue","rules"]),s(V,{modelValue:t.form.end_date,"onUpdate:modelValue":e[3]||(e[3]=n=>t.form.end_date=n),placeholder:"Choose End date",rules:[n=>n||"End date is required"],label:"End  Date"},null,8,["modelValue","rules"])]),o("div",_t,[s(_,{modelValue:t.form.description,"onUpdate:modelValue":e[4]||(e[4]=n=>t.form.description=n),"max-length":"125",label:"Short text about something",counter:"","required-mark":"",rules:[n=>n&&n.length>0||"Required",n=>n&&n.length<125]},null,8,["modelValue","rules"])]),o("div",vt,[e[11]||(e[11]=o("h3",{class:"text-lg font-semibold mb-4"},"Supporting Documents",-1)),o("div",Vt,[s(f,{modelValue:t.form.doc_type,"onUpdate:modelValue":e[5]||(e[5]=n=>t.form.doc_type=n),options:t.documentTypes,placeholder:"Select document type",label:"Document Type",searchable:"","highlight-matched-text":""},null,8,["modelValue","options"]),s(y,{modelValue:t.form.documents,"onUpdate:modelValue":e[6]||(e[6]=n=>t.form.documents=n),"upload-button-text":"Upload Document",color:"secondary",label:"Upload Document",dropzone:"",undo:"",size:"50mb","file-types":"image/jpeg, image/png, image/pdf, application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","undo-duration":"500","max-files":1},null,8,["modelValue"])]),s(h,{icon:"add",size:"small",color:"secondary",disabled:!t.form.doc_type||t.form.documents.length===0,onClick:t.addDocument},{default:i(()=>e[9]||(e[9]=[d(" Add Document ")])),_:1},8,["disabled","onClick"]),t.form.uploadedDocuments.length>0?(r(),v("div",kt,[e[10]||(e[10]=o("h4",{class:"font-semibold mb-2"},"Added Documents:",-1)),o("div",wt,[(r(!0),v(N,null,q(t.form.uploadedDocuments,(n,$)=>(r(),v("div",{key:$,class:"flex items-center justify-between bg-gray-100 p-3 rounded"},[o("span",null,c(n.type)+": "+c(n.file.name),1),s(h,{preset:"plain",icon:"delete",size:"small",color:"danger",onClick:P=>t.removeDocument($)},null,8,["onClick"])]))),128))])])):k("",!0)]),o("div",Tt,[s(h,{disabled:!t.isValidForm,onClick:e[7]||(e[7]=n=>t.validateForm()&&t.onSubmit())},{default:i(()=>e[12]||(e[12]=[d(" Submit")])),_:1},8,["disabled"])])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["loading"])}const Dt=O(yt,[["render",It],["__scopeId","data-v-d31c9607"]]),St=B({components:{ContractDetails:gt,ContractForm:Dt},data(){const t=[{icon:"feed",title:"Main Hunter's ",content:"main_hunters_contracts"},{icon:"feed",title:"Componions ",content:"componions_contracts"}];return{columns:[{key:"contract_number",sortable:!0},{key:"client_name",sortable:!0},{key:"start_date",sortable:!0},{key:"end_date",sortable:!0},{key:"created_at",sortable:!0},{key:"actions",label:"Actions"}],item:null,showDetails:!1,showAddContractForm:!1,tabs:t,value:t[0].title}},computed:{...M(E,["contracts","loadingContracts"]),currentTab(){return this.tabs.find(({title:t})=>t===this.value)}},mounted(){this.getContracts()},methods:{...F(E,["getContracts"]),async downloadPdf(t){if(!t){alert("PDF is not available for this contract yet.");return}try{await G(t,"contract.pdf")}catch(e){console.error("PDF download error:",e);const a=(e==null?void 0:e.message)||"Unknown error";a.includes("500")?alert(`The PDF generation service is temporarily unavailable.

Please try again in a few moments. If the problem persists, contact support.`):a.includes("404")?alert("The PDF file was not found on the server. The contract may not have been processed yet."):alert(`Failed to download PDF. Please try again or contact support.

Error: `+a)}},viewContract(t){this.item=t,this.showDetails=!0,this.showAddContractForm=!1},gotBack(){this.getContracts(),this.showDetails=!1,this.showAddContractForm=!1},toggleAddSalesInquiriesForm(){this.showDetails=!1,this.showAddContractForm=!this.showAddContractForm}}}),At={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between px-4 py-2"},$t={class:"flex flex-col md:flex-row gap-2 justify-start"};function Ft(t,e,a,p,w,I){const u=l("VaButton"),g=l("VaButtonGroup"),b=l("VaIcon"),f=l("VaTab"),V=l("VaCardTitle"),_=l("VaDataTable"),y=l("VaCardContent"),h=l("VaCard"),D=l("VaTabs"),S=l("ContractForm"),A=l("ContractDetails");return r(),C(h,null,{default:i(()=>[s(y,null,{default:i(()=>[o("div",At,[o("div",$t,[t.showDetails||t.showAddContractForm?(r(),C(u,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e[0]||(e[0]=m=>t.gotBack())},{default:i(()=>e[4]||(e[4]=[d(" Go Back ")])),_:1})):k("",!0)]),!t.showAddContractForm&&!t.showDetails?(r(),C(g,{key:0},{default:i(()=>[s(u,{class:"px-2 py-2",color:"primary",label:"Add New Quota",round:"",present:"secondary","border-color":"primary",icon:"add",size:"small",onClick:e[1]||(e[1]=m=>t.toggleAddSalesInquiriesForm())},{default:i(()=>e[5]||(e[5]=[d("Create Contract")])),_:1})]),_:1})):k("",!0)]),t.showDetails?(r(),C(A,{key:1,"contract-item":t.item},null,8,["contract-item"])):(r(),v(N,{key:0},[t.showAddContractForm?(r(),C(S,{key:1})):(r(),C(D,{key:0,modelValue:t.value,"onUpdate:modelValue":e[3]||(e[3]=m=>t.value=m),vertical:"",grow:""},{tabs:i(()=>[(r(!0),v(N,null,q(t.tabs,m=>(r(),C(f,{key:m.title,name:m.title,class:"px-4 py-2",onClick:e[2]||(e[2]=T=>t.getContracts(t.currentTab.content==="componions_contracts"?"COMPANION_HUNTER":"MAIN_HUNTER"))},{default:i(()=>[s(b,{name:m.icon,size:"small",class:"mr-2"},null,8,["name"]),d(" "+c(m.title),1)]),_:2},1032,["name"]))),128))]),default:i(()=>[s(h,{square:"",outlined:"",stripe:!1},{default:i(()=>[s(V,null,{default:i(()=>[s(b,{name:t.currentTab.icon,size:"small",class:"mr-2",color:"background-element"},null,8,["name"]),d(" "+c(t.currentTab.title),1)]),_:1}),s(y,null,{default:i(()=>[t.currentTab.content==="main_hunters_contracts"?(r(),C(_,{key:0,items:t.contracts,columns:t.columns,loading:t.loadingContracts},{"cell(actions)":i(({rowData:m})=>[s(u,{preset:"plain",icon:"download",disabled:!m.pdf,onClick:T=>t.downloadPdf(m.pdf)},null,8,["disabled","onClick"]),s(u,{preset:"plain",icon:"visibility",onClick:T=>t.viewContract(m.selfitem)},null,8,["onClick"])]),_:1},8,["items","columns","loading"])):k("",!0),t.currentTab.content==="componions_contracts"?(r(),C(_,{key:1,items:t.contracts,columns:t.columns,loading:t.loadingContracts},{"cell(actions)":i(({rowData:m})=>[s(u,{preset:"plain",icon:"download",disabled:!m.pdf,onClick:T=>t.downloadPdf(m.pdf)},null,8,["disabled","onClick"]),s(u,{preset:"plain",icon:"visibility",onClick:T=>t.viewContract(m.selfitem)},null,8,["onClick"])]),_:1},8,["items","columns","loading"])):k("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))],64))]),_:1})]),_:1})}const Rt=O(St,[["render",Ft]]);export{Rt as default};
//# sourceMappingURL=Contracts-Dn1lbv0z.js.map
