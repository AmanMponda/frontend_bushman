import{j as m,k as i}from"./index-Dg6zTblr.js";import{f as o}from"./utils-BWc0LXoO.js";import{f as c}from"./format-Cn4G_mmc.js";const h=m("sales_contracts",{state:()=>({contracts:[],loadingContracts:!1,permits:[],loadingPermits:!1}),actions:{async getContracts(a="MAIN_HUNTER"){this.loadingContracts=!0;const n={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/contracts"+(a?`?contractor_type=${a}`:""),headers:{"Content-Type":"application/json"}};try{const t=await i.request(n);if(t.status===200){let s=[];return t.data.data&&Array.isArray(t.data.data)?s=t.data.data:Array.isArray(t.data)?s=t.data:t.data.value&&Array.isArray(t.data.value)&&(s=t.data.value),this.contracts=s.map(e=>{var d,l,p;const _=((d=e.entity)==null?void 0:d.full_name)||((p=(l=e.sales_confirmation_proposal)==null?void 0:l.client)==null?void 0:p.full_name)||e.client_name||"Unknown Client";return{id:e.id,contract_number:e.contract_number,start_date:o(e.start_date),end_date:o(e.end_date),created_at:o(e.created_at),updated_at:o(e.updated_at),description:e.description,sales_confirmation_proposal_id:e.sales_confirmation_proposal_id,entity_id:e.entity_id,contractor_type:e.contractor_type,client_name:_,pdf:e.pdf,entity:e.entity,sales_confirmation_proposal:e.sales_confirmation_proposal,selfitem:e}}),this.loadingContracts=!1,t}return console.log(this.contracts),t}catch(t){return this.loadingContracts=!1,console.log(t),t}},async getContractPermits(){const r={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/entity-contract-permit-vset/",headers:{"Content-Type":"application/json"}},n=await i.request(r);if(n.status===200)return this.permits=n.data.map(t=>({permit_number:t.permit_number,issued_date:o(t.issued_date),description:t.description,start_date:o(t.dates[0].start_date),expiry_date:o(t.dates[0].end_date),updated_at:o(t.updated_at),entity_contract_id:t.entity_contract_id,package_type:t.package_type,pdf:t.pdf,selfitem:t})),this.loadingPermits=!1,n},async createPermit(a){const r="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/entity-contract-permit-vset/",n=JSON.stringify({entity_contract_id:a.entity_contract_id,permit_number:a.permit_number,issued_date:c(a.issued_date,"yyyy-MM-dd"),package_type:a.package_type,description:a.description,start_date:c(a.start_date,"yyyy-MM-dd"),end_date:c(a.end_date,"yyyy-MM-dd")}),t={method:"post",maxBodyLength:1/0,url:r,headers:{"Content-Type":"application/json"},data:n};return await i.request(t)},async createContract(a){var s;const r="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/contract-vset/",n={sales_confirmation_proposal_id:a.sales_confirmation_proposal_id,entity_id:a.entity_id||null,contractor_type:null,description:a.description||""};console.log("Creating contract with payload:",n);const t={method:"post",maxBodyLength:1/0,url:r,headers:{"Content-Type":"application/json"},data:JSON.stringify(n)};try{return await i.request(t)}catch(e){throw console.error("Contract creation error:",(s=e.response)==null?void 0:s.data),e}},async deleteContractById(a){var t,s;const r="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/contracts/"+a+"/";console.log("Attempting to delete contract at URL:",r);const n={method:"delete",maxBodyLength:1/0,url:r,headers:{"Content-Type":"application/json"}};try{const e=await i.request(n);return console.log("Contract deleted successfully:",e),e}catch(e){throw console.error("Contract deletion error - Status:",(t=e.response)==null?void 0:t.status),console.error("Contract deletion error - Data:",(s=e.response)==null?void 0:s.data),console.error("Contract deletion error - Full error:",e),e}}}});export{h as u};
//# sourceMappingURL=contracts-store-BRTk1SGi.js.map
