import{j as b,k as o}from"./index-ChBN8f7M.js";import{f as k}from"./utils-BWc0LXoO.js";import{f as q}from"./format-Cn4G_mmc.js";const S=b("sales_inquiries",{state:()=>({salesInquiries:[],results:[],loadingresults:!1,priceBreakDown:null,addCompanions:!1,observers:[],showObserversModal:!1,showCompanionsModal:!1,companions:[],savingSafariExtras:!1,clientSafariExtras:[],showSafariExtrasModal:!1,showAccommodationModal:!1,accommodations:[],chartersPrices:[],showChartersPriceModal:!1,savingCharterPrices:!1,loadingCharterPrices:!1}),actions:{async getSalesInquiries(s,e){const t=e?q(new Date(e),"yyyy-MM-dd"):"",a={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales/sales-inquiries/?season_id="+s+"&preferred_date="+t,headers:{"Content-Type":"application/json"}};return await o.request(a)},async createSalesInquiry(s){const t={method:"post",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales/sales-inquiries/",headers:{"Content-Type":"application/json"},data:JSON.stringify(s)};return await o.request(t)},async updateSalesInquiry(s,e){const n={method:"put",maxBodyLength:1/0,url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales/sales-inquiries/${s}/`,headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};try{return await o.request(n)}catch(a){throw console.error("Error updating sales inquiry:",a),a}},async deleteSalesInquiry(s){const t={method:"delete",maxBodyLength:1/0,url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales/sales-inquiries/${s}/`,headers:{"Content-Type":"application/json"}};try{return await o.request(t)}catch(n){throw console.error("Error deleting sales inquiry:",n),n}},async getallSalesConfirmation(){this.loadingresults=!0;const s="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-vset/";console.log("API URL:",s);const e={method:"get",maxBodyLength:1/0,url:s,headers:{"Content-Type":"application/json"}};try{const t=await o.request(e);console.log("Full API Response:",t);let n=[];return t.data&&t.data.data?n=t.data.data:Array.isArray(t.data)&&(n=t.data),console.log("Extracted data:",n),n&&Array.isArray(n)&&n.length>0?(console.log(`Found ${n.length} sales confirmations`),this.loadingresults=!1,this.results=n.map((a,r)=>{var i,l,u,d,p,f,y,_,g,m,v,x;console.log(`Processing item ${r}:`,a);const c=h=>{if(!h||h==="N/A")return"N/A";try{return new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return h}};return{client:((l=(i=a==null?void 0:a.sales_inquiry)==null?void 0:i.entity)==null?void 0:l.full_name)||(a==null?void 0:a.client_name)||"Client "+(r+1),code:((u=a==null?void 0:a.sales_inquiry)==null?void 0:u.code)||(a==null?void 0:a.sales_inquiry_code)||`SC-${(a==null?void 0:a.id)||r+1}`,area:((y=(f=(p=(d=a==null?void 0:a.sales_inquiry)==null?void 0:d.area)==null?void 0:p[0])==null?void 0:f.area)==null?void 0:y.name)||(a==null?void 0:a.area_name)||"Unknown Area",airport:((_=a==null?void 0:a.itinerary)==null?void 0:_.airport_name)||(a==null?void 0:a.airport_name)||"N/A",arrival:c(((g=a==null?void 0:a.itinerary)==null?void 0:g.arrival)||(a==null?void 0:a.arrival)),charter_in:c(((m=a==null?void 0:a.itinerary)==null?void 0:m.charter_in)||(a==null?void 0:a.charter_in)),charter_out:c(((v=a==null?void 0:a.itinerary)==null?void 0:v.charter_out)||(a==null?void 0:a.charter_out)),status:((x=a==null?void 0:a.status)==null?void 0:x.status)||(a==null?void 0:a.status)||"pending",pdf:(a==null?void 0:a.pdf)||(a==null?void 0:a.document_url)||null,id:(a==null?void 0:a.id)||r+1,created_date:(a==null?void 0:a.created_date)||(a==null?void 0:a.created_at),updated_at:a==null?void 0:a.updated_at,selfitem:a}}),console.log("Formatted Results:",this.results),t):(console.warn("No data or empty array received from API"),this.loadingresults=!1,this.results=[],t)}catch(t){throw console.error("Error fetching sales confirmations:",t),this.loadingresults=!1,this.results=[],t}},async getSalesConfirmationProposals(){this.loadingresults=!0;const s="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals/";console.log("Fetching proposals from API URL:",s);const e={method:"get",maxBodyLength:1/0,url:s,headers:{"Content-Type":"application/json"}};try{const t=await o.request(e);console.log("Sales Confirmation Proposals Response:",t);let n=[];return t.data&&t.data.data?n=t.data.data:Array.isArray(t.data)&&(n=t.data),console.log("Extracted proposals data:",n),console.log("First proposal structure:",n&&n[0]?JSON.stringify(n[0],null,2):"No data"),this.loadingresults=!1,n&&Array.isArray(n)?(console.log(`Found ${n.length} sales confirmation proposals`),{status:200,data:n}):(console.warn("No proposals data received from API"),{status:200,data:[]})}catch(t){throw console.error("Error fetching sales confirmation proposals:",t),this.loadingresults=!1,t}},async createSalesConfirmationFinalization(s){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-vset/",t=JSON.stringify({sales_inquiry_id:s.salesInquiryId,package_id:s.packageId,airport_name:s.airportName,charter_in:s.charterIn,charter_out:s.charterOut,arrival:s.arrival,installments:s.installments,regulatory_package_id:s.regulatoryPackageId}),n={method:"post",maxBodyLength:1/0,url:e,headers:{"Content-Type":"application/json"},data:t};return await o.request(n)},async getSalesPriceBreakdown(s){const t={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-price-break-down/?package_id="+s.packageId+"&sales_inquiry_id="+s.salesInquiryId,headers:{"Content-Type":"application/json"}};try{const n=await o.request(t);return this.priceBreakDown=n.data,n}catch(n){return console.log(n),n}},async updatesalesConfirmationStatus(s){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-status-vset/",t=new FormData;t.append("doc_type_id",s.docTypeId),t.append("entity_id",s.entityId),t.append("contract_doc",s.contractDoc),t.append("payment_doc",s.paymentDoc),t.append("sales_confirmation_proposal_id",s.salesConfirmationProposalId),t.append("status_id",s.statusId),t.append("area_id",s.areaId),t.append("quota_id",s.quotaId);const n={method:"patch",maxBodyLength:1/0,url:e,headers:{"Content-Type":"multipart/form-data"},data:t};return await o.request(n)},async createSalesConfirmationProposalObservers(s){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-proposal-observers-vset/",t={full_name:s.fullName,nationality_id:s.nationalityId,country_id:s.countryId,identity_number:s.identityNumber,sales_inquiry_id:s.salesInquiryId,contacts:s.contacts,charter_in:s.charter_in,charter_out:s.charter_out,arrival_airport:s.arrival_airport},n=JSON.stringify(t),a={method:"post",maxBodyLength:1/0,url:e,headers:{"Content-Type":"application/json"},data:n},r=await o.request(a);return r.status===201&&(this.addCompanions=!0,this.showObserversModal=!1),r},async getObservers(s){const t={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-proposal-observers-vset/?sales_inquiry_id="+s,headers:{"Content-Type":"application/json"}};try{const n=await o.request(t);return n.status===200&&(this.observers=n.data.map(a=>({id:a.id,full_name:a.observer.full_name,nationality:a.observer.nationality.name}))),n}catch(n){return console.log(n),n}},async createSalesConfirmationCompanion(s){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-companion-vset/",t={full_name:s.fullName,nationality_id:s.nationalityId,country_id:s.countryId,identity_number:s.identityNumber,sales_inquiry_id:s.salesInquiryId,regulatory_package_id:s.regulatoryPackageId,contacts:s.contacts,charter_in:s.charter_in,arrival_airport:s.arrival_airport,charter_out:s.charter_out},n=JSON.stringify(t),a={method:"post",maxBodyLength:1/0,url:e,headers:{"Content-Type":"application/json"},data:n},r=await o.request(a);return r.status===201&&(this.addCompanions=!0,this.showCompanionsModal=!1),r},async getCompanions(s,e=!1){let t="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-companion-vset/";const n=[];typeof s=="object"?(s.entity_id&&n.push("entity_id="+s.entity_id),s.sales_confirmation_id&&n.push("sales_confirmation_id="+s.sales_confirmation_id)):n.push("sales_confirmation_id="+s),n.length>0&&(t+="?"+n.join("&"));const a={method:"get",maxBodyLength:1/0,url:t,headers:{"Content-Type":"application/json"}};try{const r=await o.request(a);console.log("Companions response:",r);let c=[];return r.data.value&&Array.isArray(r.data.value)?c=r.data.value:r.data.data&&Array.isArray(r.data.data)?c=r.data.data:Array.isArray(r.data)&&(c=r.data),console.log("Extracted companions data:",c),e===!1?(r.status===200&&(this.companions=c.map(i=>{var l,u,d;return{id:i.id,full_name:((l=i.companion)==null?void 0:l.full_name)||i.full_name,nationality:((d=(u=i.companion)==null?void 0:u.nationality)==null?void 0:d.name)||i.nationality}})),r):(this.companions=c.map(i=>{var l,u;return{text:((l=i.companion)==null?void 0:l.full_name)||i.full_name||"Unknown",value:((u=i.companion)==null?void 0:u.id)||i.id}}),r)}catch(r){return console.log("Error fetching companions:",r),this.companions=[],r}},async createsafariExtras(s){this.savingSafariExtras=!0;const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/client-safari-extras-vset/",t=JSON.stringify({safary_extras:s}),n={method:"post",maxBodyLength:1/0,url:e,data:t,headers:{"Content-Type":"application/json"}},a=await o.request(n);return a.status===201?(this.showSafariExtrasModal=!1,this.savingSafariExtras=!1,a):(this.savingSafariExtras=!1,a)},async getClienSafariExtras(s){var a;const t={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/client-safari-extras-vset/?sales_inquiry_id="+s,headers:{"Content-Type":"application/json"}};this.clientSafariExtras=[];const n=await o.request(t);return n.status===200&&(this.clientSafariExtras=(a=n==null?void 0:n.data)==null?void 0:a.map(r=>({name:r.safari_extras.name,amount:`${r.safari_extras.currency.symbol} ${r.safari_extras.amount}`}))),n},async getAccommodation(s){const t={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-accommodation-vset/?sales_inquiry_id="+s,headers:{"Content-Type":"application/json"}},n=await o.request(t);return n.status===200&&(this.accommodations=n.data.map(a=>({id:a.id,name:a.entity.full_name,type_name:a.type.name,check_in:k(a.check_in),check_out:k(a.check_out)}))),n},async createAccommodation(s){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-confirmation-accommodation-vset/",t=JSON.stringify(s),n={method:"post",maxBodyLength:1/0,url:e,headers:{"Content-Type":"application/json"},data:t},a=await o.request(n);return a.status===201&&(this.showAccommodationModal=!1,this.getAccommodation(s.sales_inquiry_id)),a},async getChartersPrice(s){const t={method:"get",maxBodyLength:1/0,url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-charters-price-vset/?sales_inquiry_id="+s,headers:{"Content-Type":"application/json"}},n=await o.request(t);n.status===200&&(this.chartersPrices=n.data.map(a=>{var r,c,i;return{id:a.id,name:a.charters_price_list.name,amount:`${(c=(r=a==null?void 0:a.charters_price_list)==null?void 0:r.currency)==null?void 0:c.symbol} ${(i=a==null?void 0:a.charters_price_list)==null?void 0:i.amount}`}}))},async createChartersPrice(s){const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/sales-charters-price-vset/",t=JSON.stringify(s),n={method:"post",maxBodyLength:1/0,url:e,headers:{"Content-Type":"application/json"},data:t},a=await o.request(n);return a.status===201&&(this.showChartersPriceModal=!1,this.getChartersPrice(s.sales_inquiry_id)),a}}});export{S as u};
//# sourceMappingURL=sales-store-JP-c6piC.js.map
