import{d as B,_ as M,a as L,g as V,w as i,b as a,i as p,e as s,t as c,h as f,v as I,F as O,q as x,o as u,m as b,E as z,l as U,x as j,y as E,z as R,A as G,s as C,B as D}from"./index-mc8yIoJz.js";import{u as Q}from"./useForm-B0KXMGch.js";import{u as H}from"./useToast-CzWLUixe.js";import{M as Y}from"./ModuleTable-CkO475L8.js";import{u as W}from"./payment-cards-B77UYcEe.js";import{d as q}from"./pdfDownloader-DiRJnS-k.js";import{f as Z}from"./format-Cn4G_mmc.js";import{u as T}from"./price-list-store-C_f4aewT.js";import{h as J}from"./errorHandler-DijQ3xmc.js";import{v as K}from"./utils-BWc0LXoO.js";import{u as A}from"./quota-store-C74f-cSp.js";import{u as $}from"./settings-store-DQMLUdNX.js";import{S as X}from"./SalesPackageForm-DcPDkNpH.js";import"./regulatrory-store-YnGf4YFI.js";const ee=B({components:{},props:{priceListItem:{type:Object,required:!0},pdfData:{type:String,default:""}},data(){return{cardStore:W(),format:Z}},computed:{loading(){return this.cardStore.loading},hasUpgradeFees(){var t;const e=new Map;return(t=this.priceListItem.trophy_fees)==null||t.forEach(o=>{const r=e.get(o.species_id)||0;e.set(o.species_id,r+1)}),Array.from(e.values()).some(o=>o>1)}},mounted(){this.cardStore.load()},methods:{formatChargesPer(e){return e?e.toLowerCase().replace("_"," "):""},formatAmount(e){return(typeof e=="string"?parseFloat(e):e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},getSequenceLabel(e){const t=["th","st","nd","rd"],o=e%100,r=t[(o-20)%10]||t[o]||t[0];return`${e}${r}`},async downloadPriceListPdf(){var e,t;if(!this.pdfData){console.warn("No PDF data available");return}try{const r=`${(((t=(e=this.priceListItem)==null?void 0:e.sales_package)==null?void 0:t.name)||"price-list").replace(/\s+/g,"-")}-${Date.now()}.pdf`;await q(this.pdfData,r)}catch(o){console.error("Failed to download PDF:",o)}}}}),te={key:1,class:"price-list-details"},se={class:"text-center"},ae={class:"va-h3 mb-2"},oe={class:"flex justify-center items-center gap-4 mb-3"},ie={class:"text-lg text-secondary"},ne={class:"mt-4"},re={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},le={class:"text-3xl font-bold"},de={class:"text-3xl font-bold"},ce={class:"text-lg font-bold"},ue={class:"text-lg font-bold"},pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},me={class:"flex justify-between items-start"},ge={class:"flex-1"},ye={class:"font-semibold text-base"},fe={class:"text-sm text-secondary italic"},he={key:0},_e={class:"va-table-responsive"},ve={class:"va-table va-table--hoverable w-full"},be={class:"text-right"},Le={class:"font-semibold"},Ve={class:"text-secondary italic"},Pe={class:"text-center"},ke={class:"text-right font-bold text-lg"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Se={class:"space-y-3"},Ce={key:0,class:"p-4 rounded-lg bg-gray-50"},Ie={class:"flex justify-between items-start mb-2"},Fe={class:"text-right"},Oe={class:"font-bold text-lg"},Te={class:"flex justify-between items-start mb-2"},Ae={class:"font-semibold text-base capitalize"},xe={class:"text-sm text-secondary"},$e={class:"text-right"},De={class:"font-bold text-lg"},qe={class:"text-xs text-secondary"},Be={class:"space-y-4"},Me={key:0},Ne={class:"flex justify-between items-center"},Ue={class:"font-bold text-xl"},Qe={class:"flex items-center gap-2"},He={class:"flex items-center gap-2"};function ze(e,t,o,r,m,l){const y=p("VaSkeleton"),h=p("VaSkeletonGroup"),g=p("VaIcon"),P=p("VaChip"),F=p("VaButton"),_=p("VaCardContent"),v=p("VaCard"),w=p("VaCardTitle"),S=p("VaBadge"),n=p("VaAlert");return e.cardStore.loading?(u(),L(h,{key:0},{default:i(()=>[a(y,{class:"mb-4",height:"160px",variant:"squared"}),a(y,{class:"mb-4",height:"160px",variant:"squared"}),a(y,{height:"360px",variant:"squared"})]),_:1})):(u(),V("div",te,[a(v,{class:"mb-6",stripe:"","stripe-color":"primary"},{default:i(()=>[a(_,null,{default:i(()=>{var d,k,N;return[s("div",se,[s("h1",ae,c(e.priceListItem.sales_package.name),1),s("div",oe,[a(P,{color:"primary",size:"large"},{default:i(()=>[a(g,{name:"calendar_month",class:"mr-1"}),f(" "+c(e.format(e.priceListItem.price_list_type.price_list.start_date,"MMM yyyy"))+" - "+c(e.format(e.priceListItem.price_list_type.price_list.end_date,"MMM yyyy")),1)]),_:1}),(d=e.priceListItem.price_list_type)!=null&&d.is_active?(u(),L(P,{key:0,color:"success",size:"large"},{default:i(()=>[a(g,{name:"check_circle",class:"mr-1"}),t[0]||(t[0]=f(" Active "))]),_:1})):(u(),L(P,{key:1,color:"danger",size:"large"},{default:i(()=>[a(g,{name:"cancel",class:"mr-1"}),t[1]||(t[1]=f(" Inactive "))]),_:1}))]),s("p",ie,[a(g,{name:"location_on",size:"small"}),f(" "+c((N=(k=e.priceListItem.sales_package)==null?void 0:k.area)==null?void 0:N.name)+" ("+c(e.priceListItem.sales_package.area.description)+") ",1)]),s("div",ne,[e.pdfData?(u(),L(F,{key:0,color:"primary",icon:"download",onClick:e.downloadPriceListPdf},{default:i(()=>t[2]||(t[2]=[f(" Download PDF ")])),_:1},8,["onClick"])):I("",!0)])])]}),_:1})]),_:1}),s("div",re,[a(v,{stripe:"","stripe-color":"primary"},{default:i(()=>[a(_,{class:"text-center"},{default:i(()=>[a(g,{name:"attach_money",size:"large",color:"primary",class:"mb-2"}),s("div",le,c(e.priceListItem.price_list_type.currency.symbol)+c(e.formatAmount(e.priceListItem.price_list_type.amount)),1),t[3]||(t[3]=s("div",{class:"text-sm text-secondary mt-1"},"Base Amount",-1))]),_:1})]),_:1}),a(v,{stripe:"","stripe-color":"success"},{default:i(()=>[a(_,{class:"text-center"},{default:i(()=>[a(g,{name:"schedule",size:"large",color:"success",class:"mb-2"}),s("div",de,c(e.priceListItem.price_list_type.duration),1),t[4]||(t[4]=s("div",{class:"text-sm text-secondary mt-1"},"Days Duration",-1))]),_:1})]),_:1}),a(v,{stripe:"","stripe-color":"warning"},{default:i(()=>[a(_,{class:"text-center"},{default:i(()=>{var d;return[a(g,{name:"verified",size:"large",color:"warning",class:"mb-2"}),s("div",ce,c((d=e.priceListItem.sales_package.regulatory_package)==null?void 0:d.name),1),t[5]||(t[5]=s("div",{class:"text-sm text-secondary mt-1"},"License Type",-1))]}),_:1})]),_:1}),a(v,{stripe:"","stripe-color":"info"},{default:i(()=>[a(_,{class:"text-center"},{default:i(()=>[a(g,{name:"category",size:"large",color:"info",class:"mb-2"}),s("div",ue,c(e.priceListItem.price_list_type.hunting_type.name),1),t[6]||(t[6]=s("div",{class:"text-sm text-secondary mt-1"},"Hunting Type",-1))]),_:1})]),_:1})]),a(v,{class:"mb-6",stripe:"","stripe-color":"success"},{default:i(()=>[a(w,{class:"flex items-center gap-2"},{default:i(()=>[a(g,{name:"pets"}),f(" Available Species ("+c(e.priceListItem.sales_package.species.length)+") ",1)]),_:1}),a(_,null,{default:i(()=>[s("div",pe,[(u(!0),V(O,null,x(e.priceListItem.sales_package.species,d=>(u(),L(v,{key:d.id,class:"species-card",color:d.quantity>0?"#f0f9ff":"#fef2f2"},{default:i(()=>[a(_,null,{default:i(()=>[s("div",me,[s("div",ge,[s("div",ye,c(d.species.name),1),s("div",fe,c(d.species.scientific_name),1)]),a(S,{color:d.quantity>0?"success":"danger",class:"ml-2"},{default:i(()=>[f(" Qty: "+c(d.quantity),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1032,["color"]))),128))])]),_:1})]),_:1}),a(v,{class:"mb-6",stripe:"","stripe-color":"warning"},{default:i(()=>[a(w,{class:"flex items-center gap-2"},{default:i(()=>[a(g,{name:"military_tech"}),f(" Trophy Fees ("+c(e.priceListItem.price_list_type.currency.name)+") ",1)]),_:1}),a(_,null,{default:i(()=>[e.priceListItem.trophy_fees&&e.priceListItem.trophy_fees.length>0?(u(),V("div",he,[s("div",_e,[s("table",ve,[s("thead",null,[s("tr",null,[t[7]||(t[7]=s("th",{class:"text-left"},"Species",-1)),t[8]||(t[8]=s("th",{class:"text-left"},"Scientific Name",-1)),t[9]||(t[9]=s("th",{class:"text-center"},"Sequence",-1)),s("th",be,"Price ("+c(e.priceListItem.price_list_type.currency.symbol)+")",1)])]),s("tbody",null,[(u(!0),V(O,null,x(e.priceListItem.trophy_fees,d=>(u(),V("tr",{key:d.id},[s("td",Le,c(d.species.name),1),s("td",Ve,c(d.species.scientific_name),1),s("td",Pe,[a(S,{text:e.getSequenceLabel(d.sequence_order),color:"primary"},null,8,["text"])]),s("td",ke,c(e.priceListItem.price_list_type.currency.symbol)+c(e.formatAmount(d.price_usd)),1)]))),128))])])])])):(u(),L(n,{key:1,color:"info",border:"top"},{default:i(()=>t[10]||(t[10]=[f(" No trophy fees available for this package ")])),_:1}))]),_:1})]),_:1}),s("div",we,[a(v,{stripe:"","stripe-color":"info"},{default:i(()=>[a(w,{class:"flex items-center gap-2"},{default:i(()=>[a(g,{name:"add_circle"}),t[11]||(t[11]=f(" Safari Extras "))]),_:1}),a(_,null,{default:i(()=>{var d;return[s("div",Se,[e.priceListItem.observer&&e.priceListItem.observer.length>0?(u(),V("div",Ce,[s("div",Ie,[t[13]||(t[13]=s("div",null,[s("div",{class:"font-semibold text-base"},"Observer"),s("div",{class:"text-sm text-secondary"},"Observer cost")],-1)),s("div",Fe,[s("div",Oe,c(e.priceListItem.price_list_type.currency.symbol)+c((d=e.priceListItem.observer[0])==null?void 0:d.amount),1),t[12]||(t[12]=s("div",{class:"text-xs text-secondary"},"per day / person",-1))])])])):I("",!0),(u(!0),V(O,null,x(e.priceListItem.safari_extras,k=>(u(),V("div",{key:k.id,class:"p-4 rounded-lg bg-gray-50"},[s("div",Te,[s("div",null,[s("div",Ae,c(k.name),1),s("div",xe,c(k.description),1)]),s("div",$e,[s("div",De,c(k.currency.symbol)+c(k.amount),1),s("div",qe,c(e.formatChargesPer(k.charges_per)),1)])])]))),128))])]}),_:1})]),_:1}),a(v,{stripe:"","stripe-color":"success"},{default:i(()=>[a(w,{class:"flex items-center gap-2"},{default:i(()=>[a(g,{name:"groups"}),t[14]||(t[14]=f(" Companion & Observer Costs "))]),_:1}),a(_,null,{default:i(()=>[s("div",Be,[e.priceListItem.componions_hunter&&e.priceListItem.componions_hunter.length>0?(u(),V("div",Me,[t[16]||(t[16]=s("div",{class:"text-sm font-semibold text-secondary mb-2"},"Companion Hunter",-1)),(u(!0),V(O,null,x(e.priceListItem.componions_hunter,d=>(u(),V("div",{key:d.id,class:"p-4 rounded-lg bg-green-50"},[s("div",Ne,[t[15]||(t[15]=s("span",{class:"text-base"},"Daily Rate",-1)),s("span",Ue,c(e.priceListItem.price_list_type.currency.symbol)+c(d.amount),1)])]))),128))])):I("",!0)])]),_:1})]),_:1})]),a(v,{class:"mb-6",stripe:"","stripe-color":"danger"},{default:i(()=>[a(_,null,{default:i(()=>[a(n,{color:"warning",border:"left",class:"mb-3"},{title:i(()=>[s("div",Qe,[a(g,{name:"warning"}),t[17]||(t[17]=s("span",{class:"font-bold"},"Important Information",-1))])]),default:i(()=>[t[18]||(t[18]=f(" All hunts confirmation is subject to quota availability. Other safari packages are available on request and can be customized depending on client requirements. "))]),_:1}),e.hasUpgradeFees?(u(),L(n,{key:0,color:"info",border:"left"},{title:i(()=>[s("div",He,[a(g,{name:"info"}),t[19]||(t[19]=s("span",{class:"font-bold"},"Upgrade Fees",-1))])]),default:i(()=>[t[20]||(t[20]=f(" If additional trophies beyond the standard package are taken, upgrade fees may apply (plus trophy fees). "))]),_:1})):I("",!0)]),_:1})]),_:1})]))}const je=M(ee,[["render",ze],["__scopeId","data-v-a804157f"]]),Ee=B({components:{SalesPackageForm:X,VaForm:G,VaInput:R,VaSelect:E,VaButton:j},setup(){const e=C(),{isValid:t,validate:o,resetValidation:r,reset:m}=Q(e),{init:l}=H(),y=C(!1),h=D({id:null,hunting_type_id:null,package:[],amount:null,currency:null,duration:null,season:null,end_date:null,species:null,quantity:null,companion_amount:null,observer_amount:null}),g=D({id:null,client_id:null,contact:"",contact_type:null,contactable:!1}),P=d=>{h.package=h.package.filter(k=>k!==d)},F=C([]),_=C([]),v=C([]),w=C([]),S=C([]),n=C(0);return{formRef:e,form:h,contactForm:g,showEditForm:y,countries:F,nationality:_,categoryOptions:v,contactsTypes:w,clients:S,step:n,init:l,isValidForm:t,validateForm:o,resetValidationForm:r,resetForm:m,deleteChip:P,validators:K}},data(){return{preferred_species:[],speciesOptions:[],speciesObjects:[],areasOptions:[],huntingTypesOptions:[],salesQuotasOptions:[],speciesItemOptions:[],currencyOptions:[],savingPriceList:!1,durationsOptions:[{value:1,text:"1 day"},{value:2,text:"2 days"},{value:3,text:"3 days"},{value:4,text:"4 days"},{value:5,text:"5 days"},{value:6,text:"6 days"},{value:7,text:"7 days"},{value:8,text:"8 days"},{value:9,text:"9 days"},{value:10,text:"10 days"},{value:11,text:"11 days"},{value:12,text:"12 days"},{value:13,text:"13 days"},{value:14,text:"14 days"},{value:15,text:"15 days"},{value:16,text:"16 days"},{value:17,text:"17 days"},{value:18,text:"18 days"},{value:19,text:"19 days"},{value:20,text:"20 days"},{value:21,text:"21 days"}],seasonsOptions:[]}},computed:{...U(T,["salesPackages","packageOptions","latestPackage","loadingpackages"]),...z(T,{_shM:"showModal"})},watch:{},mounted(){this.getAreas(),this.getHuntingTypes(),this.getQuotaList(),this.getCurrencyList(),this.getSalesPackages(),this.getSeasonList()},methods:{...b(A,["getSpeciesList"]),...b(A,["getAllSpeciesPerQuotaPerArea"]),...b(A,["getAreaList"]),...b($,["getHuntingsTypes"]),...b($,["getCurrencies","getSeasons"]),...b(A,["getQuotas"]),...b(T,["createPriceList"]),...b(T,["getSalesPackageList"]),onAreaChange(e){console.log(e)},async submit(){var t;this.savingPriceList=!0;const e={huntingTypeId:this.form.hunting_type_id.value,sales_package_ids:(t=this.form.package)==null?void 0:t.filter(o=>(o==null?void 0:o.value)!==void 0).map(o=>o==null?void 0:o.value),amount:this.form.amount,currency:this.form.currency.value,duration:this.form.duration.value,season_id:this.form.season.value.id,start_at:this.form.season.value.start_at,end_at:this.form.season.value.end_at,is_active:1,area_id:3,user_id:1,companionAmount:this.form.companion_amount,observerAmount:this.form.observer_amount};this.savingPriceList=!1;try{const o=await this.createPriceList(e);o.status===201?(this.init({message:o.data.message,color:"success"}),this.resetForm(),this.resetValidationForm(),this.speciesObjects=[],this.savingPriceList=!1):(console.log(o),this.savingPriceList=!1)}catch(o){this.savingPriceList=!1,J(o.response),console.log(o),this.init({message:o.message,color:"danger"})}},async getSpeciesItems(){try{const e=await this.getSpeciesList();this.speciesOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getSeasonList(){try{const e=await this.getSeasons();this.seasonsOptions=e.data.map(t=>({value:t,text:t.name}))}catch(e){console.log(e)}},_showModal(){this._shM=!0},async getSalesPackages(){try{await this.getSalesPackageList(!0)}catch(e){console.log(e)}},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async getAreas(){try{const e=await this.getAreaList();this.areasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getHuntingTypes(){try{const e=await this.getHuntingsTypes();this.huntingTypesOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},onChangePackage(e){console.log(e.filter(t=>(t==null?void 0:t.value)!==void 0).map(t=>t==null?void 0:t.value))},async getQuotaList(){try{const e=await this.getQuotas(null);this.salesQuotasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getCurrencyList(){try{const e=await this.getCurrencies();this.currencyOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}}}}),Re={class:"p-1"},Ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ze={class:"mt-4 d-flex p-2"};function Je(e,t,o,r,m,l){const y=p("VaChip"),h=p("VaIcon"),g=p("VaSelect"),P=p("VaInput"),F=p("VaButton"),_=p("VaForm"),v=p("VaInnerLoading"),w=p("SalesPackageForm"),S=p("VaModal");return u(),V(O,null,[a(v,{loading:e.savingPriceList,size:60},{default:i(()=>[a(_,{ref:"formRef"},{default:i(()=>[s("div",Re,[t[11]||(t[11]=s("h3",{class:"font-bold text-lg mb-2"},"Price list Infos",-1)),s("div",Ge,[a(g,{modelValue:e.form.package,"onUpdate:modelValue":[t[1]||(t[1]=n=>e.form.package=n),e.onChangePackage],options:e.packageOptions,multiple:"",clearable:"",placeholder:"Select Package list here",rules:[n=>n||"Package is required"],label:"Packages","required-mark":""},{content:i(({value:n})=>[(u(!0),V(O,null,x(n,d=>(u(),L(y,{key:d,size:"small",color:"info",class:"mr-1 my-1",closeable:"","onUpdate:modelValue":k=>e.deleteChip(d)},{default:i(()=>[f(c(d.text),1)]),_:2},1032,["onUpdate:modelValue"]))),128))]),append:i(()=>[a(h,{name:"add",class:"ml-2",onClick:t[0]||(t[0]=n=>e._showModal())})]),_:1},8,["modelValue","options","rules","onUpdate:modelValue"]),a(g,{modelValue:e.form.hunting_type_id,"onUpdate:modelValue":t[2]||(t[2]=n=>e.form.hunting_type_id=n),placeholder:"Select Hunting Type",label:"Hunting Type",rules:[n=>n||"Hunting type is required"],options:e.huntingTypesOptions,searchable:"","required-mark":"","highlight-matched-text":""},null,8,["modelValue","rules","options"]),a(g,{modelValue:e.form.season,"onUpdate:modelValue":t[3]||(t[3]=n=>e.form.season=n),options:e.seasonsOptions,"required-mark":"",label:"Select season",placeholder:"Select season"},null,8,["modelValue","options"])]),t[12]||(t[12]=s("h3",{class:"font-bold text-lg mb-2"},"Charges",-1)),s("div",Ye,[a(P,{modelValue:e.form.amount,"onUpdate:modelValue":t[4]||(t[4]=n=>e.form.amount=n),type:"text",placeholder:"Enter Amount",rules:[n=>n&&n.length>0||"Amount is required"],label:"Amount","required-mark":""},null,8,["modelValue","rules"]),a(g,{modelValue:e.form.currency,"onUpdate:modelValue":t[5]||(t[5]=n=>e.form.currency=n),placeholder:"Select Currency",label:"Currency",rules:[n=>n||"Currency is required"],options:e.currencyOptions,searchable:"","highlight-matched-text":"","required-mark":""},null,8,["modelValue","rules","options"]),a(g,{modelValue:e.form.duration,"onUpdate:modelValue":t[6]||(t[6]=n=>e.form.duration=n),type:"text",options:e.durationsOptions,"required-mark":"",placeholder:"Enter Duration eg: 21 days",rules:[n=>n||"Duration is required"],label:"Duration(days)"},null,8,["modelValue","options","rules"])]),t[13]||(t[13]=s("h3",{class:"font-bold text-lg mb-2"},"Companion's and Observer's Charges(Optional)",-1)),s("div",We,[a(P,{modelValue:e.form.companion_amount,"onUpdate:modelValue":t[7]||(t[7]=n=>e.form.companion_amount=n),type:"text",placeholder:"Enter Companion Amount",label:"Companion Cost(Per Person)"},null,8,["modelValue"]),a(P,{modelValue:e.form.observer_amount,"onUpdate:modelValue":t[8]||(t[8]=n=>e.form.observer_amount=n),type:"text",placeholder:"Enter observer Amount",label:"Observer Cost(Per Person)"},null,8,["modelValue"])])]),s("div",Ze,[e.showEditForm?I("",!0):(u(),L(F,{key:0,icon:"save",class:"mr-3 mb-2",loading:e.savingPriceList,disabled:!e.isValidForm,onClick:t[9]||(t[9]=n=>e.validateForm()&&e.submit())},{default:i(()=>t[14]||(t[14]=[f(" Save ")])),_:1},8,["loading","disabled"]))])]),_:1},512)]),_:1},8,["loading"]),a(S,{modelValue:e._shM,"onUpdate:modelValue":t[10]||(t[10]=n=>e._shM=n),"ok-text":"Apply","close-button":"",size:"large","hide-default-actions":!0},{default:i(()=>[a(w)]),_:1},8,["modelValue"])],64)}const Ke=M(Ee,[["render",Je]]),Xe={name:"",start_date:null,end_date:null},et=B({name:"QuotaPage",components:{ModuleTable:Y,PricesListDetails:je,CreatePricesListForm:Ke},setup(){const e=C(null),t=C(null),o=[{key:"id",sortable:!0,sortingOptions:["desc","asc"]},{key:"package_name",sortable:!0},{key:"area",sortable:!0},{key:"hunting_type",sortable:!0},{key:"amount",sortable:!0},{key:"duration",sortable:!0,label:"Duration (Days)"},{key:"status",sortable:!0},{key:"actions",width:80}],{isValid:r,validate:m,resetValidation:l,reset:y}=Q(t);return{isValidSForm:r,validateSForm:m,resetValidationSForm:l,resetSForm:y,formRef:e,sformRef:t,columns:o}},data(){const e=[],t=[],o=D({id:null,name:"",scientific_name:""}),r=[];return{items:e,printableDataList:t,item:null,editedItemId:null,editedItem:null,createdItem:{...Xe},toast:H(),sform:o,speciesOptions:[],areasOptions:[],huntingTypeOptions:[],speciesObjects:[],showModal:!1,quotasOptions:r,showPriceList:!0,ShowCreateNewPriceListForm:!1,loading:!1,currentQuota:null,quotaItems:[],excellFile:[],itemsByHuntingType:[],huntingTypeValue:null,areaValue:null,quotaValue:null,poriceListPdf:"",individualPriceListPdf:"",downloadPdf:q}},computed:{...U($,["logo"])},mounted(){this.getPriceLists(),this.getAreas(),this.getQuota(),this.getHuntingTypesOptions(),this.loadLogo()},methods:{...b(T,["getPriceList"]),...b(T,["getPriceListByHuntingType"]),...b(T,["getPriceListById"]),...b(A,["getQuotas"]),...b(A,["getAreaList"]),...b(A,["generateQuotaYear"]),...b($,["getHuntingsTypes"]),...b($,["loadLogo"]),async toggleShowPriceListMethod(e){console.log("=== Eye button clicked ==="),console.log("Row data received:",e),console.log("Current showPriceList:",this.showPriceList);const t=e==null?void 0:e.id;if(!t){console.error("No price list ID found in row data");return}try{console.log("Fetching price list detail for ID:",t);const o=await this.getPriceListById(t);this.item=o.data.data||o.data,this.individualPriceListPdf=o.data.pdf||"",console.log("Fetched price list detail:",this.item),console.log("PDF available:",this.individualPriceListPdf?"Yes":"No"),this.showPriceList=!1,console.log("Switched to detail view")}catch(o){console.error("Error fetching price list detail:",o)}},async onDownloadPdf(){var r,m;const e=this.poriceListPdf;console.log("onDownloadPdf clicked, poriceListPdf length:",e?e.length:0);const t=l=>typeof l=="string"&&/^https?:\/\//i.test(l),o=l=>typeof l=="string"&&l.length>200&&/^[A-Za-z0-9+/=\r\n]+$/.test(l);if(!e||!t(e)&&!o(e)){try{(r=this.toast)==null||r.init({message:"PDF not available for this selection",color:"warning"})}catch{console.warn("PDF not available")}return}try{await q(e,`price-list-${Date.now()}.pdf`)}catch(l){try{(m=this.toast)==null||m.init({message:"Failed to download PDF",color:"danger"})}catch{console.error("Failed to download PDF",l)}}},goBack(){this.showPriceList=!this.showPriceList,this.ShowCreateNewPriceListForm=!1,this.getPriceLists()},showCreateNewPriceListFormMethod(){this.ShowCreateNewPriceListForm=!this.ShowCreateNewPriceListForm,this.showPriceList=!1},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async addNewSpecies(){},formatDate(e){const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${r}`},async getPriceLists(){this.loading=!0;try{const e=l=>l==null?"":typeof l=="object"&&"value"in l?l.value:l,t=e(this.huntingTypeValue)||"",o=e(this.areaValue)||"",r=e(this.quotaValue)||"";console.log("Filter params:",{huntingTypeId:t,areaId:o,quotaId:r}),console.log("huntingTypeValue:",this.huntingTypeValue),console.log("areaValue:",this.areaValue);const m=await this.getPriceList(t,o,r);if(console.log("API response:",m),console.log("Response data structure:",m==null?void 0:m.data),m.status===200){this.loading=!1;const l=m==null?void 0:m.data,y=Array.isArray(l)?l:(l==null?void 0:l.data)??[];console.log("Data array:",y),this.printableDataList=l,this.poriceListPdf=(l==null?void 0:l.pdf)||"",Array.isArray(y)?this.items=y.map(h=>({id:h.id,package_name:h.package_name,area:h.area,hunting_type:h.hunting_type,amount:h.amount,duration:h.duration,status:h.status})):(console.error("Data is not an array:",y),this.items=[]),console.log("Updated items:",this.items)}}catch(e){this.loading=!1,console.error("Error in getPriceLists:",e)}},async getPriceListByHuntingTypes(e){var t;try{const o=await this.getPriceListByHuntingType(e);this.itemsByHuntingType=(t=o==null?void 0:o.data)==null?void 0:t.map(r=>({id:r==null?void 0:r.id,item:r})),console.log(this.itemsByHuntingType)}catch(o){console.log(o)}},async getAreas(){var e;try{const t=await this.getAreaList(),o={value:"",text:"All"};this.areasOptions=(e=t==null?void 0:t.data)==null?void 0:e.map(r=>({value:r.id,text:r.name})),this.areasOptions.unshift(o),this.areaValue=this.areasOptions[0]}catch(t){console.log(t)}},async getQuota(){try{const e=await this.getQuotas(null);if(e.status===200){const t=e.data[0],o=this.generateQuotaYear(t.start_date,t.end_date);this.quotaValue={value:t.id,text:`${o} - ${t.name}`,name:t.name,start_date:t.start_date,end_date:t.end_date},this.currentQuota=t;const r={value:"",text:"All"};this.quotasOptions=e.data.map(m=>{const l=this.generateQuotaYear(m.start_date,m.end_date);return{value:m.id,text:`${l} - ${m.name}`,name:m.name,start_date:m.start_date,end_date:m.end_date}}),this.quotasOptions.unshift(r)}}catch(e){console.log(e)}},async getHuntingTypesOptions(){var t;const e=await this.getHuntingsTypes();if(e.status===200){const o={value:"",text:"All"};this.huntingTypeOptions=(t=e==null?void 0:e.data)==null?void 0:t.map(r=>({value:r.id,text:r.name})),this.huntingTypeOptions.unshift(o),this.huntingTypeValue=this.huntingTypeOptions[0]}}}}),tt={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},st={class:"flex flex-col md:flex-row gap-2 justify-start"},at={class:"grid sm:grid-cols-3 gap-6 mb-6"};function ot(e,t,o,r,m,l){const y=p("VaButton"),h=p("VaButtonGroup"),g=p("VaDivider"),P=p("VaSelect"),F=p("ModuleTable"),_=p("PricesListDetails"),v=p("CreatePricesListForm"),w=p("VaCard");return u(),L(w,{class:"p-6"},{default:i(()=>[s("div",tt,[s("div",st,[e.showPriceList?I("",!0):(u(),L(y,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e.goBack},{default:i(()=>t[2]||(t[2]=[f(" Go Back ")])),_:1},8,["onClick"]))]),e.ShowCreateNewPriceListForm?I("",!0):(u(),L(h,{key:0},{default:i(()=>[a(y,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add","border-color":"primary",round:"",preset:"secondary",size:"small",onClick:e.showCreateNewPriceListFormMethod},{default:i(()=>t[3]||(t[3]=[f(" Add a new Price List ")])),_:1},8,["onClick"])]),_:1}))]),a(g),e.ShowCreateNewPriceListForm?I("",!0):(u(),V(O,{key:0},[e.showPriceList?(u(),L(F,{key:0,items:e.items,columns:e.columns,loading:e.loading,onOnView:e.toggleShowPriceListMethod},{"filter-elements-and-download-btn":i(()=>[s("div",at,[a(P,{modelValue:e.huntingTypeValue,"onUpdate:modelValue":[t[0]||(t[0]=S=>e.huntingTypeValue=S),e.getPriceLists],options:e.huntingTypeOptions,placeholder:"Filter By Hunting Type"},null,8,["modelValue","options","onUpdate:modelValue"]),a(P,{modelValue:e.areaValue,"onUpdate:modelValue":[t[1]||(t[1]=S=>e.areaValue=S),e.getPriceLists],options:e.areasOptions,placeholder:"Filter By Area"},null,8,["modelValue","options","onUpdate:modelValue"]),a(y,{class:"px-2 py-0",color:"primary",label:"Download",icon:"download",size:"small",onClick:e.onDownloadPdf},{default:i(()=>t[4]||(t[4]=[f(" Download ")])),_:1},8,["onClick"])])]),_:1},8,["items","columns","loading","onOnView"])):(u(),L(_,{key:1,"price-list-item":e.item,"pdf-data":e.individualPriceListPdf},null,8,["price-list-item","pdf-data"]))],64)),e.ShowCreateNewPriceListForm?(u(),L(v,{key:1})):I("",!0)]),_:1})}const vt=M(et,[["render",ot]]);export{vt as default};
//# sourceMappingURL=ManagePriceList-DfuJA5cw.js.map
