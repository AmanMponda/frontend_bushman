import{h as O}from"./errorHandler-DijQ3xmc.js";import{v as V}from"./utils-BWc0LXoO.js";import{u as I}from"./useForm-BD4PJEC-.js";import{u as q}from"./useToast-BEDWU_wG.js";import{_ as D,g as _,e as s,t as o,h as d,F as Q,q as B,o as c,d as j,m as l,l as $,v as N,s as u,a as P,w,b as C,x as L,i as g}from"./index-YknbmV_z.js";import{u as v}from"./quota-store-D1n978KD.js";import{u as A}from"./settings-store-CFkNIGsP.js";import{u as T}from"./price-list-store-Cj5i_qWO.js";import{M as x}from"./ModuleTable-B8x3dwfB.js";import{u as M}from"./regulatrory-store-DnWNnLOw.js";import{S as E}from"./SalesPackageForm-BY1qcm3V.js";import"./format-Cn4G_mmc.js";const R={props:{item:{type:Object,required:!0}}},z={class:"species-details"},G={class:"header"},H={class:"description"},J={class:"area-info"},K={class:"regulatory-package-info"},U={class:"va-table-responsive"},W={class:"va-table va-table--clickable"};function X(t,e,a,i,r,b){var m,p,h,f,k;return c(),_("div",z,[e[9]||(e[9]=s("h1",{class:"title"},"Sales Package Details",-1)),s("div",G,[s("h2",null,"Packages Name: "+o(a.item.name||"N/A"),1),s("p",H,[e[0]||(e[0]=s("strong",null,"Description:",-1)),d(" "+o(a.item.description||"No description available"),1)])]),s("div",J,[e[3]||(e[3]=s("h3",null,"Area Information",-1)),s("p",null,[e[1]||(e[1]=s("strong",null,"Area Name:",-1)),d(" "+o(((m=a.item.area)==null?void 0:m.name)||"N/A"),1)]),s("p",null,[e[2]||(e[2]=s("strong",null,"Area Description:",-1)),d(" "+o(((p=a.item.area)==null?void 0:p.description)||"No description available"),1)])]),s("div",K,[e[7]||(e[7]=s("h3",null,"Licence Information",-1)),s("p",null,[e[4]||(e[4]=s("strong",null,"Package Name:",-1)),d(" "+o(((h=a.item.regulatory_package)==null?void 0:h.name)||"N/A"),1)]),s("p",null,[e[5]||(e[5]=s("strong",null,"Duration:",-1)),d(" "+o(((f=a.item.regulatory_package)==null?void 0:f.duration)||"N/A")+" days",1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"Created Date:",-1)),d(" "+o(((k=a.item.regulatory_package)==null?void 0:k.created_at)||"N/A"),1)])]),s("div",U,[s("table",W,[e[8]||(e[8]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"Species Name"),s("th",null,"Scientific Name"),s("th",null,"Quantity")])],-1)),s("tbody",null,[(c(!0),_(Q,null,B(a.item.species,n=>{var y,S;return c(),_("tr",{key:n.id},[s("td",null,o(n.id||"N/A"),1),s("td",null,o(((y=n.species)==null?void 0:y.name)||"N/A"),1),s("td",null,o(((S=n.species)==null?void 0:S.scientific_name)||"N/A"),1),s("td",null,o(n.quantity!==null?n.quantity:"N/A"),1)])}),128))])])])])}const Y=D(R,[["render",X],["__scopeId","data-v-e004d657"]]),Z=j({components:{SalesPackageDetails:Y,SalesPackageForm:E,ModuleTable:x},setup(){const t=u(),{isValid:e,validate:a,resetValidation:i,reset:r}=I(t),{init:b}=q(),m=u(!1),p=N({package_name:"",description:"",species:null,quantity:1,area:null,licence:null}),h=N({id:null,client_id:null,contact:"",contact_type:null,contactable:!1}),f=u([]),k=u([]),n=u([]),y=u([]),S=u([]),F=u(0);return{formRef:t,form:p,contactForm:h,showEditForm:m,countries:f,nationality:k,categoryOptions:n,contactsTypes:y,clients:S,step:F,init:b,isValidForm:e,validateForm:a,resetValidationForm:i,resetForm:r,validators:V}},data(){return{defaultColDef:{editable:!0},columnDefs:[{field:"name"},{field:"quantity"}],preferred_species:[],speciesOptions:[],speciesObjects:[],areasOptions:[],huntingTypesOptions:[],salesQuotasOptions:[],speciesItemOptions:[],currencyOptions:[],showPackageList:!0,showCreateNewPackageForm:!1,showEditPackageForm:!1,packages:[],columns:[{key:"id",sortable:!0,sortingOptions:["desc","asc"]},{key:"name",sortable:!0},{key:"area_name",label:"Area",sortable:!0},{key:"regulatory_package_name",label:"Licence",sortable:!0},{key:"actions",sortable:!0}],loading:!1,saving:!1,regulatoryPackagesOptions:[],loadingLicenceOptions:!1,loadingSpeciesOptions:!1,isChanged:!1,originalQuantities:N({}),quntityChangedsaved:!1,showDetailsPage:!1,selectItem:null}},computed:{...$(A,["licenceAreaSpecies","laodinglicenceAreaSpecies"]),itemChanged(){return t=>{const e=this.originalQuantities[t],a=this.licenceAreaSpecies.find(i=>i.id===t).quantity;return console.log("Original value:",e,"Current value:",a),e&&e!==a||this.isChanged}}},mounted(){this.loading=!0,this.getSpeciesItems(),this.getSalesPackages(),this.getLicencePackages(),this.getAreas()},methods:{...l(v,["getSpeciesList"]),...l(v,["getAllSpeciesPerQuotaPerArea"]),...l(v,["getAreaList"]),...l(A,["getHuntingsTypes"]),...l(A,["getCurrencies"]),...l(v,["getQuotas"]),...l(T,["createPriceList","createSalesPackage","getSalesPackageList"]),...l(M,["getRegulatoryPackages"]),...l(A,["getHuntingLicenseAreaSpecies"]),showCreateNewPackaeListFormMethod(){this.showCreateNewPackageForm=!0,this.showPackageList=!1},goBack(){this.showCreateNewPackageForm=!1,this.showPackageList=!0,this.showDetailsPage=!1,this.getSalesPackages()},async submit(){if(this.saving=!0,this.licenceAreaSpecies.length===0){this.init({message:"Please select at least one species.",color:"warning"});return}const t={name:this.form.package_name,description:this.form.description,areaId:this.form.area.value,licenceId:this.form.licence.value,speciesObjectList:this.licenceAreaSpecies};try{const e=await this.createSalesPackage(t);e.status===201&&(this.saving=!1,console.log(e),this.init({message:e.data.message,color:"success"}),this.licenceAreaSpecies=[])}catch(e){this.saving=!1;const a=O(e.response);console.log(a),this.init({message:`
`+a.map((i,r)=>`${r+1}. ${i}`).join(`
`),color:"danger"})}},async getSpeciesItems(){this.loadingSpeciesOptions=!0;try{const t=await this.getSpeciesList();t.status===200&&(this.loadingSpeciesOptions=!1,this.speciesItemOptions=t.data.map(e=>({value:e.id,text:e.name})))}catch(t){console.log(t)}},showDetails(t){console.log("Show details for:",t),this.showDetailsPage=!0,this.selectItem=t.selfItem},async getSalesPackages(){this.loading=!0;try{const t=await this.getSalesPackageList();t.status===200&&(this.packages=t.data.map(e=>{var a,i;return{id:e.id,name:e.name,area_name:((a=e==null?void 0:e.area)==null?void 0:a.name)??"N/A",regulatory_package_name:((i=e==null?void 0:e.regulatory_package)==null?void 0:i.name)??"N/A",selfItem:e}}),this.loading=!1)}catch{this.loading=!1}},async getLicencePackages(){this.loadingLicenceOptions=!0;try{const t=await this.getRegulatoryPackages();if(t.status===200){this.loadingLicenceOptions=!1;const e=t.data;this.regulatoryPackagesOptions=e.map(a=>({value:a.id,text:a.name}))}}catch(t){console.log(t)}},async getAreas(){try{const t=await this.getAreaList();this.areasOptions=t.data.map(e=>({value:e.id,text:e.name}))}catch(t){console.log(t)}},async getLicenceAreaSpeciesList(){const t={areaId:this.form.area.value,licenceId:this.form.licence.value};try{const e=await this.getHuntingLicenseAreaSpecies(t);if(e.status===200){const a=e.data;this.speciesOptions=a.map(i=>({value:i.id,text:i.name}))}}catch(e){const a=O(e.response);console.log(a),this.init({message:`
`+a.map((i,r)=>`${r+1}. ${i}`).join(`
`),color:"danger"})}},onChange(t,e){if(console.log("Quantity changed:",t,e),!(t in this.originalQuantities)){const i=this.licenceAreaSpecies.find(r=>r.id===t);this.originalQuantities[t]=i.quantity}const a=this.licenceAreaSpecies.find(i=>i.id===t);a&&(a.quantity=e,this.licenceAreaSpecies=[...this.licenceAreaSpecies]),this.init({message:`Quantity for ${a.name} has been updated to ${e} quantity(s).`,color:"success",position:"bottom-right"}),console.log("updated item list:",this.licenceAreaSpecies)},addNewSpeciesItemToStorage(){if(!this.form.species||!this.form.quantity){this.init({message:"Please fill all required fields.",color:"warning"});return}if(Number(this.form.quantity)<=0){this.init({message:"Quantity must be greater than zero.",color:"warning"});return}this.speciesObjects.some(e=>e.species_id===this.form.species.value)?console.log("Species item already exists:",this.form.species.value):this.speciesObjects.push({id:this.form.species.value,name:this.form.species.text,quantity:this.form.quantity})},deleteFromStorage(t){this.speciesObjects.splice(t,1),console.log("Species item deleted:",t)}}}),ee={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},te={class:"flex flex-col md:flex-row gap-2 justify-start"};function se(t,e,a,i,r,b){const m=g("VaButton"),p=g("VaButtonGroup"),h=g("VaDivider"),f=g("SalesPackageDetails"),k=g("SalesPackageForm"),n=g("ModuleTable"),y=g("VaCardContent"),S=g("VaCard");return c(),P(S,null,{default:w(()=>[C(y,null,{default:w(()=>[s("div",ee,[s("div",te,[!t.showPackageList||t.showDetailsPage?(c(),P(m,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:t.goBack},{default:w(()=>e[0]||(e[0]=[d(" Go Back ")])),_:1},8,["onClick"])):L("",!0)]),!t.showCreateNewPackageForm&&!t.showDetailsPage?(c(),P(p,{key:0},{default:w(()=>[C(m,{class:"px-2 py-2",color:"primary",label:"Add New Quota",icon:"add","border-color":"primary",round:"",preset:"secondary",size:"small",onClick:t.showCreateNewPackaeListFormMethod},{default:w(()=>e[1]||(e[1]=[d(" Add a package ")])),_:1},8,["onClick"])]),_:1})):L("",!0)]),C(h),t.showDetailsPage?(c(),P(f,{key:0,item:t.selectItem},null,8,["item"])):t.showCreateNewPackageForm&&!t.showDetailsPage?(c(),P(k,{key:1})):t.showPackageList?(c(),P(n,{key:2,items:t.packages,columns:t.columns,loading:t.loading,onOnView:t.showDetails},null,8,["items","columns","loading","onOnView"])):L("",!0)]),_:1})]),_:1})}const he=D(Z,[["render",se]]);export{he as default};
//# sourceMappingURL=ManageSalesPackage-CamTxMgR.js.map
