import{d as U,m as $,l as x,k as M,p as L,a as h,w as o,b as n,e as a,u as w,r as i,i as C,h as S,t as r,D as b,o as u}from"./index-ChBN8f7M.js";import{P as O,u as v}from"./ProposalView-Bt0MQ5dF.js";import{u as E}from"./useToast-pLSG-zsw.js";import"./settings-store-CfSCLwjp.js";const z=U({name:"SalesConfirmationList",components:{ProposalView:O},setup(){const{init:e}=E();return{init:e}},data(){return{searchText:"",seasonFilter:null,statusFilter:null,seasonOptions:[],statusFilterOptions:[{value:"confirmed",text:"Confirmed"},{value:"completed",text:"Completed"}],confirmations:[],showDetailsModal:!1,columns:[{key:"code",label:"CODE",sortable:!0,width:"120px"},{key:"client",label:"CLIENT",sortable:!0},{key:"season",label:"SEASON",sortable:!0},{key:"area",label:"AREA",sortable:!0},{key:"dates",label:"DATES",sortable:!0},{key:"amount",label:"AMOUNT",sortable:!0,width:"120px"},{key:"status",label:"STATUS",sortable:!0,width:"130px"},{key:"actions",label:"ACTIONS",width:"180px"}]}},computed:{...x(v,["pipeline","pipelineCounts","currentProposal","loading"]),allConfirmations(){return[...this.pipeline.confirmed||[],...this.pipeline.completed||[]]},filteredConfirmations(){let e=this.allConfirmations;if(this.searchText){const t=this.searchText.toLowerCase();e=e.filter(d=>{var m,k,_,c,g,y,p;return((m=d.code)==null?void 0:m.toLowerCase().includes(t))||((_=(k=d.client)==null?void 0:k.full_name)==null?void 0:_.toLowerCase().includes(t))||((g=(c=d.hunting_details)==null?void 0:c.areas)==null?void 0:g.toLowerCase().includes(t))||((p=(y=d.hunting_details)==null?void 0:y.season)==null?void 0:p.toLowerCase().includes(t))})}return this.statusFilter&&(e=e.filter(t=>t.stage===this.statusFilter)),e},totalConfirmations(){var e,t;return(((e=this.pipelineCounts)==null?void 0:e.confirmed)||0)+(((t=this.pipelineCounts)==null?void 0:t.completed)||0)}},mounted(){this.loadConfirmations(),this.loadSeasons()},methods:{...$(v,["fetchPipeline","fetchProposalById","updateProposalStatus","clearCurrentProposal"]),async loadConfirmations(){try{await this.fetchPipeline(void 0,this.seasonFilter||void 0)}catch{this.init({message:"Failed to load confirmations",color:"danger"})}},async loadSeasons(){try{const t=await M.get("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/seasons");if(t.data){const d=Array.isArray(t.data)?t.data:t.data.data||[];this.seasonOptions=d.map(m=>({value:m.id,text:m.name}))}}catch(e){console.error("Error loading seasons:",e)}},handleRowClick(e){this.viewDetails(e.item)},async viewDetails(e){try{const t=e.proposal_id||e.confirmation_id;t?(await this.fetchProposalById(t),this.showDetailsModal=!0):this.init({message:"No details found for this item",color:"warning"})}catch{this.init({message:"Failed to load details",color:"danger"})}},async markAsCompleted(e){try{const t=e.proposal_id||e.confirmation_id;t&&(await this.updateProposalStatus(t,"completed"),this.init({message:"Marked as completed successfully",color:"success"}),this.loadConfirmations())}catch{this.init({message:"Failed to update status",color:"danger"})}},async handleStatusChange(e){try{await this.updateProposalStatus(e.id,e.status),this.init({message:`Status changed to ${e.status}`,color:"success"}),await this.fetchProposalById(e.id),this.loadConfirmations()}catch{this.init({message:"Failed to update status",color:"danger"})}},formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return e}},formatCurrency(e){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"},formatStatus(e){return e?e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "):"Unknown"},getStatusColor(e){switch(e){case"confirmed":return"success";case"completed":return"primary";default:return"secondary"}},getStatusIcon(e){switch(e){case"confirmed":return"check_circle";case"completed":return"task_alt";default:return"help"}}}}),R={class:"flex items-center gap-2"},j={class:"flex items-center gap-3"},q={key:0,class:"loading-container py-8"},G={key:1,class:"empty-state py-12 text-center"},H={class:"text-gray-500 mt-2"},J={class:"font-semibold text-primary"},K={class:"client-cell"},Q={class:"font-semibold"},W={class:"text-xs text-gray-500"},X={class:"text-sm"},Y={class:"text-sm"},Z={class:"text-sm"},ee={class:"text-xs text-gray-500"},te={class:"font-semibold text-success"},se={class:"flex gap-2 justify-center"},oe={class:"flex justify-end mt-4 gap-2"};function ae(e,t,d,m,k,_){const c=i("VaIcon"),g=i("VaBadge"),y=i("VaInput"),p=i("VaSelect"),V=i("VaButton"),D=i("VaCardTitle"),P=i("VaProgressBar"),A=i("VaChip"),F=i("VaDataTable"),T=i("ProposalView"),N=i("VaModal"),I=i("VaCardContent"),B=i("VaCard");return u(),h(B,{class:"w-full"},{default:o(()=>[n(D,{class:"flex justify-between items-center"},{default:o(()=>[a("div",R,[n(c,{name:"check_circle",color:"success"}),t[5]||(t[5]=a("span",null,"Sales Confirmation",-1)),e.totalConfirmations>0?(u(),h(g,{key:0,text:String(e.totalConfirmations),color:"success"},null,8,["text"])):w("",!0)]),a("div",j,[n(y,{modelValue:e.searchText,"onUpdate:modelValue":t[0]||(t[0]=s=>e.searchText=s),placeholder:"Search confirmations...",class:"w-64",clearable:""},{prependInner:o(()=>[n(c,{name:"search"})]),_:1},8,["modelValue"]),n(p,{modelValue:e.seasonFilter,"onUpdate:modelValue":[t[1]||(t[1]=s=>e.seasonFilter=s),e.loadConfirmations],options:e.seasonOptions,placeholder:"All Seasons",class:"w-48",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"]),n(p,{modelValue:e.statusFilter,"onUpdate:modelValue":[t[2]||(t[2]=s=>e.statusFilter=s),e.loadConfirmations],options:e.statusFilterOptions,placeholder:"All Statuses",class:"w-40",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"]),n(V,{preset:"secondary",icon:"refresh",loading:e.loading,onClick:e.loadConfirmations},{default:o(()=>t[6]||(t[6]=[C(" Refresh ")])),_:1},8,["loading","onClick"])])]),_:1}),n(I,null,{default:o(()=>[e.loading&&e.confirmations.length===0?(u(),S("div",q,[n(P,{indeterminate:""}),t[7]||(t[7]=a("p",{class:"text-center mt-4 text-gray-600"},"Loading sales confirmations...",-1))])):e.filteredConfirmations.length===0?(u(),S("div",G,[n(c,{name:"check_circle_outline",size:"4rem",color:"secondary"}),t[8]||(t[8]=a("h3",{class:"text-xl font-semibold text-gray-600 mt-4"},"No Confirmations Found",-1)),a("p",H,r(e.searchText?`No results for "${e.searchText}"`:"No confirmed or completed sales yet."),1)])):(u(),h(F,{key:2,items:e.filteredConfirmations,columns:e.columns,loading:e.loading,hoverable:"",clickable:"",striped:"","onRow:click":e.handleRowClick},{"cell(code)":o(({value:s})=>[a("span",J,r(s),1)]),"cell(client)":o(({row:s})=>{var l,f;return[a("div",K,[a("div",Q,r(((l=s.source.client)==null?void 0:l.full_name)||"N/A"),1),a("div",W,r(((f=s.source.client)==null?void 0:f.country)||""),1)])]}),"cell(season)":o(({row:s})=>{var l;return[a("div",X,r(((l=s.source.hunting_details)==null?void 0:l.season)||"N/A"),1)]}),"cell(area)":o(({row:s})=>{var l;return[a("div",Y,r(((l=s.source.hunting_details)==null?void 0:l.areas)||"N/A"),1)]}),"cell(dates)":o(({row:s})=>{var l,f;return[a("div",Z,[a("div",null,r(e.formatDate((l=s.source.hunting_details)==null?void 0:l.start_date)),1),a("div",ee,"to "+r(e.formatDate((f=s.source.hunting_details)==null?void 0:f.end_date)),1)])]}),"cell(amount)":o(({row:s})=>[a("div",te,r(e.formatCurrency(s.source.total_amount)),1)]),"cell(status)":o(({row:s})=>[n(A,{color:e.getStatusColor(s.source.stage),size:"small"},{default:o(()=>[n(c,{name:e.getStatusIcon(s.source.stage),size:"small",class:"mr-1"},null,8,["name"]),C(" "+r(e.formatStatus(s.source.stage)),1)]),_:2},1032,["color"])]),"cell(actions)":o(({row:s})=>[a("div",se,[n(V,{preset:"secondary",size:"small",icon:"visibility",onClick:b(l=>e.viewDetails(s.source),["stop"])},{default:o(()=>t[9]||(t[9]=[C(" View ")])),_:2},1032,["onClick"]),s.source.stage==="confirmed"?(u(),h(V,{key:0,preset:"primary",size:"small",icon:"task_alt",onClick:b(l=>e.markAsCompleted(s.source),["stop"])},{default:o(()=>t[10]||(t[10]=[C(" Complete ")])),_:2},1032,["onClick"])):w("",!0)])]),_:1},8,["items","columns","loading","onRow:click"])),n(N,{modelValue:e.showDetailsModal,"onUpdate:modelValue":t[4]||(t[4]=s=>e.showDetailsModal=s),size:"large","hide-default-actions":!0,title:"Confirmation Details"},{default:o(()=>[e.currentProposal?(u(),h(T,{key:0,proposal:e.currentProposal,onStatusChange:e.handleStatusChange},null,8,["proposal","onStatusChange"])):w("",!0),a("div",oe,[n(V,{preset:"secondary",onClick:t[3]||(t[3]=s=>e.showDetailsModal=!1)},{default:o(()=>t[11]||(t[11]=[C("Close")])),_:1})])]),_:1},8,["modelValue"])]),_:1})]),_:1})}const de=L(z,[["render",ae],["__scopeId","data-v-a877c514"]]);export{de as default};
//# sourceMappingURL=SalesConfirmationProposals-DCRPrO_2.js.map
