import{d as O,p as z,h as l,e as t,u as f,t as i,a as Z,g as j,w as H,i as b,r as M,F as E,q as U,B as rs,J as ds,E as os,n as cs,o as n,m as L,l as ns,s as ts,z as us,b as A}from"./index-ChBN8f7M.js";import{u as B}from"./contracts-store-TGLz6K26.js";import{d as as}from"./pdfDownloader-Cg_wDO9M.js";import{f as ms}from"./utils-BWc0LXoO.js";import{u as is}from"./useToast-pLSG-zsw.js";import{u as ps}from"./useForm-DvvDy_4m.js";import{u as q}from"./sales-store-JP-c6piC.js";import{h as fs}from"./errorHandler-DijQ3xmc.js";import"./format-Cn4G_mmc.js";const hs=O({props:{contractItem:{type:Object,required:!0},isEditMode:{type:Boolean,default:!1}},emits:["close"],setup(){const{init:s}=is();return{formatDateTime:ms,init:s}},data(){return{documents:[],newDocument:{type:"",file:null},selectedFiles:[],uploadMessage:"",uploadMessageType:"",isUploading:!1,uploadProgress:0,isDeleting:!1,deletingDocId:null,downloadingPdf:!1}},computed:{isMainHunterContract(){var s;return((s=this.contractItem)==null?void 0:s.contractor_type)==="MAIN_HUNTER"},displayDocuments(){var s;return this.documents.length>0?this.documents:((s=this.contractItem)==null?void 0:s.client_docs)||[]},hasDocuments(){return this.displayDocuments.length>0}},watch:{contractItem:{handler(s){s!=null&&s.client_docs&&s.client_docs.length>0&&(this.documents=s.client_docs)},deep:!0},isEditMode(s){s===!1&&this.fetchDocuments()}},mounted(){var s;(s=this.contractItem)!=null&&s.client_docs&&this.contractItem.client_docs.length>0&&(this.documents=this.contractItem.client_docs),this.fetchDocuments()},methods:{getContractStatusClass(){var e;const s=(e=this.contractItem)==null?void 0:e.contractor_type;return s==="MAIN_HUNTER"?"status-main-hunter":s==="COMPANION_HUNTER"?"status-companion-hunter":"status-default"},calculateDuration(){var s,e;if(!((s=this.contractItem)!=null&&s.start_date)||!((e=this.contractItem)!=null&&e.end_date))return"N/A";try{const o=new Date(this.contractItem.start_date),c=new Date(this.contractItem.end_date),a=Math.abs(c.getTime()-o.getTime()),r=Math.ceil(a/(1e3*60*60*24));return`${r} day${r!==1?"s":""}`}catch{return"N/A"}},async downloadContractPdf(){var s;if(!((s=this.contractItem)!=null&&s.id)){this.init({message:"Contract ID is missing. Cannot download PDF.",color:"warning"});return}this.downloadingPdf=!0;try{const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/",o=this.contractItem.id,c=`sales-confirmation/contracts/${o}/pdf`,a=`${e}${c}`,p=`${this.contractItem.contract_number||`contract-${o}`}.pdf`;await as(a,p),this.init({message:"PDF downloaded successfully",color:"success"})}catch(e){console.error("PDF download error:",e);const o=(e==null?void 0:e.message)||"Unknown error";o.includes("500")||o.includes("503")?this.init({message:"The PDF generation service is temporarily unavailable. Please try again in a few moments.",color:"warning"}):o.includes("404")?this.init({message:"The PDF file was not found. The contract may not have been processed yet.",color:"warning"}):this.init({message:`Failed to download PDF: ${o}`,color:"danger"})}finally{this.downloadingPdf=!1}},async deleteDocument(s){if(!s){this.uploadMessage="âŒ Document ID is missing",this.uploadMessageType="error";return}if(confirm("Are you sure you want to delete this document?")){this.isDeleting=!0,this.deletingDocId=s,this.uploadMessage="â³ Deleting document...",this.uploadMessageType="info";try{const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/",o=`sales-confirmation/contract-documents/${s}`,c=await fetch(`${e}${o}`,{method:"DELETE"}),a=await c.json().catch(()=>({}));if(c.ok)console.log("Delete successful:",a),this.documents=this.documents.filter(r=>(r.id||r.document_id)!==s),this.uploadMessage="âœ“ Document deleted successfully!",this.uploadMessageType="success",setTimeout(()=>{this.uploadMessage="",this.uploadMessageType="",this.deletingDocId=null},2e3);else{const r=(a==null?void 0:a.message)||(a==null?void 0:a.error)||"Unknown error";this.uploadMessage=`âŒ Delete failed: ${r}`,this.uploadMessageType="error",console.error("Delete error response:",a)}}catch(e){console.error("Delete error:",e),this.uploadMessage=`âŒ Error: ${e.message||"Failed to delete document"}`,this.uploadMessageType="error"}finally{this.isDeleting=!1}}},async fetchDocuments(){var e;const s=(e=this.contractItem)==null?void 0:e.id;if(!s){console.warn("No contract ID found");return}try{const o="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/",c=`sales-confirmation/contract-documents/?entity_id=${s}`,a=await fetch(`${o}${c}`,{method:"GET"});if(a.ok){const r=await a.json().catch(()=>({}));let p=[];r.data&&Array.isArray(r.data)?p=r.data:r.value&&Array.isArray(r.value)?p=r.value:Array.isArray(r)&&(p=r),this.documents=p}}catch(o){console.error("Error fetching documents:",o)}},onFileSelected(s){const e=s.target.files[0];if(e){if(e.size>50*1024*1024){this.uploadMessage="âŒ File size exceeds 50MB limit",this.uploadMessageType="error",this.newDocument.file=null;return}if(!["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)){this.uploadMessage="âŒ File type not supported. Use PDF, JPG, PNG, DOC, or XLS",this.uploadMessageType="error",this.newDocument.file=null;return}this.newDocument.file=e,this.uploadMessage=`âœ“ Selected: ${e.name} (${(e.size/1024/1024).toFixed(2)} MB)`,this.uploadMessageType="info"}},addDocument(){if(!this.newDocument.file||!this.newDocument.type){this.uploadMessage="âŒ Please select both a document type and file",this.uploadMessageType="error";return}this.selectedFiles.push({file:this.newDocument.file,type:this.newDocument.type}),this.uploadMessage=`âœ… Added: ${this.newDocument.file.name} (${this.newDocument.type})`,this.uploadMessageType="success",this.newDocument={type:"",file:null},this.$refs.fileInput&&(this.$refs.fileInput.value=""),setTimeout(()=>{this.uploadMessage="",this.uploadMessageType=""},2e3)},removeFromQueue(s){this.selectedFiles.splice(s,1)},clearQueue(){this.selectedFiles=[],this.newDocument={type:"",file:null},this.uploadMessage="",this.uploadMessageType=""},async uploadBatchDocuments(){var s,e;if(this.selectedFiles.length===0){this.uploadMessage="âŒ Please select at least one file",this.uploadMessageType="error";return}if(!((s=this.contractItem)!=null&&s.id)){this.uploadMessage="âŒ Error: Contract ID is missing. Cannot upload documents.",this.uploadMessageType="error";return}this.isUploading=!0,this.uploadMessage=`â³ Uploading ${this.selectedFiles.length} document(s)...`,this.uploadMessageType="info",this.uploadProgress=0;try{const o="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/",a=`sales-confirmation/contracts/${this.contractItem.id}/documents`,r=new FormData;this.selectedFiles.forEach((d,h)=>{r.append("documents[]",d.file),r.append(`doc_types[${h}]`,d.type)}),console.log(`Uploading ${this.selectedFiles.length} documents to:`,a);const p=await fetch(`${o}${a}`,{method:"POST",body:r}),u=await p.json().catch(()=>({}));if(console.log("Batch upload response:",u),p.ok||p.status===201){console.log("Batch upload successful:",u),u.data&&Array.isArray(u.data)&&u.data.forEach(h=>{var v;this.documents.push({id:h.id,document_type:h.doc_type,doc_type:h.doc_type,forWho:((v=this.contractItem)==null?void 0:v.client_name)||"Unknown",document_url:h.url||h.document,document:h.document,uploaded_at:h.created_at||new Date().toISOString()})});const d=u.total||((e=u.data)==null?void 0:e.length)||this.selectedFiles.length;this.uploadMessage=`âœ“ ${d} document(s) uploaded successfully!`,this.uploadMessageType="success",setTimeout(()=>{this.fetchDocuments()},500),setTimeout(()=>{this.clearQueue()},2e3)}else{let d=(u==null?void 0:u.message)||`Upload failed with status ${p.status}`;u!=null&&u.errors&&(d=Object.keys(u.errors).map(g=>{const y=u.errors[g],w=Array.isArray(y)?y.join(", "):String(y);return`${g}: ${w}`}).join(" | ")||d,console.error("Validation errors:",u.errors)),this.uploadMessage=`âŒ Upload failed: ${d}`,this.uploadMessageType="error",console.error("Upload error response:",u)}}catch(o){console.error("Upload error:",o),this.uploadMessage=`âŒ Error: ${o.message||"Failed to upload documents"}`,this.uploadMessageType="error"}finally{this.isUploading=!1,this.uploadProgress=0}},resetUploadForm(){this.newDocument={type:"",file:null},this.$refs.fileInput&&(this.$refs.fileInput.value=""),this.uploadMessageType==="success"&&setTimeout(()=>{this.uploadMessage="",this.uploadMessageType=""},3e3)}}}),gs={class:"contract-details-page"},vs={class:"contract-header"},ys={class:"header-content"},_s={class:"header-text"},ws={class:"page-title"},bs={class:"page-subtitle"},Cs={class:"header-actions"},$s={class:"contract-overview-card"},Ds={class:"card-content"},ks={class:"overview-grid"},Is={class:"overview-item"},Ms={class:"overview-value highlight"},Vs={class:"overview-item"},Fs={class:"overview-value"},Ss={class:"overview-item"},Ps={class:"overview-value"},Ts={class:"overview-item"},As={class:"overview-value"},Hs={class:"overview-item"},Ns={class:"overview-value"},Es={class:"overview-item"},Us={class:"overview-value"},Ls={key:0,class:"info-card"},Bs={class:"card-content"},Zs={class:"info-grid"},qs={class:"info-item"},js={class:"info-value"},Os={key:0,class:"info-item"},zs={class:"info-value"},Rs={key:1,class:"info-item"},Gs={class:"info-value"},Qs={key:2,class:"info-item"},Ws={class:"info-value"},Xs={key:1,class:"info-card"},Js={class:"card-content"},Ks={class:"info-grid"},Ys={class:"info-item"},xs={class:"info-value"},se={key:0,class:"info-item"},ee={class:"info-value"},te={key:1,class:"info-item"},oe={class:"info-value"},ne={key:2,class:"info-item"},ae={class:"info-value"},ie={key:3,class:"info-item"},le={class:"info-value"},re={class:"info-card"},de={class:"card-header"},ce={class:"card-title"},ue={key:0,class:"doc-count-badge"},me={class:"card-content"},pe={key:0,class:"documents-grid"},fe={class:"document-details-content"},he={class:"document-type-name"},ge={class:"document-meta"},ve={key:0,class:"document-date"},ye={key:1,class:"document-for"},_e={class:"document-actions"},we=["href"],be=["disabled","onClick"],Ce={key:1,class:"no-documents-message"},$e={key:2,class:"info-card document-upload-card"},De={class:"card-content"},ke={class:"document-upload-form"},Ie={class:"upload-section"},Me={class:"upload-row"},Ve={class:"upload-field"},Fe=["disabled"],Se={class:"upload-field"},Pe=["disabled"],Te={class:"upload-actions-row"},Ae=["disabled"],He={key:1,class:"progress-bar-container"},Ne={class:"progress-text"},Ee={key:2,class:"added-documents"},Ue={class:"documents-title"},Le={class:"documents-list"},Be={class:"doc-info"},Ze={class:"doc-type"},qe={class:"doc-name"},je={class:"doc-size"},Oe=["disabled","onClick"],ze={class:"upload-all-actions"},Re=["disabled"],Ge=["disabled"],Qe={key:3,class:"no-documents-message"},We={class:"submit-section"},Xe={class:"submit-actions"};function Je(s,e,o,c,a,r){var u,d,h,v,g,y,w,C,$,D,S,V,F;const p=M("VaButton");return n(),l("div",gs,[t("div",vs,[t("div",ys,[e[7]||(e[7]=t("div",{class:"header-icon"},[t("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z",fill:"currentColor"})])],-1)),t("div",_s,[t("h1",ws,i(s.isEditMode?"Upload Documents":"Contract Details"),1),t("p",bs,i(((u=s.contractItem)==null?void 0:u.contract_number)||"Contract Information"),1)]),t("div",Cs,[t("span",{class:j(["status-badge",s.getContractStatusClass()])},i(((d=s.contractItem)==null?void 0:d.contractor_type)||"CONTRACT"),3),s.isEditMode?f("",!0):(n(),Z(p,{key:0,color:"primary",icon:"download",loading:s.downloadingPdf,class:"download-pdf-btn",onClick:s.downloadContractPdf},{default:H(()=>e[6]||(e[6]=[b(" Download PDF ")])),_:1},8,["loading","onClick"]))])])]),t("div",$s,[e[14]||(e[14]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},[t("svg",{class:"card-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM7 10H9V17H7V10ZM11 7H13V17H11V7ZM15 13H17V17H15V13Z",fill:"currentColor"})]),b(" Contract Overview ")])],-1)),t("div",Ds,[t("div",ks,[t("div",Is,[e[8]||(e[8]=t("span",{class:"overview-label"},"Contract Number",-1)),t("span",Ms,i(((h=s.contractItem)==null?void 0:h.contract_number)||"N/A"),1)]),t("div",Vs,[e[9]||(e[9]=t("span",{class:"overview-label"},"Description",-1)),t("span",Fs,i(((v=s.contractItem)==null?void 0:v.description)||"N/A"),1)]),t("div",Ss,[e[10]||(e[10]=t("span",{class:"overview-label"},"Start Date",-1)),t("span",Ps,i(s.formatDateTime((g=s.contractItem)==null?void 0:g.start_date)||"N/A"),1)]),t("div",Ts,[e[11]||(e[11]=t("span",{class:"overview-label"},"End Date",-1)),t("span",As,i(s.formatDateTime((y=s.contractItem)==null?void 0:y.end_date)||"N/A"),1)]),t("div",Hs,[e[12]||(e[12]=t("span",{class:"overview-label"},"Duration",-1)),t("span",Ns,i(s.calculateDuration()),1)]),t("div",Es,[e[13]||(e[13]=t("span",{class:"overview-label"},"Created",-1)),t("span",Us,i(s.formatDateTime((w=s.contractItem)==null?void 0:w.created_at)||"N/A"),1)])])])]),(C=s.contractItem)!=null&&C.entity?(n(),l("div",Ls,[e[19]||(e[19]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},[t("svg",{class:"card-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"currentColor"})]),b(" Client Information ")])],-1)),t("div",Bs,[t("div",Zs,[t("div",qs,[e[15]||(e[15]=t("span",{class:"info-label"},"Full Name",-1)),t("span",js,i(s.contractItem.entity.full_name||"N/A"),1)]),s.contractItem.entity.nick_name?(n(),l("div",Os,[e[16]||(e[16]=t("span",{class:"info-label"},"Nick Name",-1)),t("span",zs,i(s.contractItem.entity.nick_name),1)])):f("",!0),s.contractItem.entity.country_name||($=s.contractItem.entity.country)!=null&&$.name?(n(),l("div",Rs,[e[17]||(e[17]=t("span",{class:"info-label"},"Country",-1)),t("span",Gs,i(s.contractItem.entity.country_name||((D=s.contractItem.entity.country)==null?void 0:D.name)||"N/A"),1)])):f("",!0),s.contractItem.entity.nationality_name||(S=s.contractItem.entity.nationality)!=null&&S.name?(n(),l("div",Qs,[e[18]||(e[18]=t("span",{class:"info-label"},"Nationality",-1)),t("span",Ws,i(s.contractItem.entity.nationality_name||((V=s.contractItem.entity.nationality)==null?void 0:V.name)||"N/A"),1)])):f("",!0)])])])):f("",!0),(F=s.contractItem)!=null&&F.sales_confirmation_proposal?(n(),l("div",Xs,[e[25]||(e[25]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},[t("svg",{class:"card-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z",fill:"currentColor"})]),b(" Sales Confirmation Details ")])],-1)),t("div",Js,[t("div",Ks,[t("div",Ys,[e[20]||(e[20]=t("span",{class:"info-label"},"Proposal ID",-1)),t("span",xs,i(s.contractItem.sales_confirmation_proposal.id||"N/A"),1)]),s.contractItem.sales_confirmation_proposal.confirmation_date?(n(),l("div",se,[e[21]||(e[21]=t("span",{class:"info-label"},"Confirmation Date",-1)),t("span",ee,i(s.formatDateTime(s.contractItem.sales_confirmation_proposal.confirmation_date)),1)])):f("",!0),s.contractItem.sales_confirmation_proposal.sales_inquiry_id?(n(),l("div",te,[e[22]||(e[22]=t("span",{class:"info-label"},"Sales Inquiry ID",-1)),t("span",oe,i(s.contractItem.sales_confirmation_proposal.sales_inquiry_id),1)])):f("",!0),s.contractItem.sales_confirmation_proposal.hunting_license?(n(),l("div",ne,[e[23]||(e[23]=t("span",{class:"info-label"},"Hunting License",-1)),t("span",ae,i(s.contractItem.sales_confirmation_proposal.hunting_license),1)])):f("",!0),s.contractItem.sales_confirmation_proposal.remarks?(n(),l("div",ie,[e[24]||(e[24]=t("span",{class:"info-label"},"Remarks",-1)),t("span",le,i(s.contractItem.sales_confirmation_proposal.remarks),1)])):f("",!0)])])])):f("",!0),t("div",re,[t("div",de,[t("h3",ce,[e[26]||(e[26]=t("svg",{class:"card-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z",fill:"currentColor"})],-1)),e[27]||(e[27]=b(" Documents ")),s.hasDocuments?(n(),l("span",ue,i(s.displayDocuments.length),1)):f("",!0)])]),t("div",me,[s.hasDocuments?(n(),l("div",pe,[(n(!0),l(E,null,U(s.displayDocuments,(m,I)=>(n(),l("div",{key:I,class:"document-card-item"},[e[28]||(e[28]=t("div",{class:"document-icon-wrapper"},[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z",fill:"currentColor"})])],-1)),t("div",fe,[t("div",he,i(m.document_type||m.doc_type||"Document"),1),t("div",ge,[m.uploaded_at?(n(),l("span",ve,i(s.formatDateTime(m.uploaded_at)),1)):f("",!0),m.forWho?(n(),l("span",ye,i(m.forWho),1)):f("",!0)])]),t("div",_e,[m.document_url||m.document?(n(),l("a",{key:0,href:m.document_url||m.document,target:"_blank",class:"document-view-btn"}," View ",8,we)):f("",!0),s.isEditMode?f("",!0):(n(),l("button",{key:1,class:"document-delete-btn",disabled:s.isDeleting&&s.deletingDocId===(m.id||m.document_id),onClick:T=>s.deleteDocument(m.id||m.document_id)}," Delete ",8,be))])]))),128))])):(n(),l("div",Ce,[e[29]||(e[29]=t("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z",fill:"currentColor"})],-1)),t("p",null,i(s.isEditMode?"Upload documents to this contract":"No documents uploaded for this contract"),1)]))])]),s.isEditMode?(n(),l("div",$e,[e[40]||(e[40]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},[t("svg",{class:"card-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z",fill:"currentColor"})]),b(" Upload Documents ")])],-1)),t("div",De,[t("div",ke,[e[36]||(e[36]=t("h3",{class:"upload-title"},"Upload Supporting Documents",-1)),e[37]||(e[37]=t("p",{class:"upload-description"},' Choose a document type, select a file, and click "Add Document". Repeat to add more documents. ',-1)),t("div",Ie,[t("div",Me,[t("div",Ve,[e[31]||(e[31]=t("label",{class:"field-label"},"Document Type *",-1)),rs(t("select",{"onUpdate:modelValue":e[0]||(e[0]=m=>s.newDocument.type=m),class:"form-select",disabled:s.isUploading},e[30]||(e[30]=[os('<option value="" data-v-027c6bca>-- Select Type --</option><option value="Passport_Copy" data-v-027c6bca>Passport Copy</option><option value="Passport_Photo" data-v-027c6bca>Passport Photo</option><option value="Visa" data-v-027c6bca>Visa</option><option value="Gun_Permits" data-v-027c6bca>Gun Permits</option><option value="CITES_Documentation" data-v-027c6bca>CITES Documentation</option><option value="sales_invoice" data-v-027c6bca>Sales Invoice</option><option value="receipt" data-v-027c6bca>Receipt</option><option value="document" data-v-027c6bca>General Document</option>',9)]),8,Fe),[[ds,s.newDocument.type]])]),t("div",Se,[e[32]||(e[32]=t("label",{class:"field-label"},"Select File *",-1)),t("input",{ref:"fileInput",type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx",class:"form-input",disabled:s.isUploading,onChange:e[1]||(e[1]=(...m)=>s.onFileSelected&&s.onFileSelected(...m))},null,40,Pe)])]),t("div",Te,[t("button",{class:"btn-add-document",disabled:!s.newDocument.file||!s.newDocument.type||s.isUploading,onClick:e[2]||(e[2]=(...m)=>s.addDocument&&s.addDocument(...m))}," âž• Add Document ",8,Ae)]),e[33]||(e[33]=t("small",{class:"help-text"},"Select document type and file, then click to add",-1))]),s.uploadMessage?(n(),l("div",{key:0,class:j(["upload-message",s.uploadMessageType])},i(s.uploadMessage),3)):f("",!0),s.isUploading&&s.uploadProgress>0?(n(),l("div",He,[t("div",{class:"progress-bar",style:cs({width:s.uploadProgress+"%"})},null,4),t("span",Ne,i(s.uploadProgress)+"%",1)])):f("",!0),s.selectedFiles.length>0?(n(),l("div",Ee,[t("h4",Ue,"ðŸ“‹ Documents to Upload ("+i(s.selectedFiles.length)+"):",1),t("div",Le,[(n(!0),l(E,null,U(s.selectedFiles,(m,I)=>(n(),l("div",{key:I,class:"document-item"},[t("div",Be,[t("span",Ze,i(m.type),1),t("span",qe,i(m.file.name),1),t("span",je,"("+i((m.file.size/1024/1024).toFixed(2))+" MB)",1)]),t("button",{class:"btn-remove-doc",disabled:s.isUploading,title:"Remove this document",onClick:T=>s.removeFromQueue(I)}," âœ• ",8,Oe)]))),128))]),t("div",ze,[t("button",{disabled:s.isUploading||s.selectedFiles.length===0,class:"btn-upload-all",onClick:e[3]||(e[3]=(...m)=>s.uploadBatchDocuments&&s.uploadBatchDocuments(...m))},i(s.isUploading?`â³ Uploading ${s.selectedFiles.length}...`:`âœ… Upload ${s.selectedFiles.length} Document(s)`),9,Re),t("button",{class:"btn-clear-all",disabled:s.isUploading,onClick:e[4]||(e[4]=(...m)=>s.clearQueue&&s.clearQueue(...m))},"ðŸ—‘ï¸ Clear All",8,Ge)])])):(n(),l("div",Qe,"âš ï¸ No documents added yet. Add documents and click Upload.")),e[38]||(e[38]=t("p",{class:"upload-help"},[t("strong",null,"How it works:"),b(' Select type â†’ Choose file â†’ Click "Add Document" â†’ Repeat for more â†’ Click "Upload All" ')],-1)),e[39]||(e[39]=t("p",{class:"upload-help"},[t("strong",null,"Supported formats:"),b(" PDF, JPG, PNG, DOC, DOCX, XLS, XLSX (Max 10MB per file) ")],-1)),t("div",We,[e[34]||(e[34]=t("hr",{class:"divider"},null,-1)),t("div",Xe,[t("button",{class:"btn-cancel-submit",onClick:e[5]||(e[5]=m=>s.$emit("close"))},"âŒ Close")]),e[35]||(e[35]=t("small",{class:"submit-help"},"Upload documents or close to go back",-1))])])])])):f("",!0)])}const Ke=z(hs,[["render",Je],["__scopeId","data-v-027c6bca"]]),Ye=O({setup(){const{init:s}=is(),e=ts(null),{isValid:o,validate:c,resetValidation:a,reset:r}=ps(e),p=ts(!0),u=h=>{console.log(h),(h.value=="prior"||h.value=="after")&&(p.value=!1)},d=us({proposal:null,enity_id:null,description:"",doc_type:null,documents:[],uploadedDocuments:[]});return{iformRef:e,isValidForm:o,validateForm:c,resetValidationForm:a,resetForm:r,form:d,init:s,onInputChange:u,isNotUpBookingSelected:p}},data(){return{packages:[],installments:[],regulatoryPackages:[],proposalOptions:[],documentTypes:[{text:"Travel Packet (Passport Copy)",value:"Passport_Copy"},{text:"Travel Packet (Passport Photo)",value:"Passport_Photo"},{text:"Visa",value:"Visa"},{text:"Gun Permits",value:"Gun_Permits"},{text:"CITES Documentation",value:"CITES_Documentation"},{text:"Sales Invoice",value:"sales_invoice"},{text:"Receipt",value:"receipt"}],loadingSales:!1,salesItem:null}},computed:{...ns(q,["companions"])},mounted(){this.getSalesProposalOptions()},methods:{...L(B,["createContract"]),...L(q,["getallSalesConfirmation","getSalesConfirmationProposals"]),...L(q,["getCompanions"]),onValueChange(s){var a,r,p,u,d,h,v,g,y,w,C,$;if(!s)return;let e=null;typeof s=="object"&&(s.selfitem||s.value)?e=s:(typeof s=="number"||typeof s=="string")&&(e=this.proposalOptions.find(D=>String(D.value)===String(s))||null);const o=(e==null?void 0:e.selfitem)||e||null;console.log("Selected proposal full object:",o),console.log("Entity ID locations - sales_inquiry.entity.id:",(r=(a=o==null?void 0:o.sales_inquiry)==null?void 0:a.entity)==null?void 0:r.id),console.log("Entity ID locations - entity.id:",(p=o==null?void 0:o.entity)==null?void 0:p.id),console.log("Entity ID locations - client.id:",(u=o==null?void 0:o.client)==null?void 0:u.id),e&&(this.form.proposal=e),this.salesItem=o;const c=((d=o==null?void 0:o.client)==null?void 0:d.full_name)||((v=(h=o==null?void 0:o.sales_inquiry)==null?void 0:h.entity)==null?void 0:v.full_name)||((g=o==null?void 0:o.entity)==null?void 0:g.full_name)||(o==null?void 0:o.client_name)||"";c&&(this.form.description=this.buildDetailedDescription(o,c)),this.form.enity_id=((w=(y=o==null?void 0:o.sales_inquiry)==null?void 0:y.entity)==null?void 0:w.id)||((C=o==null?void 0:o.entity)==null?void 0:C.id)||(($=o==null?void 0:o.client)==null?void 0:$.id)||null},async onSubmit(){var r,p,u,d,h,v;let s=null,e=null;this.form.proposal&&(typeof this.form.proposal=="object"&&this.form.proposal.value?(s=this.form.proposal.value,e=this.form.proposal.selfitem):typeof this.form.proposal=="number"&&(s=this.form.proposal));const o=((p=(r=e==null?void 0:e.sales_inquiry)==null?void 0:r.entity)==null?void 0:p.id)||((u=e==null?void 0:e.entity)==null?void 0:u.id)||((d=e==null?void 0:e.client)==null?void 0:d.id)||null;if(!s){this.init({message:"Sales confirmation is required",color:"warning"});return}if(!e||!e.id){this.init({message:"Invalid sales confirmation selected. Please select again from the list.",color:"warning"});return}if(!o){this.init({message:"Entity information is missing. Please select a valid sales confirmation.",color:"warning"});return}const c=((h=e==null?void 0:e.status)==null?void 0:h.status)||(e==null?void 0:e.status)||"";if(String(c).toLowerCase()!=="completed"){this.init({message:"Contracts can only be created for completed sales confirmations.",color:"warning"});return}const a={sales_confirmation_proposal_id:s,entity_id:o,description:this.form.description};console.log("Form submission data:",a),console.log("Selected proposal object:",e);try{(await this.createContract(a)).status===201&&(this.init({message:"Contract created successfully",color:"success"}),this.resetForm(),this.resetValidationForm())}catch(g){console.error("Contract creation error:",g),console.error("Error response:",g.response),console.error("Error message:",g.message);const y=(v=g.response)==null?void 0:v.data,w=(y==null?void 0:y.error)||(y==null?void 0:y.message)||g.message||"";if(w.includes("Duplicate entry")||w.includes("constraint"))this.init({message:"A contract already exists for this sales confirmation and client combination. Please select a different sales confirmation to create a new contract.",color:"danger"});else if(w.includes("FOREIGN KEY"))this.init({message:"The selected sales confirmation is no longer available. Please refresh and select a different one.",color:"danger"}),this.getSalesProposalOptions();else if(g.response&&g.response.data){const C=fs(g.response);C.length>0?this.init({message:C.map(($,D)=>`${D+1}. ${$}`).join(`
`),color:"danger"}):this.init({message:w||"Failed to create contract. Please check the form data and try again.",color:"danger"})}else this.init({message:w||"An unexpected error occurred while creating the contract. Please try again.",color:"danger"})}},async getSalesProposalOptions(){var s;this.loadingSales=!0;try{const e=await this.getSalesConfirmationProposals();if(e&&e.status===200){this.loadingSales=!1;const o=Array.isArray(e.data)?e.data:((s=e.data)==null?void 0:s.data)||[];console.log("Raw proposal data:",o);const c=o.filter(a=>{var p;const r=((p=a==null?void 0:a.status)==null?void 0:p.status)||(a==null?void 0:a.status)||"";return String(r).toLowerCase()==="completed"});this.proposalOptions=c.filter(a=>a&&a.id).map(a=>{var d,h,v,g;console.log("Processing item:",a);let r="";(d=a.client)!=null&&d.full_name?r=a.client.full_name:(v=(h=a.sales_inquiry)==null?void 0:h.entity)!=null&&v.full_name?r=a.sales_inquiry.entity.full_name:(g=a.entity)!=null&&g.full_name?r=a.entity.full_name:typeof a.client_name=="string"?r=a.client_name:r="Proposal";const p=a.id,u=r||`Proposal ${p}`;return console.log("Option text:",u),{text:u,value:a.id,selfitem:a}}),console.log("Final proposalOptions:",this.proposalOptions)}else this.loadingSales=!1}catch(e){console.error("Error loading sales proposals:",e),this.loadingSales=!1}},buildDetailedDescription(s,e=""){var I,T;if(!s)return e||"";const o=s.hunting_trip||{},c=s.pricing||{},a=Array.isArray(s.hunt_combination)?s.hunt_combination:[],r=s.trip_details||{},p=s.companion_observer||{},u=((I=a[0])==null?void 0:I.title)||((T=a[0])==null?void 0:T.name)||(o==null?void 0:o.type)||"",d=(o==null?void 0:o.hunting_area)||(o==null?void 0:o.hunting_areas)&&o.hunting_areas[0]||"",h=(o==null?void 0:o.type)||"",v=c!=null&&c.total_amount?`${c.currency||""} ${c.total_amount}`.trim():"",g=(o==null?void 0:o.dates)||s.confirmation_date_formatted||"",y=a.map(_=>_.species||_.name||_.title).filter(Boolean),w=(r==null?void 0:r.no_of_hunters)||(r==null?void 0:r.no_of_hunters)||"",C=(p==null?void 0:p.no_of_companions)||(r==null?void 0:r.no_of_companions)||"",$=(p==null?void 0:p.no_of_observers)||(r==null?void 0:r.no_of_observers)||"",D=s.companion_hunter_cost||(c==null?void 0:c.companion_hunter_cost)||"",S=s.observer_fee||(c==null?void 0:c.observer_fee)||"",V=(o==null?void 0:o.extras)||s.extras||(c==null?void 0:c.extras)||[],F=s.trophy_fees||(c==null?void 0:c.trophy_fees)||[],m=[];return u&&m.push(`${u}`),d&&m.push(`Area: ${d}`),h&&m.push(`Safari Model: ${h}`),v&&m.push(`Cost: ${v}`),g&&m.push(`Dates: ${g}`),y.length&&m.push(`Species: ${y.join(", ")}`),w&&m.push(`Number SP to be hunted: ${w}`),C&&m.push(`Companion(s): ${C}`),D&&m.push(`Companion Hunter Cost: ${D}`),$&&m.push(`Observers: ${$}`),S&&m.push(`Observer Fee: ${S}`),Array.isArray(V)&&V.length>0&&(m.push("Safari Extras:"),V.forEach(_=>{const N=_.label||_.name||_.type||JSON.stringify(_),P=_.amount||_.price||_.fee||"";m.push(`  - ${N}${P?`: ${P}`:""}`)})),Array.isArray(F)&&F.length>0&&(m.push("Trophy Fees:"),F.forEach(_=>{const N=_.label||_.name||_.trophy||"",P=_.amount||_.price||_.fee||"";m.push(`  - ${N}${P?`: ${P}`:""}`)})),m.length===0&&e?e:m.join(`
`)},getSpeciesList(){return!this.salesItem||!this.salesItem.hunt_combination?[]:this.salesItem.hunt_combination.map(s=>s.species_name||s.species||s.name||s.title).filter(Boolean)},getStatusClass(s){var c;const e=((c=s==null?void 0:s.status)==null?void 0:c.status)||(s==null?void 0:s.status)||"",o=String(e).toLowerCase();return o==="completed"?"status-completed":o==="confirmed"?"status-confirmed":o==="pending"?"status-pending":"status-default"},getStatusText(s){var o;const e=((o=s==null?void 0:s.status)==null?void 0:o.status)||(s==null?void 0:s.status)||"";return String(e).charAt(0).toUpperCase()+String(e).slice(1).toLowerCase()},formatDate(s){if(!s)return"-";try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return s}},formatNumber(s){return!s&&s!==0?"-":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s)},formatFileSize(s){if(!s)return"0 Bytes";const e=1024,o=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,c)*100)/100+" "+o[c]},addDocument(){if(!this.form.doc_type){this.init({message:"Please select a document type",color:"warning"});return}if(!this.form.documents||this.form.documents.length===0){this.init({message:"Please upload a file",color:"warning"});return}const s=this.form.doc_type.text||this.form.doc_type;this.form.uploadedDocuments.push({type:s,file:this.form.documents[0]}),this.form.doc_type=null,this.form.documents=[],this.init({message:"Document added successfully",color:"success"})},removeDocument(s){this.form.uploadedDocuments.splice(s,1),this.init({message:"Document removed",color:"info"})},async uploadDocumentsForContract(s){try{const e="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/",o=`sales-confirmation/contracts/${s}/documents`,c=new FormData;this.form.uploadedDocuments.forEach((p,u)=>{c.append("documents[]",p.file),c.append(`doc_types[${u}]`,p.type)}),console.log("Uploading documents for contract:",s);const a=await fetch(`${e}${o}`,{method:"POST",body:c}),r=await a.json().catch(()=>({}));a.ok||a.status===201?(console.log("Documents uploaded successfully:",r),this.init({message:`âœ“ ${this.form.uploadedDocuments.length} document(s) uploaded successfully!`,color:"success"})):(console.error("Document upload failed:",r),this.init({message:"Warning: Contract created but document upload failed. Please upload documents manually.",color:"warning"}))}catch(e){console.error("Document upload error:",e),this.init({message:"Warning: Contract created but document upload encountered an error. Please upload documents manually.",color:"warning"})}},handleReset(){this.resetForm(),this.resetValidationForm()}}}),xe={class:"mb-6"},st={key:0,class:"proposal-details-card mt-4"},et={class:"details-header"},tt={class:"details-content"},ot={class:"info-section"},nt={class:"info-grid"},at={class:"info-item"},it={class:"info-value"},lt={key:0,class:"info-item"},rt={class:"info-value"},dt={key:1,class:"info-item"},ct={class:"info-value"},ut={key:2,class:"info-item"},mt={class:"info-value"},pt={key:3,class:"info-item"},ft={class:"info-value"},ht={class:"info-section"},gt={class:"info-grid"},vt={class:"info-item"},yt={class:"info-value"},_t={key:0,class:"info-item"},wt={class:"info-value"},bt={key:1,class:"info-item"},Ct={class:"info-value"},$t={class:"info-item"},Dt={class:"info-value"},kt={key:2,class:"info-item"},It={class:"info-value"},Mt={key:3,class:"info-item"},Vt={class:"info-value"},Ft={key:4,class:"info-item"},St={class:"info-value"},Pt={class:"info-section"},Tt={class:"info-grid"},At={key:0,class:"info-item"},Ht={class:"species-tags"},Nt={class:"info-item"},Et={class:"info-value"},Ut={key:1,class:"info-item"},Lt={class:"info-value"},Bt={key:2,class:"info-item"},Zt={class:"info-value"},qt={key:0,class:"info-section"},jt={class:"info-grid"},Ot={class:"info-item pricing-highlight"},zt={class:"info-value price-value"},Rt={key:0,class:"info-item"},Gt={class:"info-value"},Qt={key:1,class:"info-section"},Wt={class:"info-grid"},Xt={key:0,class:"info-item"},Jt={class:"info-value"},Kt={key:1,class:"info-item"},Yt={class:"info-value"},xt={key:2,class:"info-item"},so={class:"info-value"},eo={key:3,class:"info-item"},to={class:"info-value"},oo={key:4,class:"info-item"},no={class:"info-value"},ao={class:"description-section"},io={class:"description-input-area"},lo={class:"form-actions"},ro={width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"8px"}};function co(s,e,o,c,a,r){const p=M("VaSelect"),u=M("VaTextarea"),d=M("VaButton"),h=M("VaForm"),v=M("VaCardContent"),g=M("VaCard"),y=M("VaInnerLoading");return n(),Z(y,{loading:s.loadingSales},{default:H(()=>[A(g,{square:"",outlined:"",class:"contract-form-card"},{default:H(()=>[e[36]||(e[36]=t("div",{class:"form-header flex items-start gap-4 p-4"},[t("div",{class:"header-icon bg-primary-500 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-md"},[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2L15 8H21L16.5 12L18.5 18L12 14L5.5 18L7.5 12L3 8H9L12 2Z",fill:"currentColor"})])]),t("div",{class:"header-text"},[t("div",{class:"text-2xl font-semibold"},"Create Contract"),t("div",{class:"text-sm text-muted"}," Create a contract for a completed sales confirmation. Upload required documents below. ")])],-1)),A(v,{class:"p-6"},{default:H(()=>[A(h,{ref:"iformRef",class:"space-y-6"},{default:H(()=>{var w,C,$,D,S,V,F,m,I,T,_,N,P,R,G,Q,W,X,J,K,Y,x,ss,es;return[t("div",xe,[A(p,{modelValue:s.form.proposal,"onUpdate:modelValue":[e[0]||(e[0]=k=>s.form.proposal=k),s.onValueChange],options:s.proposalOptions,rules:[k=>k||"Sales confirmation is required"],placeholder:"Select sales confirmation",label:"Sales Confirmation",class:"mb-4"},null,8,["modelValue","options","rules","onUpdate:modelValue"]),s.salesItem?(n(),l("div",st,[t("div",et,[e[3]||(e[3]=t("h3",{class:"details-title"},"Sales Confirmation Details",-1)),t("div",{class:j(["status-badge",s.getStatusClass(s.salesItem)])},i(s.getStatusText(s.salesItem)),3)]),t("div",tt,[t("div",ot,[e[9]||(e[9]=t("h4",{class:"section-title"},[t("svg",{class:"section-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"currentColor"})]),b(" Client Information ")],-1)),t("div",nt,[t("div",at,[e[4]||(e[4]=t("span",{class:"info-label"},"Full Name:",-1)),t("span",it,i(((w=s.salesItem.client)==null?void 0:w.full_name)||"-"),1)]),(C=s.salesItem.client)!=null&&C.email?(n(),l("div",lt,[e[5]||(e[5]=t("span",{class:"info-label"},"Email:",-1)),t("span",rt,i(s.salesItem.client.email),1)])):f("",!0),($=s.salesItem.client)!=null&&$.country?(n(),l("div",dt,[e[6]||(e[6]=t("span",{class:"info-label"},"Country:",-1)),t("span",ct,i(s.salesItem.client.country),1)])):f("",!0),(D=s.salesItem.client)!=null&&D.nationality?(n(),l("div",ut,[e[7]||(e[7]=t("span",{class:"info-label"},"Nationality:",-1)),t("span",mt,i(s.salesItem.client.nationality),1)])):f("",!0),(S=s.salesItem.client)!=null&&S.cell?(n(),l("div",pt,[e[8]||(e[8]=t("span",{class:"info-label"},"Phone:",-1)),t("span",ft,i(s.salesItem.client.cell),1)])):f("",!0)])]),t("div",ht,[e[17]||(e[17]=t("h4",{class:"section-title"},[t("svg",{class:"section-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z",fill:"currentColor"})]),b(" Hunting Trip Details ")],-1)),t("div",gt,[t("div",vt,[e[10]||(e[10]=t("span",{class:"info-label"},"Hunting Area:",-1)),t("span",yt,i(((V=s.salesItem.hunting_trip)==null?void 0:V.hunting_area)||"-"),1)]),(F=s.salesItem.hunting_trip)!=null&&F.type?(n(),l("div",_t,[e[11]||(e[11]=t("span",{class:"info-label"},"Safari Type:",-1)),t("span",wt,i(s.salesItem.hunting_trip.type),1)])):f("",!0),(m=s.salesItem.hunting_trip)!=null&&m.outfitter?(n(),l("div",bt,[e[12]||(e[12]=t("span",{class:"info-label"},"Outfitter:",-1)),t("span",Ct,i(s.salesItem.hunting_trip.outfitter),1)])):f("",!0),t("div",$t,[e[13]||(e[13]=t("span",{class:"info-label"},"Dates:",-1)),t("span",Dt,i(((I=s.salesItem.hunting_trip)==null?void 0:I.dates)||s.salesItem.confirmation_date_formatted||"-"),1)]),(T=s.salesItem.hunting_trip)!=null&&T.start_date&&((_=s.salesItem.hunting_trip)!=null&&_.end_date)?(n(),l("div",kt,[e[14]||(e[14]=t("span",{class:"info-label"},"Start Date:",-1)),t("span",It,i(s.formatDate(s.salesItem.hunting_trip.start_date)),1)])):f("",!0),(N=s.salesItem.hunting_trip)!=null&&N.end_date?(n(),l("div",Mt,[e[15]||(e[15]=t("span",{class:"info-label"},"End Date:",-1)),t("span",Vt,i(s.formatDate(s.salesItem.hunting_trip.end_date)),1)])):f("",!0),(P=s.salesItem.hunting_trip)!=null&&P.no_of_days?(n(),l("div",Ft,[e[16]||(e[16]=t("span",{class:"info-label"},"Duration:",-1)),t("span",St,i(s.salesItem.hunting_trip.no_of_days)+" days",1)])):f("",!0)])]),t("div",Pt,[e[22]||(e[22]=t("h4",{class:"section-title"},[t("svg",{class:"section-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",fill:"currentColor"}),t("path",{d:"M2 17L12 22L22 17V12L12 17L2 12V17Z",fill:"currentColor"})]),b(" Species & Participants ")],-1)),t("div",Tt,[s.getSpeciesList().length>0?(n(),l("div",At,[e[18]||(e[18]=t("span",{class:"info-label"},"Species:",-1)),t("div",Ht,[(n(!0),l(E,null,U(s.getSpeciesList(),(k,ls)=>(n(),l("span",{key:ls,class:"species-tag"},i(k),1))),128))])])):f("",!0),t("div",Nt,[e[19]||(e[19]=t("span",{class:"info-label"},"Hunters:",-1)),t("span",Et,i(((R=s.salesItem.trip_details)==null?void 0:R.no_of_hunters)||"-"),1)]),(G=s.salesItem.companion_observer)!=null&&G.no_of_companions||(Q=s.salesItem.trip_details)!=null&&Q.no_of_companions?(n(),l("div",Ut,[e[20]||(e[20]=t("span",{class:"info-label"},"Companions:",-1)),t("span",Lt,i(((W=s.salesItem.companion_observer)==null?void 0:W.no_of_companions)||((X=s.salesItem.trip_details)==null?void 0:X.no_of_companions)||"-"),1)])):f("",!0),(J=s.salesItem.companion_observer)!=null&&J.no_of_observers||(K=s.salesItem.trip_details)!=null&&K.no_of_observers?(n(),l("div",Bt,[e[21]||(e[21]=t("span",{class:"info-label"},"Observers:",-1)),t("span",Zt,i(((Y=s.salesItem.companion_observer)==null?void 0:Y.no_of_observers)||((x=s.salesItem.trip_details)==null?void 0:x.no_of_observers)||"-"),1)])):f("",!0)])]),s.salesItem.pricing?(n(),l("div",qt,[e[25]||(e[25]=t("h4",{class:"section-title"},[t("svg",{class:"section-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M11.8 10.9C9.53 10.31 8.8 9.7 8.8 8.75C8.8 7.66 9.81 6.9 11.5 6.9C13.28 6.9 13.94 7.75 14 9H16.21C16.14 7.28 15.09 5.7 13 5.19V3H10V5.16C8.06 5.58 6.5 6.84 6.5 8.77C6.5 10.65 8.2 11.96 11 12.58C13.5 13.11 14.2 13.85 14.2 14.9C14.2 15.91 13.36 16.75 11.5 16.75C9.45 16.75 8.7 15.81 8.6 14.5H6.39C6.5 16.47 7.88 17.9 10 18.29V21H13V18.33C14.95 17.9 16.5 16.66 16.5 14.7C16.5 12.36 14.47 11.1 11.8 10.9Z",fill:"currentColor"})]),b(" Pricing Information ")],-1)),t("div",jt,[t("div",Ot,[e[23]||(e[23]=t("span",{class:"info-label"},"Total Amount:",-1)),t("span",zt,i(s.salesItem.pricing.currency||"")+" "+i(s.formatNumber(s.salesItem.pricing.total_amount)),1)]),s.salesItem.pricing.installments&&s.salesItem.pricing.installments.length>0?(n(),l("div",Rt,[e[24]||(e[24]=t("span",{class:"info-label"},"Installments:",-1)),t("span",Gt,i(s.salesItem.pricing.installments.length)+" payment(s)",1)])):f("",!0)])])):f("",!0),s.salesItem.sales_inquiry||s.salesItem.confirmation_date_formatted||s.salesItem.hunting_license?(n(),l("div",Qt,[e[31]||(e[31]=t("h4",{class:"section-title"},[t("svg",{class:"section-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM7 10H9V17H7V10ZM11 7H13V17H11V7ZM15 13H17V17H15V13Z",fill:"currentColor"})]),b(" Additional Information ")],-1)),t("div",Wt,[(ss=s.salesItem.sales_inquiry)!=null&&ss.code?(n(),l("div",Xt,[e[26]||(e[26]=t("span",{class:"info-label"},"Sales Inquiry Code:",-1)),t("span",Jt,i(s.salesItem.sales_inquiry.code),1)])):f("",!0),(es=s.salesItem.sales_inquiry)!=null&&es.season?(n(),l("div",Kt,[e[27]||(e[27]=t("span",{class:"info-label"},"Season:",-1)),t("span",Yt,i(s.salesItem.sales_inquiry.season),1)])):f("",!0),s.salesItem.confirmation_date_formatted?(n(),l("div",xt,[e[28]||(e[28]=t("span",{class:"info-label"},"Confirmation Date:",-1)),t("span",so,i(s.salesItem.confirmation_date_formatted),1)])):f("",!0),s.salesItem.hunting_license?(n(),l("div",eo,[e[29]||(e[29]=t("span",{class:"info-label"},"Hunting License:",-1)),t("span",to,i(s.salesItem.hunting_license),1)])):f("",!0),s.salesItem.remarks?(n(),l("div",oo,[e[30]||(e[30]=t("span",{class:"info-label"},"Remarks:",-1)),t("span",no,i(s.salesItem.remarks),1)])):f("",!0)])])):f("",!0)])])):f("",!0)]),t("div",ao,[e[32]||(e[32]=t("div",{class:"section-header"},[t("h3",{class:"section-title-large"},[t("svg",{class:"section-icon-large",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z",fill:"currentColor"})]),b(" Contract Description ")]),t("p",{class:"section-description"}," Provide a detailed description for this contract. This will be pre-filled with sales confirmation details, but you can edit it as needed. ")],-1)),t("div",io,[A(u,{modelValue:s.form.description,"onUpdate:modelValue":e[1]||(e[1]=k=>s.form.description=k),label:"Description",placeholder:"Enter contract description...","min-rows":6,"max-rows":12,counter:"",autosize:"","required-mark":"",rules:[k=>k&&k.length>0||"Description is required"],class:"description-textarea"},null,8,["modelValue","rules"])])]),t("div",lo,[A(d,{preset:"outline",color:"danger",size:"medium",class:"action-button",onClick:s.handleReset},{default:H(()=>e[33]||(e[33]=[b(" Cancel ")])),_:1},8,["onClick"]),A(d,{color:"primary",size:"large",disabled:!s.isValidForm,class:"action-button primary-action",onClick:e[2]||(e[2]=k=>s.validateForm()&&s.onSubmit())},{default:H(()=>[(n(),l("svg",ro,e[34]||(e[34]=[t("path",{d:"M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z",fill:"currentColor"},null,-1)]))),e[35]||(e[35]=b(" Create Contract "))]),_:1},8,["disabled"])])]}),_:1},512)]),_:1})]),_:1})]),_:1},8,["loading"])}const uo=z(Ye,[["render",co],["__scopeId","data-v-25df96a9"]]),mo=O({components:{ContractDetails:Ke,ContractForm:uo},data(){return{columns:[{key:"contract_number",sortable:!0},{key:"client_name",sortable:!0},{key:"start_date",sortable:!0},{key:"end_date",sortable:!0},{key:"created_at",sortable:!0},{key:"actions",label:"Actions"}],item:null,showDetails:!1,showAddContractForm:!1,isEditMode:!1}},computed:{...ns(B,["contracts","loadingContracts"])},watch:{},mounted(){this.getContracts()},methods:{...L(B,["getContracts"]),formatColumnName(s){return s.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},formatDate(s){if(!s)return"N/A";try{return new Date(s).toLocaleDateString()}catch{return"N/A"}},async deleteContract(s){var o,c,a,r,p;if(!(s!=null&&s.id)){alert("Contract ID is missing");return}const e=s.contract_number||`Contract #${s.id}`;if(confirm(`Are you sure you want to delete ${e}? This action cannot be undone.`))try{const d=await B().deleteContractById(s.id);(d.status===200||d.status===204)&&(alert("Contract deleted successfully"),this.getContracts())}catch(u){console.error("Full delete error:",u);let d="Failed to delete contract";((o=u.response)==null?void 0:o.status)===500?d="Server error (500). Please check the backend logs for details.":(a=(c=u.response)==null?void 0:c.data)!=null&&a.message?d=u.response.data.message:(p=(r=u.response)==null?void 0:r.data)!=null&&p.error?d=u.response.data.error:u.message&&(d=u.message),alert(`Error: ${d}`)}},async downloadPdf(s){if(!s){alert("PDF is not available for this contract yet.");return}try{await as(s,"contract.pdf")}catch(e){console.error("PDF download error:",e);const o=(e==null?void 0:e.message)||"Unknown error";o.includes("500")?alert(`The PDF generation service is temporarily unavailable.

Please try again in a few moments. If the problem persists, contact support.`):o.includes("404")?alert("The PDF file was not found on the server. The contract may not have been processed yet."):alert(`Failed to download PDF. Please try again or contact support.

Error: `+o)}},viewContract(s){this.item=s,this.showDetails=!0,this.isEditMode=!1,this.showAddContractForm=!1},gotBack(){this.getContracts(),this.showDetails=!1,this.showAddContractForm=!1,this.isEditMode=!1},toggleAddSalesInquiriesForm(){this.showDetails=!1,this.showAddContractForm=!this.showAddContractForm}}}),po={class:"contracts-page"},fo={class:"d-flex justify-content-between align-items-center mb-4"},ho={class:"d-flex align-items-center gap-3"},go={key:0},vo={key:0,class:"card shadow-sm contracts-list-card"},yo={class:"card-body p-0"},_o={class:"table-responsive"},wo={class:"table table-hover table-striped mb-0"},bo={class:"thead-light"},Co={key:0},$o=["colspan"],Do={key:1},ko=["colspan"],Io={class:"btn-group",role:"group"},Mo=["disabled","title","onClick"],Vo=["onClick"],Fo=["onClick"];function So(s,e,o,c,a,r){const p=M("ContractForm"),u=M("ContractDetails");return n(),l("div",po,[t("div",fo,[t("div",ho,[s.showDetails||s.showAddContractForm?(n(),l("button",{key:0,class:"btn btn-outline-secondary btn-sm",onClick:e[0]||(e[0]=d=>s.gotBack())},e[2]||(e[2]=[t("i",{class:"material-icons mr-1",style:{"font-size":"18px"}},"arrow_back",-1),b(" Go Back ")]))):f("",!0)]),!s.showAddContractForm&&!s.showDetails?(n(),l("div",go,[t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=d=>s.toggleAddSalesInquiriesForm())},e[3]||(e[3]=[t("i",{class:"material-icons mr-1",style:{"font-size":"18px"}},"add",-1),b(" Create Contract ")]))])):f("",!0)]),s.showDetails?(n(),Z(u,{key:1,"contract-item":s.item,"is-edit-mode":s.isEditMode},null,8,["contract-item","is-edit-mode"])):(n(),l(E,{key:0},[s.showAddContractForm?(n(),Z(p,{key:1})):(n(),l("div",vo,[e[9]||(e[9]=os('<div class="card-header bg-white border-bottom" data-v-6193413c><div class="d-flex align-items-center" data-v-6193413c><i class="material-icons mr-2 text-muted" data-v-6193413c>feed</i><div data-v-6193413c><h5 class="mb-0 font-weight-bold" data-v-6193413c>Contracts</h5><small class="text-muted" data-v-6193413c>All Available contracts</small></div></div></div>',1)),t("div",yo,[t("div",_o,[t("table",wo,[t("thead",bo,[t("tr",null,[(n(!0),l(E,null,U(s.columns,d=>(n(),l("th",{key:d.key,scope:"col",class:"text-nowrap"},i(d.label||s.formatColumnName(d.key)),1))),128))])]),t("tbody",null,[s.loadingContracts?(n(),l("tr",Co,[t("td",{colspan:s.columns.length,class:"text-center py-5"},e[4]||(e[4]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"mt-2 text-muted"},"Loading contracts...",-1)]),8,$o)])):s.contracts.length===0?(n(),l("tr",Do,[t("td",{colspan:s.columns.length,class:"text-center py-5"},e[5]||(e[5]=[t("i",{class:"material-icons text-muted",style:{"font-size":"48px"}},"description",-1),t("p",{class:"mt-2 text-muted"},"No contracts found",-1)]),8,ko)])):(n(!0),l(E,{key:2},U(s.contracts,(d,h)=>(n(),l("tr",{key:h},[t("td",null,i(d.contract_number||"N/A"),1),t("td",null,i(d.client_name||"N/A"),1),t("td",null,i(s.formatDate(d.start_date)),1),t("td",null,i(s.formatDate(d.end_date)),1),t("td",null,i(s.formatDate(d.created_at)),1),t("td",null,[t("div",Io,[t("button",{class:"btn btn-sm btn-outline-primary",disabled:!d.pdf,title:d.pdf?"Download PDF":"PDF not available",onClick:v=>s.downloadPdf(d.pdf)},e[6]||(e[6]=[t("i",{class:"material-icons",style:{"font-size":"18px"}},"download",-1)]),8,Mo),t("button",{class:"btn btn-sm btn-outline-info",title:"View Contract",onClick:v=>s.viewContract(d.selfitem)},e[7]||(e[7]=[t("i",{class:"material-icons",style:{"font-size":"18px"}},"visibility",-1)]),8,Vo),t("button",{class:"btn btn-sm btn-outline-danger",title:"Delete Contract",onClick:v=>s.deleteContract(d.selfitem)},e[8]||(e[8]=[t("i",{class:"material-icons",style:{"font-size":"18px"}},"delete",-1)]),8,Fo)])])]))),128))])])])])]))],64))])}const Zo=z(mo,[["render",So],["__scopeId","data-v-6193413c"]]);export{Zo as default};
//# sourceMappingURL=Contracts-1rfpy70f.js.map
