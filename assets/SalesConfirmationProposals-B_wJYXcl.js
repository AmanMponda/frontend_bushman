import{j as X,k as D,d as N,_ as B,g as m,e as s,v as b,a as k,t as u,w as i,h,i as c,b as a,I as L,F,f as O,o as l,n as U,q as E,m as W,l as R}from"./index-BWHJDooV.js";import{u as Y}from"./settings-store-W7vxArlA.js";import{u as J}from"./useForm-D3NxtFXh.js";import{f as H}from"./format-Cn4G_mmc.js";import{u as K}from"./useToast-s8yo9qJb.js";const j=X("proposals",{state:()=>({proposals:[],currentProposal:null,pipeline:{new_inquiries:[],pending:[],provision_sales:[],confirmed:[],cancelled:[],completed:[]},pipelineCounts:{new_inquiries:0,pending:0,provision_sales:0,confirmed:0,cancelled:0,completed:0},pipelineTotal:0,paymentStatus:null,loading:!1,saving:!1,error:null}),getters:{getProposalById:e=>t=>e.proposals.find(n=>n.id===t),pendingProposals:e=>e.proposals.filter(t=>t.status==="pending"),confirmedProposals:e=>e.proposals.filter(t=>t.status==="confirmed"),newInquiries:e=>e.pipeline.new_inquiries,pendingItems:e=>e.pipeline.pending,provisionSalesItems:e=>e.pipeline.provision_sales,confirmedItems:e=>e.pipeline.confirmed,cancelledItems:e=>e.pipeline.cancelled,completedItems:e=>e.pipeline.completed},actions:{async fetchPipeline(e,t){this.loading=!0,this.error=null;try{let n="https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/pipeline";const r=new URLSearchParams;e&&r.append("stage",e),t&&r.append("season_id",String(t)),r.toString()&&(n+=`?${r.toString()}`);const d=await D.get(n);return d.data.success&&(this.pipeline=d.data.data,this.pipelineCounts=d.data.counts,this.pipelineTotal=d.data.total),d}catch(n){throw this.error=n.message||"Failed to fetch pipeline",console.error("Error fetching pipeline:",n),n}finally{this.loading=!1}},async updatePipelineStage(e,t){this.saving=!0,this.error=null;try{const n=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/pipeline/${e}/stage`,r=await D.put(n,{stage:t});return r.data.success&&await this.fetchPipeline(),r}catch(n){throw this.error=n.message||"Failed to update stage",console.error("Error updating pipeline stage:",n),n}finally{this.saving=!1}},async fetchProposals(){this.loading=!0,this.error=null;try{const t=await D.get("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals");return t.data.success?this.proposals=t.data.data:this.proposals=Array.isArray(t.data)?t.data:[],t}catch(e){throw this.error=e.message||"Failed to fetch proposals",console.error("Error fetching proposals:",e),e}finally{this.loading=!1}},async fetchProposalById(e){this.loading=!0,this.error=null;try{const t=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals/${e}`,n=await D.get(t);return n.data.success?this.currentProposal=n.data.data:this.currentProposal=n.data,n}catch(t){throw this.error=t.message||"Failed to fetch proposal",console.error("Error fetching proposal:",t),t}finally{this.loading=!1}},async createProposal(e){this.saving=!0,this.error=null;try{const n=await D.post("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals",e);return n.data.success&&n.data.data&&this.proposals.push(n.data.data),n}catch(t){throw this.error=t.message||"Failed to create proposal",console.error("Error creating proposal:",t),t}finally{this.saving=!1}},async updateProposal(e,t){var n;this.saving=!0,this.error=null;try{const r=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals/${e}`,d=await D.put(r,t);if(d.data.success&&d.data.data){const _=this.proposals.findIndex(p=>p.id===e);_!==-1&&(this.proposals[_]=d.data.data),((n=this.currentProposal)==null?void 0:n.id)===e&&(this.currentProposal=d.data.data)}return d}catch(r){throw this.error=r.message||"Failed to update proposal",console.error("Error updating proposal:",r),r}finally{this.saving=!1}},async updateProposalStatus(e,t){return this.updateProposal(e,{status:t})},async fetchPayments(e){this.loading=!0,this.error=null;try{const t=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals/${e}/payments`,n=await D.get(t);return n.data.success&&(this.paymentStatus=n.data.data),n}catch(t){throw this.error=t.message||"Failed to fetch payments",console.error("Error fetching payments:",t),t}finally{this.loading=!1}},async recordPayment(e,t){this.saving=!0,this.error=null;try{const n=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/installments/${e}/pay`,r=await D.post(n,t);return r.data.success&&this.paymentStatus&&await this.fetchPayments(this.paymentStatus.proposal_id),r.data.success&&this.currentProposal&&await this.fetchProposalById(this.currentProposal.id),r.data}catch(n){throw this.error=n.message||"Failed to record payment",console.error("Error recording payment:",n),n}finally{this.saving=!1}},async unpayInstallment(e){this.saving=!0,this.error=null;try{const t=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/installments/${e}/unpay`,n=await D.post(t);return n.data.success&&this.paymentStatus&&await this.fetchPayments(this.paymentStatus.proposal_id),n.data.success&&this.currentProposal&&await this.fetchProposalById(this.currentProposal.id),n.data}catch(t){throw this.error=t.message||"Failed to reverse payment",console.error("Error reversing payment:",t),t}finally{this.saving=!1}},async deletePayment(e){this.saving=!0,this.error=null;try{const t=`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/payments/${e}`,n=await D.delete(t);return n.data.success&&this.paymentStatus&&await this.fetchPayments(this.paymentStatus.proposal_id),n.data.success&&this.currentProposal&&await this.fetchProposalById(this.currentProposal.id),n.data}catch(t){throw this.error=t.message||"Failed to delete payment",console.error("Error deleting payment:",t),t}finally{this.saving=!1}},clearPaymentStatus(){this.paymentStatus=null},clearCurrentProposal(){this.currentProposal=null,this.paymentStatus=null},clearError(){this.error=null}}}),Z=N({name:"PipelineCard",props:{item:{type:Object,required:!0}},emits:["click","create-proposal","view","edit"],computed:{formatDateRange(){const e=this.item.hunting_details;if(!(e!=null&&e.start_date))return"N/A";const t=_=>{try{return new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return _}},n=t(e.start_date),r=e.end_date?t(e.end_date):"",d=e.no_of_days?` (${e.no_of_days}d)`:"";return r?`${n} - ${r}${d}`:`${n}${d}`}},methods:{handleClick(){this.$emit("click",this.item)},truncateSpecies(e){return e?e.length>30?e.substring(0,30)+"...":e:"N/A"},formatCurrency(e){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"}}}),x={class:"card-header"},ee={class:"inquiry-code"},te={class:"client-info"},se={class:"client-name"},ae={class:"client-meta"},ne={class:"hunting-details"},oe={class:"detail-row"},le={class:"detail-text truncate"},ie={class:"detail-row"},re={class:"detail-text"},de={class:"detail-row"},ue={class:"detail-text"},pe={key:0,class:"detail-row amount-row"},me={class:"detail-text amount"},ce={key:1,class:"detail-row"},ye={class:"detail-text"},fe={key:0,class:"agent-info"},he={class:"agent-name"},ge={class:"card-actions"};function _e(e,t,n,r,d,_){var C,f,v,P,o;const p=c("VaChip"),$=c("VaIcon"),y=c("VaButton");return l(),m("div",{class:O(["pipeline-card",{"is-new":e.item.type==="inquiry"}]),onClick:t[3]||(t[3]=(...g)=>e.handleClick&&e.handleClick(...g))},[s("div",x,[s("span",ee,u(e.item.code),1),e.item.type==="proposal"?(l(),k(p,{key:0,size:"small",color:"primary"},{default:i(()=>t[4]||(t[4]=[h(" Quotation ")])),_:1})):b("",!0)]),s("div",te,[s("h4",se,u(((C=e.item.client)==null?void 0:C.full_name)||"Unknown Client"),1),s("p",ae,u(((f=e.item.client)==null?void 0:f.country)||"N/A")+" • "+u(e.item.created_date_formatted||e.item.created_date),1)]),s("div",ne,[s("div",oe,[a($,{name:"pets",size:"small",color:"secondary"}),s("span",le,u(e.truncateSpecies((v=e.item.hunting_details)==null?void 0:v.species)),1)]),s("div",ie,[a($,{name:"location_on",size:"small",color:"secondary"}),s("span",re,u(((P=e.item.hunting_details)==null?void 0:P.areas)||"N/A"),1)]),s("div",de,[a($,{name:"calendar_today",size:"small",color:"secondary"}),s("span",ue,u(e.formatDateRange),1)]),e.item.type==="proposal"&&e.item.total_amount?(l(),m("div",pe,[a($,{name:"payments",size:"small",color:"success"}),s("span",me,u(e.formatCurrency(e.item.total_amount)),1)])):(l(),m("div",ce,[a($,{name:"person",size:"small",color:"secondary"}),s("span",ye,u(((o=e.item.hunting_details)==null?void 0:o.no_of_hunters)||0)+" hunter(s)",1)]))]),e.item.sales_agent?(l(),m("div",fe,[a($,{name:"support_agent",size:"small",color:"info"}),s("span",he,u(e.item.sales_agent.name),1)])):b("",!0),s("div",ge,[e.item.type==="inquiry"?(l(),k(y,{key:0,size:"small",color:"primary",block:"",onClick:t[0]||(t[0]=L(g=>e.$emit("create-proposal",e.item),["stop"]))},{default:i(()=>t[5]||(t[5]=[h(" Create Quotation ")])),_:1})):(l(),m(F,{key:1},[a(y,{size:"small",preset:"secondary",onClick:t[1]||(t[1]=L(g=>e.$emit("view",e.item),["stop"]))},{default:i(()=>t[6]||(t[6]=[h(" View ")])),_:1}),a(y,{size:"small",preset:"plain",color:"info",onClick:t[2]||(t[2]=L(g=>e.$emit("edit",e.item),["stop"]))},{default:i(()=>t[7]||(t[7]=[h(" Edit ")])),_:1})],64))])],2)}const ve=B(Z,[["render",_e],["__scopeId","data-v-6712a9b3"]]),$e=N({name:"PipelineBoard",components:{PipelineCard:ve},props:{pipeline:{type:Object,required:!0},counts:{type:Object,required:!0},loading:{type:Boolean,default:!1},saving:{type:Boolean,default:!1},seasonOptions:{type:Array,default:()=>[]}},emits:["refresh","season-change","create-proposal","view-proposal","edit-proposal","stage-change"],data(){return{seasonFilter:null,showStageModal:!1,selectedItem:null,targetStage:null,stageColors:{new_inquiries:"warning",pending:"warning",provision_sales:"info",confirmed:"success",cancelled:"secondary",completed:"primary"},stageOptions:[{value:"pending",text:"Pending"},{value:"provision_sales",text:"Provision Sales"},{value:"confirmed",text:"Confirmed"},{value:"cancelled",text:"Cancelled"},{value:"completed",text:"Completed"}]}},computed:{totalItems(){return Object.values(this.counts).reduce((e,t)=>e+t,0)},hasData(){return this.totalItems>0},availableStages(){if(!this.selectedItem)return this.stageOptions;const e=this.selectedItem.stage==="new"?"new_inquiries":this.selectedItem.stage;return this.stageOptions.filter(t=>t.value!==e)}},methods:{refreshPipeline(){this.$emit("refresh")},onSeasonChange(e){this.$emit("season-change",e)},handleCardClick(e){e.type==="proposal"&&this.$emit("view-proposal",e)},openStageModal(e){this.selectedItem=e,this.targetStage=null,this.showStageModal=!0},confirmStageChange(){this.selectedItem&&this.targetStage&&(this.$emit("stage-change",{inquiryId:this.selectedItem.id,newStage:this.targetStage}),this.showStageModal=!1,this.selectedItem=null,this.targetStage=null)}}}),Ce={class:"pipeline-board"},be={class:"board-header"},we={class:"flex items-center gap-4"},Se={class:"flex gap-3"},Pe={key:0,class:"loading-container"},ke={key:1,class:"pipeline-columns"},Ve={class:"pipeline-column new-inquiries"},Ie={class:"column-title"},qe={class:"column-content"},De={key:0,class:"empty-column"},Fe={class:"pipeline-column pending"},Ae={class:"column-title"},Ee={class:"column-content"},Ne={key:0,class:"empty-column"},Be={class:"pipeline-column provision-sales"},Ue={class:"column-title"},Me={class:"column-content"},Te={key:0,class:"empty-column"},Oe={class:"pipeline-column confirmed"},je={class:"column-title"},Re={class:"column-content"},ze={key:0,class:"empty-column"},Le={class:"pipeline-column cancelled"},Qe={class:"column-title"},Ge={class:"column-content"},He={key:0,class:"empty-column"},We={class:"pipeline-column completed"},Xe={class:"column-title"},Ye={class:"column-content"},Je={key:0,class:"empty-column"},Ke={class:"p-4"},Ze={class:"mb-4"},xe={class:"flex justify-end gap-3"};function et(e,t,n,r,d,_){const p=c("VaBadge"),$=c("VaSelect"),y=c("VaButton"),C=c("VaProgressBar"),f=c("VaIcon"),v=c("PipelineCard"),P=c("VaModal");return l(),m("div",Ce,[s("div",be,[s("div",we,[t[4]||(t[4]=s("h2",{class:"text-xl font-bold text-gray-800"},"Sales Confirmation Pipeline",-1)),a(p,{text:String(e.totalItems),color:"primary"},null,8,["text"])]),s("div",Se,[a($,{modelValue:e.seasonFilter,"onUpdate:modelValue":[t[0]||(t[0]=o=>e.seasonFilter=o),e.onSeasonChange],options:e.seasonOptions,placeholder:"All Seasons",class:"w-48",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"]),a(y,{preset:"secondary",icon:"refresh",loading:e.loading,onClick:e.refreshPipeline},{default:i(()=>t[5]||(t[5]=[h(" Refresh ")])),_:1},8,["loading","onClick"])])]),e.loading&&!e.hasData?(l(),m("div",Pe,[a(C,{indeterminate:""}),t[6]||(t[6]=s("p",{class:"text-center mt-4 text-gray-600"},"Loading pipeline...",-1))])):(l(),m("div",ke,[s("div",Ve,[s("div",{class:"column-header",style:U({borderColor:e.stageColors.new_inquiries})},[s("div",Ie,[a(f,{name:"fiber_new",color:e.stageColors.new_inquiries},null,8,["color"]),t[7]||(t[7]=s("span",null,"New Inquiries",-1))]),a(p,{text:String(e.counts.new_inquiries),color:e.stageColors.new_inquiries},null,8,["text","color"])],4),s("div",qe,[e.pipeline.new_inquiries.length===0?(l(),m("div",De,[a(f,{name:"inbox",size:"2rem",color:"secondary"}),t[8]||(t[8]=s("span",null,"No new inquiries",-1))])):b("",!0),(l(!0),m(F,null,E(e.pipeline.new_inquiries,o=>(l(),k(v,{key:`new-${o.id}`,item:o,onCreateProposal:g=>e.$emit("create-proposal",o),onClick:g=>e.handleCardClick(o)},null,8,["item","onCreateProposal","onClick"]))),128))])]),s("div",Fe,[s("div",{class:"column-header",style:U({borderColor:e.stageColors.pending})},[s("div",Ae,[a(f,{name:"hourglass_empty",color:e.stageColors.pending},null,8,["color"]),t[9]||(t[9]=s("span",null,"Pending",-1))]),a(p,{text:String(e.counts.pending),color:e.stageColors.pending},null,8,["text","color"])],4),s("div",Ee,[e.pipeline.pending.length===0?(l(),m("div",Ne,[a(f,{name:"hourglass_empty",size:"2rem",color:"secondary"}),t[10]||(t[10]=s("span",null,"No pending items",-1))])):b("",!0),(l(!0),m(F,null,E(e.pipeline.pending,o=>(l(),k(v,{key:`pending-${o.id}`,item:o,onView:g=>e.$emit("view-proposal",o),onEdit:g=>e.$emit("edit-proposal",o),onClick:g=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])]),s("div",Be,[s("div",{class:"column-header",style:U({borderColor:e.stageColors.provision_sales})},[s("div",Ue,[a(f,{name:"pending_actions",color:e.stageColors.provision_sales},null,8,["color"]),t[11]||(t[11]=s("span",null,"Provision Sales",-1))]),a(p,{text:String(e.counts.provision_sales),color:e.stageColors.provision_sales},null,8,["text","color"])],4),s("div",Me,[e.pipeline.provision_sales.length===0?(l(),m("div",Te,[a(f,{name:"pending_actions",size:"2rem",color:"secondary"}),t[12]||(t[12]=s("span",null,"No provisional sales",-1))])):b("",!0),(l(!0),m(F,null,E(e.pipeline.provision_sales,o=>(l(),k(v,{key:`provision-${o.id}`,item:o,onView:g=>e.$emit("view-proposal",o),onEdit:g=>e.$emit("edit-proposal",o),onClick:g=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])]),s("div",Oe,[s("div",{class:"column-header",style:U({borderColor:e.stageColors.confirmed})},[s("div",je,[a(f,{name:"check_circle",color:e.stageColors.confirmed},null,8,["color"]),t[13]||(t[13]=s("span",null,"Confirmed",-1))]),a(p,{text:String(e.counts.confirmed),color:e.stageColors.confirmed},null,8,["text","color"])],4),s("div",Re,[e.pipeline.confirmed.length===0?(l(),m("div",ze,[a(f,{name:"check_circle",size:"2rem",color:"secondary"}),t[14]||(t[14]=s("span",null,"No confirmed items",-1))])):b("",!0),(l(!0),m(F,null,E(e.pipeline.confirmed,o=>(l(),k(v,{key:`confirmed-${o.id}`,item:o,onView:g=>e.$emit("view-proposal",o),onEdit:g=>e.$emit("edit-proposal",o),onClick:g=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])]),s("div",Le,[s("div",{class:"column-header",style:U({borderColor:e.stageColors.cancelled})},[s("div",Qe,[a(f,{name:"cancel",color:e.stageColors.cancelled},null,8,["color"]),t[15]||(t[15]=s("span",null,"Cancelled",-1))]),a(p,{text:String(e.counts.cancelled),color:e.stageColors.cancelled},null,8,["text","color"])],4),s("div",Ge,[e.pipeline.cancelled.length===0?(l(),m("div",He,[a(f,{name:"cancel",size:"2rem",color:"secondary"}),t[16]||(t[16]=s("span",null,"No cancelled items",-1))])):b("",!0),(l(!0),m(F,null,E(e.pipeline.cancelled,o=>(l(),k(v,{key:`cancelled-${o.id}`,item:o,onView:g=>e.$emit("view-proposal",o),onEdit:g=>e.$emit("edit-proposal",o),onClick:g=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])]),s("div",We,[s("div",{class:"column-header",style:U({borderColor:e.stageColors.completed})},[s("div",Xe,[a(f,{name:"task_alt",color:e.stageColors.completed},null,8,["color"]),t[17]||(t[17]=s("span",null,"Completed",-1))]),a(p,{text:String(e.counts.completed),color:e.stageColors.completed},null,8,["text","color"])],4),s("div",Ye,[e.pipeline.completed.length===0?(l(),m("div",Je,[a(f,{name:"task_alt",size:"2rem",color:"secondary"}),t[18]||(t[18]=s("span",null,"No completed items",-1))])):b("",!0),(l(!0),m(F,null,E(e.pipeline.completed,o=>(l(),k(v,{key:`completed-${o.id}`,item:o,onView:g=>e.$emit("view-proposal",o),onEdit:g=>e.$emit("edit-proposal",o),onClick:g=>e.handleCardClick(o)},null,8,["item","onView","onEdit","onClick"]))),128))])])])),a(P,{modelValue:e.showStageModal,"onUpdate:modelValue":t[3]||(t[3]=o=>e.showStageModal=o),title:"Move to Stage",size:"small","hide-default-actions":!0},{default:i(()=>{var o;return[s("div",Ke,[s("p",Ze,[t[19]||(t[19]=h(" Move ")),s("strong",null,u((o=e.selectedItem)==null?void 0:o.code),1),t[20]||(t[20]=h(" to: "))]),a($,{modelValue:e.targetStage,"onUpdate:modelValue":t[1]||(t[1]=g=>e.targetStage=g),options:e.availableStages,label:"Select Stage",class:"mb-4"},null,8,["modelValue","options"]),s("div",xe,[a(y,{preset:"secondary",onClick:t[2]||(t[2]=g=>e.showStageModal=!1)},{default:i(()=>t[21]||(t[21]=[h(" Cancel ")])),_:1}),a(y,{color:"primary",loading:e.saving,disabled:!e.targetStage,onClick:e.confirmStageChange},{default:i(()=>t[22]||(t[22]=[h(" Move ")])),_:1},8,["loading","disabled","onClick"])])])]}),_:1},8,["modelValue"])])}const tt=B($e,[["render",et],["__scopeId","data-v-b1b7efe9"]]),st=N({name:"StageIndicator",props:{currentStage:{type:String,required:!0},installments:{type:Array,default:()=>[]}},data(){return{stages:[{value:"new_inquiries",label:"NEW"},{value:"pending",label:"PEND"},{value:"provision_sales",label:"PROV"},{value:"confirmed",label:"CONF"},{value:"completed",label:"COMP"}],stageColors:{new_inquiries:"#E3F2FD",pending:"#FFF9C4",provision_sales:"#FFE0B2",confirmed:"#C8E6C9",cancelled:"#FFCDD2",completed:"#E1BEE7"},stageActiveColors:{new_inquiries:"#2196F3",pending:"#FFC107",provision_sales:"#FF9800",confirmed:"#4CAF50",cancelled:"#F44336",completed:"#9C27B0"}}},computed:{stageOrder(){return this.stages.map(e=>e.value)},currentStageIndex(){return this.stageOrder.indexOf(this.currentStage)},mainInstallments(){return this.installments.filter(e=>{var r;const t=((r=e.installment_type)==null?void 0:r.toLowerCase())||"",n=e.narration.toLowerCase();return t.includes("deposit")||t.includes("final")||t.includes("trophy")||n.includes("deposit")||n.includes("final")||n.includes("trophy")})}},methods:{isStageCompleted(e){return this.currentStage==="cancelled"?!1:this.stageOrder.indexOf(e)<this.currentStageIndex},getStageColor(e){return this.currentStage==="cancelled"?this.stageActiveColors.cancelled:this.isStageCompleted(e)||this.currentStage===e?this.stageActiveColors[e]||this.stageActiveColors.pending:"#e0e0e0"},getShortLabel(e){const t=e.narration.toLowerCase();return t.includes("deposit")&&t.includes("booking")?"Deposit":t.includes("2nd")||t.includes("year prior")?"2nd":t.includes("final")?"Final":t.includes("trophy")?"Trophy":e.narration.substring(0,6)}}}),at={class:"stage-indicator"},nt={class:"stage-progress"},ot={key:2,class:"stage-number"},lt={class:"stage-label"},it={key:0,class:"payment-indicators"},rt=["title"],dt={class:"payment-label"},ut={key:1,class:"cancelled-overlay"};function pt(e,t,n,r,d,_){const p=c("VaIcon"),$=c("VaChip");return l(),m("div",at,[s("div",nt,[(l(!0),m(F,null,E(e.stages,(y,C)=>(l(),m("div",{key:y.value,class:O(["stage-step",{"is-active":e.currentStage===y.value,"is-completed":e.isStageCompleted(y.value),"is-cancelled":e.currentStage==="cancelled"}])},[s("div",{class:"stage-dot",style:U({backgroundColor:e.getStageColor(y.value)})},[e.isStageCompleted(y.value)?(l(),k(p,{key:0,name:"check",size:"small",color:"white"})):e.currentStage==="cancelled"?(l(),k(p,{key:1,name:"close",size:"small",color:"white"})):(l(),m("span",ot,u(C+1),1))],4),s("div",lt,u(y.label),1),C<e.stages.length-1?(l(),m("div",{key:0,class:O(["stage-line",{"is-filled":e.isStageCompleted(y.value)}])},null,2)):b("",!0)],2))),128))]),e.installments&&e.installments.length>0?(l(),m("div",it,[(l(!0),m(F,null,E(e.mainInstallments,y=>(l(),m("div",{key:y.id,class:O(["payment-indicator",{"is-paid":y.is_paid}]),title:y.narration},[a(p,{name:y.is_paid?"check_circle":"radio_button_unchecked",color:y.is_paid?"success":"secondary",size:"small"},null,8,["name","color"]),s("span",dt,u(e.getShortLabel(y)),1)],10,rt))),128))])):b("",!0),e.currentStage==="cancelled"?(l(),m("div",ut,[a($,{color:"danger",size:"small"},{default:i(()=>t[0]||(t[0]=[h("CANCELLED")])),_:1})])):b("",!0)])}const mt=B(st,[["render",pt],["__scopeId","data-v-934a1ecb"]]),ct=N({name:"PaymentTable",props:{installments:{type:Array,default:()=>[]},summary:{type:Object,default:null},totalAmount:{type:Number,default:0},loading:{type:Boolean,default:!1},allowUnpay:{type:Boolean,default:!0}},emits:["record-payment","unpay"],computed:{paymentPercentage(){return!this.summary||this.summary.total_due===0?0:Math.round(this.summary.total_paid/this.summary.total_due*100)},totalInstallmentCount(){return this.summary?(this.summary.fully_paid_count||this.summary.paid_count||0)+(this.summary.partial_paid_count||0)+(this.summary.unpaid_count||0):this.installments.length}},methods:{getStatusIcon(e){return e.is_paid||e.payment_status==="paid"?"check_circle":e.payment_status==="partial"?"hourglass_top":"radio_button_unchecked"},getStatusIconColor(e){return e.is_paid||e.payment_status==="paid"?"success":e.payment_status==="partial"?"warning":"secondary"},formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return e}},formatStageName(e){return{provision_sales:"Provision Sales",confirmed:"Confirmed",completed:"Completed"}[e]||e.replace(/_/g," ")}}}),yt={class:"flex items-center gap-2"},ft={class:"total-badge"},ht={key:0,class:"loading-state"},gt={key:1,class:"payment-rows"},_t={class:"status-icon"},vt={class:"installment-details"},$t={class:"narration"},Ct={key:0,class:"triggers-badge"},bt={key:1,class:"partial-info"},wt={class:"text-xs text-orange-600"},St={key:2,class:"payments-count"},Pt={class:"amount-section"},kt={class:"amount"},Vt={class:"action-section"},It={key:0,class:"paid-info"},qt={key:0,class:"paid-date"},Dt={key:1,class:"partial-actions"},Ft={key:2,class:"payment-summary"},At={class:"summary-item paid"},Et={class:"summary-item remaining"},Nt={class:"summary-item count"},Bt={key:3,class:"payment-progress"};function Ut(e,t,n,r,d,_){const p=c("VaIcon"),$=c("VaCardTitle"),y=c("VaProgressBar"),C=c("VaChip"),f=c("VaButton"),v=c("VaCardContent"),P=c("VaCard");return l(),k(P,{outlined:"",class:"payment-table-card"},{default:i(()=>[a($,{class:"flex items-center justify-between"},{default:i(()=>{var o;return[s("div",yt,[a(p,{name:"payments",color:"primary"}),t[0]||(t[0]=s("span",null,"Payment Schedule",-1))]),s("div",ft,"Total: "+u(e.formatCurrency(((o=e.summary)==null?void 0:o.total_due)||e.totalAmount)),1)]}),_:1}),a(v,null,{default:i(()=>[e.loading?(l(),m("div",ht,[a(y,{indeterminate:""}),t[1]||(t[1]=s("p",{class:"text-center mt-2 text-gray-600"},"Loading payment status...",-1))])):(l(),m("div",gt,[(l(!0),m(F,null,E(e.installments,o=>(l(),m("div",{key:o.id,class:O(["payment-row",{"is-paid":o.is_paid||o.payment_status==="paid","is-partial":o.payment_status==="partial"}])},[s("div",_t,[a(p,{name:e.getStatusIcon(o),color:e.getStatusIconColor(o)},null,8,["name","color"])]),s("div",vt,[s("div",$t,u(o.narration),1),o.triggers_stage?(l(),m("div",Ct,[a(C,{size:"small",color:"info",flat:""},{default:i(()=>[h(" → "+u(e.formatStageName(o.triggers_stage)),1)]),_:2},1024)])):b("",!0),o.payment_status==="partial"?(l(),m("div",bt,[s("span",wt," Paid: "+u(e.formatCurrency(o.amount_paid||0))+" / Remaining: "+u(e.formatCurrency(o.remaining_balance||0)),1)])):b("",!0),o.payments&&o.payments.length>1?(l(),m("div",St,[a(C,{size:"small",color:"secondary",flat:""},{default:i(()=>[h(u(o.payments.length)+" payments ",1)]),_:2},1024)])):b("",!0)]),s("div",Pt,[s("span",kt,u(e.formatCurrency(o.amount_due)),1)]),s("div",Vt,[o.is_paid||o.payment_status==="paid"?(l(),m("div",It,[t[2]||(t[2]=s("span",{class:"paid-badge"},"PAID",-1)),o.paid_at?(l(),m("span",qt,u(e.formatDate(o.paid_at)),1)):b("",!0),e.allowUnpay?(l(),k(f,{key:1,preset:"plain",size:"small",color:"secondary",icon:"undo",title:"Reverse All Payments",onClick:g=>e.$emit("unpay",o)},null,8,["onClick"])):b("",!0)])):o.payment_status==="partial"?(l(),m("div",Dt,[t[4]||(t[4]=s("span",{class:"partial-badge"},"PARTIAL",-1)),a(f,{size:"small",color:"warning",onClick:g=>e.$emit("record-payment",o)},{default:i(()=>t[3]||(t[3]=[h(" Add Payment ")])),_:2},1032,["onClick"]),e.allowUnpay?(l(),k(f,{key:0,preset:"plain",size:"small",color:"secondary",icon:"undo",title:"Reverse All Payments",onClick:g=>e.$emit("unpay",o)},null,8,["onClick"])):b("",!0)])):(l(),k(f,{key:2,size:"small",color:"primary",onClick:g=>e.$emit("record-payment",o)},{default:i(()=>t[5]||(t[5]=[h(" Record Payment ")])),_:2},1032,["onClick"]))])],2))),128))])),e.summary?(l(),m("div",Ft,[s("div",At,[a(p,{name:"check_circle",color:"success",size:"small"}),s("span",null,"Paid: "+u(e.formatCurrency(e.summary.total_paid)),1)]),t[6]||(t[6]=s("div",{class:"summary-divider"},"|",-1)),s("div",Et,[a(p,{name:"pending",color:"warning",size:"small"}),s("span",null,"Remaining: "+u(e.formatCurrency(e.summary.total_unpaid)),1)]),t[7]||(t[7]=s("div",{class:"summary-divider"},"|",-1)),s("div",Nt,[s("span",null,[h(u(e.summary.fully_paid_count||e.summary.paid_count)+"/"+u(e.totalInstallmentCount)+" Fully Paid ",1),e.summary.partial_paid_count?(l(),m(F,{key:0},[h(" ("+u(e.summary.partial_paid_count)+" partial) ",1)],64)):b("",!0)])])])):b("",!0),e.summary?(l(),m("div",Bt,[a(y,{"model-value":e.paymentPercentage,color:e.paymentPercentage===100?"success":"primary","show-percent":""},null,8,["model-value","color"])])):b("",!0)]),_:1})]),_:1})}const Mt=B(ct,[["render",Ut],["__scopeId","data-v-d5091453"]]),Tt=N({name:"PaymentModal",props:{modelValue:{type:Boolean,default:!1},installment:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],data(){return{form:{amount_paid:null,payment_reference:"",paid_at:new Date}}},computed:{isFormValid(){return!!this.form.amount_paid&&this.form.amount_paid>0},hasPartialPayment(){return this.installment?this.installment.payment_status==="partial"||(this.installment.amount_paid||0)>0:!1},remainingBalance(){return this.installment?this.installment.remaining_balance!==void 0?this.installment.remaining_balance:(this.installment.amount_due||0)-(this.installment.amount_paid||0):0},willCompleteInstallment(){return!this.installment||!this.form.amount_paid?!1:this.form.amount_paid>=this.remainingBalance},triggersStage(){var n,r;if(!this.installment)return null;if(this.installment.triggers_stage)return this.installment.triggers_stage;const e=((n=this.installment.narration)==null?void 0:n.toLowerCase())||"",t=((r=this.installment.installment_type)==null?void 0:r.toLowerCase())||"";return t.includes("deposit_booking")||e.includes("deposit")&&e.includes("booking")?"provision_sales":t.includes("final_payment")||e.includes("final")&&e.includes("90")?"confirmed":t.includes("trophy_deposit")||e.includes("trophy")&&e.includes("45")?"completed":null},requiredRule(){return e=>!!e||"Amount is required"},positiveAmountRule(){return e=>e&&Number(e)>0||"Amount must be positive"}},watch:{modelValue(e){e&&this.installment&&(this.form.amount_paid=null,this.form.payment_reference="",this.form.paid_at=new Date)}},methods:{formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatStageName(e){return{pending:"PENDING",provision_sales:"PROVISION SALES",confirmed:"CONFIRMED",completed:"COMPLETED"}[e]||e.replace(/_/g," ").toUpperCase()},handleCancel(){this.$emit("update:modelValue",!1)},handleSubmit(){if(!this.installment||!this.isFormValid)return;const e={installment_id:this.installment.id,amount_paid:this.form.amount_paid,payment_reference:this.form.payment_reference||void 0,paid_at:this.form.paid_at?this.formatDateForApi(this.form.paid_at):void 0};this.$emit("submit",e)},formatDateForApi(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}}}),Ot={class:"payment-modal-content"},jt={class:"installment-info mb-6"},Rt={class:"info-header"},zt={class:"info-amount"},Lt={class:"amount"},Qt={key:0,class:"partial-payment-info mt-3"},Gt={class:"flex justify-between text-sm"},Ht={class:"text-green-600 font-medium"},Wt={class:"flex justify-between text-sm mt-1"},Xt={class:"text-orange-600 font-semibold"},Yt={key:0,class:"stage-warning mb-6"},Jt={key:1,class:"partial-notice mb-6"},Kt={class:"payment-form"},Zt={class:"modal-actions"};function xt(e,t,n,r,d,_){const p=c("VaIcon"),$=c("VaInput"),y=c("VaDateInput"),C=c("VaButton"),f=c("VaModal");return l(),k(f,{"model-value":e.modelValue,title:"Record Payment",size:"medium","hide-default-actions":!0,"onUpdate:modelValue":t[3]||(t[3]=v=>e.$emit("update:modelValue",v))},{default:i(()=>{var v,P,o;return[s("div",Ot,[s("div",jt,[s("div",Rt,[a(p,{name:"receipt_long",color:"primary"}),s("span",null,u(((v=e.installment)==null?void 0:v.narration)||"Payment"),1)]),s("div",zt,[t[4]||(t[4]=s("span",{class:"label"},"Amount Due:",-1)),s("span",Lt,u(e.formatCurrency(((P=e.installment)==null?void 0:P.amount_due)||0)),1)]),e.hasPartialPayment?(l(),m("div",Qt,[s("div",Gt,[t[5]||(t[5]=s("span",{class:"text-gray-600"},"Already Paid:",-1)),s("span",Ht,u(e.formatCurrency(((o=e.installment)==null?void 0:o.amount_paid)||0)),1)]),s("div",Wt,[t[6]||(t[6]=s("span",{class:"text-gray-600"},"Remaining Balance:",-1)),s("span",Xt,u(e.formatCurrency(e.remainingBalance)),1)])])):b("",!0)]),e.triggersStage&&e.willCompleteInstallment?(l(),m("div",Yt,[a(p,{name:"flash_on",color:"warning"}),s("span",null,[t[7]||(t[7]=h(" This payment will move the sale to ")),s("strong",null,u(e.formatStageName(e.triggersStage)),1),t[8]||(t[8]=h(" stage "))])])):b("",!0),!e.willCompleteInstallment&&e.form.amount_paid?(l(),m("div",Jt,[a(p,{name:"info",color:"info"}),t[9]||(t[9]=s("span",null,"This is a partial payment.",-1))])):b("",!0),s("div",Kt,[a($,{modelValue:e.form.amount_paid,"onUpdate:modelValue":t[0]||(t[0]=g=>e.form.amount_paid=g),modelModifiers:{number:!0},type:"number",label:"Amount Paid",placeholder:"Enter amount",class:"mb-4",rules:[e.requiredRule,e.positiveAmountRule]},{prependInner:i(()=>t[10]||(t[10]=[s("span",{class:"text-gray-500"},"$",-1)])),_:1},8,["modelValue","rules"]),a($,{modelValue:e.form.payment_reference,"onUpdate:modelValue":t[1]||(t[1]=g=>e.form.payment_reference=g),label:"Payment Reference",placeholder:"e.g., TRX-2025-001",class:"mb-4"},null,8,["modelValue"]),a(y,{modelValue:e.form.paid_at,"onUpdate:modelValue":t[2]||(t[2]=g=>e.form.paid_at=g),label:"Payment Date",class:"mb-4",clearable:!1},null,8,["modelValue"])]),s("div",Zt,[a(C,{preset:"secondary",onClick:e.handleCancel},{default:i(()=>t[11]||(t[11]=[h(" Cancel ")])),_:1},8,["onClick"]),a(C,{color:"primary",loading:e.loading,disabled:!e.isFormValid,onClick:e.handleSubmit},{default:i(()=>t[12]||(t[12]=[h(" Record Payment ")])),_:1},8,["loading","disabled","onClick"])])])]}),_:1},8,["model-value"])}const es=B(Tt,[["render",xt],["__scopeId","data-v-9500179c"]]),ts=N({name:"ProposalView",components:{StageIndicator:mt,PaymentTable:Mt,PaymentModal:es},props:{proposal:{type:Object,required:!0}},emits:["edit","status-change","payment-recorded"],data(){return{showStatusModal:!1,showPaymentModal:!1,selectedInstallment:null,newStatus:null,loadingPayments:!1,savingPayment:!1,speciesColumns:[{key:"species_name",label:"Species",sortable:!0},{key:"quantity",label:"Quantity",sortable:!0,width:120}],statusOptions:[{value:"pending",text:"Pending"},{value:"provision_sales",text:"Provisional Sale"},{value:"confirmed",text:"Confirmed"},{value:"declined",text:"Declined"},{value:"cancelled",text:"Cancelled"},{value:"completed",text:"Completed"}]}},computed:{...R(Y,["logo"]),...R(j,["paymentStatus"]),logoUrl(){return this.logo||null},canBeCancelled(){const e=this.proposal.status;return e==="pending"||e==="provision_sales"||e==="confirmed"},paymentInstallments(){var e,t;return(e=this.paymentStatus)!=null&&e.installments?this.paymentStatus.installments:(((t=this.proposal.pricing)==null?void 0:t.installments)||[]).map(n=>({...n,is_paid:n.is_paid||!1,paid_at:n.paid_at||null,amount_paid:n.amount_paid||null,payment_reference:n.payment_reference||null}))},paymentSummary(){var d;if((d=this.paymentStatus)!=null&&d.summary)return this.paymentStatus.summary;const e=this.paymentInstallments,t=e.reduce((_,p)=>_+(p.amount_due||0),0),n=e.reduce((_,p)=>_+(p.is_paid?p.amount_paid||p.amount_due:0),0),r=e.filter(_=>_.is_paid).length;return{total_due:t,total_paid:n,total_unpaid:t-n,paid_count:r,unpaid_count:e.length-r}}},watch:{"proposal.id":{handler(){this.loadPaymentStatus()}}},mounted(){this.loadPaymentStatus()},methods:{...W(j,["fetchPayments","recordPayment","unpayInstallment"]),async loadPaymentStatus(){var e;if((e=this.proposal)!=null&&e.id){this.loadingPayments=!0;try{await this.fetchPayments(this.proposal.id)}catch(t){console.error("Error loading payment status:",t)}finally{this.loadingPayments=!1}}},formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return e}},formatCurrency(e){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"},getStatusColor(e){return{pending:"warning",provision_sales:"info",confirmed:"success",declined:"danger",cancelled:"secondary",completed:"primary"}[e]||"secondary"},formatStatus(e){return e?e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):"N/A"},printProposal(){window.print()},async downloadPdf(){var e,t,n,r,d,_,p;if(!((e=this.proposal)!=null&&e.id)){(t=this.$vaToast)==null||t.init({message:"No proposal selected",color:"warning"});return}try{(n=this.$vaToast)==null||n.init({message:"Generating PDF...",color:"info"});const y=await(await fetch(`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/proposals/${this.proposal.id}/pdf`)).json();if(y.success){const C=atob(y.pdf),f=new Array(C.length);for(let I=0;I<C.length;I++)f[I]=C.charCodeAt(I);const v=new Uint8Array(f),P=new Blob([v],{type:"application/pdf"}),o=window.URL.createObjectURL(P),g=document.createElement("a");g.href=o,g.download=`Sales_Confirmation_${y.client_name||((r=this.proposal.client)==null?void 0:r.full_name)||"Proposal"}.pdf`,g.click(),window.URL.revokeObjectURL(o),(d=this.$vaToast)==null||d.init({message:"PDF downloaded successfully",color:"success"})}else(_=this.$vaToast)==null||_.init({message:y.message||"Failed to generate PDF",color:"danger"})}catch($){console.error("Error downloading PDF:",$),(p=this.$vaToast)==null||p.init({message:"Failed to download PDF",color:"danger"})}},confirmProposal(){this.newStatus="confirmed",this.showStatusModal=!0},changeToStage(e){this.$emit("status-change",{id:this.proposal.id,status:e})},changeStatus(){this.newStatus&&(this.$emit("status-change",{id:this.proposal.id,status:this.newStatus}),this.showStatusModal=!1,this.newStatus=null)},openPaymentModal(e){this.selectedInstallment=e,this.showPaymentModal=!0},async handlePaymentSubmit(e){var t,n,r,d,_;this.savingPayment=!0;try{const p=await this.recordPayment(e.installment_id,{amount_paid:e.amount_paid,payment_reference:e.payment_reference,paid_at:e.paid_at});this.showPaymentModal=!1,this.selectedInstallment=null;let $="Payment recorded successfully";p.stage_changed?$=p.message||`Payment recorded. Stage updated to ${this.formatStatus(p.new_stage||"")}`:((t=p.data)==null?void 0:t.payment_status)==="partial"&&($=`Partial payment recorded. Remaining balance: ${this.formatCurrency(p.data.remaining_balance)}`),(n=this.$vaToast)==null||n.init({message:$,color:"success"}),this.$emit("payment-recorded",p),await this.loadPaymentStatus()}catch(p){(_=this.$vaToast)==null||_.init({message:((d=(r=p.response)==null?void 0:r.data)==null?void 0:d.message)||"Failed to record payment",color:"danger"})}finally{this.savingPayment=!1}},async handleUnpay(e){var t,n,r,d;if(confirm(`Are you sure you want to reverse the payment for "${e.narration}"?`)){this.savingPayment=!0;try{await this.unpayInstallment(e.id),(t=this.$vaToast)==null||t.init({message:"Payment reversed successfully",color:"success"}),await this.loadPaymentStatus()}catch(_){(d=this.$vaToast)==null||d.init({message:((r=(n=_.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to reverse payment",color:"danger"})}finally{this.savingPayment=!1}}}}}),ss={class:"proposal-view"},as={class:"proposal-header"},ns={class:"flex justify-between items-start mb-6"},os={class:"logo-section"},ls=["src"],is={key:1,class:"text-xl font-bold text-primary"},rs={class:"text-right"},ds={class:"text-gray-600"},us={class:"action-buttons mb-6 flex flex-wrap justify-end gap-3"},ps={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ms={class:"info-row"},cs={class:"value"},ys={class:"info-row"},fs={class:"value"},hs={class:"info-row"},gs={class:"value font-semibold"},_s={class:"info-row"},vs={class:"value"},$s={class:"info-row"},Cs={class:"value"},bs={class:"info-row"},ws={class:"value"},Ss={class:"info-row"},Ps={class:"value"},ks={class:"info-row"},Vs={class:"value"},Is={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},qs={class:"info-row"},Ds={class:"value"},Fs={class:"info-row"},As={class:"value"},Es={class:"info-row"},Ns={class:"value"},Bs={class:"info-row"},Us={class:"value"},Ms={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ts={class:"stat-card"},Os={class:"stat-value"},js={class:"stat-card"},Rs={class:"stat-value"},zs={class:"stat-card"},Ls={class:"stat-value"},Qs={class:"flex flex-col"},Gs={class:"font-semibold"},Hs={class:"text-xs text-gray-500 italic"},Ws={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Xs={class:"info-row"},Ys={class:"value font-mono"},Js={class:"info-row"},Ks={class:"value"},Zs={class:"info-row"},xs={class:"value"},ea={class:"info-row"},ta={class:"value"},sa={class:"text-gray-700"},aa={class:"p-4"},na={class:"flex justify-end gap-3"};function oa(e,t,n,r,d,_){var V;const p=c("VaChip"),$=c("StageIndicator"),y=c("VaButton"),C=c("VaIcon"),f=c("VaCardTitle"),v=c("VaCardContent"),P=c("VaCard"),o=c("VaBadge"),g=c("VaDataTable"),I=c("PaymentTable"),z=c("PaymentModal"),w=c("VaSelect"),M=c("VaModal");return l(),m("div",ss,[s("div",as,[s("div",ns,[s("div",os,[e.logoUrl?(l(),m("img",{key:0,src:e.logoUrl,alt:"Company Logo",class:"h-16"},null,8,ls)):(l(),m("h2",is,"Bushman Safari Trackers Limited"))]),s("div",rs,[t[6]||(t[6]=s("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"SALES CONFIRMATION",-1)),s("p",ds," Date: "+u(e.proposal.confirmation_date_formatted||e.formatDate(e.proposal.confirmation_date)),1),a(p,{color:e.getStatusColor(e.proposal.status),size:"small",class:"mt-2"},{default:i(()=>[h(u(e.formatStatus(e.proposal.status)),1)]),_:1},8,["color"])])])]),e.proposal.status?(l(),k($,{key:0,"current-stage":e.proposal.status,installments:e.paymentInstallments,class:"mb-6"},null,8,["current-stage","installments"])):b("",!0),s("div",us,[a(y,{preset:"secondary",icon:"print",onClick:e.printProposal},{default:i(()=>t[7]||(t[7]=[h(" Print ")])),_:1},8,["onClick"]),a(y,{preset:"secondary",icon:"download",onClick:e.downloadPdf},{default:i(()=>t[8]||(t[8]=[h(" Download PDF ")])),_:1},8,["onClick"]),a(y,{color:"primary",icon:"edit",onClick:t[0]||(t[0]=S=>e.$emit("edit",e.proposal))},{default:i(()=>t[9]||(t[9]=[h(" Edit ")])),_:1}),e.canBeCancelled?(l(),k(y,{key:0,color:"secondary",icon:"cancel",onClick:t[1]||(t[1]=S=>e.changeToStage("cancelled"))},{default:i(()=>t[10]||(t[10]=[h(" Cancel ")])),_:1})):b("",!0)]),s("div",ps,[a(P,{outlined:""},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"support_agent",color:"primary"}),t[11]||(t[11]=h(" Sales Agent "))]),_:1}),a(v,null,{default:i(()=>{var S,q;return[s("div",ms,[t[12]||(t[12]=s("span",{class:"label"},"Name:",-1)),s("span",cs,u(((S=e.proposal.sales_agent)==null?void 0:S.name)||"N/A"),1)]),s("div",ys,[t[13]||(t[13]=s("span",{class:"label"},"Email:",-1)),s("span",fs,u(((q=e.proposal.sales_agent)==null?void 0:q.email)||"N/A"),1)])]}),_:1})]),_:1}),a(P,{outlined:""},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"person",color:"primary"}),t[14]||(t[14]=h(" Client Information "))]),_:1}),a(v,null,{default:i(()=>{var S,q,A,T,Q,G;return[s("div",hs,[t[15]||(t[15]=s("span",{class:"label"},"Name:",-1)),s("span",gs,u(((S=e.proposal.client)==null?void 0:S.full_name)||"N/A"),1)]),s("div",_s,[t[16]||(t[16]=s("span",{class:"label"},"Address:",-1)),s("span",vs,u(((q=e.proposal.client)==null?void 0:q.address)||"N/A"),1)]),s("div",$s,[t[17]||(t[17]=s("span",{class:"label"},"Home Tel:",-1)),s("span",Cs,u(((A=e.proposal.client)==null?void 0:A.home_tel)||"N/A"),1)]),s("div",bs,[t[18]||(t[18]=s("span",{class:"label"},"Work Tel:",-1)),s("span",ws,u(((T=e.proposal.client)==null?void 0:T.work_tel)||"N/A"),1)]),s("div",Ss,[t[19]||(t[19]=s("span",{class:"label"},"Cell:",-1)),s("span",Ps,u(((Q=e.proposal.client)==null?void 0:Q.cell)||"N/A"),1)]),s("div",ks,[t[20]||(t[20]=s("span",{class:"label"},"Email:",-1)),s("span",Vs,u(((G=e.proposal.client)==null?void 0:G.email)||"N/A"),1)])]}),_:1})]),_:1})]),a(P,{outlined:"",class:"mb-6"},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"landscape",color:"primary"}),t[21]||(t[21]=h(" Hunting Trip Details "))]),_:1}),a(v,null,{default:i(()=>{var S,q,A,T;return[s("div",Is,[s("div",qs,[t[22]||(t[22]=s("span",{class:"label"},"Type of Safari:",-1)),s("span",Ds,u(((S=e.proposal.hunting_trip)==null?void 0:S.type)||"N/A"),1)]),s("div",Fs,[t[23]||(t[23]=s("span",{class:"label"},"Hunting Area:",-1)),s("span",As,u(((q=e.proposal.hunting_trip)==null?void 0:q.hunting_area)||"N/A"),1)]),s("div",Es,[t[24]||(t[24]=s("span",{class:"label"},"Outfitter:",-1)),s("span",Ns,u(((A=e.proposal.hunting_trip)==null?void 0:A.outfitter)||"Bushman Safari Trackers Limited"),1)]),s("div",Bs,[t[25]||(t[25]=s("span",{class:"label"},"Dates:",-1)),s("span",Us,u(((T=e.proposal.hunting_trip)==null?void 0:T.dates)||"N/A"),1)])])]}),_:1})]),_:1}),a(P,{outlined:"",class:"mb-6"},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"groups",color:"primary"}),t[26]||(t[26]=h(" Details of Trip "))]),_:1}),a(v,null,{default:i(()=>{var S,q,A;return[s("div",Ms,[s("div",Ts,[s("div",Os,u(((S=e.proposal.trip_details)==null?void 0:S.no_of_hunters)||0),1),t[27]||(t[27]=s("div",{class:"stat-label"},"Hunters",-1))]),s("div",js,[s("div",Rs,u(((q=e.proposal.trip_details)==null?void 0:q.no_of_observers)||0),1),t[28]||(t[28]=s("div",{class:"stat-label"},"Observers",-1))]),s("div",zs,[s("div",Ls,u(((A=e.proposal.trip_details)==null?void 0:A.no_of_companions)||0),1),t[29]||(t[29]=s("div",{class:"stat-label"},"Companions",-1))])])]}),_:1})]),_:1}),a(P,{outlined:"",class:"mb-6"},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"pets",color:"primary"}),t[30]||(t[30]=h(" Hunt Combination "))]),_:1}),a(v,null,{default:i(()=>[a(g,{items:e.proposal.hunt_combination||[],columns:e.speciesColumns,hoverable:"",striped:""},{"cell(species_name)":i(({rowData:S})=>[s("div",Qs,[s("span",Gs,u(S.species_name),1),s("span",Hs,u(S.scientific_name),1)])]),"cell(quantity)":i(({rowData:S})=>[a(o,{text:String(S.quantity),color:"primary"},null,8,["text"])]),_:1},8,["items","columns"])]),_:1})]),_:1}),a(I,{installments:e.paymentInstallments,summary:e.paymentSummary,"total-amount":((V=e.proposal.pricing)==null?void 0:V.total_amount)||0,loading:e.loadingPayments,"allow-unpay":!0,onRecordPayment:e.openPaymentModal,onUnpay:e.handleUnpay},null,8,["installments","summary","total-amount","loading","onRecordPayment","onUnpay"]),a(P,{outlined:"",class:"mb-6 bg-gray-50"},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"link",color:"info"}),t[31]||(t[31]=h(" Linked Sales Inquiry "))]),_:1}),a(v,null,{default:i(()=>{var S,q,A;return[s("div",Ws,[s("div",Xs,[t[32]||(t[32]=s("span",{class:"label"},"Inquiry Code:",-1)),s("span",Ys,u(((S=e.proposal.sales_inquiry)==null?void 0:S.code)||"N/A"),1)]),s("div",Js,[t[33]||(t[33]=s("span",{class:"label"},"Created Date:",-1)),s("span",Ks,u(((q=e.proposal.sales_inquiry)==null?void 0:q.created_date)||"N/A"),1)]),s("div",Zs,[t[34]||(t[34]=s("span",{class:"label"},"Season:",-1)),s("span",xs,u(((A=e.proposal.sales_inquiry)==null?void 0:A.season)||"N/A"),1)]),s("div",ea,[t[35]||(t[35]=s("span",{class:"label"},"Hunting License:",-1)),s("span",ta,u(e.proposal.hunting_license||"N/A"),1)])])]}),_:1})]),_:1}),e.proposal.remarks?(l(),k(P,{key:1,outlined:"",class:"mb-6"},{default:i(()=>[a(f,{class:"flex items-center gap-2"},{default:i(()=>[a(C,{name:"notes",color:"primary"}),t[36]||(t[36]=h(" Remarks "))]),_:1}),a(v,null,{default:i(()=>[s("p",sa,u(e.proposal.remarks),1)]),_:1})]),_:1})):b("",!0),a(z,{modelValue:e.showPaymentModal,"onUpdate:modelValue":t[2]||(t[2]=S=>e.showPaymentModal=S),installment:e.selectedInstallment,loading:e.savingPayment,onSubmit:e.handlePaymentSubmit},null,8,["modelValue","installment","loading","onSubmit"]),a(M,{modelValue:e.showStatusModal,"onUpdate:modelValue":t[5]||(t[5]=S=>e.showStatusModal=S),title:"Change Proposal Status","hide-default-actions":!0},{default:i(()=>[s("div",aa,[a(w,{modelValue:e.newStatus,"onUpdate:modelValue":t[3]||(t[3]=S=>e.newStatus=S),options:e.statusOptions,label:"Select New Status",class:"mb-4"},null,8,["modelValue","options"]),s("div",na,[a(y,{preset:"secondary",onClick:t[4]||(t[4]=S=>e.showStatusModal=!1)},{default:i(()=>t[37]||(t[37]=[h("Cancel")])),_:1}),a(y,{color:"primary",onClick:e.changeStatus},{default:i(()=>t[38]||(t[38]=[h("Confirm")])),_:1},8,["onClick"])])])]),_:1},8,["modelValue"])])}const la=B(ts,[["render",oa],["__scopeId","data-v-5ae67f1e"]]),ia=N({name:"ProposalForm",props:{proposal:{type:Object,default:null},isEdit:{type:Boolean,default:!1},preselectedInquiry:{type:Object,default:null}},emits:["save","cancel"],setup(){const{validate:e,reset:t}=J("formRef");return{validate:e,reset:t}},data(){return{form:{sales_inquiry_id:null,confirmation_date:new Date,hunting_license:"",remarks:"",status:"pending",installments:[]},salesInquiryOptions:[],loadingInquiries:!1,selectedInquiry:null,dueDaysTypeOptions:[{value:"upon_booking",text:"Upon Booking"},{value:"before_arrival",text:"Days Before Arrival"},{value:"upon_completion",text:"Upon Completion"}],statusOptions:[{value:"pending",text:"Pending"},{value:"provision_sales",text:"Provisional Sale"},{value:"confirmed",text:"Confirmed"},{value:"declined",text:"Declined"},{value:"cancelled",text:"Cancelled"},{value:"completed",text:"Completed"}],defaultInstallments:[{narration:"Deposit Due upon booking",amount_due:5e3,due_days:0,amount_due_type:"fixed",due_days_type:"upon_booking"},{narration:"2nd Deposit Due one year prior",amount_due:1e4,due_days:365,amount_due_type:"fixed",due_days_type:"before_arrival"},{narration:"Final Payment Due 90 days prior",amount_due:15e3,due_days:90,amount_due_type:"fixed",due_days_type:"before_arrival"},{narration:"Trophy Deposit Due 45 days prior",amount_due:2500,due_days:45,amount_due_type:"fixed",due_days_type:"before_arrival"}]}},computed:{...R(j,["saving"]),totalAmount(){return this.form.installments.reduce((e,t)=>e+(Number(t.amount_due)||0),0)},canSubmit(){return this.isEdit?!0:!!this.form.sales_inquiry_id&&this.form.installments.length>0}},mounted(){this.loadNewInquiries(),this.isEdit&&this.proposal?this.populateForm():(this.form.installments=[],this.preselectedInquiry&&this.handlePreselectedInquiry())},methods:{async loadNewInquiries(){var e;this.loadingInquiries=!0;try{const n=await D.get("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/sales-confirmation/pipeline?stage=new_inquiries");if(n.data.success){const r=((e=n.data.data)==null?void 0:e.new_inquiries)||[];this.salesInquiryOptions=r.map(d=>{var _,p,$,y,C,f,v,P,o,g,I;return{value:d.id,text:`${d.code} - ${((_=d.client)==null?void 0:_.full_name)||"Unknown"}`,subtitle:`${((p=d.hunting_details)==null?void 0:p.areas)||"N/A"} | ${(($=d.hunting_details)==null?void 0:$.no_of_days)||0} days | ${((y=d.hunting_details)==null?void 0:y.no_of_hunters)||0} hunter(s)`,selfItem:{id:d.id,code:d.code,client_name:(C=d.client)==null?void 0:C.full_name,country:(f=d.client)==null?void 0:f.country,area:(v=d.hunting_details)==null?void 0:v.areas,species:(P=d.hunting_details)==null?void 0:P.species,no_of_days:(o=d.hunting_details)==null?void 0:o.no_of_days,no_of_hunters:(g=d.hunting_details)==null?void 0:g.no_of_hunters,season:(I=d.hunting_details)==null?void 0:I.season}}})}}catch(t){console.error("Error loading new inquiries:",t)}finally{this.loadingInquiries=!1}},handlePreselectedInquiry(){var r,d,_,p,$,y,C,f,v,P;const e=this.preselectedInquiry;if(!e)return;this.selectedInquiry={id:e.id,code:e.code,client_name:(r=e.client)==null?void 0:r.full_name,country:(d=e.client)==null?void 0:d.country,area:(_=e.hunting_details)==null?void 0:_.areas,species:(p=e.hunting_details)==null?void 0:p.species,no_of_days:($=e.hunting_details)==null?void 0:$.no_of_days,no_of_hunters:(y=e.hunting_details)==null?void 0:y.no_of_hunters,season:(C=e.hunting_details)==null?void 0:C.season};const t={value:e.id,text:`${e.code} - ${((f=e.client)==null?void 0:f.full_name)||"Unknown"}`,subtitle:`${((v=e.hunting_details)==null?void 0:v.areas)||"N/A"} | ${((P=e.hunting_details)==null?void 0:P.no_of_days)||0} days`,selfItem:this.selectedInquiry};this.salesInquiryOptions.find(o=>o.value===e.id)||this.salesInquiryOptions.unshift(t),this.form.sales_inquiry_id=t},onInquirySelected(e){e!=null&&e.selfItem?this.selectedInquiry=e.selfItem:this.selectedInquiry=null},populateForm(){var e,t,n,r;this.proposal&&(this.form.confirmation_date=this.proposal.confirmation_date?new Date(this.proposal.confirmation_date):new Date,this.form.hunting_license=this.proposal.hunting_license||"",this.form.remarks=this.proposal.remarks||"",this.form.status=this.proposal.status||"pending",(e=this.proposal.pricing)!=null&&e.installments&&(this.form.installments=this.proposal.pricing.installments.map(d=>({narration:d.narration,amount_due:d.amount_due,due_days:d.due_days,amount_due_type:d.amount_due_type||"fixed",due_days_type:d.due_days_type||"upon_booking"}))),this.proposal.sales_inquiry&&(this.selectedInquiry={id:this.proposal.sales_inquiry.id,code:this.proposal.sales_inquiry.code,client_name:(t=this.proposal.client)==null?void 0:t.full_name,area:(n=this.proposal.hunting_trip)==null?void 0:n.hunting_area,no_of_days:(r=this.proposal.hunting_trip)==null?void 0:r.no_of_days,season:this.proposal.sales_inquiry.season}))},addInstallment(){this.form.installments.push({narration:"",amount_due:0,due_days:null,amount_due_type:"fixed",due_days_type:"upon_booking"})},removeInstallment(e){this.form.installments.splice(e,1)},formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},async submitForm(){var n;if(!await this.validate())return;const t={confirmation_date:this.form.confirmation_date?H(new Date(this.form.confirmation_date),"yyyy-MM-dd"):H(new Date,"yyyy-MM-dd"),hunting_license:this.form.hunting_license||null,remarks:this.form.remarks||null,installments:this.form.installments.map(r=>{let d=r.due_days_type;typeof d=="object"&&d!==null&&(d=d.value||"upon_booking");let _=r.amount_due_type;return typeof _=="object"&&_!==null&&(_=_.value||"fixed"),{narration:r.narration,amount_due:Number(r.amount_due),due_days:r.due_days?Number(r.due_days):null,amount_due_type:String(_||"fixed"),due_days_type:String(d||"upon_booking")}})};this.isEdit||(t.sales_inquiry_id=((n=this.form.sales_inquiry_id)==null?void 0:n.value)||this.form.sales_inquiry_id),this.isEdit&&(t.status=this.form.status),this.$emit("save",t)}}}),ra={class:"proposal-form"},da={class:"text-2xl font-bold mb-6"},ua={key:0,class:"flex flex-col"},pa={class:"font-semibold"},ma={class:"text-xs text-gray-500"},ca={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg"},ya={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},fa={class:"ml-1 font-medium"},ha={class:"ml-1 font-medium"},ga={class:"ml-1 font-medium"},_a={class:"ml-1 font-medium"},va={key:0,class:"mt-2"},$a={class:"ml-1 font-medium"},Ca={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ba={class:"flex items-center gap-2"},wa={key:1,class:"text-center text-gray-500 py-4"},Sa={class:"flex justify-between items-start mb-3"},Pa={class:"font-semibold text-gray-700"},ka={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Va={key:2,class:"mt-4 p-4 bg-primary rounded-lg text-white"},Ia={class:"flex justify-between items-center"},qa={class:"text-2xl font-bold"},Da={class:"flex justify-end gap-3 mt-6"};function Fa(e,t,n,r,d,_){const p=c("VaIcon"),$=c("VaCardTitle"),y=c("VaAlert"),C=c("VaSelect"),f=c("VaCardContent"),v=c("VaCard"),P=c("VaDateInput"),o=c("VaInput"),g=c("VaTextarea"),I=c("VaButton"),z=c("VaForm");return l(),m("div",ra,[s("h2",da,u(e.isEdit?"Edit Quotation":"Create New Quotation"),1),a(z,{ref:"formRef"},{default:i(()=>[e.isEdit?b("",!0):(l(),k(v,{key:0,outlined:"",class:"mb-6"},{default:i(()=>[a($,{class:"flex items-center gap-2"},{default:i(()=>[a(p,{name:"search",color:"primary"}),t[6]||(t[6]=h(" Select Sales Inquiry "))]),_:1}),a(f,null,{default:i(()=>[a(y,{color:"info",class:"mb-4",border:"left"},{title:i(()=>t[7]||(t[7]=[h("Link to Sales Inquiry")])),default:i(()=>[t[8]||(t[8]=h(" Select a sales inquiry to create a quotation. Client and hunting details will be automatically populated. "))]),_:1}),a(C,{modelValue:e.form.sales_inquiry_id,"onUpdate:modelValue":[t[0]||(t[0]=w=>e.form.sales_inquiry_id=w),e.onInquirySelected],options:e.salesInquiryOptions,loading:e.loadingInquiries,label:"Sales Inquiry",placeholder:"Search and select a sales inquiry...",searchable:"","highlight-matched-text":"",rules:[w=>!!w||"Sales inquiry is required"]},{content:i(({value:w})=>[w?(l(),m("div",ua,[s("span",pa,u(w.text),1),s("span",ma,u(w.subtitle),1)])):b("",!0)]),_:1},8,["modelValue","options","loading","rules","onUpdate:modelValue"]),e.selectedInquiry?(l(),m("div",ca,[t[14]||(t[14]=s("h4",{class:"font-semibold mb-2"},"Selected Inquiry Details",-1)),s("div",ya,[s("div",null,[t[9]||(t[9]=s("span",{class:"text-gray-500"},"Client:",-1)),s("span",fa,u(e.selectedInquiry.client_name),1)]),s("div",null,[t[10]||(t[10]=s("span",{class:"text-gray-500"},"Area:",-1)),s("span",ha,u(e.selectedInquiry.area),1)]),s("div",null,[t[11]||(t[11]=s("span",{class:"text-gray-500"},"Days:",-1)),s("span",ga,u(e.selectedInquiry.no_of_days),1)]),s("div",null,[t[12]||(t[12]=s("span",{class:"text-gray-500"},"Season:",-1)),s("span",_a,u(e.selectedInquiry.season),1)])]),e.selectedInquiry.species?(l(),m("div",va,[t[13]||(t[13]=s("span",{class:"text-gray-500"},"Species:",-1)),s("span",$a,u(e.selectedInquiry.species),1)])):b("",!0)])):b("",!0)]),_:1})]),_:1})),a(v,{outlined:"",class:"mb-6"},{default:i(()=>[a($,{class:"flex items-center gap-2"},{default:i(()=>[a(p,{name:"description",color:"primary"}),t[15]||(t[15]=h(" Quotation Details "))]),_:1}),a(f,null,{default:i(()=>[s("div",Ca,[a(P,{modelValue:e.form.confirmation_date,"onUpdate:modelValue":t[1]||(t[1]=w=>e.form.confirmation_date=w),label:"Confirmation Date",placeholder:"Select date"},null,8,["modelValue"]),a(o,{modelValue:e.form.hunting_license,"onUpdate:modelValue":t[2]||(t[2]=w=>e.form.hunting_license=w),label:"Hunting License",placeholder:"Enter license number (optional)"},null,8,["modelValue"])]),a(g,{modelValue:e.form.remarks,"onUpdate:modelValue":t[3]||(t[3]=w=>e.form.remarks=w),label:"Remarks",placeholder:"Add any additional notes or remarks...",class:"mt-4","min-rows":3},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{outlined:"",class:"mb-6"},{default:i(()=>[a($,{class:"flex items-center justify-between"},{default:i(()=>[s("div",ba,[a(p,{name:"payments",color:"primary"}),t[16]||(t[16]=h(" Payment Installments "))]),a(I,{preset:"secondary",size:"small",icon:"add",onClick:e.addInstallment},{default:i(()=>t[17]||(t[17]=[h(" Add Installment ")])),_:1},8,["onClick"])]),_:1}),a(f,null,{default:i(()=>[e.form.installments.length===0?(l(),k(y,{key:0,color:"warning",class:"mb-4",border:"left"},{title:i(()=>t[18]||(t[18]=[h("Required")])),default:i(()=>[t[19]||(t[19]=h(" At least one payment installment is required to create a quotation. "))]),_:1})):b("",!0),e.form.installments.length===0?(l(),m("div",wa,' No installments added. Click "Add Installment" to create payment schedule. ')):b("",!0),(l(!0),m(F,null,E(e.form.installments,(w,M)=>(l(),m("div",{key:M,class:"installment-row mb-4 p-4 border rounded-lg"},[s("div",Sa,[s("span",Pa,"Installment "+u(M+1),1),a(I,{preset:"plain",color:"danger",size:"small",icon:"delete",onClick:V=>e.removeInstallment(M)},null,8,["onClick"])]),s("div",ka,[a(o,{modelValue:w.narration,"onUpdate:modelValue":V=>w.narration=V,label:"Description",placeholder:"e.g., Deposit Due upon booking",rules:[V=>!!V||"Description is required"]},null,8,["modelValue","onUpdate:modelValue","rules"]),a(o,{modelValue:w.amount_due,"onUpdate:modelValue":V=>w.amount_due=V,label:"Amount (USD)",type:"number",placeholder:"5000",rules:[V=>V>0||"Amount must be greater than 0"]},null,8,["modelValue","onUpdate:modelValue","rules"]),a(C,{modelValue:w.due_days_type,"onUpdate:modelValue":V=>w.due_days_type=V,options:e.dueDaysTypeOptions,label:"Due Type",placeholder:"Select when due","value-by":"value","text-by":"text"},null,8,["modelValue","onUpdate:modelValue","options"]),a(o,{modelValue:w.due_days,"onUpdate:modelValue":V=>w.due_days=V,label:w.due_days_type==="before_arrival"?"Days Before Arrival":"Due Days",type:"number",placeholder:"e.g., 90",disabled:w.due_days_type==="upon_booking"},null,8,["modelValue","onUpdate:modelValue","label","disabled"])])]))),128)),e.form.installments.length>0?(l(),m("div",Va,[s("div",Ia,[t[20]||(t[20]=s("span",{class:"text-lg font-semibold"},"TOTAL",-1)),s("span",qa,u(e.formatCurrency(e.totalAmount)),1)])])):b("",!0)]),_:1})]),_:1}),e.isEdit?(l(),k(v,{key:1,outlined:"",class:"mb-6"},{default:i(()=>[a($,{class:"flex items-center gap-2"},{default:i(()=>[a(p,{name:"flag",color:"primary"}),t[21]||(t[21]=h(" Status "))]),_:1}),a(f,null,{default:i(()=>[a(C,{modelValue:e.form.status,"onUpdate:modelValue":t[4]||(t[4]=w=>e.form.status=w),options:e.statusOptions,label:"Quotation Status",placeholder:"Select status"},null,8,["modelValue","options"])]),_:1})]),_:1})):b("",!0),s("div",Da,[a(I,{preset:"secondary",onClick:t[5]||(t[5]=w=>e.$emit("cancel"))},{default:i(()=>t[22]||(t[22]=[h(" Cancel ")])),_:1}),a(I,{color:"primary",loading:e.saving,disabled:!e.canSubmit,onClick:e.submitForm},{default:i(()=>[h(u(e.isEdit?"Update Quotation":"Create Quotation"),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1},512)])}const Aa=B(ia,[["render",Fa],["__scopeId","data-v-d3fd6ab2"]]),Ea=N({name:"SalesConfirmationProposals",components:{PipelineBoard:tt,ProposalView:la,ProposalForm:Aa},setup(){const{init:e}=K();return{init:e}},data(){return{currentView:"pipeline",editingProposal:null,isEditMode:!1,preselectedInquiry:null,seasonOptions:[],currentSeasonId:null}},computed:{...R(j,["pipeline","pipelineCounts","currentProposal","paymentStatus","loading","saving","error"])},mounted(){this.loadPipeline(),this.loadSeasons()},methods:{...W(j,["fetchPipeline","updatePipelineStage","fetchProposalById","createProposal","updateProposal","updateProposalStatus","clearCurrentProposal","clearPaymentStatus"]),async loadPipeline(){try{await this.fetchPipeline(void 0,this.currentSeasonId||void 0)}catch{this.init({message:"Failed to load pipeline",color:"danger"})}},async loadSeasons(){try{const t=await D.get("https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/seasons");if(t.data){const n=Array.isArray(t.data)?t.data:t.data.data||[];this.seasonOptions=n.map(r=>({value:r.id,text:r.name}))}}catch(e){console.error("Error loading seasons:",e)}},onSeasonChange(e){this.currentSeasonId=e,this.loadPipeline()},async viewProposal(e){try{const t=e.proposal_id||e.confirmation_id;t?(await this.fetchProposalById(t),this.currentView="view"):this.init({message:"No quotation found for this item",color:"warning"})}catch{this.init({message:"Failed to load quotation details",color:"danger"})}},editProposal(e){if(e.proposal_id||e.confirmation_id){const t=e.proposal_id||e.confirmation_id;this.fetchProposalById(t).then(()=>{this.editingProposal=this.currentProposal,this.isEditMode=!0,this.preselectedInquiry=null,this.currentView="form"})}else this.editingProposal=e,this.isEditMode=!0,this.preselectedInquiry=null,this.currentView="form"},handleCreateFromInquiry(e){this.editingProposal=null,this.isEditMode=!1,this.preselectedInquiry=e,this.currentView="form"},showCreateForm(){this.editingProposal=null,this.isEditMode=!1,this.preselectedInquiry=null,this.currentView="form"},handleGoBack(){this.currentView="pipeline",this.editingProposal=null,this.isEditMode=!1,this.preselectedInquiry=null,this.clearCurrentProposal(),this.clearPaymentStatus(),this.loadPipeline()},async handleSave(e){var t,n,r;try{this.isEditMode&&((t=this.editingProposal)!=null&&t.id)?(await this.updateProposal(this.editingProposal.id,e),this.init({message:"Quotation updated successfully",color:"success"})):(await this.createProposal(e),this.init({message:"Quotation created successfully",color:"success"})),this.handleGoBack()}catch(d){this.init({message:((r=(n=d.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to save quotation",color:"danger"})}},async handleStatusChange(e){try{await this.updateProposalStatus(e.id,e.status),this.init({message:`Proposal status changed to ${e.status}`,color:"success"}),await this.fetchProposalById(e.id)}catch{this.init({message:"Failed to update proposal status",color:"danger"})}},async handleStageChange(e){var t,n;try{await this.updatePipelineStage(e.inquiryId,e.newStage),this.init({message:`Moved to ${e.newStage.replace(/_/g," ")}`,color:"success"})}catch(r){this.init({message:((n=(t=r.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to update stage",color:"danger"})}},async handlePaymentRecorded(e){var t;e.stage_changed&&(this.init({message:`Stage updated: ${e.old_stage} → ${e.new_stage}`,color:"info"}),(t=this.currentProposal)!=null&&t.id&&await this.fetchProposalById(this.currentProposal.id))}}}),Na={class:"flex flex-col md:flex-row gap-3 mb-6 justify-between items-center py-4 px-2 bg-gray-50 rounded-lg"},Ba={class:"flex flex-col md:flex-row gap-3 justify-start"};function Ua(e,t,n,r,d,_){const p=c("VaButton"),$=c("PipelineBoard"),y=c("ProposalView"),C=c("ProposalForm"),f=c("VaCardContent"),v=c("VaCard");return l(),k(v,{class:"w-full"},{default:i(()=>[a(f,null,{default:i(()=>[s("div",Na,[s("div",Ba,[e.currentView!=="pipeline"?(l(),k(p,{key:0,class:"px-6",icon:"arrow_back",size:"large",onClick:e.handleGoBack},{default:i(()=>t[0]||(t[0]=[h(" Go Back ")])),_:1},8,["onClick"])):b("",!0)])]),e.currentView==="pipeline"?(l(),k($,{key:0,pipeline:e.pipeline,counts:e.pipelineCounts,loading:e.loading,saving:e.saving,"season-options":e.seasonOptions,onRefresh:e.loadPipeline,onSeasonChange:e.onSeasonChange,onCreateProposal:e.handleCreateFromInquiry,onViewProposal:e.viewProposal,onEditProposal:e.editProposal,onStageChange:e.handleStageChange},null,8,["pipeline","counts","loading","saving","season-options","onRefresh","onSeasonChange","onCreateProposal","onViewProposal","onEditProposal","onStageChange"])):e.currentView==="view"&&e.currentProposal?(l(),k(y,{key:1,proposal:e.currentProposal,onEdit:e.editProposal,onStatusChange:e.handleStatusChange,onPaymentRecorded:e.handlePaymentRecorded},null,8,["proposal","onEdit","onStatusChange","onPaymentRecorded"])):e.currentView==="form"?(l(),k(C,{key:2,proposal:e.editingProposal,"is-edit":e.isEditMode,"preselected-inquiry":e.preselectedInquiry,onSave:e.handleSave,onCancel:e.handleGoBack},null,8,["proposal","is-edit","preselected-inquiry","onSave","onCancel"])):b("",!0)]),_:1})]),_:1})}const za=B(Ea,[["render",Ua]]);export{za as default};
//# sourceMappingURL=SalesConfirmationProposals-B_wJYXcl.js.map
