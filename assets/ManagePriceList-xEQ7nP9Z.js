import{d as M,_ as q,a as w,g as _,w as i,b as o,i as p,e as s,t as r,h,v as k,F as C,q as D,o as d,m as I,E as j,l as B,x as H,y as Q,z as R,A as G,s as F,B as z}from"./index-C9vSFmy5.js";import{u as U}from"./useToast-6DeNNyrn.js";import{u as W}from"./payment-cards-Ce_6J8p_.js";import{d as E}from"./pdfDownloader-DiRJnS-k.js";import{f as Z}from"./format-Cn4G_mmc.js";import{u as A}from"./price-list-store-DsfWqoo5.js";import{u as J}from"./useForm-BYrNbDub.js";import{h as N}from"./errorHandler-DijQ3xmc.js";import{v as K}from"./utils-BWc0LXoO.js";import{u as O}from"./quota-store-Trz1doDf.js";import{u as T}from"./settings-store-DsaTCK3O.js";import{S as X}from"./SalesPackageForm-B0Y8C-M1.js";import"./regulatrory-store-m2UTHE4r.js";const Y=M({components:{},props:{priceListItem:{type:Object,required:!0},pdfData:{type:String,default:""}},data(){return{cardStore:W(),format:Z}},computed:{loading(){return this.cardStore.loading},hasUpgradeFees(){var t;const e=new Map;return(t=this.priceListItem.trophy_fees)==null||t.forEach(a=>{const g=e.get(a.species_id)||0;e.set(a.species_id,g+1)}),Array.from(e.values()).some(a=>a>1)}},mounted(){this.cardStore.load()},methods:{formatChargesPer(e){return e?e.toLowerCase().replace("_"," "):""},formatAmount(e){return(typeof e=="string"?parseFloat(e):e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},getSequenceLabel(e){const t=["th","st","nd","rd"],a=e%100,g=t[(a-20)%10]||t[a]||t[0];return`${e}${g}`},async downloadPriceListPdf(){var e,t;if(!this.pdfData){console.warn("No PDF data available");return}try{const g=`${(((t=(e=this.priceListItem)==null?void 0:e.sales_package)==null?void 0:t.name)||"price-list").replace(/\s+/g,"-")}-${Date.now()}.pdf`;await E(this.pdfData,g)}catch(a){console.error("Failed to download PDF:",a)}}}}),ee={key:1,class:"price-list-details"},te={class:"text-center"},se={class:"va-h3 mb-2"},oe={class:"flex justify-center items-center gap-4 mb-3"},ae={class:"text-lg text-secondary"},ie={class:"mt-4"},ne={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},re={class:"text-3xl font-bold"},le={class:"text-3xl font-bold"},de={class:"text-lg font-bold"},ce={class:"text-lg font-bold"},ue={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},me={class:"flex justify-between items-start"},pe={class:"flex-1"},ge={class:"font-semibold text-base"},fe={class:"text-sm text-secondary italic"},he={key:0},ye={class:"va-table-responsive"},ve={class:"va-table va-table--hoverable w-full"},_e={class:"text-right"},be={class:"font-semibold"},Le={class:"text-secondary italic"},Ve={class:"text-center"},Pe={class:"text-right font-bold text-lg"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},we={class:"space-y-3"},Se={key:0,class:"p-4 rounded-lg bg-gray-50"},xe={class:"flex justify-between items-start mb-2"},Ie={class:"text-right"},Ce={class:"font-bold text-lg"},$e={class:"flex justify-between items-start mb-2"},Fe={class:"font-semibold text-base capitalize"},De={class:"text-sm text-secondary"},Ae={class:"text-right"},Oe={class:"font-bold text-lg"},Te={class:"text-xs text-secondary"},Ee={class:"space-y-4"},Me={key:0},qe={class:"flex justify-between items-center"},ze={class:"font-bold text-xl"},Be={class:"flex items-center gap-2"},Ue={class:"flex items-center gap-2"};function Ne(e,t,a,g,V,f){const v=p("VaSkeleton"),c=p("VaSkeletonGroup"),u=p("VaIcon"),P=p("VaChip"),x=p("VaButton"),b=p("VaCardContent"),L=p("VaCard"),S=p("VaCardTitle"),y=p("VaBadge"),l=p("VaAlert");return e.cardStore.loading?(d(),w(c,{key:0},{default:i(()=>[o(v,{class:"mb-4",height:"160px",variant:"squared"}),o(v,{class:"mb-4",height:"160px",variant:"squared"}),o(v,{height:"360px",variant:"squared"})]),_:1})):(d(),_("div",ee,[o(L,{class:"mb-6",stripe:"","stripe-color":"primary"},{default:i(()=>[o(b,null,{default:i(()=>{var m,n,$;return[s("div",te,[s("h1",se,r(e.priceListItem.sales_package.name),1),s("div",oe,[o(P,{color:"primary",size:"large"},{default:i(()=>[o(u,{name:"calendar_month",class:"mr-1"}),h(" "+r(e.format(e.priceListItem.price_list_type.price_list.start_date,"MMM yyyy"))+" - "+r(e.format(e.priceListItem.price_list_type.price_list.end_date,"MMM yyyy")),1)]),_:1}),(m=e.priceListItem.price_list_type)!=null&&m.is_active?(d(),w(P,{key:0,color:"success",size:"large"},{default:i(()=>[o(u,{name:"check_circle",class:"mr-1"}),t[0]||(t[0]=h(" Active "))]),_:1})):(d(),w(P,{key:1,color:"danger",size:"large"},{default:i(()=>[o(u,{name:"cancel",class:"mr-1"}),t[1]||(t[1]=h(" Inactive "))]),_:1}))]),s("p",ae,[o(u,{name:"location_on",size:"small"}),h(" "+r(($=(n=e.priceListItem.sales_package)==null?void 0:n.area)==null?void 0:$.name)+" ("+r(e.priceListItem.sales_package.area.description)+") ",1)]),s("div",ie,[e.pdfData?(d(),w(x,{key:0,color:"primary",icon:"download",onClick:e.downloadPriceListPdf},{default:i(()=>t[2]||(t[2]=[h(" Download PDF ")])),_:1},8,["onClick"])):k("",!0)])])]}),_:1})]),_:1}),s("div",ne,[o(L,{stripe:"","stripe-color":"primary"},{default:i(()=>[o(b,{class:"text-center"},{default:i(()=>[o(u,{name:"attach_money",size:"large",color:"primary",class:"mb-2"}),s("div",re,r(e.priceListItem.price_list_type.currency.symbol)+r(e.formatAmount(e.priceListItem.price_list_type.amount)),1),t[3]||(t[3]=s("div",{class:"text-sm text-secondary mt-1"},"Base Amount",-1))]),_:1})]),_:1}),o(L,{stripe:"","stripe-color":"success"},{default:i(()=>[o(b,{class:"text-center"},{default:i(()=>[o(u,{name:"schedule",size:"large",color:"success",class:"mb-2"}),s("div",le,r(e.priceListItem.price_list_type.duration),1),t[4]||(t[4]=s("div",{class:"text-sm text-secondary mt-1"},"Days Duration",-1))]),_:1})]),_:1}),o(L,{stripe:"","stripe-color":"warning"},{default:i(()=>[o(b,{class:"text-center"},{default:i(()=>{var m;return[o(u,{name:"verified",size:"large",color:"warning",class:"mb-2"}),s("div",de,r((m=e.priceListItem.sales_package.regulatory_package)==null?void 0:m.name),1),t[5]||(t[5]=s("div",{class:"text-sm text-secondary mt-1"},"License Type",-1))]}),_:1})]),_:1}),o(L,{stripe:"","stripe-color":"info"},{default:i(()=>[o(b,{class:"text-center"},{default:i(()=>[o(u,{name:"category",size:"large",color:"info",class:"mb-2"}),s("div",ce,r(e.priceListItem.price_list_type.hunting_type.name),1),t[6]||(t[6]=s("div",{class:"text-sm text-secondary mt-1"},"Hunting Type",-1))]),_:1})]),_:1})]),o(L,{class:"mb-6",stripe:"","stripe-color":"success"},{default:i(()=>[o(S,{class:"flex items-center gap-2"},{default:i(()=>[o(u,{name:"pets"}),h(" Available Species ("+r(e.priceListItem.sales_package.species.length)+") ",1)]),_:1}),o(b,null,{default:i(()=>[s("div",ue,[(d(!0),_(C,null,D(e.priceListItem.sales_package.species,m=>(d(),w(L,{key:m.id,class:"species-card",color:m.quantity>0?"#f0f9ff":"#fef2f2"},{default:i(()=>[o(b,null,{default:i(()=>[s("div",me,[s("div",pe,[s("div",ge,r(m.species.name),1),s("div",fe,r(m.species.scientific_name),1)]),o(y,{color:m.quantity>0?"success":"danger",class:"ml-2"},{default:i(()=>[h(" Qty: "+r(m.quantity),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1032,["color"]))),128))])]),_:1})]),_:1}),o(L,{class:"mb-6",stripe:"","stripe-color":"warning"},{default:i(()=>[o(S,{class:"flex items-center gap-2"},{default:i(()=>[o(u,{name:"military_tech"}),h(" Trophy Fees ("+r(e.priceListItem.price_list_type.currency.name)+") ",1)]),_:1}),o(b,null,{default:i(()=>[e.priceListItem.trophy_fees&&e.priceListItem.trophy_fees.length>0?(d(),_("div",he,[s("div",ye,[s("table",ve,[s("thead",null,[s("tr",null,[t[7]||(t[7]=s("th",{class:"text-left"},"Species",-1)),t[8]||(t[8]=s("th",{class:"text-left"},"Scientific Name",-1)),t[9]||(t[9]=s("th",{class:"text-center"},"Sequence",-1)),s("th",_e,"Price ("+r(e.priceListItem.price_list_type.currency.symbol)+")",1)])]),s("tbody",null,[(d(!0),_(C,null,D(e.priceListItem.trophy_fees,m=>(d(),_("tr",{key:m.id},[s("td",be,r(m.species.name),1),s("td",Le,r(m.species.scientific_name),1),s("td",Ve,[o(y,{text:e.getSequenceLabel(m.sequence_order),color:"primary"},null,8,["text"])]),s("td",Pe,r(e.priceListItem.price_list_type.currency.symbol)+r(e.formatAmount(m.price_usd)),1)]))),128))])])])])):(d(),w(l,{key:1,color:"info",border:"top"},{default:i(()=>t[10]||(t[10]=[h(" No trophy fees available for this package ")])),_:1}))]),_:1})]),_:1}),s("div",ke,[o(L,{stripe:"","stripe-color":"info"},{default:i(()=>[o(S,{class:"flex items-center gap-2"},{default:i(()=>[o(u,{name:"add_circle"}),t[11]||(t[11]=h(" Safari Extras "))]),_:1}),o(b,null,{default:i(()=>{var m;return[s("div",we,[e.priceListItem.observer&&e.priceListItem.observer.length>0?(d(),_("div",Se,[s("div",xe,[t[13]||(t[13]=s("div",null,[s("div",{class:"font-semibold text-base"},"Observer"),s("div",{class:"text-sm text-secondary"},"Observer cost")],-1)),s("div",Ie,[s("div",Ce,r(e.priceListItem.price_list_type.currency.symbol)+r((m=e.priceListItem.observer[0])==null?void 0:m.amount),1),t[12]||(t[12]=s("div",{class:"text-xs text-secondary"},"per day / person",-1))])])])):k("",!0),(d(!0),_(C,null,D(e.priceListItem.safari_extras,n=>(d(),_("div",{key:n.id,class:"p-4 rounded-lg bg-gray-50"},[s("div",$e,[s("div",null,[s("div",Fe,r(n.name),1),s("div",De,r(n.description),1)]),s("div",Ae,[s("div",Oe,r(n.currency.symbol)+r(n.amount),1),s("div",Te,r(e.formatChargesPer(n.charges_per)),1)])])]))),128))])]}),_:1})]),_:1}),o(L,{stripe:"","stripe-color":"success"},{default:i(()=>[o(S,{class:"flex items-center gap-2"},{default:i(()=>[o(u,{name:"groups"}),t[14]||(t[14]=h(" Companion & Observer Costs "))]),_:1}),o(b,null,{default:i(()=>[s("div",Ee,[e.priceListItem.componions_hunter&&e.priceListItem.componions_hunter.length>0?(d(),_("div",Me,[t[16]||(t[16]=s("div",{class:"text-sm font-semibold text-secondary mb-2"},"Companion Hunter",-1)),(d(!0),_(C,null,D(e.priceListItem.componions_hunter,m=>(d(),_("div",{key:m.id,class:"p-4 rounded-lg bg-green-50"},[s("div",qe,[t[15]||(t[15]=s("span",{class:"text-base"},"Daily Rate",-1)),s("span",ze,r(e.priceListItem.price_list_type.currency.symbol)+r(m.amount),1)])]))),128))])):k("",!0)])]),_:1})]),_:1})]),o(L,{class:"mb-6",stripe:"","stripe-color":"danger"},{default:i(()=>[o(b,null,{default:i(()=>[o(l,{color:"warning",border:"left",class:"mb-3"},{title:i(()=>[s("div",Be,[o(u,{name:"warning"}),t[17]||(t[17]=s("span",{class:"font-bold"},"Important Information",-1))])]),default:i(()=>[t[18]||(t[18]=h(" All hunts confirmation is subject to quota availability. Other safari packages are available on request and can be customized depending on client requirements. "))]),_:1}),e.hasUpgradeFees?(d(),w(l,{key:0,color:"info",border:"left"},{title:i(()=>[s("div",Ue,[o(u,{name:"info"}),t[19]||(t[19]=s("span",{class:"font-bold"},"Upgrade Fees",-1))])]),default:i(()=>[t[20]||(t[20]=h(" If additional trophies beyond the standard package are taken, upgrade fees may apply (plus trophy fees). "))]),_:1})):k("",!0)]),_:1})]),_:1})]))}const je=q(Y,[["render",Ne],["__scopeId","data-v-a804157f"]]),He=M({components:{SalesPackageForm:X,VaForm:G,VaInput:R,VaSelect:Q,VaButton:H},props:{editMode:{type:Boolean,default:!1},editItem:{type:Object,default:null}},emits:["saved"],setup(){const e=F(),{isValid:t,validate:a,resetValidation:g,reset:V}=J(e),{init:f}=U(),v=F(!1),c=z({id:null,hunting_type_id:null,package:[],amount:null,currency:null,duration:null,season:null,end_date:null,species:null,quantity:null,companion_amount:null,observer_amount:null}),u=z({id:null,client_id:null,contact:"",contact_type:null,contactable:!1}),P=m=>{c.package=c.package.filter(n=>n!==m)},x=F([]),b=F([]),L=F([]),S=F([]),y=F([]),l=F(0);return{formRef:e,form:c,contactForm:u,showEditForm:v,countries:x,nationality:b,categoryOptions:L,contactsTypes:S,clients:y,step:l,init:f,isValidForm:t,validateForm:a,resetValidationForm:g,resetForm:V,deleteChip:P,validators:K}},data(){return{preferred_species:[],speciesOptions:[],speciesObjects:[],areasOptions:[],huntingTypesOptions:[],salesQuotasOptions:[],speciesItemOptions:[],currencyOptions:[],savingPriceList:!1,durationsOptions:[{value:1,text:"1 day"},{value:2,text:"2 days"},{value:3,text:"3 days"},{value:4,text:"4 days"},{value:5,text:"5 days"},{value:6,text:"6 days"},{value:7,text:"7 days"},{value:8,text:"8 days"},{value:9,text:"9 days"},{value:10,text:"10 days"},{value:11,text:"11 days"},{value:12,text:"12 days"},{value:13,text:"13 days"},{value:14,text:"14 days"},{value:15,text:"15 days"},{value:16,text:"16 days"},{value:17,text:"17 days"},{value:18,text:"18 days"},{value:19,text:"19 days"},{value:20,text:"20 days"},{value:21,text:"21 days"}],seasonsOptions:[]}},computed:{...B(A,["salesPackages","packageOptions","latestPackage","loadingpackages"]),...j(A,{_shM:"showModal"})},watch:{},mounted(){this.getAreas(),this.getHuntingTypes(),this.getQuotaList(),this.getCurrencyList(),this.getSalesPackages(),this.getSeasonList(),this.editMode&&this.editItem&&this.populateFormForEdit()},methods:{...I(O,["getSpeciesList"]),...I(O,["getAllSpeciesPerQuotaPerArea"]),...I(O,["getAreaList"]),...I(T,["getHuntingsTypes"]),...I(T,["getCurrencies","getSeasons"]),...I(O,["getQuotas"]),...I(A,["createPriceList","updatePriceList"]),...I(A,["getSalesPackageList"]),onAreaChange(e){console.log(e)},async submit(){var t,a,g,V,f,v,c,u,P,x,b,L,S;this.savingPriceList=!0;const e={huntingTypeId:((t=this.form.hunting_type_id)==null?void 0:t.value)||this.form.hunting_type_id,sales_package_ids:(a=this.form.package)==null?void 0:a.filter(y=>(y==null?void 0:y.value)!==void 0).map(y=>y==null?void 0:y.value),amount:this.form.amount,currency:((g=this.form.currency)==null?void 0:g.value)||this.form.currency,duration:((V=this.form.duration)==null?void 0:V.value)||this.form.duration,season_id:((v=(f=this.form.season)==null?void 0:f.value)==null?void 0:v.id)||((c=this.form.season)==null?void 0:c.id),start_at:((P=(u=this.form.season)==null?void 0:u.value)==null?void 0:P.start_at)||((x=this.form.season)==null?void 0:x.start_at),end_at:((L=(b=this.form.season)==null?void 0:b.value)==null?void 0:L.end_at)||((S=this.form.season)==null?void 0:S.end_at),is_active:1,area_id:3,user_id:1,companionAmount:this.form.companion_amount,observerAmount:this.form.observer_amount};try{let y;this.editMode&&this.editItem?(y=await this.updatePriceList(this.editItem.id,e),y.status===200&&(this.init({message:"Price list updated successfully",color:"success"}),this.savingPriceList=!1,this.$emit("saved"))):(y=await this.createPriceList(e),y.status===201&&(this.init({message:y.data.message,color:"success"}),this.resetForm(),this.resetValidationForm(),this.speciesObjects=[],this.savingPriceList=!1))}catch(y){this.savingPriceList=!1,N(y.response),console.log(y),this.init({message:y.message,color:"danger"})}},populateFormForEdit(){this.editItem&&this.$nextTick(()=>{setTimeout(()=>{var t;this.form.amount=((t=this.editItem.amount)==null?void 0:t.replace("$","").replace(",",""))||this.editItem.amount;const e=this.editItem.duration;this.form.duration=this.durationsOptions.find(a=>a.value===e)||{value:e,text:`${e} days`},this.editItem.hunting_type_id?this.form.hunting_type_id=this.huntingTypesOptions.find(a=>a.value===this.editItem.hunting_type_id):this.editItem.hunting_type&&(this.form.hunting_type_id=this.huntingTypesOptions.find(a=>a.text===this.editItem.hunting_type)),this.editItem.season_id&&(this.form.season=this.seasonsOptions.find(a=>{var g;return((g=a.value)==null?void 0:g.id)===this.editItem.season_id})),this.form.currency=this.currencyOptions.find(a=>a.text==="USD")||this.currencyOptions[0],this.form.companion_amount=this.editItem.companion_amount||null,this.form.observer_amount=this.editItem.observer_amount||null,this.editItem.packages&&Array.isArray(this.editItem.packages)&&(this.form.package=this.editItem.packages.map(a=>({value:a.id,text:a.name})))},500)})},async getSpeciesItems(){try{const e=await this.getSpeciesList();this.speciesOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getSeasonList(){try{const e=await this.getSeasons();this.seasonsOptions=e.data.map(t=>({value:t,text:t.name}))}catch(e){console.log(e)}},_showModal(){this._shM=!0},async getSalesPackages(){try{await this.getSalesPackageList(!0)}catch(e){console.log(e)}},deleteFromStorage(e){this.speciesObjects.splice(e,1),console.log("Species item deleted:",e)},async getAreas(){try{const e=await this.getAreaList();this.areasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getHuntingTypes(){try{const e=await this.getHuntingsTypes();this.huntingTypesOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},onChangePackage(e){console.log(e.filter(t=>(t==null?void 0:t.value)!==void 0).map(t=>t==null?void 0:t.value))},async getQuotaList(){try{const e=await this.getQuotas(null);this.salesQuotasOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}},async getCurrencyList(){try{const e=await this.getCurrencies();this.currencyOptions=e.data.map(t=>({value:t.id,text:t.name}))}catch(e){console.log(e)}}}}),Qe={class:"p-1"},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ze={class:"mt-4 d-flex p-2"};function Je(e,t,a,g,V,f){const v=p("VaChip"),c=p("VaIcon"),u=p("VaSelect"),P=p("VaInput"),x=p("VaButton"),b=p("VaForm"),L=p("VaInnerLoading"),S=p("SalesPackageForm"),y=p("VaModal");return d(),_(C,null,[o(L,{loading:e.savingPriceList,size:60},{default:i(()=>[o(b,{ref:"formRef"},{default:i(()=>[s("div",Qe,[t[11]||(t[11]=s("h3",{class:"font-bold text-lg mb-2"},"Price list Infos",-1)),s("div",Re,[o(u,{modelValue:e.form.package,"onUpdate:modelValue":[t[1]||(t[1]=l=>e.form.package=l),e.onChangePackage],options:e.packageOptions,multiple:"",clearable:"",placeholder:"Select Package list here",rules:[l=>l||"Package is required"],label:"Packages","required-mark":""},{content:i(({value:l})=>[(d(!0),_(C,null,D(l,m=>(d(),w(v,{key:m,size:"small",color:"info",class:"mr-1 my-1",closeable:"","onUpdate:modelValue":n=>e.deleteChip(m)},{default:i(()=>[h(r(m.text),1)]),_:2},1032,["onUpdate:modelValue"]))),128))]),append:i(()=>[o(c,{name:"add",class:"ml-2",onClick:t[0]||(t[0]=l=>e._showModal())})]),_:1},8,["modelValue","options","rules","onUpdate:modelValue"]),o(u,{modelValue:e.form.hunting_type_id,"onUpdate:modelValue":t[2]||(t[2]=l=>e.form.hunting_type_id=l),placeholder:"Select Hunting Type",label:"Hunting Type",rules:[l=>l||"Hunting type is required"],options:e.huntingTypesOptions,searchable:"","required-mark":"","highlight-matched-text":""},null,8,["modelValue","rules","options"]),o(u,{modelValue:e.form.season,"onUpdate:modelValue":t[3]||(t[3]=l=>e.form.season=l),options:e.seasonsOptions,"required-mark":"",label:"Select season",placeholder:"Select season"},null,8,["modelValue","options"])]),t[12]||(t[12]=s("h3",{class:"font-bold text-lg mb-2"},"Charges",-1)),s("div",Ge,[o(P,{modelValue:e.form.amount,"onUpdate:modelValue":t[4]||(t[4]=l=>e.form.amount=l),type:"text",placeholder:"Enter Amount",rules:[l=>l&&l.length>0||"Amount is required"],label:"Amount","required-mark":""},null,8,["modelValue","rules"]),o(u,{modelValue:e.form.currency,"onUpdate:modelValue":t[5]||(t[5]=l=>e.form.currency=l),placeholder:"Select Currency",label:"Currency",rules:[l=>l||"Currency is required"],options:e.currencyOptions,searchable:"","highlight-matched-text":"","required-mark":""},null,8,["modelValue","rules","options"]),o(u,{modelValue:e.form.duration,"onUpdate:modelValue":t[6]||(t[6]=l=>e.form.duration=l),type:"text",options:e.durationsOptions,"required-mark":"",placeholder:"Enter Duration eg: 21 days",rules:[l=>l||"Duration is required"],label:"Duration(days)"},null,8,["modelValue","options","rules"])]),t[13]||(t[13]=s("h3",{class:"font-bold text-lg mb-2"},"Companion's and Observer's Charges(Optional)",-1)),s("div",We,[o(P,{modelValue:e.form.companion_amount,"onUpdate:modelValue":t[7]||(t[7]=l=>e.form.companion_amount=l),type:"text",placeholder:"Enter Companion Amount",label:"Companion Cost(Per Person)"},null,8,["modelValue"]),o(P,{modelValue:e.form.observer_amount,"onUpdate:modelValue":t[8]||(t[8]=l=>e.form.observer_amount=l),type:"text",placeholder:"Enter observer Amount",label:"Observer Cost(Per Person)"},null,8,["modelValue"])])]),s("div",Ze,[o(x,{icon:"save",class:"mr-3 mb-2",loading:e.savingPriceList,disabled:!e.isValidForm,onClick:t[9]||(t[9]=l=>e.validateForm()&&e.submit())},{default:i(()=>[h(r(e.editMode?"Update":"Save"),1)]),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1},8,["loading"]),o(y,{modelValue:e._shM,"onUpdate:modelValue":t[10]||(t[10]=l=>e._shM=l),"ok-text":"Apply","close-button":"",size:"large","hide-default-actions":!0},{default:i(()=>[o(S)]),_:1},8,["modelValue"])],64)}const Ke=q(He,[["render",Je]]),Xe=M({name:"ManagePriceList",components:{PricesListDetails:je,CreatePricesListForm:Ke},setup(){return{formRef:F(null)}},data(){return{items:[],printableDataList:[],item:null,toast:U(),areasOptions:[],huntingTypeOptions:[],seasonOptions:[],showPriceList:!0,ShowCreateNewPriceListForm:!1,loading:!1,loadingSeasons:!1,huntingTypeValue:null,areaValue:null,seasonValue:null,poriceListPdf:"",individualPriceListPdf:"",downloadPdf:E,downloadingPdf:!1,showDeleteModal:!1,itemToDelete:null,deleting:!1,showEditForm:!1,editItem:null}},computed:{...B(T,["logo"]),activePackages(){return this.items.filter(e=>e.status==="Active").length},uniqueAreas(){return new Set(this.items.map(t=>t.area)).size}},mounted(){this.getSeasonOptions(),this.getPriceLists(),this.getAreas(),this.getHuntingTypesOptions(),this.loadLogo()},methods:{...I(A,["getPriceList","getPriceListByHuntingType","getPriceListById","deletePriceList","getCompletePriceListPdf"]),...I(O,["getAreaList"]),...I(T,["getHuntingsTypes","loadLogo","getSeasons"]),getActiveSpecies(e){return e.filter(t=>t.quantity>0)},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},async getSeasonOptions(){this.loadingSeasons=!0;try{const e=await this.getSeasons(!1);if(e.status===200){const t={value:"",text:"All Seasons"};this.seasonOptions=e.data.map(a=>({value:a.id,text:a.name})),this.seasonOptions.unshift(t),this.seasonValue=this.seasonOptions[0]}}catch(e){console.error("Error fetching seasons:",e)}finally{this.loadingSeasons=!1}},async toggleShowPriceListMethod(e){const t=e==null?void 0:e.id;if(t)try{const a=await this.getPriceListById(t);this.item=a.data.data||a.data,this.individualPriceListPdf=a.data.pdf||"",this.showPriceList=!1}catch(a){console.error("Error fetching price list detail:",a)}},async onDownloadPdf(){var e,t,a,g;this.downloadingPdf=!0;try{const V=await this.getCompletePriceListPdf();if(V.status===200){const f=((e=V.data)==null?void 0:e.pdf)||V.data,v=u=>typeof u=="string"&&/^https?:\/\//i.test(u),c=u=>typeof u=="string"&&u.length>200&&/^[A-Za-z0-9+/=\r\n]+$/.test(u);if(!f||!v(f)&&!c(f)){(t=this.toast)==null||t.init({message:"PDF not available",color:"warning"});return}await E(f,`complete-price-list-${Date.now()}.pdf`)}else(a=this.toast)==null||a.init({message:"Failed to generate PDF",color:"danger"})}catch(V){console.error("Error downloading PDF:",V),(g=this.toast)==null||g.init({message:"Failed to download PDF",color:"danger"})}finally{this.downloadingPdf=!1}},goBack(){this.showPriceList=!0,this.ShowCreateNewPriceListForm=!1,this.showEditForm=!1,this.editItem=null,this.getPriceLists()},showCreateNewPriceListFormMethod(){this.ShowCreateNewPriceListForm=!0,this.showPriceList=!1,this.showEditForm=!1},async editPriceList(e){var t;try{const a=await this.getPriceListById(e.id);this.editItem=a.data.data||a.data,this.showEditForm=!0,this.showPriceList=!1,this.ShowCreateNewPriceListForm=!1}catch(a){console.error("Error fetching price list for edit:",a),(t=this.toast)==null||t.init({message:"Failed to load price list details",color:"danger"})}},onEditSaved(){var e;this.showEditForm=!1,this.showPriceList=!0,this.editItem=null,this.getPriceLists(),(e=this.toast)==null||e.init({message:"Price list updated successfully",color:"success"})},confirmDelete(e){this.itemToDelete=e,this.showDeleteModal=!0},async confirmDeletePriceList(){var e,t;if(this.itemToDelete){this.deleting=!0;try{const a=await this.deletePriceList(this.itemToDelete.id,!0);(a.status===200||a.status===204)&&((e=this.toast)==null||e.init({message:"Price list deleted successfully",color:"success"}),this.showDeleteModal=!1,this.itemToDelete=null,this.getPriceLists())}catch(a){const g=N(a.response);(t=this.toast)==null||t.init({message:g.join(", ")||"Failed to delete price list",color:"danger"})}finally{this.deleting=!1}}},async getPriceLists(){this.loading=!0;try{const e=f=>f==null?"":typeof f=="object"&&"value"in f?f.value:f,t=e(this.huntingTypeValue)||"",a=e(this.areaValue)||"",g=e(this.seasonValue)||"",V=await this.getPriceList(t,a,g);if(V.status===200){const f=V==null?void 0:V.data,v=Array.isArray(f)?f:(f==null?void 0:f.data)??[];this.printableDataList=f,this.poriceListPdf=(f==null?void 0:f.pdf)||"",Array.isArray(v)?this.items=v.map(c=>({id:c.id,package_name:c.package_name,area:c.area,hunting_type:c.hunting_type,amount:c.amount,duration:c.duration,status:c.status,start_date:c.start_date,end_date:c.end_date,season_id:c.season_id,season_name:c.season_name,species_count:c.species_count,species:c.species||[]})):this.items=[]}}catch(e){console.error("Error in getPriceLists:",e)}finally{this.loading=!1}},async getAreas(){var e;try{const t=await this.getAreaList(),a={value:"",text:"All Areas"};this.areasOptions=(e=t==null?void 0:t.data)==null?void 0:e.map(g=>({value:g.id,text:g.name})),this.areasOptions.unshift(a),this.areaValue=this.areasOptions[0]}catch(t){console.error("Error fetching areas:",t)}},async getHuntingTypesOptions(){var e;try{const t=await this.getHuntingsTypes();if(t.status===200){const a={value:"",text:"All Types"};this.huntingTypeOptions=(e=t==null?void 0:t.data)==null?void 0:e.map(g=>({value:g.id,text:g.name})),this.huntingTypeOptions.unshift(a),this.huntingTypeValue=this.huntingTypeOptions[0]}}catch(t){console.error("Error fetching hunting types:",t)}}}}),Ye={class:"flex flex-col md:flex-row gap-2 mb-4 justify-between items-center"},et={class:"flex flex-col md:flex-row gap-2 justify-start items-center"},tt={key:1,class:"text-xl font-bold text-gray-700"},st={key:2,class:"text-xl font-bold text-gray-700"},ot={class:"filters-section bg-gray-50 rounded-lg p-4 mb-6 mt-4"},at={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},it={class:"block text-sm font-medium text-gray-600 mb-1"},nt={class:"block text-sm font-medium text-gray-600 mb-1"},rt={class:"block text-sm font-medium text-gray-600 mb-1"},lt={class:"flex items-end"},dt={key:0,class:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6"},ct={class:"stat-card bg-blue-50 rounded-lg p-4 text-center"},ut={class:"text-2xl font-bold text-blue-600"},mt={class:"stat-card bg-green-50 rounded-lg p-4 text-center"},pt={class:"text-2xl font-bold text-green-600"},gt={class:"stat-card bg-amber-50 rounded-lg p-4 text-center"},ft={class:"text-2xl font-bold text-amber-600"},ht={key:0,class:"text-center py-12"},yt={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},vt={class:"card-header bg-gradient-to-r from-amber-600 to-amber-700 text-white p-4"},_t={class:"flex justify-between items-start"},bt={class:"font-bold text-lg"},Lt={class:"text-amber-100 text-sm mt-1"},Vt={class:"p-4"},Pt={class:"flex justify-between items-center mb-4 pb-4 border-b border-gray-100"},kt={class:"text-2xl font-bold text-green-600"},wt={class:"text-right"},St={class:"text-xl font-semibold text-gray-700"},xt={class:"grid grid-cols-2 gap-3 mb-4"},It={class:"detail-item"},Ct={class:"text-sm text-gray-600 ml-1"},$t={class:"detail-item"},Ft={class:"text-sm text-gray-600 ml-1"},Dt={class:"detail-item col-span-2"},At={class:"text-sm text-gray-600 ml-1"},Ot={class:"date-range bg-gray-50 rounded-lg p-3 mb-4"},Tt={class:"flex justify-between text-sm"},Et={class:"font-medium ml-1"},Mt={class:"font-medium ml-1"},qt={key:0,class:"species-preview mb-4"},zt={class:"flex flex-wrap gap-1"},Bt={class:"flex gap-2 pt-3 border-t border-gray-100"},Ut={class:"flex gap-2 justify-end"};function Nt(e,t,a,g,V,f){const v=p("VaButton"),c=p("VaIcon"),u=p("VaDivider"),P=p("VaSelect"),x=p("VaBadge"),b=p("VaInnerLoading"),L=p("PricesListDetails"),S=p("CreatePricesListForm"),y=p("VaCardContent"),l=p("VaCard"),m=p("VaModal");return d(),_(C,null,[o(l,{class:"price-list-page"},{default:i(()=>[o(y,null,{default:i(()=>[s("div",Ye,[s("div",et,[!e.showPriceList||e.showEditForm?(d(),w(v,{key:0,class:"px-3 py-2",icon:"arrow_back",size:"small",onClick:e.goBack},{default:i(()=>t[5]||(t[5]=[h(" Back to List ")])),_:1},8,["onClick"])):k("",!0),e.showPriceList&&!e.showEditForm?(d(),_("h2",tt,[o(c,{name:"list_alt",class:"mr-2"}),t[6]||(t[6]=h(" Price Lists "))])):k("",!0),e.showEditForm?(d(),_("h2",st,[o(c,{name:"edit",class:"mr-2"}),t[7]||(t[7]=h(" Edit Price List "))])):k("",!0)]),!e.ShowCreateNewPriceListForm&&e.showPriceList&&!e.showEditForm?(d(),w(v,{key:0,class:"px-4 py-2",color:"primary",icon:"add",round:"",onClick:e.showCreateNewPriceListFormMethod},{default:i(()=>t[8]||(t[8]=[h(" Add a new Price List ")])),_:1},8,["onClick"])):k("",!0)]),o(u),e.ShowCreateNewPriceListForm?k("",!0):(d(),_(C,{key:0},[e.showPriceList?(d(),_(C,{key:0},[s("div",ot,[s("div",at,[s("div",null,[s("label",it,[o(c,{name:"date_range",size:"small",class:"mr-1"}),t[9]||(t[9]=h(" Season "))]),o(P,{modelValue:e.seasonValue,"onUpdate:modelValue":[t[0]||(t[0]=n=>e.seasonValue=n),e.getPriceLists],options:e.seasonOptions,placeholder:"Select Season",loading:e.loadingSeasons},null,8,["modelValue","options","loading","onUpdate:modelValue"])]),s("div",null,[s("label",nt,[o(c,{name:"pets",size:"small",class:"mr-1"}),t[10]||(t[10]=h(" Hunting Type "))]),o(P,{modelValue:e.huntingTypeValue,"onUpdate:modelValue":[t[1]||(t[1]=n=>e.huntingTypeValue=n),e.getPriceLists],options:e.huntingTypeOptions,placeholder:"Filter By Type"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",null,[s("label",rt,[o(c,{name:"location_on",size:"small",class:"mr-1"}),t[11]||(t[11]=h(" Hunting Area "))]),o(P,{modelValue:e.areaValue,"onUpdate:modelValue":[t[2]||(t[2]=n=>e.areaValue=n),e.getPriceLists],options:e.areasOptions,placeholder:"Filter By Area"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",lt,[o(v,{class:"w-full",color:"secondary",icon:"download",loading:e.downloadingPdf,onClick:e.onDownloadPdf},{default:i(()=>t[12]||(t[12]=[h(" Download PDF ")])),_:1},8,["loading","onClick"])])])]),e.items.length>0?(d(),_("div",dt,[s("div",ct,[s("div",ut,r(e.items.length),1),t[13]||(t[13]=s("div",{class:"text-sm text-gray-600"},"Total Packages",-1))]),s("div",mt,[s("div",pt,r(e.activePackages),1),t[14]||(t[14]=s("div",{class:"text-sm text-gray-600"},"Active",-1))]),s("div",gt,[s("div",ft,r(e.uniqueAreas),1),t[15]||(t[15]=s("div",{class:"text-sm text-gray-600"},"Areas",-1))])])):k("",!0),o(b,{loading:e.loading},{default:i(()=>[e.items.length===0&&!e.loading?(d(),_("div",ht,[o(c,{name:"inventory_2",size:"4rem",color:"gray"}),t[16]||(t[16]=s("p",{class:"text-gray-500 mt-4"},"No price lists found for the selected filters.",-1))])):k("",!0),s("div",yt,[(d(!0),_(C,null,D(e.items,n=>(d(),_("div",{key:n.id,class:"price-card bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden border border-gray-100"},[s("div",vt,[s("div",_t,[s("div",null,[s("h3",bt,r(n.package_name),1),s("p",Lt,[o(c,{name:"location_on",size:"small"}),h(" "+r(n.area),1)])]),o(x,{text:n.status,color:n.status==="Active"?"success":"warning"},null,8,["text","color"])])]),s("div",Vt,[s("div",Pt,[s("div",null,[s("div",kt,r(n.amount),1),t[17]||(t[17]=s("div",{class:"text-xs text-gray-500"},"Package Price",-1))]),s("div",wt,[s("div",St,r(n.duration)+" Days",1),t[18]||(t[18]=s("div",{class:"text-xs text-gray-500"},"Duration",-1))])]),s("div",xt,[s("div",It,[o(c,{name:"category",size:"small",color:"primary"}),s("span",Ct,r(n.hunting_type),1)]),s("div",$t,[o(c,{name:"pets",size:"small",color:"warning"}),s("span",Ft,r(n.species_count||0)+" Species",1)]),s("div",Dt,[o(c,{name:"event",size:"small",color:"info"}),s("span",At,r(n.season_name||"N/A"),1)])]),s("div",Ot,[s("div",Tt,[s("div",null,[t[19]||(t[19]=s("span",{class:"text-gray-500"},"Start:",-1)),s("span",Et,r(e.formatDate(n.start_date)),1)]),s("div",null,[t[20]||(t[20]=s("span",{class:"text-gray-500"},"End:",-1)),s("span",Mt,r(e.formatDate(n.end_date)),1)])])]),n.species&&n.species.length>0?(d(),_("div",qt,[t[21]||(t[21]=s("div",{class:"text-xs text-gray-500 mb-2 font-medium"},"INCLUDED SPECIES:",-1)),s("div",zt,[(d(!0),_(C,null,D(e.getActiveSpecies(n.species).slice(0,4),$=>(d(),w(x,{key:$.id,text:`${$.name} (${$.quantity})`,color:"backgroundElement",class:"text-xs"},null,8,["text"]))),128)),e.getActiveSpecies(n.species).length>4?(d(),w(x,{key:0,text:`+${e.getActiveSpecies(n.species).length-4} more`,color:"info",class:"text-xs"},null,8,["text"])):k("",!0)])])):k("",!0),s("div",Bt,[o(v,{class:"flex-1",preset:"secondary",icon:"visibility",size:"small",onClick:$=>e.toggleShowPriceListMethod(n)},{default:i(()=>t[22]||(t[22]=[h(" View Details ")])),_:2},1032,["onClick"]),o(v,{preset:"plain",icon:"edit",color:"warning",size:"small",title:"Edit",onClick:$=>e.editPriceList(n)},null,8,["onClick"]),o(v,{preset:"plain",icon:"delete",color:"danger",size:"small",title:"Delete",onClick:$=>e.confirmDelete(n)},null,8,["onClick"])])])]))),128))])]),_:1},8,["loading"])],64)):e.showEditForm?e.showEditForm?(d(),w(S,{key:2,"edit-mode":!0,"edit-item":e.editItem,onSaved:e.onEditSaved},null,8,["edit-item","onSaved"])):k("",!0):(d(),w(L,{key:1,"price-list-item":e.item,"pdf-data":e.individualPriceListPdf},null,8,["price-list-item","pdf-data"]))],64)),e.ShowCreateNewPriceListForm?(d(),w(S,{key:1})):k("",!0)]),_:1})]),_:1}),o(m,{modelValue:e.showDeleteModal,"onUpdate:modelValue":t[4]||(t[4]=n=>e.showDeleteModal=n),"hide-default-actions":""},{header:i(()=>t[23]||(t[23]=[s("h3",{class:"va-h6"},"Confirm Delete",-1)])),footer:i(()=>[s("div",Ut,[o(v,{preset:"secondary",onClick:t[3]||(t[3]=n=>e.showDeleteModal=!1)},{default:i(()=>t[26]||(t[26]=[h("Cancel")])),_:1}),o(v,{color:"danger",loading:e.deleting,onClick:e.confirmDeletePriceList},{default:i(()=>t[27]||(t[27]=[h("Delete")])),_:1},8,["loading","onClick"])])]),default:i(()=>{var n;return[s("p",null,[t[24]||(t[24]=h(" Are you sure you want to delete ")),s("strong",null,r((n=e.itemToDelete)==null?void 0:n.package_name),1),t[25]||(t[25]=h("? "))])]}),_:1},8,["modelValue"])],64)}const ss=q(Xe,[["render",Nt],["__scopeId","data-v-26e58a99"]]);export{ss as default};
//# sourceMappingURL=ManagePriceList-xEQ7nP9Z.js.map
