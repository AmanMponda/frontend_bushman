{"version":3,"file":"ProposalView-Bt0MQ5dF.js","sources":["../../src/stores/proposal-store.ts","../../src/pages/client/dashboard/components/StageIndicator.vue","../../src/pages/client/dashboard/components/StageIndicator.vue","../../src/pages/client/dashboard/components/PaymentTable.vue","../../src/pages/client/dashboard/components/PaymentTable.vue","../../src/pages/client/dashboard/components/PaymentModal.vue","../../src/pages/client/dashboard/components/PaymentModal.vue","../../src/pages/client/dashboard/components/ProposalView.vue","../../src/pages/client/dashboard/components/ProposalView.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport axios from 'axios'\n\n// Pipeline item interface (for both inquiries and proposals in pipeline)\ninterface PipelineClient {\n  id: number\n  full_name: string\n  country: string\n  email: string\n  phone: string\n}\n\ninterface PipelineHuntingDetails {\n  season: string\n  areas: string\n  species: string\n  start_date: string\n  end_date: string\n  no_of_days: number\n  no_of_hunters: number\n}\n\ninterface PipelineSalesAgent {\n  id: number\n  name: string\n}\n\ninterface PipelineItem {\n  id: number\n  type: 'inquiry' | 'proposal'\n  stage: string\n  code: string\n  created_date: string\n  created_date_formatted: string\n  client: PipelineClient\n  hunting_details: PipelineHuntingDetails\n  proposal_id: number | null\n  confirmation_id: number | null\n  sales_agent: PipelineSalesAgent | null\n  total_amount: number | null\n  confirmation_date: string | null\n}\n\ninterface PipelineData {\n  new_inquiries: PipelineItem[]\n  pending: PipelineItem[]\n  provision_sales: PipelineItem[]\n  confirmed: PipelineItem[]\n  cancelled: PipelineItem[]\n  completed: PipelineItem[]\n}\n\ninterface PipelineCounts {\n  new_inquiries: number\n  pending: number\n  provision_sales: number\n  confirmed: number\n  cancelled: number\n  completed: number\n}\n\n// Payment installment interface\ninterface PaymentTransaction {\n  id: number\n  amount: number\n  payment_reference: string | null\n  paid_at: string\n  paid_by?: string | null\n}\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid: number\n  remaining_balance: number\n  payment_status: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at: string | null\n  payment_reference: string | null\n  paid_by?: string | null\n  due_days?: number | null\n  amount_due_type?: string | null\n  due_days_type?: string | null\n  payments: PaymentTransaction[]\n}\n\n// Payment status response interface\ninterface PaymentStatus {\n  proposal_id: number\n  current_stage: string\n  installments: Installment[]\n  summary: {\n    total_due: number\n    total_paid: number\n    total_unpaid: number\n    fully_paid_count: number\n    partial_paid_count: number\n    unpaid_count: number\n    paid_count?: number // deprecated, use fully_paid_count\n  }\n}\n\n// Payment response interface\ninterface PaymentResponse {\n  success: boolean\n  message: string\n  data: {\n    installment_id: number\n    narration: string\n    amount_due: number\n    amount_paid: number\n    remaining_balance: number\n    payment_status: 'paid' | 'partial' | 'unpaid'\n    paid_at: string\n    payment_reference: string\n    proposal_id: number\n    payments: PaymentTransaction[]\n  }\n  stage_changed: boolean\n  old_stage?: string\n  new_stage?: string\n}\n\ninterface Proposal {\n  id: number\n  confirmation_date: string\n  confirmation_date_formatted: string\n  hunting_license: string | null\n  remarks: string | null\n  status: string\n  sales_agent: {\n    id: number\n    name: string\n    email: string\n  }\n  client: {\n    id: number\n    full_name: string\n    nick_name: string | null\n    country: string\n    nationality: string\n    address: string\n    home_tel: string\n    work_tel: string | null\n    cell: string | null\n    email: string\n  }\n  hunting_trip: {\n    type: string\n    hunting_area: string\n    hunting_areas: Array<{\n      id: number\n      name: string\n      description: string\n      location: string\n    }>\n    outfitter: string\n    dates: string\n    start_date: string\n    end_date: string\n    no_of_days: number\n  }\n  trip_details: {\n    no_of_hunters: number\n    no_of_observers: number\n    no_of_companions: number\n    special_requests: string | null\n    prev_experience: string | null\n  }\n  hunt_combination: Array<{\n    id: number\n    species_id: number\n    species_name: string\n    scientific_name: string\n    quantity: number\n  }>\n  pricing: {\n    currency: string\n    total_amount: number\n    installments: Array<{\n      id: number\n      narration: string\n      amount_due: number\n      due_days: number | null\n      amount_due_type: string | null\n      due_days_type: string | null\n      is_paid?: boolean\n      paid_at?: string | null\n      amount_paid?: number | null\n      payment_reference?: string | null\n    }>\n  }\n  sales_inquiry: {\n    id: number\n    code: string\n    created_date: string\n    season: string\n  }\n  regulatory_package: any\n  created_date: string\n  updated_date: string\n}\n\ninterface ProposalState {\n  proposals: Proposal[]\n  currentProposal: Proposal | null\n  pipeline: PipelineData\n  pipelineCounts: PipelineCounts\n  pipelineTotal: number\n  paymentStatus: PaymentStatus | null\n  loading: boolean\n  saving: boolean\n  error: string | null\n}\n\nexport const useProposalStore = defineStore('proposals', {\n  state: (): ProposalState => ({\n    proposals: [],\n    currentProposal: null,\n    pipeline: {\n      new_inquiries: [],\n      pending: [],\n      provision_sales: [],\n      confirmed: [],\n      cancelled: [],\n      completed: [],\n    },\n    pipelineCounts: {\n      new_inquiries: 0,\n      pending: 0,\n      provision_sales: 0,\n      confirmed: 0,\n      cancelled: 0,\n      completed: 0,\n    },\n    pipelineTotal: 0,\n    paymentStatus: null,\n    loading: false,\n    saving: false,\n    error: null,\n  }),\n\n  getters: {\n    getProposalById: (state) => (id: number) => {\n      return state.proposals.find((p) => p.id === id)\n    },\n\n    pendingProposals: (state) => {\n      return state.proposals.filter((p) => p.status === 'pending')\n    },\n\n    confirmedProposals: (state) => {\n      return state.proposals.filter((p) => p.status === 'confirmed')\n    },\n\n    // Pipeline getters\n    newInquiries: (state) => state.pipeline.new_inquiries,\n    pendingItems: (state) => state.pipeline.pending,\n    provisionSalesItems: (state) => state.pipeline.provision_sales,\n    confirmedItems: (state) => state.pipeline.confirmed,\n    cancelledItems: (state) => state.pipeline.cancelled,\n    completedItems: (state) => state.pipeline.completed,\n  },\n\n  actions: {\n    // Pipeline Actions\n    async fetchPipeline(stage?: string, seasonId?: number) {\n      this.loading = true\n      this.error = null\n\n      try {\n        let url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/pipeline`\n        const params = new URLSearchParams()\n        if (stage) params.append('stage', stage)\n        if (seasonId) params.append('season_id', String(seasonId))\n        if (params.toString()) url += `?${params.toString()}`\n\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.pipeline = response.data.data\n          this.pipelineCounts = response.data.counts\n          this.pipelineTotal = response.data.total\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch pipeline'\n        console.error('Error fetching pipeline:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async updatePipelineStage(inquiryId: number, newStage: string) {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/pipeline/${inquiryId}/stage`\n        const response = await axios.put(url, { stage: newStage })\n\n        if (response.data.success) {\n          // Refresh pipeline after stage update\n          await this.fetchPipeline()\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to update stage'\n        console.error('Error updating pipeline stage:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async fetchProposals() {\n      this.loading = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.proposals = response.data.data\n        } else {\n          this.proposals = Array.isArray(response.data) ? response.data : []\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch proposals'\n        console.error('Error fetching proposals:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async fetchProposalById(id: number) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${id}`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.currentProposal = response.data.data\n        } else {\n          this.currentProposal = response.data\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch proposal'\n        console.error('Error fetching proposal:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async createProposal(payload: {\n      sales_inquiry_id: number\n      regulatory_package_id?: number | null\n      confirmation_date?: string\n      remarks?: string\n      hunting_license?: string\n      installments?: Array<{\n        narration: string\n        amount_due: number\n        due_days?: number\n        amount_due_type?: string\n        due_days_type?: string\n      }>\n    }) {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals`\n        const response = await axios.post(url, payload)\n\n        if (response.data.success && response.data.data) {\n          this.proposals.push(response.data.data)\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to create proposal'\n        console.error('Error creating proposal:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async updateProposal(\n      id: number,\n      payload: {\n        regulatory_package_id?: number | null\n        confirmation_date?: string\n        remarks?: string\n        hunting_license?: string\n        status?: string\n        installments?: Array<{\n          narration: string\n          amount_due: number\n          due_days?: number\n          amount_due_type?: string\n          due_days_type?: string\n        }>\n      },\n    ) {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${id}`\n        const response = await axios.put(url, payload)\n\n        if (response.data.success && response.data.data) {\n          // Update the proposal in the list\n          const index = this.proposals.findIndex((p) => p.id === id)\n          if (index !== -1) {\n            this.proposals[index] = response.data.data\n          }\n          // Also update currentProposal if it matches\n          if (this.currentProposal?.id === id) {\n            this.currentProposal = response.data.data\n          }\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to update proposal'\n        console.error('Error updating proposal:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async updateProposalStatus(id: number, status: string) {\n      return this.updateProposal(id, { status })\n    },\n\n    // Payment Actions\n    async fetchPayments(proposalId: number) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${proposalId}/payments`\n        const response = await axios.get(url)\n\n        if (response.data.success) {\n          this.paymentStatus = response.data.data\n        }\n\n        return response\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch payments'\n        console.error('Error fetching payments:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async recordPayment(\n      installmentId: number,\n      payload: {\n        amount_paid: number\n        payment_reference?: string\n        paid_at?: string\n      },\n    ): Promise<PaymentResponse> {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/installments/${installmentId}/pay`\n        const response = await axios.post(url, payload)\n\n        // If payment recorded successfully and we have paymentStatus, refresh it\n        if (response.data.success && this.paymentStatus) {\n          await this.fetchPayments(this.paymentStatus.proposal_id)\n        }\n\n        // Also refresh current proposal if present\n        if (response.data.success && this.currentProposal) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n\n        return response.data as PaymentResponse\n      } catch (error: any) {\n        this.error = error.message || 'Failed to record payment'\n        console.error('Error recording payment:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async unpayInstallment(installmentId: number): Promise<PaymentResponse> {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/installments/${installmentId}/unpay`\n        const response = await axios.post(url)\n\n        // If unpaid successfully and we have paymentStatus, refresh it\n        if (response.data.success && this.paymentStatus) {\n          await this.fetchPayments(this.paymentStatus.proposal_id)\n        }\n\n        // Also refresh current proposal if present\n        if (response.data.success && this.currentProposal) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n\n        return response.data as PaymentResponse\n      } catch (error: any) {\n        this.error = error.message || 'Failed to reverse payment'\n        console.error('Error reversing payment:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    async deletePayment(paymentId: number): Promise<{ success: boolean; message: string }> {\n      this.saving = true\n      this.error = null\n\n      try {\n        const url = `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/payments/${paymentId}`\n        const response = await axios.delete(url)\n\n        // If deleted successfully and we have paymentStatus, refresh it\n        if (response.data.success && this.paymentStatus) {\n          await this.fetchPayments(this.paymentStatus.proposal_id)\n        }\n\n        // Also refresh current proposal if present\n        if (response.data.success && this.currentProposal) {\n          await this.fetchProposalById(this.currentProposal.id)\n        }\n\n        return response.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to delete payment'\n        console.error('Error deleting payment:', error)\n        throw error\n      } finally {\n        this.saving = false\n      }\n    },\n\n    clearPaymentStatus() {\n      this.paymentStatus = null\n    },\n\n    clearCurrentProposal() {\n      this.currentProposal = null\n      this.paymentStatus = null\n    },\n\n    clearError() {\n      this.error = null\n    },\n  },\n})\n","<template>\n  <div class=\"stage-indicator\">\n    <!-- Stage Progress Bar -->\n    <div class=\"stage-progress\">\n      <div\n        v-for=\"(stage, index) in stages\"\n        :key=\"stage.value\"\n        class=\"stage-step\"\n        :class=\"{\n          'is-active': currentStage === stage.value,\n          'is-completed': isStageCompleted(stage.value),\n          'is-cancelled': currentStage === 'cancelled',\n        }\"\n      >\n        <div class=\"stage-dot\" :style=\"{ backgroundColor: getStageColor(stage.value) }\">\n          <VaIcon v-if=\"isStageCompleted(stage.value)\" name=\"check\" size=\"small\" color=\"white\" />\n          <VaIcon v-else-if=\"currentStage === 'cancelled'\" name=\"close\" size=\"small\" color=\"white\" />\n          <span v-else class=\"stage-number\">{{ index + 1 }}</span>\n        </div>\n        <div class=\"stage-label\">{{ stage.label }}</div>\n        <div\n          v-if=\"index < stages.length - 1\"\n          class=\"stage-line\"\n          :class=\"{ 'is-filled': isStageCompleted(stage.value) }\"\n        ></div>\n      </div>\n    </div>\n\n    <!-- Payment Indicators -->\n    <div v-if=\"installments && installments.length > 0\" class=\"payment-indicators\">\n      <div\n        v-for=\"installment in mainInstallments\"\n        :key=\"installment.id\"\n        class=\"payment-indicator\"\n        :class=\"{ 'is-paid': installment.is_paid }\"\n        :title=\"installment.narration\"\n      >\n        <VaIcon\n          :name=\"installment.is_paid ? 'check_circle' : 'radio_button_unchecked'\"\n          :color=\"installment.is_paid ? 'success' : 'secondary'\"\n          size=\"small\"\n        />\n        <span class=\"payment-label\">{{ getShortLabel(installment) }}</span>\n      </div>\n    </div>\n\n    <!-- Cancelled Overlay -->\n    <div v-if=\"currentStage === 'cancelled'\" class=\"cancelled-overlay\">\n      <VaChip color=\"danger\" size=\"small\">CANCELLED</VaChip>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  amount_paid?: number | null\n}\n\nexport default defineComponent({\n  name: 'StageIndicator',\n  props: {\n    currentStage: {\n      type: String,\n      required: true,\n    },\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n  },\n  data() {\n    return {\n      stages: [\n        { value: 'new_inquiries', label: 'NEW' },\n        { value: 'pending', label: 'PEND' },\n        { value: 'provision_sales', label: 'PROV' },\n        { value: 'confirmed', label: 'CONF' },\n        { value: 'completed', label: 'COMP' },\n      ],\n      stageColors: {\n        new_inquiries: '#E3F2FD',\n        pending: '#FFF9C4',\n        provision_sales: '#FFE0B2',\n        confirmed: '#C8E6C9',\n        cancelled: '#FFCDD2',\n        completed: '#E1BEE7',\n      } as Record<string, string>,\n      stageActiveColors: {\n        new_inquiries: '#2196F3',\n        pending: '#FFC107',\n        provision_sales: '#FF9800',\n        confirmed: '#4CAF50',\n        cancelled: '#F44336',\n        completed: '#9C27B0',\n      } as Record<string, string>,\n    }\n  },\n  computed: {\n    stageOrder(): string[] {\n      return this.stages.map((s) => s.value)\n    },\n\n    currentStageIndex(): number {\n      return this.stageOrder.indexOf(this.currentStage)\n    },\n\n    mainInstallments(): Installment[] {\n      // Filter to show only the main payment-triggering installments\n      return this.installments.filter((i) => {\n        const type = i.installment_type?.toLowerCase() || ''\n        const narration = i.narration.toLowerCase()\n        return (\n          type.includes('deposit') ||\n          type.includes('final') ||\n          type.includes('trophy') ||\n          narration.includes('deposit') ||\n          narration.includes('final') ||\n          narration.includes('trophy')\n        )\n      })\n    },\n  },\n  methods: {\n    isStageCompleted(stageValue: string): boolean {\n      if (this.currentStage === 'cancelled') return false\n      const stageIndex = this.stageOrder.indexOf(stageValue)\n      return stageIndex < this.currentStageIndex\n    },\n\n    getStageColor(stageValue: string): string {\n      if (this.currentStage === 'cancelled') {\n        return this.stageActiveColors.cancelled\n      }\n      if (this.isStageCompleted(stageValue) || this.currentStage === stageValue) {\n        return this.stageActiveColors[stageValue] || this.stageActiveColors.pending\n      }\n      return '#e0e0e0'\n    },\n\n    getShortLabel(installment: Installment): string {\n      const narration = installment.narration.toLowerCase()\n      if (narration.includes('deposit') && narration.includes('booking')) {\n        return 'Deposit'\n      }\n      if (narration.includes('2nd') || narration.includes('year prior')) {\n        return '2nd'\n      }\n      if (narration.includes('final')) {\n        return 'Final'\n      }\n      if (narration.includes('trophy')) {\n        return 'Trophy'\n      }\n      return installment.narration.substring(0, 6)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.stage-indicator {\n  padding: 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  position: relative;\n}\n\n.stage-progress {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 16px;\n}\n\n.stage-step {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  flex: 1;\n}\n\n.stage-dot {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: white;\n  z-index: 1;\n  transition: all 0.3s ease;\n}\n\n.stage-number {\n  color: white;\n}\n\n.stage-label {\n  margin-top: 8px;\n  font-size: 0.7rem;\n  font-weight: 500;\n  color: #6b7280;\n  text-align: center;\n}\n\n.stage-step.is-active .stage-label {\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-step.is-completed .stage-label {\n  color: #4caf50;\n}\n\n.stage-line {\n  position: absolute;\n  top: 16px;\n  left: 50%;\n  width: 100%;\n  height: 3px;\n  background: #e0e0e0;\n  z-index: 0;\n}\n\n.stage-line.is-filled {\n  background: #4caf50;\n}\n\n.stage-step:last-child .stage-line {\n  display: none;\n}\n\n.payment-indicators {\n  display: flex;\n  justify-content: center;\n  gap: 24px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.payment-indicator {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 4px;\n}\n\n.payment-label {\n  font-size: 0.65rem;\n  color: #9ca3af;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.payment-indicator.is-paid .payment-label {\n  color: #4caf50;\n  font-weight: 600;\n}\n\n.cancelled-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: rgba(255, 255, 255, 0.9);\n  padding: 8px 16px;\n  border-radius: 4px;\n}\n\n.stage-step.is-cancelled .stage-dot {\n  background: #f44336 !important;\n}\n\n.stage-step.is-cancelled .stage-label {\n  color: #f44336;\n}\n</style>\n","<template>\n  <div class=\"stage-indicator\">\n    <!-- Stage Progress Bar -->\n    <div class=\"stage-progress\">\n      <div\n        v-for=\"(stage, index) in stages\"\n        :key=\"stage.value\"\n        class=\"stage-step\"\n        :class=\"{\n          'is-active': currentStage === stage.value,\n          'is-completed': isStageCompleted(stage.value),\n          'is-cancelled': currentStage === 'cancelled',\n        }\"\n      >\n        <div class=\"stage-dot\" :style=\"{ backgroundColor: getStageColor(stage.value) }\">\n          <VaIcon v-if=\"isStageCompleted(stage.value)\" name=\"check\" size=\"small\" color=\"white\" />\n          <VaIcon v-else-if=\"currentStage === 'cancelled'\" name=\"close\" size=\"small\" color=\"white\" />\n          <span v-else class=\"stage-number\">{{ index + 1 }}</span>\n        </div>\n        <div class=\"stage-label\">{{ stage.label }}</div>\n        <div\n          v-if=\"index < stages.length - 1\"\n          class=\"stage-line\"\n          :class=\"{ 'is-filled': isStageCompleted(stage.value) }\"\n        ></div>\n      </div>\n    </div>\n\n    <!-- Payment Indicators -->\n    <div v-if=\"installments && installments.length > 0\" class=\"payment-indicators\">\n      <div\n        v-for=\"installment in mainInstallments\"\n        :key=\"installment.id\"\n        class=\"payment-indicator\"\n        :class=\"{ 'is-paid': installment.is_paid }\"\n        :title=\"installment.narration\"\n      >\n        <VaIcon\n          :name=\"installment.is_paid ? 'check_circle' : 'radio_button_unchecked'\"\n          :color=\"installment.is_paid ? 'success' : 'secondary'\"\n          size=\"small\"\n        />\n        <span class=\"payment-label\">{{ getShortLabel(installment) }}</span>\n      </div>\n    </div>\n\n    <!-- Cancelled Overlay -->\n    <div v-if=\"currentStage === 'cancelled'\" class=\"cancelled-overlay\">\n      <VaChip color=\"danger\" size=\"small\">CANCELLED</VaChip>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  amount_paid?: number | null\n}\n\nexport default defineComponent({\n  name: 'StageIndicator',\n  props: {\n    currentStage: {\n      type: String,\n      required: true,\n    },\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n  },\n  data() {\n    return {\n      stages: [\n        { value: 'new_inquiries', label: 'NEW' },\n        { value: 'pending', label: 'PEND' },\n        { value: 'provision_sales', label: 'PROV' },\n        { value: 'confirmed', label: 'CONF' },\n        { value: 'completed', label: 'COMP' },\n      ],\n      stageColors: {\n        new_inquiries: '#E3F2FD',\n        pending: '#FFF9C4',\n        provision_sales: '#FFE0B2',\n        confirmed: '#C8E6C9',\n        cancelled: '#FFCDD2',\n        completed: '#E1BEE7',\n      } as Record<string, string>,\n      stageActiveColors: {\n        new_inquiries: '#2196F3',\n        pending: '#FFC107',\n        provision_sales: '#FF9800',\n        confirmed: '#4CAF50',\n        cancelled: '#F44336',\n        completed: '#9C27B0',\n      } as Record<string, string>,\n    }\n  },\n  computed: {\n    stageOrder(): string[] {\n      return this.stages.map((s) => s.value)\n    },\n\n    currentStageIndex(): number {\n      return this.stageOrder.indexOf(this.currentStage)\n    },\n\n    mainInstallments(): Installment[] {\n      // Filter to show only the main payment-triggering installments\n      return this.installments.filter((i) => {\n        const type = i.installment_type?.toLowerCase() || ''\n        const narration = i.narration.toLowerCase()\n        return (\n          type.includes('deposit') ||\n          type.includes('final') ||\n          type.includes('trophy') ||\n          narration.includes('deposit') ||\n          narration.includes('final') ||\n          narration.includes('trophy')\n        )\n      })\n    },\n  },\n  methods: {\n    isStageCompleted(stageValue: string): boolean {\n      if (this.currentStage === 'cancelled') return false\n      const stageIndex = this.stageOrder.indexOf(stageValue)\n      return stageIndex < this.currentStageIndex\n    },\n\n    getStageColor(stageValue: string): string {\n      if (this.currentStage === 'cancelled') {\n        return this.stageActiveColors.cancelled\n      }\n      if (this.isStageCompleted(stageValue) || this.currentStage === stageValue) {\n        return this.stageActiveColors[stageValue] || this.stageActiveColors.pending\n      }\n      return '#e0e0e0'\n    },\n\n    getShortLabel(installment: Installment): string {\n      const narration = installment.narration.toLowerCase()\n      if (narration.includes('deposit') && narration.includes('booking')) {\n        return 'Deposit'\n      }\n      if (narration.includes('2nd') || narration.includes('year prior')) {\n        return '2nd'\n      }\n      if (narration.includes('final')) {\n        return 'Final'\n      }\n      if (narration.includes('trophy')) {\n        return 'Trophy'\n      }\n      return installment.narration.substring(0, 6)\n    },\n  },\n})\n</script>\n\n<style scoped>\n.stage-indicator {\n  padding: 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  position: relative;\n}\n\n.stage-progress {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 16px;\n}\n\n.stage-step {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  flex: 1;\n}\n\n.stage-dot {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: white;\n  z-index: 1;\n  transition: all 0.3s ease;\n}\n\n.stage-number {\n  color: white;\n}\n\n.stage-label {\n  margin-top: 8px;\n  font-size: 0.7rem;\n  font-weight: 500;\n  color: #6b7280;\n  text-align: center;\n}\n\n.stage-step.is-active .stage-label {\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-step.is-completed .stage-label {\n  color: #4caf50;\n}\n\n.stage-line {\n  position: absolute;\n  top: 16px;\n  left: 50%;\n  width: 100%;\n  height: 3px;\n  background: #e0e0e0;\n  z-index: 0;\n}\n\n.stage-line.is-filled {\n  background: #4caf50;\n}\n\n.stage-step:last-child .stage-line {\n  display: none;\n}\n\n.payment-indicators {\n  display: flex;\n  justify-content: center;\n  gap: 24px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.payment-indicator {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 4px;\n}\n\n.payment-label {\n  font-size: 0.65rem;\n  color: #9ca3af;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.payment-indicator.is-paid .payment-label {\n  color: #4caf50;\n  font-weight: 600;\n}\n\n.cancelled-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: rgba(255, 255, 255, 0.9);\n  padding: 8px 16px;\n  border-radius: 4px;\n}\n\n.stage-step.is-cancelled .stage-dot {\n  background: #f44336 !important;\n}\n\n.stage-step.is-cancelled .stage-label {\n  color: #f44336;\n}\n</style>\n","<template>\n  <VaCard outlined class=\"payment-table-card\">\n    <VaCardTitle class=\"flex items-center justify-between\">\n      <div class=\"flex items-center gap-2\">\n        <VaIcon name=\"payments\" color=\"primary\" />\n        <span>Payment Schedule</span>\n      </div>\n      <div class=\"total-badge\">Total: {{ formatCurrency(summary?.total_due || totalAmount) }}</div>\n    </VaCardTitle>\n    <VaCardContent>\n      <!-- Loading State -->\n      <div v-if=\"loading\" class=\"loading-state\">\n        <VaProgressBar indeterminate />\n        <p class=\"text-center mt-2 text-gray-600\">Loading payment status...</p>\n      </div>\n\n      <!-- Payment Rows -->\n      <div v-else class=\"payment-rows\">\n        <div\n          v-for=\"installment in installments\"\n          :key=\"installment.id\"\n          class=\"payment-row\"\n          :class=\"{\n            'is-paid': installment.is_paid || installment.payment_status === 'paid',\n            'is-partial': installment.payment_status === 'partial',\n          }\"\n        >\n          <!-- Status Icon -->\n          <div class=\"status-icon\">\n            <VaIcon :name=\"getStatusIcon(installment)\" :color=\"getStatusIconColor(installment)\" />\n          </div>\n\n          <!-- Installment Details -->\n          <div class=\"installment-details\">\n            <div class=\"narration\">{{ installment.narration }}</div>\n            <div v-if=\"installment.triggers_stage\" class=\"triggers-badge\">\n              <VaChip size=\"small\" color=\"info\" flat> → {{ formatStageName(installment.triggers_stage) }} </VaChip>\n            </div>\n            <!-- Show partial payment info -->\n            <div v-if=\"installment.payment_status === 'partial'\" class=\"partial-info\">\n              <span class=\"text-xs text-orange-600\">\n                Paid: {{ formatCurrency(installment.amount_paid || 0) }} / Remaining:\n                {{ formatCurrency(installment.remaining_balance || 0) }}\n              </span>\n            </div>\n            <!-- Show payment count if multiple payments -->\n            <div v-if=\"installment.payments && installment.payments.length > 1\" class=\"payments-count\">\n              <VaChip size=\"small\" color=\"secondary\" flat> {{ installment.payments.length }} payments </VaChip>\n            </div>\n          </div>\n\n          <!-- Amount -->\n          <div class=\"amount-section\">\n            <span class=\"amount\">{{ formatCurrency(installment.amount_due) }}</span>\n          </div>\n\n          <!-- Payment Info / Action -->\n          <div class=\"action-section\">\n            <template v-if=\"installment.is_paid || installment.payment_status === 'paid'\">\n              <div class=\"paid-info\">\n                <span class=\"paid-badge\">PAID</span>\n                <span v-if=\"installment.paid_at\" class=\"paid-date\">\n                  {{ formatDate(installment.paid_at) }}\n                </span>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else-if=\"installment.payment_status === 'partial'\">\n              <div class=\"partial-actions\">\n                <span class=\"partial-badge\">PARTIAL</span>\n                <VaButton size=\"small\" color=\"warning\" @click=\"$emit('record-payment', installment)\">\n                  Add Payment\n                </VaButton>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else>\n              <VaButton size=\"small\" color=\"primary\" @click=\"$emit('record-payment', installment)\">\n                Record Payment\n              </VaButton>\n            </template>\n          </div>\n        </div>\n      </div>\n\n      <!-- Summary -->\n      <div v-if=\"summary\" class=\"payment-summary\">\n        <div class=\"summary-item paid\">\n          <VaIcon name=\"check_circle\" color=\"success\" size=\"small\" />\n          <span>Paid: {{ formatCurrency(summary.total_paid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item remaining\">\n          <VaIcon name=\"pending\" color=\"warning\" size=\"small\" />\n          <span>Remaining: {{ formatCurrency(summary.total_unpaid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item count\">\n          <span>\n            {{ summary.fully_paid_count || summary.paid_count }}/{{ totalInstallmentCount }} Fully Paid\n            <template v-if=\"summary.partial_paid_count\"> ({{ summary.partial_paid_count }} partial) </template>\n          </span>\n        </div>\n      </div>\n\n      <!-- Progress Bar -->\n      <div v-if=\"summary\" class=\"payment-progress\">\n        <VaProgressBar\n          :model-value=\"paymentPercentage\"\n          :color=\"paymentPercentage === 100 ? 'success' : 'primary'\"\n          show-percent\n        />\n      </div>\n    </VaCardContent>\n  </VaCard>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Payment {\n  id: number\n  amount: number\n  payment_reference?: string\n  payment_method?: string\n  paid_at: string\n}\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  paid_at?: string | null\n  amount_paid?: number | null\n  remaining_balance?: number | null\n  payment_reference?: string | null\n  paid_by?: string | null\n  payments?: Payment[]\n}\n\ninterface PaymentSummary {\n  total_due: number\n  total_paid: number\n  total_unpaid: number\n  paid_count?: number\n  unpaid_count?: number\n  fully_paid_count?: number\n  partial_paid_count?: number\n}\n\nexport default defineComponent({\n  name: 'PaymentTable',\n  props: {\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n    summary: {\n      type: Object as PropType<PaymentSummary | null>,\n      default: null,\n    },\n    totalAmount: {\n      type: Number,\n      default: 0,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n    allowUnpay: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: ['record-payment', 'unpay'],\n  computed: {\n    paymentPercentage(): number {\n      if (!this.summary || this.summary.total_due === 0) return 0\n      return Math.round((this.summary.total_paid / this.summary.total_due) * 100)\n    },\n    totalInstallmentCount(): number {\n      if (!this.summary) return this.installments.length\n      return (\n        (this.summary.fully_paid_count || this.summary.paid_count || 0) +\n        (this.summary.partial_paid_count || 0) +\n        (this.summary.unpaid_count || 0)\n      )\n    },\n  },\n  methods: {\n    getStatusIcon(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'check_circle'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'hourglass_top'\n      }\n      return 'radio_button_unchecked'\n    },\n\n    getStatusIconColor(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'success'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'warning'\n      }\n      return 'secondary'\n    },\n\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatDate(dateString: string): string {\n      if (!dateString) return ''\n      try {\n        const date = new Date(dateString)\n        return date.toLocaleDateString('en-US', {\n          month: 'short',\n          day: 'numeric',\n          year: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        provision_sales: 'Provision Sales',\n        confirmed: 'Confirmed',\n        completed: 'Completed',\n      }\n      return names[stage] || stage.replace(/_/g, ' ')\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-table-card {\n  margin-bottom: 1.5rem;\n}\n\n.total-badge {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #1f2937;\n  background: #f3f4f6;\n  padding: 4px 12px;\n  border-radius: 4px;\n}\n\n.loading-state {\n  padding: 40px 20px;\n}\n\n.payment-rows {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.payment-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  background: #f9fafb;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.payment-row:hover {\n  border-color: #d1d5db;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n\n.payment-row.is-paid {\n  background: #f0fdf4;\n  border-color: #bbf7d0;\n}\n\n.status-icon {\n  flex-shrink: 0;\n}\n\n.installment-details {\n  flex: 1;\n  min-width: 0;\n}\n\n.narration {\n  font-weight: 500;\n  color: #1f2937;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.triggers-badge {\n  margin-top: 4px;\n}\n\n.amount-section {\n  flex-shrink: 0;\n  text-align: right;\n}\n\n.amount {\n  font-weight: 600;\n  font-size: 1rem;\n  color: #1f2937;\n}\n\n.action-section {\n  flex-shrink: 0;\n  min-width: 150px;\n  text-align: right;\n}\n\n.paid-info {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  justify-content: flex-end;\n}\n\n.paid-badge {\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #16a34a;\n  background: #dcfce7;\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.paid-date {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.payment-summary {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  padding: 16px;\n  margin-top: 16px;\n  background: #f3f4f6;\n  border-radius: 8px;\n}\n\n.summary-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.9rem;\n  color: #4b5563;\n}\n\n.summary-item.paid {\n  color: #16a34a;\n  font-weight: 500;\n}\n\n.summary-item.remaining {\n  color: #d97706;\n  font-weight: 500;\n}\n\n.summary-divider {\n  color: #d1d5db;\n}\n\n.payment-progress {\n  margin-top: 16px;\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n  .payment-row {\n    flex-wrap: wrap;\n  }\n\n  .installment-details {\n    flex-basis: calc(100% - 50px);\n    order: 1;\n  }\n\n  .status-icon {\n    order: 0;\n  }\n\n  .amount-section {\n    order: 2;\n    flex-basis: 50%;\n  }\n\n  .action-section {\n    order: 3;\n    flex-basis: 50%;\n    min-width: auto;\n  }\n\n  .payment-summary {\n    flex-wrap: wrap;\n    gap: 8px;\n  }\n\n  .summary-divider {\n    display: none;\n  }\n}\n</style>\n","<template>\n  <VaCard outlined class=\"payment-table-card\">\n    <VaCardTitle class=\"flex items-center justify-between\">\n      <div class=\"flex items-center gap-2\">\n        <VaIcon name=\"payments\" color=\"primary\" />\n        <span>Payment Schedule</span>\n      </div>\n      <div class=\"total-badge\">Total: {{ formatCurrency(summary?.total_due || totalAmount) }}</div>\n    </VaCardTitle>\n    <VaCardContent>\n      <!-- Loading State -->\n      <div v-if=\"loading\" class=\"loading-state\">\n        <VaProgressBar indeterminate />\n        <p class=\"text-center mt-2 text-gray-600\">Loading payment status...</p>\n      </div>\n\n      <!-- Payment Rows -->\n      <div v-else class=\"payment-rows\">\n        <div\n          v-for=\"installment in installments\"\n          :key=\"installment.id\"\n          class=\"payment-row\"\n          :class=\"{\n            'is-paid': installment.is_paid || installment.payment_status === 'paid',\n            'is-partial': installment.payment_status === 'partial',\n          }\"\n        >\n          <!-- Status Icon -->\n          <div class=\"status-icon\">\n            <VaIcon :name=\"getStatusIcon(installment)\" :color=\"getStatusIconColor(installment)\" />\n          </div>\n\n          <!-- Installment Details -->\n          <div class=\"installment-details\">\n            <div class=\"narration\">{{ installment.narration }}</div>\n            <div v-if=\"installment.triggers_stage\" class=\"triggers-badge\">\n              <VaChip size=\"small\" color=\"info\" flat> → {{ formatStageName(installment.triggers_stage) }} </VaChip>\n            </div>\n            <!-- Show partial payment info -->\n            <div v-if=\"installment.payment_status === 'partial'\" class=\"partial-info\">\n              <span class=\"text-xs text-orange-600\">\n                Paid: {{ formatCurrency(installment.amount_paid || 0) }} / Remaining:\n                {{ formatCurrency(installment.remaining_balance || 0) }}\n              </span>\n            </div>\n            <!-- Show payment count if multiple payments -->\n            <div v-if=\"installment.payments && installment.payments.length > 1\" class=\"payments-count\">\n              <VaChip size=\"small\" color=\"secondary\" flat> {{ installment.payments.length }} payments </VaChip>\n            </div>\n          </div>\n\n          <!-- Amount -->\n          <div class=\"amount-section\">\n            <span class=\"amount\">{{ formatCurrency(installment.amount_due) }}</span>\n          </div>\n\n          <!-- Payment Info / Action -->\n          <div class=\"action-section\">\n            <template v-if=\"installment.is_paid || installment.payment_status === 'paid'\">\n              <div class=\"paid-info\">\n                <span class=\"paid-badge\">PAID</span>\n                <span v-if=\"installment.paid_at\" class=\"paid-date\">\n                  {{ formatDate(installment.paid_at) }}\n                </span>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else-if=\"installment.payment_status === 'partial'\">\n              <div class=\"partial-actions\">\n                <span class=\"partial-badge\">PARTIAL</span>\n                <VaButton size=\"small\" color=\"warning\" @click=\"$emit('record-payment', installment)\">\n                  Add Payment\n                </VaButton>\n                <VaButton\n                  v-if=\"allowUnpay\"\n                  preset=\"plain\"\n                  size=\"small\"\n                  color=\"secondary\"\n                  icon=\"undo\"\n                  title=\"Reverse All Payments\"\n                  @click=\"$emit('unpay', installment)\"\n                />\n              </div>\n            </template>\n            <template v-else>\n              <VaButton size=\"small\" color=\"primary\" @click=\"$emit('record-payment', installment)\">\n                Record Payment\n              </VaButton>\n            </template>\n          </div>\n        </div>\n      </div>\n\n      <!-- Summary -->\n      <div v-if=\"summary\" class=\"payment-summary\">\n        <div class=\"summary-item paid\">\n          <VaIcon name=\"check_circle\" color=\"success\" size=\"small\" />\n          <span>Paid: {{ formatCurrency(summary.total_paid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item remaining\">\n          <VaIcon name=\"pending\" color=\"warning\" size=\"small\" />\n          <span>Remaining: {{ formatCurrency(summary.total_unpaid) }}</span>\n        </div>\n        <div class=\"summary-divider\">|</div>\n        <div class=\"summary-item count\">\n          <span>\n            {{ summary.fully_paid_count || summary.paid_count }}/{{ totalInstallmentCount }} Fully Paid\n            <template v-if=\"summary.partial_paid_count\"> ({{ summary.partial_paid_count }} partial) </template>\n          </span>\n        </div>\n      </div>\n\n      <!-- Progress Bar -->\n      <div v-if=\"summary\" class=\"payment-progress\">\n        <VaProgressBar\n          :model-value=\"paymentPercentage\"\n          :color=\"paymentPercentage === 100 ? 'success' : 'primary'\"\n          show-percent\n        />\n      </div>\n    </VaCardContent>\n  </VaCard>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Payment {\n  id: number\n  amount: number\n  payment_reference?: string\n  payment_method?: string\n  paid_at: string\n}\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  paid_at?: string | null\n  amount_paid?: number | null\n  remaining_balance?: number | null\n  payment_reference?: string | null\n  paid_by?: string | null\n  payments?: Payment[]\n}\n\ninterface PaymentSummary {\n  total_due: number\n  total_paid: number\n  total_unpaid: number\n  paid_count?: number\n  unpaid_count?: number\n  fully_paid_count?: number\n  partial_paid_count?: number\n}\n\nexport default defineComponent({\n  name: 'PaymentTable',\n  props: {\n    installments: {\n      type: Array as PropType<Installment[]>,\n      default: () => [],\n    },\n    summary: {\n      type: Object as PropType<PaymentSummary | null>,\n      default: null,\n    },\n    totalAmount: {\n      type: Number,\n      default: 0,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n    allowUnpay: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: ['record-payment', 'unpay'],\n  computed: {\n    paymentPercentage(): number {\n      if (!this.summary || this.summary.total_due === 0) return 0\n      return Math.round((this.summary.total_paid / this.summary.total_due) * 100)\n    },\n    totalInstallmentCount(): number {\n      if (!this.summary) return this.installments.length\n      return (\n        (this.summary.fully_paid_count || this.summary.paid_count || 0) +\n        (this.summary.partial_paid_count || 0) +\n        (this.summary.unpaid_count || 0)\n      )\n    },\n  },\n  methods: {\n    getStatusIcon(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'check_circle'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'hourglass_top'\n      }\n      return 'radio_button_unchecked'\n    },\n\n    getStatusIconColor(installment: Installment): string {\n      if (installment.is_paid || installment.payment_status === 'paid') {\n        return 'success'\n      }\n      if (installment.payment_status === 'partial') {\n        return 'warning'\n      }\n      return 'secondary'\n    },\n\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatDate(dateString: string): string {\n      if (!dateString) return ''\n      try {\n        const date = new Date(dateString)\n        return date.toLocaleDateString('en-US', {\n          month: 'short',\n          day: 'numeric',\n          year: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        provision_sales: 'Provision Sales',\n        confirmed: 'Confirmed',\n        completed: 'Completed',\n      }\n      return names[stage] || stage.replace(/_/g, ' ')\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-table-card {\n  margin-bottom: 1.5rem;\n}\n\n.total-badge {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #1f2937;\n  background: #f3f4f6;\n  padding: 4px 12px;\n  border-radius: 4px;\n}\n\n.loading-state {\n  padding: 40px 20px;\n}\n\n.payment-rows {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.payment-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  background: #f9fafb;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.payment-row:hover {\n  border-color: #d1d5db;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n\n.payment-row.is-paid {\n  background: #f0fdf4;\n  border-color: #bbf7d0;\n}\n\n.status-icon {\n  flex-shrink: 0;\n}\n\n.installment-details {\n  flex: 1;\n  min-width: 0;\n}\n\n.narration {\n  font-weight: 500;\n  color: #1f2937;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.triggers-badge {\n  margin-top: 4px;\n}\n\n.amount-section {\n  flex-shrink: 0;\n  text-align: right;\n}\n\n.amount {\n  font-weight: 600;\n  font-size: 1rem;\n  color: #1f2937;\n}\n\n.action-section {\n  flex-shrink: 0;\n  min-width: 150px;\n  text-align: right;\n}\n\n.paid-info {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  justify-content: flex-end;\n}\n\n.paid-badge {\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #16a34a;\n  background: #dcfce7;\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.paid-date {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.payment-summary {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  padding: 16px;\n  margin-top: 16px;\n  background: #f3f4f6;\n  border-radius: 8px;\n}\n\n.summary-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.9rem;\n  color: #4b5563;\n}\n\n.summary-item.paid {\n  color: #16a34a;\n  font-weight: 500;\n}\n\n.summary-item.remaining {\n  color: #d97706;\n  font-weight: 500;\n}\n\n.summary-divider {\n  color: #d1d5db;\n}\n\n.payment-progress {\n  margin-top: 16px;\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n  .payment-row {\n    flex-wrap: wrap;\n  }\n\n  .installment-details {\n    flex-basis: calc(100% - 50px);\n    order: 1;\n  }\n\n  .status-icon {\n    order: 0;\n  }\n\n  .amount-section {\n    order: 2;\n    flex-basis: 50%;\n  }\n\n  .action-section {\n    order: 3;\n    flex-basis: 50%;\n    min-width: auto;\n  }\n\n  .payment-summary {\n    flex-wrap: wrap;\n    gap: 8px;\n  }\n\n  .summary-divider {\n    display: none;\n  }\n}\n</style>\n","<template>\n  <VaModal\n    :model-value=\"modelValue\"\n    title=\"Record Payment\"\n    size=\"medium\"\n    :hide-default-actions=\"true\"\n    @update:modelValue=\"$emit('update:modelValue', $event)\"\n  >\n    <div class=\"payment-modal-content\">\n      <!-- Installment Info -->\n      <div class=\"installment-info mb-6\">\n        <div class=\"info-header\">\n          <VaIcon name=\"receipt_long\" color=\"primary\" />\n          <span>{{ installment?.narration || 'Payment' }}</span>\n        </div>\n        <div class=\"info-amount\">\n          <span class=\"label\">Amount Due:</span>\n          <span class=\"amount\">{{ formatCurrency(installment?.amount_due || 0) }}</span>\n        </div>\n        <!-- Show partial payment info if applicable -->\n        <div v-if=\"hasPartialPayment\" class=\"partial-payment-info mt-3\">\n          <div class=\"flex justify-between text-sm\">\n            <span class=\"text-gray-600\">Already Paid:</span>\n            <span class=\"text-green-600 font-medium\">{{ formatCurrency(installment?.amount_paid || 0) }}</span>\n          </div>\n          <div class=\"flex justify-between text-sm mt-1\">\n            <span class=\"text-gray-600\">Remaining Balance:</span>\n            <span class=\"text-orange-600 font-semibold\">{{ formatCurrency(remainingBalance) }}</span>\n          </div>\n        </div>\n      </div>\n\n      <!-- Stage Change Warning -->\n      <div v-if=\"triggersStage && willCompleteInstallment\" class=\"stage-warning mb-6\">\n        <VaIcon name=\"flash_on\" color=\"warning\" />\n        <span>\n          This payment will move the sale to\n          <strong>{{ formatStageName(triggersStage) }}</strong> stage\n        </span>\n      </div>\n\n      <!-- Partial Payment Notice -->\n      <div v-if=\"!willCompleteInstallment && form.amount_paid\" class=\"partial-notice mb-6\">\n        <VaIcon name=\"info\" color=\"info\" />\n        <span>This is a partial payment.</span>\n      </div>\n\n      <!-- Payment Form -->\n      <div class=\"payment-form\">\n        <VaInput\n          v-model.number=\"form.amount_paid\"\n          type=\"number\"\n          label=\"Amount Paid\"\n          placeholder=\"Enter amount\"\n          class=\"mb-4\"\n          :rules=\"[requiredRule, positiveAmountRule]\"\n        >\n          <template #prependInner>\n            <span class=\"text-gray-500\">$</span>\n          </template>\n        </VaInput>\n\n        <VaInput\n          v-model=\"form.payment_reference\"\n          label=\"Payment Reference\"\n          placeholder=\"e.g., TRX-2025-001\"\n          class=\"mb-4\"\n        />\n\n        <VaDateInput v-model=\"form.paid_at\" label=\"Payment Date\" class=\"mb-4\" :clearable=\"false\" />\n      </div>\n\n      <!-- Actions -->\n      <div class=\"modal-actions\">\n        <VaButton preset=\"secondary\" @click=\"handleCancel\"> Cancel </VaButton>\n        <VaButton color=\"primary\" :loading=\"loading\" :disabled=\"!isFormValid\" @click=\"handleSubmit\">\n          Record Payment\n        </VaButton>\n      </div>\n    </div>\n  </VaModal>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n}\n\nexport default defineComponent({\n  name: 'PaymentModal',\n  props: {\n    modelValue: {\n      type: Boolean,\n      default: false,\n    },\n    installment: {\n      type: Object as PropType<Installment | null>,\n      default: null,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['update:modelValue', 'submit'],\n  data() {\n    return {\n      form: {\n        amount_paid: null as number | null,\n        payment_reference: '',\n        paid_at: new Date(),\n      },\n    }\n  },\n  computed: {\n    isFormValid(): boolean {\n      return !!this.form.amount_paid && this.form.amount_paid > 0\n    },\n\n    hasPartialPayment(): boolean {\n      if (!this.installment) return false\n      return this.installment.payment_status === 'partial' || (this.installment.amount_paid || 0) > 0\n    },\n\n    remainingBalance(): number {\n      if (!this.installment) return 0\n      if (this.installment.remaining_balance !== undefined) {\n        return this.installment.remaining_balance\n      }\n      return (this.installment.amount_due || 0) - (this.installment.amount_paid || 0)\n    },\n\n    willCompleteInstallment(): boolean {\n      if (!this.installment || !this.form.amount_paid) return false\n      return this.form.amount_paid >= this.remainingBalance\n    },\n\n    triggersStage(): string | null {\n      if (!this.installment) return null\n\n      // Check explicit triggers_stage from API\n      if (this.installment.triggers_stage) {\n        return this.installment.triggers_stage\n      }\n\n      // Determine from narration/type\n      const narration = this.installment.narration?.toLowerCase() || ''\n      const type = this.installment.installment_type?.toLowerCase() || ''\n\n      if (type.includes('deposit_booking') || (narration.includes('deposit') && narration.includes('booking'))) {\n        return 'provision_sales'\n      }\n      if (type.includes('final_payment') || (narration.includes('final') && narration.includes('90'))) {\n        return 'confirmed'\n      }\n      if (type.includes('trophy_deposit') || (narration.includes('trophy') && narration.includes('45'))) {\n        return 'completed'\n      }\n\n      return null\n    },\n\n    requiredRule() {\n      return (v: any) => !!v || 'Amount is required'\n    },\n\n    positiveAmountRule() {\n      return (v: any) => (v && Number(v) > 0) || 'Amount must be positive'\n    },\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal && this.installment) {\n        // Reset form without pre-filling amount\n        this.form.amount_paid = null\n        this.form.payment_reference = ''\n        this.form.paid_at = new Date()\n      }\n    },\n  },\n  methods: {\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        pending: 'PENDING',\n        provision_sales: 'PROVISION SALES',\n        confirmed: 'CONFIRMED',\n        completed: 'COMPLETED',\n      }\n      return names[stage] || stage.replace(/_/g, ' ').toUpperCase()\n    },\n\n    handleCancel() {\n      this.$emit('update:modelValue', false)\n    },\n\n    handleSubmit() {\n      if (!this.installment || !this.isFormValid) return\n\n      const payload = {\n        installment_id: this.installment.id,\n        amount_paid: this.form.amount_paid!,\n        payment_reference: this.form.payment_reference || undefined,\n        paid_at: this.form.paid_at ? this.formatDateForApi(this.form.paid_at) : undefined,\n      }\n\n      this.$emit('submit', payload)\n    },\n\n    formatDateForApi(date: Date): string {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      return `${year}-${month}-${day}`\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-modal-content {\n  padding: 16px;\n}\n\n.installment-info {\n  background: #f3f4f6;\n  border-radius: 8px;\n  padding: 16px;\n}\n\n.info-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 12px;\n}\n\n.info-amount {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.info-amount .label {\n  color: #6b7280;\n}\n\n.info-amount .amount {\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-warning {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fff9c4;\n  border-radius: 8px;\n  border-left: 4px solid #ffc107;\n  font-size: 0.9rem;\n  color: #856404;\n}\n\n.stage-warning strong {\n  color: #1f2937;\n}\n\n.partial-notice {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #e0f2fe;\n  border-radius: 8px;\n  border-left: 4px solid #2196f3;\n  font-size: 0.9rem;\n  color: #0369a1;\n}\n\n.partial-payment-info {\n  border-top: 1px solid #e5e7eb;\n  padding-top: 12px;\n}\n\n.payment-form {\n  margin-bottom: 24px;\n}\n\n.modal-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n}\n</style>\n","<template>\n  <VaModal\n    :model-value=\"modelValue\"\n    title=\"Record Payment\"\n    size=\"medium\"\n    :hide-default-actions=\"true\"\n    @update:modelValue=\"$emit('update:modelValue', $event)\"\n  >\n    <div class=\"payment-modal-content\">\n      <!-- Installment Info -->\n      <div class=\"installment-info mb-6\">\n        <div class=\"info-header\">\n          <VaIcon name=\"receipt_long\" color=\"primary\" />\n          <span>{{ installment?.narration || 'Payment' }}</span>\n        </div>\n        <div class=\"info-amount\">\n          <span class=\"label\">Amount Due:</span>\n          <span class=\"amount\">{{ formatCurrency(installment?.amount_due || 0) }}</span>\n        </div>\n        <!-- Show partial payment info if applicable -->\n        <div v-if=\"hasPartialPayment\" class=\"partial-payment-info mt-3\">\n          <div class=\"flex justify-between text-sm\">\n            <span class=\"text-gray-600\">Already Paid:</span>\n            <span class=\"text-green-600 font-medium\">{{ formatCurrency(installment?.amount_paid || 0) }}</span>\n          </div>\n          <div class=\"flex justify-between text-sm mt-1\">\n            <span class=\"text-gray-600\">Remaining Balance:</span>\n            <span class=\"text-orange-600 font-semibold\">{{ formatCurrency(remainingBalance) }}</span>\n          </div>\n        </div>\n      </div>\n\n      <!-- Stage Change Warning -->\n      <div v-if=\"triggersStage && willCompleteInstallment\" class=\"stage-warning mb-6\">\n        <VaIcon name=\"flash_on\" color=\"warning\" />\n        <span>\n          This payment will move the sale to\n          <strong>{{ formatStageName(triggersStage) }}</strong> stage\n        </span>\n      </div>\n\n      <!-- Partial Payment Notice -->\n      <div v-if=\"!willCompleteInstallment && form.amount_paid\" class=\"partial-notice mb-6\">\n        <VaIcon name=\"info\" color=\"info\" />\n        <span>This is a partial payment.</span>\n      </div>\n\n      <!-- Payment Form -->\n      <div class=\"payment-form\">\n        <VaInput\n          v-model.number=\"form.amount_paid\"\n          type=\"number\"\n          label=\"Amount Paid\"\n          placeholder=\"Enter amount\"\n          class=\"mb-4\"\n          :rules=\"[requiredRule, positiveAmountRule]\"\n        >\n          <template #prependInner>\n            <span class=\"text-gray-500\">$</span>\n          </template>\n        </VaInput>\n\n        <VaInput\n          v-model=\"form.payment_reference\"\n          label=\"Payment Reference\"\n          placeholder=\"e.g., TRX-2025-001\"\n          class=\"mb-4\"\n        />\n\n        <VaDateInput v-model=\"form.paid_at\" label=\"Payment Date\" class=\"mb-4\" :clearable=\"false\" />\n      </div>\n\n      <!-- Actions -->\n      <div class=\"modal-actions\">\n        <VaButton preset=\"secondary\" @click=\"handleCancel\"> Cancel </VaButton>\n        <VaButton color=\"primary\" :loading=\"loading\" :disabled=\"!isFormValid\" @click=\"handleSubmit\">\n          Record Payment\n        </VaButton>\n      </div>\n    </div>\n  </VaModal>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n}\n\nexport default defineComponent({\n  name: 'PaymentModal',\n  props: {\n    modelValue: {\n      type: Boolean,\n      default: false,\n    },\n    installment: {\n      type: Object as PropType<Installment | null>,\n      default: null,\n    },\n    loading: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['update:modelValue', 'submit'],\n  data() {\n    return {\n      form: {\n        amount_paid: null as number | null,\n        payment_reference: '',\n        paid_at: new Date(),\n      },\n    }\n  },\n  computed: {\n    isFormValid(): boolean {\n      return !!this.form.amount_paid && this.form.amount_paid > 0\n    },\n\n    hasPartialPayment(): boolean {\n      if (!this.installment) return false\n      return this.installment.payment_status === 'partial' || (this.installment.amount_paid || 0) > 0\n    },\n\n    remainingBalance(): number {\n      if (!this.installment) return 0\n      if (this.installment.remaining_balance !== undefined) {\n        return this.installment.remaining_balance\n      }\n      return (this.installment.amount_due || 0) - (this.installment.amount_paid || 0)\n    },\n\n    willCompleteInstallment(): boolean {\n      if (!this.installment || !this.form.amount_paid) return false\n      return this.form.amount_paid >= this.remainingBalance\n    },\n\n    triggersStage(): string | null {\n      if (!this.installment) return null\n\n      // Check explicit triggers_stage from API\n      if (this.installment.triggers_stage) {\n        return this.installment.triggers_stage\n      }\n\n      // Determine from narration/type\n      const narration = this.installment.narration?.toLowerCase() || ''\n      const type = this.installment.installment_type?.toLowerCase() || ''\n\n      if (type.includes('deposit_booking') || (narration.includes('deposit') && narration.includes('booking'))) {\n        return 'provision_sales'\n      }\n      if (type.includes('final_payment') || (narration.includes('final') && narration.includes('90'))) {\n        return 'confirmed'\n      }\n      if (type.includes('trophy_deposit') || (narration.includes('trophy') && narration.includes('45'))) {\n        return 'completed'\n      }\n\n      return null\n    },\n\n    requiredRule() {\n      return (v: any) => !!v || 'Amount is required'\n    },\n\n    positiveAmountRule() {\n      return (v: any) => (v && Number(v) > 0) || 'Amount must be positive'\n    },\n  },\n  watch: {\n    modelValue(newVal) {\n      if (newVal && this.installment) {\n        // Reset form without pre-filling amount\n        this.form.amount_paid = null\n        this.form.payment_reference = ''\n        this.form.paid_at = new Date()\n      }\n    },\n  },\n  methods: {\n    formatCurrency(amount: number): string {\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    formatStageName(stage: string): string {\n      const names: Record<string, string> = {\n        pending: 'PENDING',\n        provision_sales: 'PROVISION SALES',\n        confirmed: 'CONFIRMED',\n        completed: 'COMPLETED',\n      }\n      return names[stage] || stage.replace(/_/g, ' ').toUpperCase()\n    },\n\n    handleCancel() {\n      this.$emit('update:modelValue', false)\n    },\n\n    handleSubmit() {\n      if (!this.installment || !this.isFormValid) return\n\n      const payload = {\n        installment_id: this.installment.id,\n        amount_paid: this.form.amount_paid!,\n        payment_reference: this.form.payment_reference || undefined,\n        paid_at: this.form.paid_at ? this.formatDateForApi(this.form.paid_at) : undefined,\n      }\n\n      this.$emit('submit', payload)\n    },\n\n    formatDateForApi(date: Date): string {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      return `${year}-${month}-${day}`\n    },\n  },\n})\n</script>\n\n<style scoped>\n.payment-modal-content {\n  padding: 16px;\n}\n\n.installment-info {\n  background: #f3f4f6;\n  border-radius: 8px;\n  padding: 16px;\n}\n\n.info-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 12px;\n}\n\n.info-amount {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.info-amount .label {\n  color: #6b7280;\n}\n\n.info-amount .amount {\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: #1f2937;\n}\n\n.stage-warning {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fff9c4;\n  border-radius: 8px;\n  border-left: 4px solid #ffc107;\n  font-size: 0.9rem;\n  color: #856404;\n}\n\n.stage-warning strong {\n  color: #1f2937;\n}\n\n.partial-notice {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #e0f2fe;\n  border-radius: 8px;\n  border-left: 4px solid #2196f3;\n  font-size: 0.9rem;\n  color: #0369a1;\n}\n\n.partial-payment-info {\n  border-top: 1px solid #e5e7eb;\n  padding-top: 12px;\n}\n\n.payment-form {\n  margin-bottom: 24px;\n}\n\n.modal-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n}\n</style>\n","<template>\n  <div class=\"proposal-view\">\n    <!-- Header with Logo and Title -->\n    <div class=\"proposal-header\">\n      <div class=\"flex justify-between items-start mb-6\">\n        <div class=\"logo-section\">\n          <img v-if=\"logoUrl\" :src=\"logoUrl\" alt=\"Company Logo\" class=\"h-16\" />\n          <h2 v-else class=\"text-xl font-bold text-primary\">Bushman Safari Trackers Limited</h2>\n        </div>\n        <div class=\"text-right\">\n          <h1 class=\"text-2xl font-bold text-gray-800 mb-2\">SALES CONFIRMATION</h1>\n          <p class=\"text-gray-600\">\n            Date: {{ proposal.confirmation_date_formatted || formatDate(proposal.confirmation_date) }}\n          </p>\n          <VaChip :color=\"getStatusColor(proposal.status)\" size=\"small\" class=\"mt-2\">\n            {{ formatStatus(proposal.status) }}\n          </VaChip>\n        </div>\n      </div>\n    </div>\n\n    <!-- Stage Indicator -->\n    <StageIndicator\n      v-if=\"proposal.status\"\n      :current-stage=\"proposal.status\"\n      :installments=\"paymentInstallments\"\n      class=\"mb-6\"\n    />\n\n    <!-- Action Buttons -->\n    <div class=\"action-buttons mb-6 flex flex-wrap justify-end gap-3\">\n      <VaButton preset=\"secondary\" icon=\"print\" @click=\"printProposal\"> Print </VaButton>\n      <VaButton preset=\"secondary\" icon=\"download\" @click=\"downloadPdf\"> Download PDF </VaButton>\n      <VaButton color=\"primary\" icon=\"edit\" @click=\"$emit('edit', proposal)\"> Edit </VaButton>\n\n      <!-- Manual Cancel Button (only available before completion) -->\n      <VaButton v-if=\"canBeCancelled\" color=\"secondary\" icon=\"cancel\" @click=\"changeToStage('cancelled')\">\n        Cancel\n      </VaButton>\n    </div>\n\n    <!-- Sales Agent & Client Info -->\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n      <!-- Sales Agent -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"support_agent\" color=\"primary\" />\n          Sales Agent\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Client Info -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"person\" color=\"primary\" />\n          Client Information\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value font-semibold\">{{ proposal.client?.full_name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Address:</span>\n            <span class=\"value\">{{ proposal.client?.address || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Home Tel:</span>\n            <span class=\"value\">{{ proposal.client?.home_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Work Tel:</span>\n            <span class=\"value\">{{ proposal.client?.work_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Cell:</span>\n            <span class=\"value\">{{ proposal.client?.cell || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.client?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </div>\n\n    <!-- Hunting Trip Details -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"landscape\" color=\"primary\" />\n        Hunting Trip Details\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Type of Safari:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.type || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting Area:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.hunting_area || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Outfitter:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.outfitter || 'Bushman Safari Trackers Limited' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Dates:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.dates || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Details of Trip -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"groups\" color=\"primary\" />\n        Details of Trip\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_hunters || 0 }}</div>\n            <div class=\"stat-label\">Hunters</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_observers || 0 }}</div>\n            <div class=\"stat-label\">Observers</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_companions || 0 }}</div>\n            <div class=\"stat-label\">Companions</div>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Hunt Combination (Species) -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"pets\" color=\"primary\" />\n        Hunt Combination\n      </VaCardTitle>\n      <VaCardContent>\n        <VaDataTable :items=\"proposal.hunt_combination || []\" :columns=\"speciesColumns\" hoverable striped>\n          <template #cell(species_name)=\"{ rowData }\">\n            <div class=\"flex flex-col\">\n              <span class=\"font-semibold\">{{ rowData.species_name }}</span>\n              <span class=\"text-xs text-gray-500 italic\">{{ rowData.scientific_name }}</span>\n            </div>\n          </template>\n          <template #cell(quantity)=\"{ rowData }\">\n            <VaBadge :text=\"String(rowData.quantity)\" color=\"primary\" />\n          </template>\n        </VaDataTable>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Pricing / Payment Schedule -->\n    <PaymentTable\n      :installments=\"paymentInstallments\"\n      :summary=\"paymentSummary\"\n      :total-amount=\"proposal.pricing?.total_amount || 0\"\n      :loading=\"loadingPayments\"\n      :allow-unpay=\"true\"\n      @recordPayment=\"openPaymentModal\"\n      @unpay=\"handleUnpay\"\n    />\n\n    <!-- Sales Inquiry Reference -->\n    <VaCard outlined class=\"mb-6 bg-gray-50\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"link\" color=\"info\" />\n        Linked Sales Inquiry\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Inquiry Code:</span>\n            <span class=\"value font-mono\">{{ proposal.sales_inquiry?.code || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Created Date:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.created_date || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Season:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.season || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting License:</span>\n            <span class=\"value\">{{ proposal.hunting_license || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Remarks -->\n    <VaCard v-if=\"proposal.remarks\" outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"notes\" color=\"primary\" />\n        Remarks\n      </VaCardTitle>\n      <VaCardContent>\n        <p class=\"text-gray-700\">{{ proposal.remarks }}</p>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Payment Modal -->\n    <PaymentModal\n      v-model=\"showPaymentModal\"\n      :installment=\"selectedInstallment\"\n      :loading=\"savingPayment\"\n      @submit=\"handlePaymentSubmit\"\n    />\n\n    <!-- Status Change Modal -->\n    <VaModal v-model=\"showStatusModal\" title=\"Change Proposal Status\" :hide-default-actions=\"true\">\n      <div class=\"p-4\">\n        <VaSelect v-model=\"newStatus\" :options=\"statusOptions\" label=\"Select New Status\" class=\"mb-4\" />\n        <div class=\"flex justify-end gap-3\">\n          <VaButton preset=\"secondary\" @click=\"showStatusModal = false\">Cancel</VaButton>\n          <VaButton color=\"primary\" @click=\"changeStatus\">Confirm</VaButton>\n        </div>\n      </div>\n    </VaModal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { mapState, mapActions } from 'pinia'\nimport { useSettingsStore } from '../../../../stores/settings-store'\nimport { useProposalStore } from '../../../../stores/proposal-store'\nimport StageIndicator from './StageIndicator.vue'\nimport PaymentTable from './PaymentTable.vue'\nimport PaymentModal from './PaymentModal.vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  payment_reference?: string | null\n  payments?: Array<{\n    id: number\n    amount: number\n    payment_reference: string | null\n    paid_at: string\n  }>\n}\n\nexport default defineComponent({\n  name: 'ProposalView',\n  components: {\n    StageIndicator,\n    PaymentTable,\n    PaymentModal,\n  },\n  props: {\n    proposal: {\n      type: Object as PropType<any>,\n      required: true,\n    },\n  },\n  emits: ['edit', 'status-change', 'payment-recorded'],\n  data() {\n    return {\n      showStatusModal: false,\n      showPaymentModal: false,\n      selectedInstallment: null as Installment | null,\n      newStatus: null as string | null,\n      loadingPayments: false,\n      savingPayment: false,\n      speciesColumns: [\n        { key: 'species_name', label: 'Species', sortable: true },\n        { key: 'quantity', label: 'Quantity', sortable: true, width: 120 },\n      ],\n      statusOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provisional Sale' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'declined', text: 'Declined' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n    }\n  },\n  computed: {\n    ...mapState(useSettingsStore, ['logo']),\n    ...mapState(useProposalStore, ['paymentStatus']),\n\n    logoUrl(): string | null {\n      return this.logo || null\n    },\n\n    canBeCancelled(): boolean {\n      const status = this.proposal.status\n      return status === 'pending' || status === 'provision_sales' || status === 'confirmed'\n    },\n\n    paymentInstallments(): Installment[] {\n      // Use payment status from API if available, otherwise fall back to proposal installments\n      if (this.paymentStatus?.installments) {\n        return this.paymentStatus.installments\n      }\n      // Map proposal installments with default is_paid status\n      return (this.proposal.pricing?.installments || []).map((inst: any) => ({\n        ...inst,\n        is_paid: inst.is_paid || false,\n        paid_at: inst.paid_at || null,\n        amount_paid: inst.amount_paid || null,\n        payment_reference: inst.payment_reference || null,\n      }))\n    },\n\n    paymentSummary() {\n      if (this.paymentStatus?.summary) {\n        return this.paymentStatus.summary\n      }\n      // Calculate from installments\n      const installments = this.paymentInstallments\n      const total_due = installments.reduce((sum: number, i: Installment) => sum + (i.amount_due || 0), 0)\n      const total_paid = installments.reduce(\n        (sum: number, i: Installment) => sum + (i.is_paid ? i.amount_paid || i.amount_due : 0),\n        0,\n      )\n      const paid_count = installments.filter((i: Installment) => i.is_paid).length\n      return {\n        total_due,\n        total_paid,\n        total_unpaid: total_due - total_paid,\n        paid_count,\n        unpaid_count: installments.length - paid_count,\n      }\n    },\n  },\n  watch: {\n    'proposal.id': {\n      handler() {\n        this.loadPaymentStatus()\n      },\n    },\n  },\n  mounted() {\n    this.loadPaymentStatus()\n  },\n  methods: {\n    ...mapActions(useProposalStore, ['fetchPayments', 'recordPayment', 'unpayInstallment']),\n\n    async loadPaymentStatus() {\n      if (!this.proposal?.id) return\n      this.loadingPayments = true\n      try {\n        await this.fetchPayments(this.proposal.id)\n      } catch (error) {\n        console.error('Error loading payment status:', error)\n      } finally {\n        this.loadingPayments = false\n      }\n    },\n\n    formatDate(dateString: string | undefined): string {\n      if (!dateString) return 'N/A'\n      try {\n        return new Date(dateString).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatCurrency(amount: number | undefined): string {\n      if (!amount) return '$0'\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    getStatusColor(status: string): string {\n      const colors: Record<string, string> = {\n        pending: 'warning',\n        provision_sales: 'info',\n        confirmed: 'success',\n        declined: 'danger',\n        cancelled: 'secondary',\n        completed: 'primary',\n      }\n      return colors[status] || 'secondary'\n    },\n\n    formatStatus(status: string): string {\n      if (!status) return 'N/A'\n      return status.replace(/_/g, ' ').replace(/\\b\\w/g, (c) => c.toUpperCase())\n    },\n\n    printProposal() {\n      window.print()\n    },\n\n    async downloadPdf() {\n      if (!this.proposal?.id) {\n        this.$vaToast?.init({\n          message: 'No proposal selected',\n          color: 'warning',\n        })\n        return\n      }\n\n      try {\n        this.$vaToast?.init({\n          message: 'Generating PDF...',\n          color: 'info',\n        })\n\n        const response = await fetch(\n          `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${this.proposal.id}/pdf`,\n        )\n        const data = await response.json()\n\n        if (data.success) {\n          // Convert base64 to blob and download\n          const byteCharacters = atob(data.pdf)\n          const byteNumbers = new Array(byteCharacters.length)\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i)\n          }\n          const byteArray = new Uint8Array(byteNumbers)\n          const blob = new Blob([byteArray], { type: 'application/pdf' })\n\n          // Create download link\n          const url = window.URL.createObjectURL(blob)\n          const a = document.createElement('a')\n          a.href = url\n          a.download = `Sales_Confirmation_${data.client_name || this.proposal.client?.full_name || 'Proposal'}.pdf`\n          a.click()\n\n          // Clean up\n          window.URL.revokeObjectURL(url)\n\n          this.$vaToast?.init({\n            message: 'PDF downloaded successfully',\n            color: 'success',\n          })\n        } else {\n          this.$vaToast?.init({\n            message: data.message || 'Failed to generate PDF',\n            color: 'danger',\n          })\n        }\n      } catch (error) {\n        console.error('Error downloading PDF:', error)\n        this.$vaToast?.init({\n          message: 'Failed to download PDF',\n          color: 'danger',\n        })\n      }\n    },\n\n    confirmProposal() {\n      this.newStatus = 'confirmed'\n      this.showStatusModal = true\n    },\n\n    changeToStage(stage: string) {\n      this.$emit('status-change', {\n        id: this.proposal.id,\n        status: stage,\n      })\n    },\n\n    changeStatus() {\n      if (this.newStatus) {\n        this.$emit('status-change', {\n          id: this.proposal.id,\n          status: this.newStatus,\n        })\n        this.showStatusModal = false\n        this.newStatus = null\n      }\n    },\n\n    // Payment methods\n    openPaymentModal(installment: Installment) {\n      this.selectedInstallment = installment\n      this.showPaymentModal = true\n    },\n\n    async handlePaymentSubmit(payload: {\n      installment_id: number\n      amount_paid: number\n      payment_reference?: string\n      paid_at?: string\n    }) {\n      this.savingPayment = true\n      try {\n        const result = await this.recordPayment(payload.installment_id, {\n          amount_paid: payload.amount_paid,\n          payment_reference: payload.payment_reference,\n          paid_at: payload.paid_at,\n        })\n\n        this.showPaymentModal = false\n        this.selectedInstallment = null\n\n        // Build success message based on payment status\n        let message = 'Payment recorded successfully'\n        if (result.stage_changed) {\n          message = result.message || `Payment recorded. Stage updated to ${this.formatStatus(result.new_stage || '')}`\n        } else if (result.data?.payment_status === 'partial') {\n          const remaining = this.formatCurrency(result.data.remaining_balance)\n          message = `Partial payment recorded. Remaining balance: ${remaining}`\n        }\n\n        this.$vaToast?.init({\n          message,\n          color: 'success',\n        })\n\n        // Emit event for parent to refresh if needed\n        this.$emit('payment-recorded', result)\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to record payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n\n    async handleUnpay(installment: Installment) {\n      if (!confirm(`Are you sure you want to reverse the payment for \"${installment.narration}\"?`)) {\n        return\n      }\n\n      this.savingPayment = true\n      try {\n        await this.unpayInstallment(installment.id)\n\n        this.$vaToast?.init({\n          message: 'Payment reversed successfully',\n          color: 'success',\n        })\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to reverse payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n  },\n})\n</script>\n\n<style scoped>\n.proposal-view {\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.proposal-header {\n  border-bottom: 2px solid #e5e7eb;\n  padding-bottom: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.info-row {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n\n.info-row .label {\n  color: #6b7280;\n  min-width: 100px;\n}\n\n.info-row .value {\n  color: #1f2937;\n}\n\n.stat-card {\n  background-color: #f3f4f6;\n  border-radius: 8px;\n  padding: 1.5rem;\n  text-align: center;\n}\n\n.stat-value {\n  font-size: 2rem;\n  font-weight: 700;\n  color: var(--va-primary);\n}\n\n.stat-label {\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.total-row {\n  background: linear-gradient(135deg, var(--va-primary), var(--va-primary-darken));\n}\n\n@media print {\n  .action-buttons {\n    display: none !important;\n  }\n\n  .proposal-view {\n    max-width: 100%;\n  }\n\n  :deep(.va-card) {\n    box-shadow: none !important;\n    border: 1px solid #e5e7eb !important;\n  }\n}\n</style>\n","<template>\n  <div class=\"proposal-view\">\n    <!-- Header with Logo and Title -->\n    <div class=\"proposal-header\">\n      <div class=\"flex justify-between items-start mb-6\">\n        <div class=\"logo-section\">\n          <img v-if=\"logoUrl\" :src=\"logoUrl\" alt=\"Company Logo\" class=\"h-16\" />\n          <h2 v-else class=\"text-xl font-bold text-primary\">Bushman Safari Trackers Limited</h2>\n        </div>\n        <div class=\"text-right\">\n          <h1 class=\"text-2xl font-bold text-gray-800 mb-2\">SALES CONFIRMATION</h1>\n          <p class=\"text-gray-600\">\n            Date: {{ proposal.confirmation_date_formatted || formatDate(proposal.confirmation_date) }}\n          </p>\n          <VaChip :color=\"getStatusColor(proposal.status)\" size=\"small\" class=\"mt-2\">\n            {{ formatStatus(proposal.status) }}\n          </VaChip>\n        </div>\n      </div>\n    </div>\n\n    <!-- Stage Indicator -->\n    <StageIndicator\n      v-if=\"proposal.status\"\n      :current-stage=\"proposal.status\"\n      :installments=\"paymentInstallments\"\n      class=\"mb-6\"\n    />\n\n    <!-- Action Buttons -->\n    <div class=\"action-buttons mb-6 flex flex-wrap justify-end gap-3\">\n      <VaButton preset=\"secondary\" icon=\"print\" @click=\"printProposal\"> Print </VaButton>\n      <VaButton preset=\"secondary\" icon=\"download\" @click=\"downloadPdf\"> Download PDF </VaButton>\n      <VaButton color=\"primary\" icon=\"edit\" @click=\"$emit('edit', proposal)\"> Edit </VaButton>\n\n      <!-- Manual Cancel Button (only available before completion) -->\n      <VaButton v-if=\"canBeCancelled\" color=\"secondary\" icon=\"cancel\" @click=\"changeToStage('cancelled')\">\n        Cancel\n      </VaButton>\n    </div>\n\n    <!-- Sales Agent & Client Info -->\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n      <!-- Sales Agent -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"support_agent\" color=\"primary\" />\n          Sales Agent\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.sales_agent?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n\n      <!-- Client Info -->\n      <VaCard outlined>\n        <VaCardTitle class=\"flex items-center gap-2\">\n          <VaIcon name=\"person\" color=\"primary\" />\n          Client Information\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"info-row\">\n            <span class=\"label\">Name:</span>\n            <span class=\"value font-semibold\">{{ proposal.client?.full_name || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Address:</span>\n            <span class=\"value\">{{ proposal.client?.address || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Home Tel:</span>\n            <span class=\"value\">{{ proposal.client?.home_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Work Tel:</span>\n            <span class=\"value\">{{ proposal.client?.work_tel || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Cell:</span>\n            <span class=\"value\">{{ proposal.client?.cell || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Email:</span>\n            <span class=\"value\">{{ proposal.client?.email || 'N/A' }}</span>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </div>\n\n    <!-- Hunting Trip Details -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"landscape\" color=\"primary\" />\n        Hunting Trip Details\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Type of Safari:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.type || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting Area:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.hunting_area || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Outfitter:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.outfitter || 'Bushman Safari Trackers Limited' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Dates:</span>\n            <span class=\"value\">{{ proposal.hunting_trip?.dates || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Details of Trip -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"groups\" color=\"primary\" />\n        Details of Trip\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_hunters || 0 }}</div>\n            <div class=\"stat-label\">Hunters</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_observers || 0 }}</div>\n            <div class=\"stat-label\">Observers</div>\n          </div>\n          <div class=\"stat-card\">\n            <div class=\"stat-value\">{{ proposal.trip_details?.no_of_companions || 0 }}</div>\n            <div class=\"stat-label\">Companions</div>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Hunt Combination (Species) -->\n    <VaCard outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"pets\" color=\"primary\" />\n        Hunt Combination\n      </VaCardTitle>\n      <VaCardContent>\n        <VaDataTable :items=\"proposal.hunt_combination || []\" :columns=\"speciesColumns\" hoverable striped>\n          <template #cell(species_name)=\"{ rowData }\">\n            <div class=\"flex flex-col\">\n              <span class=\"font-semibold\">{{ rowData.species_name }}</span>\n              <span class=\"text-xs text-gray-500 italic\">{{ rowData.scientific_name }}</span>\n            </div>\n          </template>\n          <template #cell(quantity)=\"{ rowData }\">\n            <VaBadge :text=\"String(rowData.quantity)\" color=\"primary\" />\n          </template>\n        </VaDataTable>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Pricing / Payment Schedule -->\n    <PaymentTable\n      :installments=\"paymentInstallments\"\n      :summary=\"paymentSummary\"\n      :total-amount=\"proposal.pricing?.total_amount || 0\"\n      :loading=\"loadingPayments\"\n      :allow-unpay=\"true\"\n      @recordPayment=\"openPaymentModal\"\n      @unpay=\"handleUnpay\"\n    />\n\n    <!-- Sales Inquiry Reference -->\n    <VaCard outlined class=\"mb-6 bg-gray-50\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"link\" color=\"info\" />\n        Linked Sales Inquiry\n      </VaCardTitle>\n      <VaCardContent>\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div class=\"info-row\">\n            <span class=\"label\">Inquiry Code:</span>\n            <span class=\"value font-mono\">{{ proposal.sales_inquiry?.code || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Created Date:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.created_date || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Season:</span>\n            <span class=\"value\">{{ proposal.sales_inquiry?.season || 'N/A' }}</span>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">Hunting License:</span>\n            <span class=\"value\">{{ proposal.hunting_license || 'N/A' }}</span>\n          </div>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Remarks -->\n    <VaCard v-if=\"proposal.remarks\" outlined class=\"mb-6\">\n      <VaCardTitle class=\"flex items-center gap-2\">\n        <VaIcon name=\"notes\" color=\"primary\" />\n        Remarks\n      </VaCardTitle>\n      <VaCardContent>\n        <p class=\"text-gray-700\">{{ proposal.remarks }}</p>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Payment Modal -->\n    <PaymentModal\n      v-model=\"showPaymentModal\"\n      :installment=\"selectedInstallment\"\n      :loading=\"savingPayment\"\n      @submit=\"handlePaymentSubmit\"\n    />\n\n    <!-- Status Change Modal -->\n    <VaModal v-model=\"showStatusModal\" title=\"Change Proposal Status\" :hide-default-actions=\"true\">\n      <div class=\"p-4\">\n        <VaSelect v-model=\"newStatus\" :options=\"statusOptions\" label=\"Select New Status\" class=\"mb-4\" />\n        <div class=\"flex justify-end gap-3\">\n          <VaButton preset=\"secondary\" @click=\"showStatusModal = false\">Cancel</VaButton>\n          <VaButton color=\"primary\" @click=\"changeStatus\">Confirm</VaButton>\n        </div>\n      </div>\n    </VaModal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { mapState, mapActions } from 'pinia'\nimport { useSettingsStore } from '../../../../stores/settings-store'\nimport { useProposalStore } from '../../../../stores/proposal-store'\nimport StageIndicator from './StageIndicator.vue'\nimport PaymentTable from './PaymentTable.vue'\nimport PaymentModal from './PaymentModal.vue'\n\ninterface Installment {\n  id: number\n  narration: string\n  amount_due: number\n  amount_paid?: number\n  remaining_balance?: number\n  payment_status?: 'paid' | 'partial' | 'unpaid'\n  installment_type?: string\n  triggers_stage?: string | null\n  is_paid: boolean\n  paid_at?: string | null\n  payment_reference?: string | null\n  payments?: Array<{\n    id: number\n    amount: number\n    payment_reference: string | null\n    paid_at: string\n  }>\n}\n\nexport default defineComponent({\n  name: 'ProposalView',\n  components: {\n    StageIndicator,\n    PaymentTable,\n    PaymentModal,\n  },\n  props: {\n    proposal: {\n      type: Object as PropType<any>,\n      required: true,\n    },\n  },\n  emits: ['edit', 'status-change', 'payment-recorded'],\n  data() {\n    return {\n      showStatusModal: false,\n      showPaymentModal: false,\n      selectedInstallment: null as Installment | null,\n      newStatus: null as string | null,\n      loadingPayments: false,\n      savingPayment: false,\n      speciesColumns: [\n        { key: 'species_name', label: 'Species', sortable: true },\n        { key: 'quantity', label: 'Quantity', sortable: true, width: 120 },\n      ],\n      statusOptions: [\n        { value: 'pending', text: 'Pending' },\n        { value: 'provision_sales', text: 'Provisional Sale' },\n        { value: 'confirmed', text: 'Confirmed' },\n        { value: 'declined', text: 'Declined' },\n        { value: 'cancelled', text: 'Cancelled' },\n        { value: 'completed', text: 'Completed' },\n      ],\n    }\n  },\n  computed: {\n    ...mapState(useSettingsStore, ['logo']),\n    ...mapState(useProposalStore, ['paymentStatus']),\n\n    logoUrl(): string | null {\n      return this.logo || null\n    },\n\n    canBeCancelled(): boolean {\n      const status = this.proposal.status\n      return status === 'pending' || status === 'provision_sales' || status === 'confirmed'\n    },\n\n    paymentInstallments(): Installment[] {\n      // Use payment status from API if available, otherwise fall back to proposal installments\n      if (this.paymentStatus?.installments) {\n        return this.paymentStatus.installments\n      }\n      // Map proposal installments with default is_paid status\n      return (this.proposal.pricing?.installments || []).map((inst: any) => ({\n        ...inst,\n        is_paid: inst.is_paid || false,\n        paid_at: inst.paid_at || null,\n        amount_paid: inst.amount_paid || null,\n        payment_reference: inst.payment_reference || null,\n      }))\n    },\n\n    paymentSummary() {\n      if (this.paymentStatus?.summary) {\n        return this.paymentStatus.summary\n      }\n      // Calculate from installments\n      const installments = this.paymentInstallments\n      const total_due = installments.reduce((sum: number, i: Installment) => sum + (i.amount_due || 0), 0)\n      const total_paid = installments.reduce(\n        (sum: number, i: Installment) => sum + (i.is_paid ? i.amount_paid || i.amount_due : 0),\n        0,\n      )\n      const paid_count = installments.filter((i: Installment) => i.is_paid).length\n      return {\n        total_due,\n        total_paid,\n        total_unpaid: total_due - total_paid,\n        paid_count,\n        unpaid_count: installments.length - paid_count,\n      }\n    },\n  },\n  watch: {\n    'proposal.id': {\n      handler() {\n        this.loadPaymentStatus()\n      },\n    },\n  },\n  mounted() {\n    this.loadPaymentStatus()\n  },\n  methods: {\n    ...mapActions(useProposalStore, ['fetchPayments', 'recordPayment', 'unpayInstallment']),\n\n    async loadPaymentStatus() {\n      if (!this.proposal?.id) return\n      this.loadingPayments = true\n      try {\n        await this.fetchPayments(this.proposal.id)\n      } catch (error) {\n        console.error('Error loading payment status:', error)\n      } finally {\n        this.loadingPayments = false\n      }\n    },\n\n    formatDate(dateString: string | undefined): string {\n      if (!dateString) return 'N/A'\n      try {\n        return new Date(dateString).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n        })\n      } catch {\n        return dateString\n      }\n    },\n\n    formatCurrency(amount: number | undefined): string {\n      if (!amount) return '$0'\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(amount)\n    },\n\n    getStatusColor(status: string): string {\n      const colors: Record<string, string> = {\n        pending: 'warning',\n        provision_sales: 'info',\n        confirmed: 'success',\n        declined: 'danger',\n        cancelled: 'secondary',\n        completed: 'primary',\n      }\n      return colors[status] || 'secondary'\n    },\n\n    formatStatus(status: string): string {\n      if (!status) return 'N/A'\n      return status.replace(/_/g, ' ').replace(/\\b\\w/g, (c) => c.toUpperCase())\n    },\n\n    printProposal() {\n      window.print()\n    },\n\n    async downloadPdf() {\n      if (!this.proposal?.id) {\n        this.$vaToast?.init({\n          message: 'No proposal selected',\n          color: 'warning',\n        })\n        return\n      }\n\n      try {\n        this.$vaToast?.init({\n          message: 'Generating PDF...',\n          color: 'info',\n        })\n\n        const response = await fetch(\n          `${import.meta.env.VITE_APP_BASE_URL}sales-confirmation/proposals/${this.proposal.id}/pdf`,\n        )\n        const data = await response.json()\n\n        if (data.success) {\n          // Convert base64 to blob and download\n          const byteCharacters = atob(data.pdf)\n          const byteNumbers = new Array(byteCharacters.length)\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i)\n          }\n          const byteArray = new Uint8Array(byteNumbers)\n          const blob = new Blob([byteArray], { type: 'application/pdf' })\n\n          // Create download link\n          const url = window.URL.createObjectURL(blob)\n          const a = document.createElement('a')\n          a.href = url\n          a.download = `Sales_Confirmation_${data.client_name || this.proposal.client?.full_name || 'Proposal'}.pdf`\n          a.click()\n\n          // Clean up\n          window.URL.revokeObjectURL(url)\n\n          this.$vaToast?.init({\n            message: 'PDF downloaded successfully',\n            color: 'success',\n          })\n        } else {\n          this.$vaToast?.init({\n            message: data.message || 'Failed to generate PDF',\n            color: 'danger',\n          })\n        }\n      } catch (error) {\n        console.error('Error downloading PDF:', error)\n        this.$vaToast?.init({\n          message: 'Failed to download PDF',\n          color: 'danger',\n        })\n      }\n    },\n\n    confirmProposal() {\n      this.newStatus = 'confirmed'\n      this.showStatusModal = true\n    },\n\n    changeToStage(stage: string) {\n      this.$emit('status-change', {\n        id: this.proposal.id,\n        status: stage,\n      })\n    },\n\n    changeStatus() {\n      if (this.newStatus) {\n        this.$emit('status-change', {\n          id: this.proposal.id,\n          status: this.newStatus,\n        })\n        this.showStatusModal = false\n        this.newStatus = null\n      }\n    },\n\n    // Payment methods\n    openPaymentModal(installment: Installment) {\n      this.selectedInstallment = installment\n      this.showPaymentModal = true\n    },\n\n    async handlePaymentSubmit(payload: {\n      installment_id: number\n      amount_paid: number\n      payment_reference?: string\n      paid_at?: string\n    }) {\n      this.savingPayment = true\n      try {\n        const result = await this.recordPayment(payload.installment_id, {\n          amount_paid: payload.amount_paid,\n          payment_reference: payload.payment_reference,\n          paid_at: payload.paid_at,\n        })\n\n        this.showPaymentModal = false\n        this.selectedInstallment = null\n\n        // Build success message based on payment status\n        let message = 'Payment recorded successfully'\n        if (result.stage_changed) {\n          message = result.message || `Payment recorded. Stage updated to ${this.formatStatus(result.new_stage || '')}`\n        } else if (result.data?.payment_status === 'partial') {\n          const remaining = this.formatCurrency(result.data.remaining_balance)\n          message = `Partial payment recorded. Remaining balance: ${remaining}`\n        }\n\n        this.$vaToast?.init({\n          message,\n          color: 'success',\n        })\n\n        // Emit event for parent to refresh if needed\n        this.$emit('payment-recorded', result)\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to record payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n\n    async handleUnpay(installment: Installment) {\n      if (!confirm(`Are you sure you want to reverse the payment for \"${installment.narration}\"?`)) {\n        return\n      }\n\n      this.savingPayment = true\n      try {\n        await this.unpayInstallment(installment.id)\n\n        this.$vaToast?.init({\n          message: 'Payment reversed successfully',\n          color: 'success',\n        })\n\n        // Reload payment status\n        await this.loadPaymentStatus()\n      } catch (error: any) {\n        this.$vaToast?.init({\n          message: error.response?.data?.message || 'Failed to reverse payment',\n          color: 'danger',\n        })\n      } finally {\n        this.savingPayment = false\n      }\n    },\n  },\n})\n</script>\n\n<style scoped>\n.proposal-view {\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.proposal-header {\n  border-bottom: 2px solid #e5e7eb;\n  padding-bottom: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.info-row {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n\n.info-row .label {\n  color: #6b7280;\n  min-width: 100px;\n}\n\n.info-row .value {\n  color: #1f2937;\n}\n\n.stat-card {\n  background-color: #f3f4f6;\n  border-radius: 8px;\n  padding: 1.5rem;\n  text-align: center;\n}\n\n.stat-value {\n  font-size: 2rem;\n  font-weight: 700;\n  color: var(--va-primary);\n}\n\n.stat-label {\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.total-row {\n  background: linear-gradient(135deg, var(--va-primary), var(--va-primary-darken));\n}\n\n@media print {\n  .action-buttons {\n    display: none !important;\n  }\n\n  .proposal-view {\n    max-width: 100%;\n  }\n\n  :deep(.va-card) {\n    box-shadow: none !important;\n    border: 1px solid #e5e7eb !important;\n  }\n}\n</style>\n"],"names":["useProposalStore","defineStore","state","id","p","stage","seasonId","url","params","response","axios","error","inquiryId","newStage","payload","index","_a","status","proposalId","installmentId","paymentId","_sfc_main$3","defineComponent","s","i","type","narration","stageValue","installment","_hoisted_1","_hoisted_2","_hoisted_4","_hoisted_6","_hoisted_7","_openBlock","_createElementBlock","_createElementVNode","_Fragment","_renderList","_ctx","_normalizeClass","_normalizeStyle","_createBlock","_component_VaIcon","_hoisted_3","_toDisplayString","_createCommentVNode","_hoisted_5","_createVNode","_hoisted_8","_component_VaChip","_withCtx","_cache","_createTextVNode","_sfc_main$2","amount","dateString","_hoisted_10","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_19","_hoisted_20","_hoisted_21","_component_VaCard","_component_VaCardTitle","_component_VaCardContent","_component_VaProgressBar","_hoisted_9","_hoisted_11","_hoisted_15","_hoisted_16","_component_VaButton","$event","_hoisted_17","_hoisted_18","_hoisted_22","_sfc_main$1","_b","v","newVal","date","year","month","day","_component_VaModal","_c","_component_VaInput","_component_VaDateInput","_sfc_main","StageIndicator","PaymentTable","PaymentModal","mapState","useSettingsStore","inst","installments","total_due","sum","total_paid","paid_count","mapActions","c","data","byteCharacters","byteNumbers","byteArray","blob","a","_d","_e","_f","_g","result","message","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_component_StageIndicator","_component_VaDataTable","rowData","_component_VaBadge","_component_PaymentTable","_component_PaymentModal","_component_VaSelect"],"mappings":"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"}