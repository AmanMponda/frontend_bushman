import{d as A,_ as P,g as b,e as s,x as h,h as a,t as i,o as d,m as $,s as R,v as E,a as g,w as p,b as l,i as n,l as j,F as G}from"./index-Ck95g1n5.js";import{u as D}from"./contracts-store-D8waIcRx.js";import{d as z}from"./pdfDownloader-DiRJnS-k.js";import{f as L}from"./utils-BWc0LXoO.js";import{u as Q}from"./useForm-D15ipaqT.js";import{u as H}from"./useToast-B3kBqZQd.js";import{u as J}from"./sales-store-B7SEdOKN.js";import{h as K}from"./errorHandler-BXe9Gc4p.js";import{u as M}from"./regulatrory-store-CZlZVJ4m.js";import"./format-Cn4G_mmc.js";const W=A({props:{item:{type:Object,required:!0}},setup(){return{formatDateTime:L}}}),X={class:"contract-permit-details"},Y={class:"permit-info"},Z={class:"info-item"},x={class:"info-item"},tt={class:"info-item"},et={class:"info-item"},ot={class:"info-item"},st={key:0,class:"dates-info"},at={class:"info-item"},nt={class:"info-item"},rt={key:1,class:"client-info"},it={class:"info-item"},lt={class:"info-item"},dt={class:"info-item"},mt={key:2,class:"price-breakdown"};function ut(t,e,f,y,_,v){var r,c,m,u,k,V,C,o,w,F,N,S,I,B,q,T,O,U;return d(),b("div",X,[e[15]||(e[15]=s("h1",{class:"permit-title"},"Contract Permit Details",-1)),s("div",Y,[s("div",Z,[e[0]||(e[0]=s("strong",null,"Permit Number:",-1)),a(" "+i(((r=t.item)==null?void 0:r.permit_number)??"N/A"),1)]),s("div",x,[e[1]||(e[1]=s("strong",null,"Issued Date:",-1)),a(" "+i(t.formatDateTime((c=t.item)==null?void 0:c.issued_date)??"N/A"),1)]),s("div",tt,[e[2]||(e[2]=s("strong",null,"Description:",-1)),a(" "+i(((m=t.item)==null?void 0:m.description)??"N/A"),1)]),s("div",et,[e[3]||(e[3]=s("strong",null,"Created At:",-1)),a(" "+i(t.formatDateTime((u=t.item)==null?void 0:u.created_at)??"N/A"),1)]),s("div",ot,[e[4]||(e[4]=s("strong",null,"Updated At:",-1)),a(" "+i(t.formatDateTime((k=t.item)==null?void 0:k.updated_at)??"N/A"),1)])]),((C=(V=t.item)==null?void 0:V.dates)==null?void 0:C.length)>0?(d(),b("section",st,[e[7]||(e[7]=s("h2",null,"Contract Dates",-1)),s("div",at,[e[5]||(e[5]=s("strong",null,"Start Date:",-1)),a(" "+i(t.formatDateTime((o=t.item.dates[0])==null?void 0:o.start_date)??"N/A"),1)]),s("div",nt,[e[6]||(e[6]=s("strong",null,"End Date:",-1)),a(" "+i(t.formatDateTime((w=t.item.dates[0])==null?void 0:w.end_date)??"N/A"),1)])])):h("",!0),(N=(F=t.item)==null?void 0:F.entity_contract)!=null&&N.entity?(d(),b("section",rt,[e[11]||(e[11]=s("h2",null,"Client Information",-1)),s("div",it,[e[8]||(e[8]=s("strong",null,"Full Name:",-1)),a(" "+i(t.item.entity_contract.entity.full_name??"N/A"),1)]),s("div",lt,[e[9]||(e[9]=s("strong",null,"Country:",-1)),a(" "+i(((S=t.item.entity_contract.entity.country)==null?void 0:S.name)??"N/A"),1)]),s("div",dt,[e[10]||(e[10]=s("strong",null,"Email:",-1)),a(" "+i(((B=(I=t.item.entity_contract.entity.contacts)==null?void 0:I[0])==null?void 0:B.contact)??"N/A"),1)])])):h("",!0),(T=(q=t.item)==null?void 0:q.entity_contract)!=null&&T.price_break_down?(d(),b("section",mt,[e[14]||(e[14]=s("h2",null,"Price Breakdown",-1)),s("div",null,[e[12]||(e[12]=s("strong",null,"Total Amount:",-1)),a(" "+i((O=t.item.entity_contract.price_break_down.total_amount.currency)==null?void 0:O.symbol)+i(t.item.entity_contract.price_break_down.total_amount.amount??"N/A"),1)]),s("div",null,[e[13]||(e[13]=s("strong",null,"Number of Companions:",-1)),a(" "+i(((U=t.item.entity_contract.price_break_down.companion_cost_details)==null?void 0:U.number_of_companions)??"N/A"),1)])])):h("",!0)])}const pt=P(W,[["render",ut],["__scopeId","data-v-a06ee2e4"]]),ct=A({setup(){const{init:t}=H(),e=R(null),{isValid:f,validate:y,resetValidation:_,reset:v}=Q(e),r=R(!0),c=u=>{console.log(u),(u.value=="prior"||u.value=="after")&&(r.value=!1)},m=E({enity_contract:null,permit_number:"",issued_date:null,package_type:null,description:"",start_date:null,end_date:null});return{iformRef:e,isValidForm:f,validateForm:y,resetValidationForm:_,resetForm:v,form:m,init:t,onInputChange:c,isNotUpBookingSelected:r}},data(){return{packages:[],installments:[],regulatoryPackages:[],proposalOptions:[],loadingContracts:!1,salesItem:null,packageOptions:[]}},computed:{},mounted(){this.getContractsOptions(),this.getRegulatoryPackagesOptions()},methods:{...$(D,["getContracts","createPermit"]),...$(J,["getallSalesConfirmation"]),...$(M,["getRegulatoryPackages"]),onValueChange(t){console.log(t),this.form.package_type={value:t.regulatoryPackages.id,text:t.regulatoryPackages.name}},async onSubmit(){const t={entity_contract_id:this.form.enity_contract.value,permit_number:this.form.permit_number,issued_date:this.form.issued_date,package_type:this.form.package_type.value,description:this.form.description,start_date:this.form.start_date,end_date:this.form.end_date};console.log(t);try{(await this.createPermit(t)).status===201&&this.init({message:"Contract created successfully",color:"success"})}catch(e){const f=K(e.response);this.init({message:`
`+f.map((y,_)=>`${_+1}. ${y}`).join(`
`),color:"danger"})}},async getContractsOptions(){this.loadingContracts=!0;const t=await this.getContracts();t.status===200?(this.loadingContracts=!1,this.proposalOptions=t.data.map(e=>({text:`sales contract for ${e.sales_confirmation_proposal.sales_inquiry.entity.full_name}-${e.contract_number}`,value:e.id,regulatoryPackages:e.sales_confirmation_proposal.regulatory_package}))):this.loadingContracts=!1},async getRegulatoryPackagesOptions(){const t=await this.getRegulatoryPackages();t.status===200&&(this.regulatoryPackages=t.data.map(e=>({text:e.name,value:e.id})),this.packageOptions=this.regulatoryPackages)}}}),gt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ft={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},yt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},_t={class:"grid grid-cols-1 md:grid-cols-1 gap-4 mb-4"},kt={class:"flex justify-end"};function Vt(t,e,f,y,_,v){const r=n("VaSelect"),c=n("VaInput"),m=n("VaDateInput"),u=n("VaTextarea"),k=n("VaButton"),V=n("VaForm"),C=n("VaInnerLoading");return d(),g(C,{loading:t.loadingContracts},{default:p(()=>[l(V,{ref:"iformRef"},{default:p(()=>[s("div",gt,[l(r,{modelValue:t.form.enity_contract,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.form.enity_contract=o),t.onValueChange],options:t.proposalOptions,rules:[o=>o||"Contract is required"],placeholder:"Select contract",label:"Choose contract"},null,8,["modelValue","options","rules","onUpdate:modelValue"]),l(r,{modelValue:t.form.package_type,"onUpdate:modelValue":e[1]||(e[1]=o=>t.form.package_type=o),options:t.packageOptions,rules:[o=>o||"Package type is required"],placeholder:"Select package type",label:"Choose package type"},null,8,["modelValue","options","rules"])]),s("div",ft,[l(c,{modelValue:t.form.permit_number,"onUpdate:modelValue":e[2]||(e[2]=o=>t.form.permit_number=o),type:"text",placeholder:"Enter permit number",rules:[o=>o&&o.length>0||" Permit number is required"],label:"Permit Number"},null,8,["modelValue","rules"]),l(m,{modelValue:t.form.issued_date,"onUpdate:modelValue":e[3]||(e[3]=o=>t.form.issued_date=o),placeholder:"Choose issued date",rules:[o=>o||"Issued date is required"],label:"Issued Date"},null,8,["modelValue","rules"])]),s("div",yt,[l(m,{modelValue:t.form.start_date,"onUpdate:modelValue":e[4]||(e[4]=o=>t.form.start_date=o),placeholder:"Choose start date",rules:[o=>o||"Start date is required"],label:"Start Date"},null,8,["modelValue","rules"]),l(m,{modelValue:t.form.end_date,"onUpdate:modelValue":e[5]||(e[5]=o=>t.form.end_date=o),placeholder:"Choose enddate",rules:[o=>o||"End Date is required"],label:"End Date"},null,8,["modelValue","rules"])]),s("div",_t,[l(u,{modelValue:t.form.description,"onUpdate:modelValue":e[6]||(e[6]=o=>t.form.description=o),"max-length":"125",label:"Short text about something",counter:"","required-mark":"",rules:[o=>o&&o.length>0||"Required",o=>o&&o.length<125]},null,8,["modelValue","rules"])]),s("div",kt,[l(k,{disabled:!t.isValidForm,onClick:e[7]||(e[7]=o=>t.validateForm()&&t.onSubmit())},{default:p(()=>e[8]||(e[8]=[a("Submit")])),_:1},8,["disabled"])])]),_:1},512)]),_:1},8,["loading"])}const Ct=P(ct,[["render",Vt],["__scopeId","data-v-66615585"]]),bt=A({components:{ContractDetails:pt,ContractForm:Ct},data(){return{columns:[{key:"permit_number",sortable:!0},{key:"issued_date",sortable:!0},{key:"start_date",sortable:!0},{key:"expiry_date",sortable:!0},{key:"actions",label:"Actions"}],downloadPdf:z,item:null,showDetails:!1,showAddForm:!1}},computed:{...j(D,["permits","loadingPermits"])},mounted(){this.getContractPermits()},methods:{...$(D,["getContractPermits"]),viewContract(t){this.item=t,this.showDetails=!0,this.showAddForm=!1},gotBack(){this.getContractPermits(),this.showDetails=!1,this.showAddForm=!1},toggleAddSalesInquiriesForm(){this.showDetails=!1,this.showAddForm=!this.showAddForm}}}),ht={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between px-4 py-2"},vt={class:"flex flex-col md:flex-row gap-2 justify-start"};function wt(t,e,f,y,_,v){const r=n("VaButton"),c=n("VaButtonGroup"),m=n("VaDataTable"),u=n("ContractForm"),k=n("ContractDetails"),V=n("VaCardContent"),C=n("VaCard");return d(),g(C,null,{default:p(()=>[l(V,null,{default:p(()=>[s("div",ht,[s("div",vt,[t.showDetails||t.showAddForm?(d(),g(r,{key:0,class:"px-2 py-2",icon:"arrow_back",size:"small",onClick:e[0]||(e[0]=o=>t.gotBack())},{default:p(()=>e[2]||(e[2]=[a(" Go Back ")])),_:1})):h("",!0)]),!t.showAddForm&&!t.showDetails?(d(),g(c,{key:0},{default:p(()=>[l(r,{class:"px-2 py-2",color:"primary",label:"Add New Quota",round:"",present:"secondary","border-color":"primary",icon:"add",size:"small",onClick:e[1]||(e[1]=o=>t.toggleAddSalesInquiriesForm())},{default:p(()=>e[3]||(e[3]=[a("Add add Permit")])),_:1})]),_:1})):h("",!0)]),t.showDetails?(d(),g(k,{key:1,item:t.item},null,8,["item"])):(d(),b(G,{key:0},[t.showAddForm?(d(),g(u,{key:1})):(d(),g(m,{key:0,items:t.permits,columns:t.columns,loading:t.loadingPermits},{"cell(actions)":p(({rowData:o})=>[l(r,{preset:"plain",icon:"download",onClick:w=>t.downloadPdf(o.pdf)},null,8,["onClick"]),l(r,{preset:"plain",icon:"visibility",onClick:w=>t.viewContract(o.selfitem)},null,8,["onClick"])]),_:1},8,["items","columns","loading"]))],64))]),_:1})]),_:1})}const Tt=P(bt,[["render",wt]]);export{Tt as default};
//# sourceMappingURL=SalesContractPermit-B3VAYGEJ.js.map
