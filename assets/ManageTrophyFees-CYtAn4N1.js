import{j as L,k as b,d as O,m as k,B as $,s as M,_ as I,a as f,w as o,e as l,g as v,v as g,t as T,i as p,h,b as t,o as d}from"./index-P4QeRV7n.js";import{u as j}from"./useForm-XQT-jLAz.js";import{u as B}from"./useToast-DVuIP6Z-.js";import{h as w}from"./errorHandler-DijQ3xmc.js";import{M as U}from"./ModuleTable-B_AuVaDZ.js";import{u as N}from"./quota-store-Bck9cnCu.js";import{u as z}from"./settings-store-BoS8g_yz.js";const D=L("trophyFees",{state:()=>({trophyFees:[],loading:!1}),actions:{async fetchTrophyFees(e={}){this.loading=!0;const r={method:"get",url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/",params:e,headers:{"Content-Type":"application/json"}};try{const a=await b.request(r);return this.trophyFees=a.data.data||a.data,a}finally{this.loading=!1}},async getTrophyFeeById(e){const r={method:"get",url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/${e}/`,headers:{"Content-Type":"application/json"}};return await b.request(r)},async createTrophyFee(e){const r={method:"post",url:"https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/",data:e,headers:{"Content-Type":"application/json"}};return await b.request(r)},async updateTrophyFee(e,s){const a={method:"put",url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/${e}/`,data:s,headers:{"Content-Type":"application/json"}};return await b.request(a)},async deleteTrophyFeeById(e){const r={method:"delete",url:`https://backend-bushman-master-kxhmlj.laravel.cloud/api/v1.0/settings/trophy-fees/${e}/`,headers:{"Content-Type":"application/json"}};return await b.request(r)}}}),E=O({name:"ManageTrophyFeesPage",components:{ModuleTable:U},setup(){const e=M(null),{isValid:s,validate:r,resetValidation:a,reset:y}=j(e);return{isValidTrophyFeeForm:s,validateTrophyFeeForm:r,resetValidationTrophyFeeForm:a,resetTrophyFeeForm:y,trophyFeeFormRef:e,columns:[{key:"id",label:"ID",sortable:!0,width:80},{key:"species_name",label:"Species Name",sortable:!0},{key:"area_name",label:"Hunting Area",sortable:!0},{key:"season_name",label:"Season",sortable:!0},{key:"sequence_order",label:"Sequence",sortable:!0,width:100},{key:"amount",label:"Amount",sortable:!0,width:130},{key:"actions",label:"Actions",width:120}]}},data(){const e=[],s=$({id:null,species:null,area:null,season:null,currency:null,sequence_order:1,amount:null});return{items:e,trophyFeeForm:s,showTrophyFeesList:!0,loading:!1,saving:!1,editMode:!1,toast:B(),speciesOptions:[],areaOptions:[],seasonOptions:[],currencyOptions:[],selectedSpecies:null,selectedArea:null,selectedSeason:null}},computed:{uniqueSpeciesCount(){return new Set(this.items.map(s=>{var r;return(r=s._raw)==null?void 0:r.species_id})).size},uniqueAreasCount(){return new Set(this.items.map(s=>{var r;return(r=s._raw)==null?void 0:r.area_id})).size}},mounted(){this.getTrophyFees(),this.loadSpecies(),this.loadAreas(),this.loadSeasons(),this.loadCurrencies()},methods:{...k(D,["fetchTrophyFees","createTrophyFee","updateTrophyFee","deleteTrophyFeeById"]),...k(N,["getSpeciesList","getAreaList"]),...k(z,["getSeasons","getCurrencies"]),async getTrophyFees(){this.loading=!0;try{const e={};this.selectedSpecies&&(e.species_id=this.selectedSpecies.value),this.selectedArea&&(e.area_id=this.selectedArea.value),this.selectedSeason&&(e.season_id=this.selectedSeason.value);const s=await this.fetchTrophyFees(e);if(s.status===200){const r=s.data.data||s.data;this.items=r.map(a=>{var y,V,u,i;return{id:a.id,species_name:((y=a.species)==null?void 0:y.name)||"N/A",area_name:((V=a.area)==null?void 0:V.name)||"N/A",season_name:((u=a.season)==null?void 0:u.name)||"N/A",sequence_order:this.getSequenceLabel(a.sequence_order),amount:`${((i=a.currency)==null?void 0:i.symbol)||"$"}${parseFloat(a.amount).toFixed(2)}`,_raw:a}})}}catch(e){w(e),this.toast.init({message:"Failed to load trophy fees",color:"danger"})}finally{this.loading=!1}},async loadSpecies(){try{const e=await this.getSpeciesList();this.speciesOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Failed to load species",e)}},async loadAreas(){try{const e=await this.getAreaList();this.areaOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Failed to load areas",e)}},clearFilters(){this.selectedSpecies=null,this.selectedArea=null,this.selectedSeason=null,this.getTrophyFees()},getSequenceLabel(e){const s=["th","st","nd","rd"],r=e%100;return e+(s[(r-20)%10]||s[r]||s[0])},async loadSeasons(){try{const e=await this.getSeasons();this.seasonOptions=e.data.map(s=>({value:s.id,text:s.name}))}catch(e){console.error("Failed to load seasons",e)}},async loadCurrencies(){try{const e=await this.getCurrencies();this.currencyOptions=e.data.map(s=>({value:s.id,text:s.name,symbol:s.symbol}))}catch(e){console.error("Failed to load currencies",e)}},toggleFormAndList(){this.showTrophyFeesList=!this.showTrophyFeesList,this.showTrophyFeesList&&this.resetForm()},editTrophyFee(e){this.editMode=!0,this.showTrophyFeesList=!1;const s=e._raw;this.trophyFeeForm.id=s.id,this.trophyFeeForm.species=this.speciesOptions.find(r=>{var a;return r.value===s.species_id||r.value===((a=s.species)==null?void 0:a.id)}),this.trophyFeeForm.area=this.areaOptions.find(r=>{var a;return r.value===s.area_id||r.value===((a=s.area)==null?void 0:a.id)}),this.trophyFeeForm.season=this.seasonOptions.find(r=>{var a;return r.value===s.season_id||r.value===((a=s.season)==null?void 0:a.id)}),this.trophyFeeForm.currency=this.currencyOptions.find(r=>{var a;return r.value===s.currency_id||r.value===((a=s.currency)==null?void 0:a.id)}),this.trophyFeeForm.sequence_order=s.sequence_order,this.trophyFeeForm.amount=s.amount},async saveTrophyFee(){this.saving=!0;try{const e={species_id:this.trophyFeeForm.species.value,area_id:this.trophyFeeForm.area.value,season_id:this.trophyFeeForm.season.value,currency_id:this.trophyFeeForm.currency.value,sequence_order:this.trophyFeeForm.sequence_order,amount:this.trophyFeeForm.amount};let s;this.editMode?s=await this.updateTrophyFee(this.trophyFeeForm.id,e):s=await this.createTrophyFee(e),(s.status===200||s.status===201)&&(this.toast.init({message:this.editMode?"Trophy fee updated successfully":"Trophy fee created successfully",color:"success"}),this.toggleFormAndList(),this.getTrophyFees())}catch(e){w(e),this.toast.init({message:"Failed to save trophy fee",color:"danger"})}finally{this.saving=!1}},async deleteTrophyFee(e){if(confirm("Are you sure you want to delete this trophy fee?"))try{const s=await this.deleteTrophyFeeById(e.id);(s.status===200||s.status===204)&&(this.toast.init({message:"Trophy fee deleted successfully",color:"success"}),this.getTrophyFees())}catch(s){w(s),this.toast.init({message:"Failed to delete trophy fee",color:"danger"})}},cancelEdit(){this.resetForm(),this.toggleFormAndList()},resetForm(){this.editMode=!1,this.trophyFeeForm.id=null,this.trophyFeeForm.species=null,this.trophyFeeForm.area=null,this.trophyFeeForm.season=null,this.trophyFeeForm.currency=null,this.trophyFeeForm.sequence_order=1,this.trophyFeeForm.amount=null,this.resetValidationTrophyFeeForm()}}}),H={class:"flex flex-col md:flex-row gap-4 mb-6 justify-between items-center"},P={key:0,class:"text-2xl font-semibold"},R={key:1,class:"text-2xl font-semibold"},Q={key:2,class:"text-secondary text-sm mt-1"},G={class:"flex gap-2"},J={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},K={class:"text-2xl font-bold"},W={class:"text-2xl font-bold"},X={class:"text-2xl font-bold"},Y={class:"flex items-center gap-2 mb-3"},Z={class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4"},x={class:"flex items-end"},ee={key:2},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"flex gap-3 justify-end"};function ae(e,s,r,a,y,V){const u=p("VaButton"),i=p("VaIcon"),m=p("VaCardContent"),c=p("VaCard"),F=p("VaSelect"),q=p("ModuleTable"),S=p("VaCardTitle"),A=p("VaPopover"),_=p("VaInput"),C=p("VaForm");return d(),f(c,{class:"p-6"},{default:o(()=>[l("div",H,[l("div",null,[e.showTrophyFeesList?(d(),v("h2",P,"Trophy Fees Management")):(d(),v("h2",R,T(e.editMode?"Edit Trophy Fee":"Add New Trophy Fee"),1)),e.showTrophyFeesList?(d(),v("p",Q," Manage trophy fees for different species and hunting areas ")):g("",!0)]),l("div",G,[e.showTrophyFeesList?g("",!0):(d(),f(u,{key:0,icon:"arrow_back",preset:"secondary",onClick:s[0]||(s[0]=n=>e.toggleFormAndList())},{default:o(()=>s[11]||(s[11]=[h(" Back to List ")])),_:1})),e.showTrophyFeesList?(d(),f(u,{key:1,color:"primary",icon:"add",onClick:s[1]||(s[1]=n=>e.toggleFormAndList())},{default:o(()=>s[12]||(s[12]=[h(" Add Trophy Fee ")])),_:1})):g("",!0)])]),e.showTrophyFeesList&&!e.loading?(d(),v("div",J,[t(c,{stripe:""},{default:o(()=>[t(m,{class:"flex items-center gap-4"},{default:o(()=>[t(i,{name:"military_tech",size:"large",color:"primary"}),l("div",null,[l("div",K,T(e.items.length),1),s[13]||(s[13]=l("div",{class:"text-sm text-secondary"},"Total Trophy Fees",-1))])]),_:1})]),_:1}),t(c,{stripe:""},{default:o(()=>[t(m,{class:"flex items-center gap-4"},{default:o(()=>[t(i,{name:"pets",size:"large",color:"success"}),l("div",null,[l("div",W,T(e.uniqueSpeciesCount),1),s[14]||(s[14]=l("div",{class:"text-sm text-secondary"},"Unique Species",-1))])]),_:1})]),_:1}),t(c,{stripe:""},{default:o(()=>[t(m,{class:"flex items-center gap-4"},{default:o(()=>[t(i,{name:"location_on",size:"large",color:"warning"}),l("div",null,[l("div",X,T(e.uniqueAreasCount),1),s[15]||(s[15]=l("div",{class:"text-sm text-secondary"},"Hunting Areas",-1))])]),_:1})]),_:1})])):g("",!0),e.showTrophyFeesList?(d(),f(q,{key:1,items:e.items,columns:e.columns,loading:e.loading,onOnView:e.editTrophyFee,onOnDelete:e.deleteTrophyFee},{"filter-elements-and-download-btn":o(()=>[t(c,{stripe:"","stripe-color":"primary",class:"mb-4"},{default:o(()=>[t(m,null,{default:o(()=>[l("div",Y,[t(i,{name:"filter_list"}),s[16]||(s[16]=l("span",{class:"font-semibold"},"Filter Trophy Fees",-1))]),l("div",Z,[t(F,{modelValue:e.selectedSpecies,"onUpdate:modelValue":[s[2]||(s[2]=n=>e.selectedSpecies=n),e.getTrophyFees],options:e.speciesOptions,label:"Filter by Species",placeholder:"All Species",clearable:"",searchable:""},{prepend:o(()=>[t(i,{name:"pets",size:"small"})]),_:1},8,["modelValue","options","onUpdate:modelValue"]),t(F,{modelValue:e.selectedArea,"onUpdate:modelValue":[s[3]||(s[3]=n=>e.selectedArea=n),e.getTrophyFees],options:e.areaOptions,label:"Filter by Hunting Area",placeholder:"All Areas",clearable:"",searchable:""},{prepend:o(()=>[t(i,{name:"location_on",size:"small"})]),_:1},8,["modelValue","options","onUpdate:modelValue"]),l("div",x,[e.selectedSpecies||e.selectedArea?(d(),f(u,{key:0,preset:"plain",icon:"clear",onClick:e.clearFilters},{default:o(()=>s[17]||(s[17]=[h(" Clear Filters ")])),_:1},8,["onClick"])):g("",!0)])])]),_:1})]),_:1})]),_:1},8,["items","columns","loading","onOnView","onOnDelete"])):(d(),v("div",ee,[t(C,{ref:"trophyFeeFormRef"},{default:o(()=>[t(c,{stripe:"","stripe-color":"primary",class:"mb-4"},{default:o(()=>[t(S,null,{default:o(()=>s[18]||(s[18]=[h("Species & Area Information")])),_:1}),t(m,null,{default:o(()=>[l("div",se,[t(F,{modelValue:e.trophyFeeForm.species,"onUpdate:modelValue":s[4]||(s[4]=n=>e.trophyFeeForm.species=n),options:e.speciesOptions,label:"Species",placeholder:"Select a species",rules:[n=>!!n||"Species is required"],searchable:"","highlight-matched-text":"","required-mark":""},{prepend:o(()=>[t(i,{name:"pets"})]),_:1},8,["modelValue","options","rules"]),t(F,{modelValue:e.trophyFeeForm.area,"onUpdate:modelValue":s[5]||(s[5]=n=>e.trophyFeeForm.area=n),options:e.areaOptions,label:"Hunting Area",placeholder:"Select a hunting area",rules:[n=>!!n||"Hunting area is required"],searchable:"","highlight-matched-text":"","required-mark":""},{prepend:o(()=>[t(i,{name:"location_on"})]),_:1},8,["modelValue","options","rules"])])]),_:1})]),_:1}),t(c,{stripe:"","stripe-color":"success",class:"mb-4"},{default:o(()=>[t(S,null,{default:o(()=>s[19]||(s[19]=[h("Season & Currency")])),_:1}),t(m,null,{default:o(()=>[l("div",te,[t(F,{modelValue:e.trophyFeeForm.season,"onUpdate:modelValue":s[6]||(s[6]=n=>e.trophyFeeForm.season=n),options:e.seasonOptions,label:"Season",placeholder:"Select a season",rules:[n=>!!n||"Season is required"],searchable:"","highlight-matched-text":"","required-mark":""},{prepend:o(()=>[t(i,{name:"date_range"})]),_:1},8,["modelValue","options","rules"]),t(F,{modelValue:e.trophyFeeForm.currency,"onUpdate:modelValue":s[7]||(s[7]=n=>e.trophyFeeForm.currency=n),options:e.currencyOptions,label:"Currency",placeholder:"Select a currency",rules:[n=>!!n||"Currency is required"],searchable:"","highlight-matched-text":"","required-mark":""},{prepend:o(()=>[t(i,{name:"payments"})]),_:1},8,["modelValue","options","rules"])])]),_:1})]),_:1}),t(c,{stripe:"","stripe-color":"info",class:"mb-4"},{default:o(()=>[t(S,null,{default:o(()=>s[20]||(s[20]=[h("Pricing Details")])),_:1}),t(m,null,{default:o(()=>[l("div",oe,[t(_,{modelValue:e.trophyFeeForm.sequence_order,"onUpdate:modelValue":s[8]||(s[8]=n=>e.trophyFeeForm.sequence_order=n),label:"Sequence Order",type:"number",min:"1",placeholder:"Enter sequence number",rules:[n=>n>0||"Sequence must be greater than 0"],"required-mark":""},{prepend:o(()=>[t(i,{name:"format_list_numbered"})]),appendInner:o(()=>[t(A,{message:"Sequence order represents the trophy number (1st, 2nd, 3rd, etc.). Different sequences can have different prices for the same species.",placement:"top"},{default:o(()=>[t(i,{name:"info",size:"small",color:"info"})]),_:1})]),_:1},8,["modelValue","rules"]),t(_,{modelValue:e.trophyFeeForm.amount,"onUpdate:modelValue":s[9]||(s[9]=n=>e.trophyFeeForm.amount=n),label:"Amount",type:"number",step:"0.01",min:"0",placeholder:"0.00",rules:[n=>n>0||"Amount must be greater than 0"],"required-mark":""},{prepend:o(()=>[t(i,{name:"attach_money"})]),_:1},8,["modelValue","rules"])])]),_:1})]),_:1}),l("div",re,[e.editMode?(d(),f(u,{key:0,preset:"secondary",icon:"close",onClick:e.cancelEdit},{default:o(()=>s[21]||(s[21]=[h(" Cancel ")])),_:1},8,["onClick"])):g("",!0),t(u,{disabled:!e.isValidTrophyFeeForm,color:"primary",icon:"save",loading:e.saving,onClick:s[10]||(s[10]=n=>e.validateTrophyFeeForm()&&e.saveTrophyFee())},{default:o(()=>[h(T(e.editMode?"Update Trophy Fee":"Save Trophy Fee"),1)]),_:1},8,["disabled","loading"])])]),_:1},512)]))]),_:1})}const he=I(E,[["render",ae]]);export{he as default};
//# sourceMappingURL=ManageTrophyFees-CYtAn4N1.js.map
