{"version":3,"file":"quota-store-Bck9cnCu.js","sources":["../../src/stores/quota-store.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport axios from 'axios'\n// import { format } from 'date-fns'\n\n// Define types\ninterface QuotaParams {\n  quota_id?: string | number | null\n  area_id?: string | number | null\n  species_id?: string | number | null\n}\n\nexport const useQuotaStore = defineStore('quota', {\n  state: () => {\n    return {\n      quotas: [] as any,\n    }\n  },\n\n  actions: {\n    generateQuotaYear(startDate: any, endDate: any) {\n      const startYear = new Date(startDate).getFullYear()\n      const nextYear = new Date(endDate).getFullYear()\n      const quotaYear = `${startYear}/${nextYear}`\n\n      return quotaYear\n    },\n\n    async getQuotas(id: any = null) {\n      let url = import.meta.env.VITE_APP_BASE_URL + 'sales/sales-quotas'\n\n      // If ID is provided, use path parameter for single item\n      if (id !== null && id !== undefined) {\n        url += `/${id}`\n      }\n\n      console.log('GET URL:', url)\n\n      const config = {\n        method: 'get',\n        url: url,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      }\n\n      try {\n        const response = await axios.request(config)\n        if (response.status === 200) {\n          // Handle response format\n          if (id) {\n            // Single item response\n            this.quotas = [response.data.data]\n          } else {\n            // List response\n            this.quotas = response.data.data\n          }\n        }\n        return response\n      } catch (error) {\n        console.error('Error getting quotas:', error)\n        throw error\n      }\n    },\n\n    async createQuota(quota: any) {\n      const url = import.meta.env.VITE_APP_BASE_URL + import.meta.env.VITE_APP_SALES_QUOTAS_URL\n\n      // Helper function to safely format dates\n      const formatDateForApi = (date: any): string => {\n        if (!date) return ''\n\n        // If it's already a string in YYYY-MM-DD format\n        if (typeof date === 'string') {\n          // Check if already in correct format\n          if (date.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n            return date\n          }\n\n          // Try to parse and format\n          try {\n            const parsedDate = new Date(date)\n            if (!isNaN(parsedDate.getTime())) {\n              return parsedDate.toISOString().split('T')[0]\n            }\n          } catch (e) {\n            console.error('Date parsing error:', e)\n          }\n\n          return date // Return as-is if can't parse\n        }\n\n        // If it's a Date object\n        if (date instanceof Date) {\n          return date.toISOString().split('T')[0]\n        }\n\n        // For any other type, try to convert to string\n        try {\n          const str = String(date)\n          // Try to parse it\n          const parsedDate = new Date(str)\n          if (!isNaN(parsedDate.getTime())) {\n            return parsedDate.toISOString().split('T')[0]\n          }\n          return str\n        } catch (e) {\n          return ''\n        }\n      }\n\n      const q_data = JSON.stringify({\n        name: quota.name,\n        description: quota.description || '',\n        start_date: formatDateForApi(quota.start_date),\n        end_date: formatDateForApi(quota.end_date),\n      })\n\n      console.log('Creating quota with data:', q_data)\n      console.log('Raw quota data received:', quota)\n\n      const config = {\n        method: 'post',\n        maxBodyLength: Infinity,\n        url: url,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        data: q_data,\n      }\n\n      try {\n        const response = await axios.request(config)\n        console.log('Create quota response:', response)\n\n        // Handle the response structure\n        if (response.status === 201) {\n          return {\n            status: response.status,\n            data: response.data,\n            message: response.data?.message || 'Quota created successfully',\n            success: true,\n          }\n        } else {\n          return {\n            status: response.status,\n            data: response.data,\n            message: response.data?.message || 'Request failed',\n            success: false,\n          }\n        }\n      } catch (error: any) {\n        console.error('Error in createQuota:', error)\n\n        // Return error in consistent format\n        return {\n          status: error.response?.status || 500,\n          data: error.response?.data || error,\n          message: error.response?.data?.message || error.message || 'Failed to create quota',\n          success: false,\n        }\n      }\n    },\n\n    async createQuotaAreaSpecies(request_data: any) {\n      const url = import.meta.env.VITE_APP_BASE_URL + import.meta.env.VITE_APP_SALES_QUOTAS_AREA_SPECIES_URL\n      const data = JSON.stringify({\n        quota_id: request_data.quota_id,\n        species_objects: request_data.speciesObjects,\n        quantity: request_data.quantity,\n        area_id: request_data.area_id,\n      })\n      const config = {\n        method: 'post',\n        maxBodyLength: Infinity,\n        url: url,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        data: data,\n      }\n\n      const response = await axios.request(config)\n      if (response.status === 201) {\n        return response\n      } else {\n        return response\n      }\n    },\n\n    async updateQuota(quota: any) {\n      // Use path parameter with PATCH method\n      const url = `${import.meta.env.VITE_APP_BASE_URL}sales/sales-quotas/${quota.id}`\n\n      console.log('Update URL (PATCH with path param):', url)\n\n      // Date formatting\n      const formatDateForApi = (date: any): string => {\n        if (!date) return ''\n\n        if (typeof date === 'string' && date.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n          return date\n        }\n\n        try {\n          const dateObj = new Date(date)\n          if (!isNaN(dateObj.getTime())) {\n            const year = dateObj.getFullYear()\n            const month = String(dateObj.getMonth() + 1).padStart(2, '0')\n            const day = String(dateObj.getDate()).padStart(2, '0')\n            return `${year}-${month}-${day}`\n          }\n        } catch (e) {\n          console.error('Date formatting error:', e)\n        }\n\n        return String(date || '')\n      }\n\n      const data = {\n        name: quota.name,\n        start_date: formatDateForApi(quota.start_date),\n        end_date: formatDateForApi(quota.end_date),\n        description: quota.description || '',\n      }\n\n      console.log('Update data:', data)\n\n      const config = {\n        method: 'patch', // Now using PATCH with path parameter\n        url: url,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        data: data,\n      }\n\n      try {\n        const response = await axios.request(config)\n        console.log('Update response:', response)\n        return response\n      } catch (error: any) {\n        console.error('Error in updateQuota:', error)\n        throw error\n      }\n    },\n\n    async deleteQuota(quota_id: any) {\n      // Use path parameter with DELETE method\n      const url = `${import.meta.env.VITE_APP_BASE_URL}sales/sales-quotas/${quota_id}`\n\n      console.log('Delete URL (DELETE with path param):', url)\n\n      const config = {\n        method: 'delete', // Now using DELETE with path parameter\n        url: url,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      }\n\n      try {\n        const response = await axios.request(config)\n        console.log('Delete response:', response)\n        return response\n      } catch (error) {\n        console.error('Delete quota error:', error)\n        throw error\n      }\n    },\n\n    // Fixed method with proper TypeScript types\n    async getAllSpeciesPerQuotaPerArea(quota_id: any, area_id: any, species_id: any) {\n      console.log('Params received:', { quota_id, area_id, species_id })\n\n      // Build URL without null/undefined values\n      let url = import.meta.env.VITE_APP_BASE_URL + import.meta.env.VITE_APP_SALES_QUOTAS_AREA_SPECIES_URL\n\n      // Create query parameters object with proper typing\n      const params: QuotaParams = {}\n\n      // Only add parameters if they have valid values\n      if (quota_id && quota_id !== 'null' && quota_id !== 'undefined') {\n        params.quota_id = quota_id\n      }\n\n      if (area_id && area_id !== 'null' && area_id !== 'undefined') {\n        params.area_id = area_id\n      }\n\n      if (species_id && species_id !== 'null' && species_id !== 'undefined') {\n        params.species_id = species_id\n      }\n\n      // If there are parameters, append them to URL\n      if (Object.keys(params).length > 0) {\n        const queryString = new URLSearchParams(params as Record<string, string>).toString()\n        url += '?' + queryString\n      }\n\n      console.log('Final URL:', url)\n\n      const config = {\n        method: 'get',\n        maxBodyLength: Infinity,\n        url: url,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      }\n\n      try {\n        const response = await axios.request(config)\n        console.log('API Response:', response.data)\n        return response\n      } catch (error) {\n        console.error('API Error:', error)\n        throw error\n      }\n    },\n\n    async getSpeciesList() {\n      const config = {\n        method: 'get',\n        maxBodyLength: Infinity,\n        url: import.meta.env.VITE_APP_BASE_URL + import.meta.env.VITE_APP_SPECIES_URL,\n      }\n      const response = await axios.request(config)\n      if (response.status === 200) {\n        return response\n      } else {\n        return response\n      }\n    },\n\n    async getAreaList() {\n      const config = {\n        method: 'get',\n        maxBodyLength: Infinity,\n        url: import.meta.env.VITE_APP_BASE_URL + import.meta.env.VITE_APP_HUTING_AREAS_URL,\n      }\n\n      const response = await axios.request(config)\n      if (response.status === 200) {\n        return response\n      } else {\n        return response\n      }\n    },\n  },\n})\n"],"names":["useQuotaStore","defineStore","startDate","endDate","startYear","nextYear","id","url","config","response","axios","error","quota","formatDateForApi","date","parsedDate","e","str","q_data","_a","_b","_c","_d","_f","_e","request_data","data","dateObj","year","month","day","quota_id","area_id","species_id","params","queryString"],"mappings":"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"}